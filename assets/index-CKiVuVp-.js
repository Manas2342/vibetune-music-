var e=Object.getOwnPropertyNames;import{r as t,j as n,P as r,c as a,a as i,u as o,B as s,b as u,d as c,e as l,f as d,g as h,h as p,i as f,k as m,l as v,R as g,m as x,n as y,D as b,C as w,o as N,A as k,p as C,q as j,S,s as E,t as R,v as _,w as I,I as T,x as A,y as D,z as P,L as M,E as F,F as O,T as L,O as B,G as z,H as U,J as W,K as V,M as H,N as q,Q as G,U as K,V as $,W as X,X as Y,Y as Q,Z as J,_ as Z,$ as ee,a0 as te,a1 as ne,a2 as re,a3 as ae}from"./ui-De92VDop.js";import{c as ie,R as oe,A as se,C as ue,X as ce,Y as le,T as de,a as he}from"./charts-DqMTHiMC.js";import{_ as pe,r as fe,c as me}from"./three-DK1MnLQ5.js";import"./vendor-eVk5PToZ.js";var ve,ge,xe=(ve={"assets/index-CKiVuVp-.js"(e,ve){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();let ge=0;const xe=new Map,ye=e=>{if(xe.has(e))return;const t=setTimeout(()=>{xe.delete(e),Ne({type:"REMOVE_TOAST",toastId:e})},1e6);xe.set(e,t)},be=[];let we={toasts:[]};function Ne(e){we=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{const{toastId:n}=t;return n?ye(n):e.toasts.forEach(e=>{ye(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(we,e),be.forEach(e=>{e(we)})}function ke({...e}){const t=(ge=(ge+1)%Number.MAX_SAFE_INTEGER,ge.toString()),n=()=>Ne({type:"DISMISS_TOAST",toastId:t});return Ne({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||n()}}}),{id:t,dismiss:n,update:e=>Ne({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function Ce(){const[e,n]=t.useState(we);return t.useEffect(()=>(be.push(n),()=>{const e=be.indexOf(n);e>-1&&be.splice(e,1)}),[e]),{...e,toast:ke,dismiss:e=>Ne({type:"DISMISS_TOAST",toastId:e})}}var je=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Se=t.forwardRef((e,t)=>n.jsx(r.span,{...e,ref:t,style:{...je,...e.style}}));Se.displayName="VisuallyHidden";var Ee=Se,Re="ToastProvider",[_e,Ie,Te]=i("Toast"),[Ae,De]=a("Toast",[Te]),[Pe,Me]=Ae(Re),Fe=e=>{const{__scopeToast:r,label:a="Notification",duration:i=5e3,swipeDirection:o="right",swipeThreshold:s=50,children:u}=e,[c,l]=t.useState(null),[d,h]=t.useState(0),p=t.useRef(!1),f=t.useRef(!1);return a.trim(),n.jsx(_e.Provider,{scope:r,children:n.jsx(Pe,{scope:r,label:a,duration:i,swipeDirection:o,swipeThreshold:s,toastCount:d,viewport:c,onViewportChange:l,onToastAdd:t.useCallback(()=>h(e=>e+1),[]),onToastRemove:t.useCallback(()=>h(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:p,isClosePausedRef:f,children:u})})};Fe.displayName=Re;var Oe="ToastViewport",Le=["F8"],Be="toast.viewportPause",ze="toast.viewportResume",Ue=t.forwardRef((e,a)=>{const{__scopeToast:i,hotkey:u=Le,label:c="Notifications ({hotkey})",...l}=e,d=Me(Oe,i),h=Ie(i),p=t.useRef(null),f=t.useRef(null),m=t.useRef(null),v=t.useRef(null),g=o(a,v,d.onViewportChange),x=u.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=d.toastCount>0;t.useEffect(()=>{const e=e=>{0!==u.length&&u.every(t=>e[t]||e.code===t)&&v.current?.focus()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[u]),t.useEffect(()=>{const e=p.current,t=v.current;if(y&&e&&t){const n=()=>{if(!d.isClosePausedRef.current){const e=new CustomEvent(Be);t.dispatchEvent(e),d.isClosePausedRef.current=!0}},r=()=>{if(d.isClosePausedRef.current){const e=new CustomEvent(ze);t.dispatchEvent(e),d.isClosePausedRef.current=!1}},a=t=>{!e.contains(t.relatedTarget)&&r()},i=()=>{e.contains(document.activeElement)||r()};return e.addEventListener("focusin",n),e.addEventListener("focusout",a),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",i),window.addEventListener("blur",n),window.addEventListener("focus",r),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",a),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",i),window.removeEventListener("blur",n),window.removeEventListener("focus",r)}}},[y,d.isClosePausedRef]);const b=t.useCallback(({tabbingDirection:e})=>{const t=h().map(t=>{const n=t.ref.current,r=[n,...it(n)];return"forwards"===e?r:r.reverse()});return("forwards"===e?t.reverse():t).flat()},[h]);return t.useEffect(()=>{const e=v.current;if(e){const t=t=>{const n=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!n){const n=document.activeElement,r=t.shiftKey;if(t.target===e&&r)return void f.current?.focus();const a=b({tabbingDirection:r?"backwards":"forwards"}),i=a.findIndex(e=>e===n);ot(a.slice(i+1))?t.preventDefault():r?f.current?.focus():m.current?.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[h,b]),n.jsxs(s,{ref:p,role:"region","aria-label":c.replace("{hotkey}",x),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&n.jsx(Ve,{ref:f,onFocusFromOutsideViewport:()=>{ot(b({tabbingDirection:"forwards"}))}}),n.jsx(_e.Slot,{scope:i,children:n.jsx(r.ol,{tabIndex:-1,...l,ref:g})}),y&&n.jsx(Ve,{ref:m,onFocusFromOutsideViewport:()=>{ot(b({tabbingDirection:"backwards"}))}})]})});Ue.displayName=Oe;var We="ToastFocusProxy",Ve=t.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:a,...i}=e,o=Me(We,r);return n.jsx(Se,{tabIndex:0,...i,ref:t,style:{position:"fixed"},onFocus:e=>{const t=e.relatedTarget;!o.viewport?.contains(t)&&a()}})});Ve.displayName=We;var He="Toast",qe=t.forwardRef((e,t)=>{const{forceMount:r,open:a,defaultOpen:i,onOpenChange:o,...s}=e,[h,p]=u({prop:a,defaultProp:i??!0,onChange:o,caller:He});return n.jsx(c,{present:r||h,children:n.jsx($e,{open:h,...s,ref:t,onClose:()=>p(!1),onPause:d(e.onPause),onResume:d(e.onResume),onSwipeStart:l(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:l(e.onSwipeMove,e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:l(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:l(e.onSwipeEnd,e=>{const{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),p(!1)})})})});qe.displayName=He;var[Ge,Ke]=Ae(He,{onClose(){}}),$e=t.forwardRef((e,a)=>{const{__scopeToast:i,type:s="foreground",duration:u,open:c,onClose:f,onEscapeKeyDown:m,onPause:v,onResume:g,onSwipeStart:x,onSwipeMove:y,onSwipeCancel:b,onSwipeEnd:w,...N}=e,k=Me(He,i),[C,j]=t.useState(null),S=o(a,e=>j(e)),E=t.useRef(null),R=t.useRef(null),_=u||k.duration,I=t.useRef(0),T=t.useRef(_),A=t.useRef(0),{onToastAdd:D,onToastRemove:P}=k,M=d(()=>{const e=C?.contains(document.activeElement);e&&k.viewport?.focus(),f()}),F=t.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(A.current),I.current=(new Date).getTime(),A.current=window.setTimeout(M,e))},[M]);t.useEffect(()=>{const e=k.viewport;if(e){const t=()=>{F(T.current),g?.()},n=()=>{const e=(new Date).getTime()-I.current;T.current=T.current-e,window.clearTimeout(A.current),v?.()};return e.addEventListener(Be,n),e.addEventListener(ze,t),()=>{e.removeEventListener(Be,n),e.removeEventListener(ze,t)}}},[k.viewport,_,v,g,F]),t.useEffect(()=>{c&&!k.isClosePausedRef.current&&F(_)},[c,_,k.isClosePausedRef,F]),t.useEffect(()=>(D(),()=>P()),[D,P]);const O=t.useMemo(()=>C?nt(C):null,[C]);return k.viewport?n.jsxs(n.Fragment,{children:[O&&n.jsx(Xe,{__scopeToast:i,role:"status","aria-live":"foreground"===s?"assertive":"polite",children:O}),n.jsx(Ge,{scope:i,onClose:M,children:h.createPortal(n.jsx(_e.ItemSlot,{scope:i,children:n.jsx(p,{asChild:!0,onEscapeKeyDown:l(m,()=>{k.isFocusedToastEscapeKeyDownRef.current||M(),k.isFocusedToastEscapeKeyDownRef.current=!1}),children:n.jsx(r.li,{tabIndex:0,"data-state":c?"open":"closed","data-swipe-direction":k.swipeDirection,...N,ref:S,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:l(e.onKeyDown,e=>{"Escape"===e.key&&(m?.(e.nativeEvent),e.nativeEvent.defaultPrevented||(k.isFocusedToastEscapeKeyDownRef.current=!0,M()))}),onPointerDown:l(e.onPointerDown,e=>{0===e.button&&(E.current={x:e.clientX,y:e.clientY})}),onPointerMove:l(e.onPointerMove,e=>{if(!E.current)return;const t=e.clientX-E.current.x,n=e.clientY-E.current.y,r=Boolean(R.current),a=["left","right"].includes(k.swipeDirection),i=["left","up"].includes(k.swipeDirection)?Math.min:Math.max,o=a?i(0,t):0,s=a?0:i(0,n),u="touch"===e.pointerType?10:2,c={x:o,y:s},l={originalEvent:e,delta:c};r?(R.current=c,rt("toast.swipeMove",y,l,{discrete:!1})):at(c,k.swipeDirection,u)?(R.current=c,rt("toast.swipeStart",x,l,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>u||Math.abs(n)>u)&&(E.current=null)}),onPointerUp:l(e.onPointerUp,e=>{const t=R.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),R.current=null,E.current=null,t){const n=e.currentTarget,r={originalEvent:e,delta:t};at(t,k.swipeDirection,k.swipeThreshold)?rt("toast.swipeEnd",w,r,{discrete:!0}):rt("toast.swipeCancel",b,r,{discrete:!0}),n.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})})}),k.viewport)})]}):null}),Xe=e=>{const{__scopeToast:r,children:a,...i}=e,o=Me(He,r),[s,u]=t.useState(!1),[c,l]=t.useState(!1);return function(e=()=>{}){const t=d(e);m(()=>{let e=0,n=0;return e=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}},[t])}(()=>u(!0)),t.useEffect(()=>{const e=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(e)},[]),c?null:n.jsx(f,{asChild:!0,children:n.jsx(Se,{...i,children:s&&n.jsxs(n.Fragment,{children:[o.label," ",a]})})})},Ye=t.forwardRef((e,t)=>{const{__scopeToast:a,...i}=e;return n.jsx(r.div,{...i,ref:t})});Ye.displayName="ToastTitle";var Qe=t.forwardRef((e,t)=>{const{__scopeToast:a,...i}=e;return n.jsx(r.div,{...i,ref:t})});Qe.displayName="ToastDescription";var Je=t.forwardRef((e,t)=>{const{altText:r,...a}=e;return r.trim()?n.jsx(tt,{altText:r,asChild:!0,children:n.jsx(et,{...a,ref:t})}):null});Je.displayName="ToastAction";var Ze="ToastClose",et=t.forwardRef((e,t)=>{const{__scopeToast:a,...i}=e,o=Ke(Ze,a);return n.jsx(tt,{asChild:!0,children:n.jsx(r.button,{type:"button",...i,ref:t,onClick:l(e.onClick,o.onClose)})})});et.displayName=Ze;var tt=t.forwardRef((e,t)=>{const{__scopeToast:a,altText:i,...o}=e;return n.jsx(r.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":i||void 0,...o,ref:t})});function nt(e){const t=[];return Array.from(e.childNodes).forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const n=e.ariaHidden||e.hidden||"none"===e.style.display,r=""===e.dataset.radixToastAnnounceExclude;if(!n)if(r){const n=e.dataset.radixToastAnnounceAlt;n&&t.push(n)}else t.push(...nt(e))}}),t}function rt(e,t,n,{discrete:r}){const a=n.originalEvent.currentTarget,i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&a.addEventListener(e,t,{once:!0}),r?v(a,i):a.dispatchEvent(i)}var at=(e,t,n=0)=>{const r=Math.abs(e.x),a=Math.abs(e.y),i=r>a;return"left"===t||"right"===t?i&&r>n:!i&&a>n};function it(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function ot(e){const t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}var st=Fe,ut=Ue,ct=qe,lt=Ye,dt=Qe,ht=Je,pt=et;const ft=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,mt=ie,vt=(e,t)=>n=>{var r;if(null==(null==t?void 0:t.variants))return mt(e,null==n?void 0:n.class,null==n?void 0:n.className);const{variants:a,defaultVariants:i}=t,o=Object.keys(a).map(e=>{const t=null==n?void 0:n[e],r=null==i?void 0:i[e];if(null===t)return null;const o=ft(t)||ft(r);return a[e][o]}),s=n&&Object.entries(n).reduce((e,t)=>{let[n,r]=t;return void 0===r||(e[n]=r),e},{}),u=null==t||null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:n,className:r,...a}=t;return Object.entries(a).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...i,...s}[t]):{...i,...s}[t]===n})?[...e,n,r]:e},[]);return mt(e,o,u,null==n?void 0:n.class,null==n?void 0:n.className)},gt=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},xt=(...e)=>e.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim(),yt=e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};
/**
     * @license lucide-react v0.539.0 - ISC
     *
     * This source code is licensed under the ISC license.
     * See the LICENSE file in the root directory of this source tree.
     */
var bt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
     * @license lucide-react v0.539.0 - ISC
     *
     * This source code is licensed under the ISC license.
     * See the LICENSE file in the root directory of this source tree.
     */const wt=t.forwardRef(({color:e="currentColor",size:n=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:i="",children:o,iconNode:s,...u},c)=>t.createElement("svg",{ref:c,...bt,width:n,height:n,stroke:e,strokeWidth:a?24*Number(r)/Number(n):r,className:xt("lucide",i),...!o&&!yt(u)&&{"aria-hidden":"true"},...u},[...s.map(([e,n])=>t.createElement(e,n)),...Array.isArray(o)?o:[o]])),Nt=(e,n)=>{const r=t.forwardRef(({className:r,...a},i)=>{return t.createElement(wt,{ref:i,iconNode:n,className:xt(`lucide-${o=gt(e),o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...a});var o});return r.displayName=gt(e),r},kt=Nt("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Ct=Nt("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),jt=Nt("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]]),St=Nt("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Et=Nt("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Rt=Nt("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),_t=Nt("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),It=Nt("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Tt=Nt("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),At=Nt("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Dt=Nt("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Pt=Nt("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Mt=Nt("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Ft=Nt("circle-play",[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ot=Nt("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Lt=Nt("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Bt=Nt("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),zt=Nt("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),Ut=Nt("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Wt=Nt("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Vt=Nt("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ht=Nt("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),qt=Nt("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),Gt=Nt("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),Kt=Nt("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),$t=Nt("library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]),Xt=Nt("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Yt=Nt("list",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),Qt=Nt("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Jt=Nt("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),Zt=Nt("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),en=Nt("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),tn=Nt("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),nn=Nt("music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),rn=Nt("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]),an=Nt("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),on=Nt("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),sn=Nt("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),un=Nt("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),cn=Nt("repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),ln=Nt("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),dn=Nt("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),hn=Nt("scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),pn=Nt("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),fn=Nt("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),mn=Nt("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),vn=Nt("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),gn=Nt("shuffle",[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]]),xn=Nt("skip-back",[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]]),yn=Nt("skip-forward",[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]]),bn=Nt("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),wn=Nt("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Nn=Nt("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),kn=Nt("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Cn=Nt("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),jn=Nt("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Sn=Nt("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),En=Nt("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),Rn=Nt("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),_n=Nt("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),In=e=>{const t=Pn(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{const n=e.split("-");return""===n[0]&&1!==n.length&&n.shift(),Tn(n,t)||Dn(e)},getConflictingClassGroupIds:(e,t)=>{const a=n[e]||[];return t&&r[e]?[...a,...r[e]]:a}}},Tn=(e,t)=>{if(0===e.length)return t.classGroupId;const n=e[0],r=t.nextPart.get(n),a=r?Tn(e.slice(1),r):void 0;if(a)return a;if(0===t.validators.length)return;const i=e.join("-");return t.validators.find(({validator:e})=>e(i))?.classGroupId},An=/^\[(.+)\]$/,Dn=e=>{if(An.test(e)){const t=An.exec(e)[1],n=t?.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},Pn=e=>{const{theme:t,prefix:n}=e,r={nextPart:new Map,validators:[]};return Ln(Object.entries(e.classGroups),n).forEach(([e,n])=>{Mn(n,r,e,t)}),r},Mn=(e,t,n,r)=>{e.forEach(e=>{if("string"!=typeof e)return"function"==typeof e?On(e)?void Mn(e(r),t,n,r):void t.validators.push({validator:e,classGroupId:n}):void Object.entries(e).forEach(([e,a])=>{Mn(a,Fn(t,e),n,r)});(""===e?t:Fn(t,e)).classGroupId=n})},Fn=(e,t)=>{let n=e;return t.split("-").forEach(e=>{n.nextPart.has(e)||n.nextPart.set(e,{nextPart:new Map,validators:[]}),n=n.nextPart.get(e)}),n},On=e=>e.isThemeGetter,Ln=(e,t)=>t?e.map(([e,n])=>[e,n.map(e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,n])=>[t+e,n])):e)]):e,Bn=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,r=new Map;const a=(a,i)=>{n.set(a,i),t++,t>e&&(t=0,r=n,n=new Map)};return{get(e){let t=n.get(e);return void 0!==t?t:void 0!==(t=r.get(e))?(a(e,t),t):void 0},set(e,t){n.has(e)?n.set(e,t):a(e,t)}}},zn=e=>{const{separator:t,experimentalParseClassName:n}=e,r=1===t.length,a=t[0],i=t.length,o=e=>{const n=[];let o,s=0,u=0;for(let d=0;d<e.length;d++){let c=e[d];if(0===s){if(c===a&&(r||e.slice(d,d+i)===t)){n.push(e.slice(u,d)),u=d+i;continue}if("/"===c){o=d;continue}}"["===c?s++:"]"===c&&s--}const c=0===n.length?e:e.substring(u),l=c.startsWith("!");return{modifiers:n,hasImportantModifier:l,baseClassName:l?c.substring(1):c,maybePostfixModifierPosition:o&&o>u?o-u:void 0}};return n?e=>n({className:e,parseClassName:o}):o},Un=e=>{if(e.length<=1)return e;const t=[];let n=[];return e.forEach(e=>{"["===e[0]?(t.push(...n.sort(),e),n=[]):n.push(e)}),t.push(...n.sort()),t},Wn=/\s+/;
/**
     * @license lucide-react v0.539.0 - ISC
     *
     * This source code is licensed under the ISC license.
     * See the LICENSE file in the root directory of this source tree.
     */function Vn(){let e,t,n=0,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=Hn(e))&&(r&&(r+=" "),r+=t);return r}const Hn=e=>{if("string"==typeof e)return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=Hn(e[r]))&&(n&&(n+=" "),n+=t);return n};function qn(e,...t){let n,r,a,i=function(s){const u=t.reduce((e,t)=>t(e),e());return n=(e=>({cache:Bn(e.cacheSize),parseClassName:zn(e),...In(e)}))(u),r=n.cache.get,a=n.cache.set,i=o,o(s)};function o(e){const t=r(e);if(t)return t;const i=((e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a}=t,i=[],o=e.trim().split(Wn);let s="";for(let u=o.length-1;u>=0;u-=1){const e=o[u],{modifiers:t,hasImportantModifier:c,baseClassName:l,maybePostfixModifierPosition:d}=n(e);let h=Boolean(d),p=r(h?l.substring(0,d):l);if(!p){if(!h){s=e+(s.length>0?" "+s:s);continue}if(p=r(l),!p){s=e+(s.length>0?" "+s:s);continue}h=!1}const f=Un(t).join(":"),m=c?f+"!":f,v=m+p;if(i.includes(v))continue;i.push(v);const g=a(p,h);for(let n=0;n<g.length;++n){const e=g[n];i.push(m+e)}s=e+(s.length>0?" "+s:s)}return s})(e,n);return a(e,i),i}return function(){return i(Vn.apply(null,arguments))}}const Gn=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},Kn=/^\[(?:([a-z-]+):)?(.+)\]$/i,$n=/^\d+\/\d+$/,Xn=new Set(["px","full","screen"]),Yn=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Qn=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Jn=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Zn=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,er=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,tr=e=>rr(e)||Xn.has(e)||$n.test(e),nr=e=>vr(e,"length",gr),rr=e=>Boolean(e)&&!Number.isNaN(Number(e)),ar=e=>vr(e,"number",rr),ir=e=>Boolean(e)&&Number.isInteger(Number(e)),or=e=>e.endsWith("%")&&rr(e.slice(0,-1)),sr=e=>Kn.test(e),ur=e=>Yn.test(e),cr=new Set(["length","size","percentage"]),lr=e=>vr(e,cr,xr),dr=e=>vr(e,"position",xr),hr=new Set(["image","url"]),pr=e=>vr(e,hr,br),fr=e=>vr(e,"",yr),mr=()=>!0,vr=(e,t,n)=>{const r=Kn.exec(e);return!!r&&(r[1]?"string"==typeof t?r[1]===t:t.has(r[1]):n(r[2]))},gr=e=>Qn.test(e)&&!Jn.test(e),xr=()=>!1,yr=e=>Zn.test(e),br=e=>er.test(e),wr=qn(()=>{const e=Gn("colors"),t=Gn("spacing"),n=Gn("blur"),r=Gn("brightness"),a=Gn("borderColor"),i=Gn("borderRadius"),o=Gn("borderSpacing"),s=Gn("borderWidth"),u=Gn("contrast"),c=Gn("grayscale"),l=Gn("hueRotate"),d=Gn("invert"),h=Gn("gap"),p=Gn("gradientColorStops"),f=Gn("gradientColorStopPositions"),m=Gn("inset"),v=Gn("margin"),g=Gn("opacity"),x=Gn("padding"),y=Gn("saturate"),b=Gn("scale"),w=Gn("sepia"),N=Gn("skew"),k=Gn("space"),C=Gn("translate"),j=()=>["auto",sr,t],S=()=>[sr,t],E=()=>["",tr,nr],R=()=>["auto",rr,sr],_=()=>["","0",sr],I=()=>[rr,sr];return{cacheSize:500,separator:":",theme:{colors:[mr],spacing:[tr,nr],blur:["none","",ur,sr],brightness:I(),borderColor:[e],borderRadius:["none","","full",ur,sr],borderSpacing:S(),borderWidth:E(),contrast:I(),grayscale:_(),hueRotate:I(),invert:_(),gap:S(),gradientColorStops:[e],gradientColorStopPositions:[or,nr],inset:j(),margin:j(),opacity:I(),padding:S(),saturate:I(),scale:I(),sepia:_(),skew:I(),space:S(),translate:S()},classGroups:{aspect:[{aspect:["auto","square","video",sr]}],container:["container"],columns:[{columns:[ur]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",sr]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[m]}],"inset-x":[{"inset-x":[m]}],"inset-y":[{"inset-y":[m]}],start:[{start:[m]}],end:[{end:[m]}],top:[{top:[m]}],right:[{right:[m]}],bottom:[{bottom:[m]}],left:[{left:[m]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",ir,sr]}],basis:[{basis:j()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",sr]}],grow:[{grow:_()}],shrink:[{shrink:_()}],order:[{order:["first","last","none",ir,sr]}],"grid-cols":[{"grid-cols":[mr]}],"col-start-end":[{col:["auto",{span:["full",ir,sr]},sr]}],"col-start":[{"col-start":R()}],"col-end":[{"col-end":R()}],"grid-rows":[{"grid-rows":[mr]}],"row-start-end":[{row:["auto",{span:[ir,sr]},sr]}],"row-start":[{"row-start":R()}],"row-end":[{"row-end":R()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",sr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",sr]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[x]}],px:[{px:[x]}],py:[{py:[x]}],ps:[{ps:[x]}],pe:[{pe:[x]}],pt:[{pt:[x]}],pr:[{pr:[x]}],pb:[{pb:[x]}],pl:[{pl:[x]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[k]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[k]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",sr,t]}],"min-w":[{"min-w":[sr,t,"min","max","fit"]}],"max-w":[{"max-w":[sr,t,"none","full","min","max","fit","prose",{screen:[ur]},ur]}],h:[{h:[sr,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[sr,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[sr,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[sr,t,"auto","min","max","fit"]}],"font-size":[{text:["base",ur,nr]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ar]}],"font-family":[{font:[mr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",sr]}],"line-clamp":[{"line-clamp":["none",rr,ar]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",tr,sr]}],"list-image":[{"list-image":["none",sr]}],"list-style-type":[{list:["none","disc","decimal",sr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[g]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",tr,nr]}],"underline-offset":[{"underline-offset":["auto",tr,sr]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:S()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",sr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",sr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[g]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",dr]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",lr]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},pr]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[f]}],"gradient-via-pos":[{via:[f]}],"gradient-to-pos":[{to:[f]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[g]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[g]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[tr,sr]}],"outline-w":[{outline:[tr,nr]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:E()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[g]}],"ring-offset-w":[{"ring-offset":[tr,nr]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",ur,fr]}],"shadow-color":[{shadow:[mr]}],opacity:[{opacity:[g]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[u]}],"drop-shadow":[{"drop-shadow":["","none",ur,sr]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[l]}],invert:[{invert:[d]}],saturate:[{saturate:[y]}],sepia:[{sepia:[w]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[u]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[l]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[g]}],"backdrop-saturate":[{"backdrop-saturate":[y]}],"backdrop-sepia":[{"backdrop-sepia":[w]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",sr]}],duration:[{duration:I()}],ease:[{ease:["linear","in","out","in-out",sr]}],delay:[{delay:I()}],animate:[{animate:["none","spin","ping","pulse","bounce",sr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[ir,sr]}],"translate-x":[{"translate-x":[C]}],"translate-y":[{"translate-y":[C]}],"skew-x":[{"skew-x":[N]}],"skew-y":[{"skew-y":[N]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",sr]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",sr]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":S()}],"scroll-mx":[{"scroll-mx":S()}],"scroll-my":[{"scroll-my":S()}],"scroll-ms":[{"scroll-ms":S()}],"scroll-me":[{"scroll-me":S()}],"scroll-mt":[{"scroll-mt":S()}],"scroll-mr":[{"scroll-mr":S()}],"scroll-mb":[{"scroll-mb":S()}],"scroll-ml":[{"scroll-ml":S()}],"scroll-p":[{"scroll-p":S()}],"scroll-px":[{"scroll-px":S()}],"scroll-py":[{"scroll-py":S()}],"scroll-ps":[{"scroll-ps":S()}],"scroll-pe":[{"scroll-pe":S()}],"scroll-pt":[{"scroll-pt":S()}],"scroll-pr":[{"scroll-pr":S()}],"scroll-pb":[{"scroll-pb":S()}],"scroll-pl":[{"scroll-pl":S()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",sr]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[tr,nr,ar]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function Nr(...e){return wr(ie(e))}const kr=st,Cr=t.forwardRef(({className:e,...t},r)=>n.jsx(ut,{ref:r,className:Nr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));Cr.displayName=ut.displayName;const jr=vt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Sr=t.forwardRef(({className:e,variant:t,...r},a)=>n.jsx(ct,{ref:a,className:Nr(jr({variant:t}),e),...r}));Sr.displayName=ct.displayName,t.forwardRef(({className:e,...t},r)=>n.jsx(ht,{ref:r,className:Nr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t})).displayName=ht.displayName;const Er=t.forwardRef(({className:e,...t},r)=>n.jsx(pt,{ref:r,className:Nr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:n.jsx(_n,{className:"h-4 w-4"})}));Er.displayName=pt.displayName;const Rr=t.forwardRef(({className:e,...t},r)=>n.jsx(lt,{ref:r,className:Nr("text-sm font-semibold",e),...t}));Rr.displayName=lt.displayName;const _r=t.forwardRef(({className:e,...t},r)=>n.jsx(dt,{ref:r,className:Nr("text-sm opacity-90",e),...t}));function Ir(){const{toasts:e}=Ce();return n.jsxs(kr,{children:[e.map(function({id:e,title:t,description:r,action:a,...i}){return n.jsxs(Sr,{...i,children:[n.jsxs("div",{className:"grid gap-1",children:[t&&n.jsx(Rr,{children:t}),r&&n.jsx(_r,{children:r})]}),a,n.jsx(Er,{})]},e)}),n.jsx(Cr,{})]})}_r.displayName=dt.displayName;var Tr=(e,t,n,r,a,i,o,s)=>{let u=document.documentElement,c=["light","dark"];function l(t){(Array.isArray(e)?e:[e]).forEach(e=>{let n="class"===e,r=n&&i?a.map(e=>i[e]||e):a;n?(u.classList.remove(...r),u.classList.add(i&&i[t]?i[t]:t)):u.setAttribute(e,t)}),function(e){s&&c.includes(e)&&(u.style.colorScheme=e)}(t)}if(r)l(r);else try{let e=localStorage.getItem(t)||n;l(o&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e)}catch(d){}},Ar=t.createContext(void 0),Dr={setTheme:e=>{},themes:[]};t.memo(({forcedTheme:e,storageKey:n,attribute:r,enableSystem:a,enableColorScheme:i,defaultTheme:o,value:s,themes:u,nonce:c,scriptProps:l})=>{let d=JSON.stringify([r,n,o,e,u,s,a,i]).slice(1,-1);return t.createElement("script",{...l,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?c:"",dangerouslySetInnerHTML:{__html:`(${Tr.toString()})(${d})`}})});var Pr=Array(12).fill(0),Mr=({visible:e,className:t})=>g.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},g.createElement("div",{className:"sonner-spinner"},Pr.map((e,t)=>g.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${t}`})))),Fr=g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},g.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Or=g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},g.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Lr=g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},g.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Br=g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},g.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),zr=g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},g.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),g.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ur=1,Wr=new class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:n,...r}=e,a="number"==typeof(null==e?void 0:e.id)||(null==(t=e.id)?void 0:t.length)>0?e.id:Ur++,i=this.toasts.find(e=>e.id===a),o=void 0===e.dismissible||e.dismissible;return this.dismissedToasts.has(a)&&this.dismissedToasts.delete(a),i?this.toasts=this.toasts.map(t=>t.id===a?(this.publish({...t,...e,id:a,title:n}),{...t,...e,id:a,dismissible:o,title:n}):t):this.addToast({title:n,...r,dismissible:o,id:a}),a},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(e=>{this.subscribers.forEach(t=>t({id:e.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;void 0!==t.loading&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:"function"!=typeof t.description?t.description:void 0}));let r,a=e instanceof Promise?e:e(),i=void 0!==n,o=a.then(async e=>{if(r=["resolve",e],g.isValidElement(e))i=!1,this.create({id:n,type:"default",message:e});else if(Vr(e)&&!e.ok){i=!1;let r="function"==typeof t.error?await t.error(`HTTP error! status: ${e.status}`):t.error,a="function"==typeof t.description?await t.description(`HTTP error! status: ${e.status}`):t.description;this.create({id:n,type:"error",message:r,description:a})}else if(void 0!==t.success){i=!1;let r="function"==typeof t.success?await t.success(e):t.success,a="function"==typeof t.description?await t.description(e):t.description;this.create({id:n,type:"success",message:r,description:a})}}).catch(async e=>{if(r=["reject",e],void 0!==t.error){i=!1;let r="function"==typeof t.error?await t.error(e):t.error,a="function"==typeof t.description?await t.description(e):t.description;this.create({id:n,type:"error",message:r,description:a})}}).finally(()=>{var e;i&&(this.dismiss(n),n=void 0),null==(e=t.finally)||e.call(t)}),s=()=>new Promise((e,t)=>o.then(()=>"reject"===r[0]?t(r[1]):e(r[1])).catch(t));return"string"!=typeof n&&"number"!=typeof n?{unwrap:s}:Object.assign(n,{unwrap:s})},this.custom=(e,t)=>{let n=(null==t?void 0:t.id)||Ur++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Vr=e=>e&&"object"==typeof e&&"ok"in e&&"boolean"==typeof e.ok&&"status"in e&&"number"==typeof e.status,Hr=(e,t)=>{let n=(null==t?void 0:t.id)||Ur++;return Wr.addToast({title:e,...t,id:n}),n};function qr(e){return void 0!==e.label}Object.assign(Hr,{success:Wr.success,info:Wr.info,warning:Wr.warning,error:Wr.error,custom:Wr.custom,message:Wr.message,promise:Wr.promise,dismiss:Wr.dismiss,loading:Wr.loading},{getHistory:()=>Wr.toasts,getToasts:()=>Wr.getActiveToasts()}),function(e,{insertAt:t}={}){if("undefined"==typeof document)return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}(':where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}\n');var Gr=3,Kr=14;function $r(...e){return e.filter(Boolean).join(" ")}var Xr=e=>{var n,r,a,i,o,s,u,c,l,d,h;let{invert:p,toast:f,unstyled:m,interacting:v,setHeights:x,visibleToasts:y,heights:b,index:w,toasts:N,expanded:k,removeToast:C,defaultRichColors:j,closeButton:S,style:E,cancelButtonStyle:R,actionButtonStyle:_,className:I="",descriptionClassName:T="",duration:A,position:D,gap:P,loadingIcon:M,expandByDefault:F,classNames:O,icons:L,closeButtonAriaLabel:B="Close toast",pauseWhenPageIsHidden:z}=e,[U,W]=g.useState(null),[V,H]=g.useState(null),[q,G]=g.useState(!1),[K,$]=g.useState(!1),[X,Y]=g.useState(!1),[Q,J]=g.useState(!1),[Z,ee]=g.useState(!1),[te,ne]=g.useState(0),[re,ae]=g.useState(0),ie=g.useRef(f.duration||A||4e3),oe=g.useRef(null),se=g.useRef(null),ue=0===w,ce=w+1<=y,le=f.type,de=!1!==f.dismissible,he=f.className||"",pe=f.descriptionClassName||"",fe=g.useMemo(()=>b.findIndex(e=>e.toastId===f.id)||0,[b,f.id]),me=g.useMemo(()=>{var e;return null!=(e=f.closeButton)?e:S},[f.closeButton,S]),ve=g.useMemo(()=>f.duration||A||4e3,[f.duration,A]),ge=g.useRef(0),xe=g.useRef(0),ye=g.useRef(0),be=g.useRef(null),[we,Ne]=D.split("-"),ke=g.useMemo(()=>b.reduce((e,t,n)=>n>=fe?e:e+t.height,0),[b,fe]),Ce=(()=>{let[e,t]=g.useState(document.hidden);return g.useEffect(()=>{let e=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",e),()=>window.removeEventListener("visibilitychange",e)},[]),e})(),je=f.invert||p,Se="loading"===le;xe.current=g.useMemo(()=>fe*P+ke,[fe,ke]),g.useEffect(()=>{ie.current=ve},[ve]),g.useEffect(()=>{G(!0)},[]),g.useEffect(()=>{let e=se.current;if(e){let t=e.getBoundingClientRect().height;return ae(t),x(e=>[{toastId:f.id,height:t,position:f.position},...e]),()=>x(e=>e.filter(e=>e.toastId!==f.id))}},[x,f.id]),g.useLayoutEffect(()=>{if(!q)return;let e=se.current,t=e.style.height;e.style.height="auto";let n=e.getBoundingClientRect().height;e.style.height=t,ae(n),x(e=>e.find(e=>e.toastId===f.id)?e.map(e=>e.toastId===f.id?{...e,height:n}:e):[{toastId:f.id,height:n,position:f.position},...e])},[q,f.title,f.description,x,f.id]);let Ee=g.useCallback(()=>{$(!0),ne(xe.current),x(e=>e.filter(e=>e.toastId!==f.id)),setTimeout(()=>{C(f)},200)},[f,C,x,xe]);return g.useEffect(()=>{if(f.promise&&"loading"===le||f.duration===1/0||"loading"===f.type)return;let e;return k||v||z&&Ce?(()=>{if(ye.current<ge.current){let e=(new Date).getTime()-ge.current;ie.current=ie.current-e}ye.current=(new Date).getTime()})():ie.current!==1/0&&(ge.current=(new Date).getTime(),e=setTimeout(()=>{var e;null==(e=f.onAutoClose)||e.call(f,f),Ee()},ie.current)),()=>clearTimeout(e)},[k,v,f,le,z,Ce,Ee]),g.useEffect(()=>{f.delete&&Ee()},[Ee,f.delete]),g.createElement("li",{tabIndex:0,ref:se,className:$r(I,he,null==O?void 0:O.toast,null==(n=null==f?void 0:f.classNames)?void 0:n.toast,null==O?void 0:O.default,null==O?void 0:O[le],null==(r=null==f?void 0:f.classNames)?void 0:r[le]),"data-sonner-toast":"","data-rich-colors":null!=(a=f.richColors)?a:j,"data-styled":!(f.jsx||f.unstyled||m),"data-mounted":q,"data-promise":!!f.promise,"data-swiped":Z,"data-removed":K,"data-visible":ce,"data-y-position":we,"data-x-position":Ne,"data-index":w,"data-front":ue,"data-swiping":X,"data-dismissible":de,"data-type":le,"data-invert":je,"data-swipe-out":Q,"data-swipe-direction":V,"data-expanded":!!(k||F&&q),style:{"--index":w,"--toasts-before":w,"--z-index":N.length-w,"--offset":`${K?te:xe.current}px`,"--initial-height":F?"auto":`${re}px`,...E,...f.style},onDragEnd:()=>{Y(!1),W(null),be.current=null},onPointerDown:e=>{Se||!de||(oe.current=new Date,ne(xe.current),e.target.setPointerCapture(e.pointerId),"BUTTON"!==e.target.tagName&&(Y(!0),be.current={x:e.clientX,y:e.clientY}))},onPointerUp:()=>{var e,t,n,r;if(Q||!de)return;be.current=null;let a=Number((null==(e=se.current)?void 0:e.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),i=Number((null==(t=se.current)?void 0:t.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),o=(new Date).getTime()-(null==(n=oe.current)?void 0:n.getTime()),s="x"===U?a:i,u=Math.abs(s)/o;if(Math.abs(s)>=20||u>.11)return ne(xe.current),null==(r=f.onDismiss)||r.call(f,f),H("x"===U?a>0?"right":"left":i>0?"down":"up"),Ee(),J(!0),void ee(!1);Y(!1),W(null)},onPointerMove:t=>{var n,r,a,i;if(!be.current||!de||(null==(n=window.getSelection())?void 0:n.toString().length)>0)return;let o=t.clientY-be.current.y,s=t.clientX-be.current.x,u=null!=(r=e.swipeDirections)?r:function(e){let[t,n]=e.split("-"),r=[];return t&&r.push(t),n&&r.push(n),r}(D);!U&&(Math.abs(s)>1||Math.abs(o)>1)&&W(Math.abs(s)>Math.abs(o)?"x":"y");let c={x:0,y:0};"y"===U?(u.includes("top")||u.includes("bottom"))&&(u.includes("top")&&o<0||u.includes("bottom")&&o>0)&&(c.y=o):"x"===U&&(u.includes("left")||u.includes("right"))&&(u.includes("left")&&s<0||u.includes("right")&&s>0)&&(c.x=s),(Math.abs(c.x)>0||Math.abs(c.y)>0)&&ee(!0),null==(a=se.current)||a.style.setProperty("--swipe-amount-x",`${c.x}px`),null==(i=se.current)||i.style.setProperty("--swipe-amount-y",`${c.y}px`)}},me&&!f.jsx?g.createElement("button",{"aria-label":B,"data-disabled":Se,"data-close-button":!0,onClick:Se||!de?()=>{}:()=>{var e;Ee(),null==(e=f.onDismiss)||e.call(f,f)},className:$r(null==O?void 0:O.closeButton,null==(i=null==f?void 0:f.classNames)?void 0:i.closeButton)},null!=(o=null==L?void 0:L.close)?o:zr):null,f.jsx||t.isValidElement(f.title)?f.jsx?f.jsx:"function"==typeof f.title?f.title():f.title:g.createElement(g.Fragment,null,le||f.icon||f.promise?g.createElement("div",{"data-icon":"",className:$r(null==O?void 0:O.icon,null==(s=null==f?void 0:f.classNames)?void 0:s.icon)},f.promise||"loading"===f.type&&!f.icon?f.icon||(null!=L&&L.loading?g.createElement("div",{className:$r(null==O?void 0:O.loader,null==(Re=null==f?void 0:f.classNames)?void 0:Re.loader,"sonner-loader"),"data-visible":"loading"===le},L.loading):M?g.createElement("div",{className:$r(null==O?void 0:O.loader,null==(_e=null==f?void 0:f.classNames)?void 0:_e.loader,"sonner-loader"),"data-visible":"loading"===le},M):g.createElement(Mr,{className:$r(null==O?void 0:O.loader,null==(Ie=null==f?void 0:f.classNames)?void 0:Ie.loader),visible:"loading"===le})):null,"loading"!==f.type?f.icon||(null==L?void 0:L[le])||(e=>{switch(e){case"success":return Fr;case"info":return Lr;case"warning":return Or;case"error":return Br;default:return null}})(le):null):null,g.createElement("div",{"data-content":"",className:$r(null==O?void 0:O.content,null==(u=null==f?void 0:f.classNames)?void 0:u.content)},g.createElement("div",{"data-title":"",className:$r(null==O?void 0:O.title,null==(c=null==f?void 0:f.classNames)?void 0:c.title)},"function"==typeof f.title?f.title():f.title),f.description?g.createElement("div",{"data-description":"",className:$r(T,pe,null==O?void 0:O.description,null==(l=null==f?void 0:f.classNames)?void 0:l.description)},"function"==typeof f.description?f.description():f.description):null),t.isValidElement(f.cancel)?f.cancel:f.cancel&&qr(f.cancel)?g.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||R,onClick:e=>{var t,n;qr(f.cancel)&&de&&(null==(n=(t=f.cancel).onClick)||n.call(t,e),Ee())},className:$r(null==O?void 0:O.cancelButton,null==(d=null==f?void 0:f.classNames)?void 0:d.cancelButton)},f.cancel.label):null,t.isValidElement(f.action)?f.action:f.action&&qr(f.action)?g.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||_,onClick:e=>{var t,n;qr(f.action)&&(null==(n=(t=f.action).onClick)||n.call(t,e),!e.defaultPrevented&&Ee())},className:$r(null==O?void 0:O.actionButton,null==(h=null==f?void 0:f.classNames)?void 0:h.actionButton)},f.action.label):null));var Re,_e,Ie};function Yr(){if("undefined"==typeof window||"undefined"==typeof document)return"ltr";let e=document.documentElement.getAttribute("dir");return"auto"!==e&&e?e:window.getComputedStyle(document.documentElement).direction}function Qr(e,t){let n={};return[e,t].forEach((e,t)=>{let r=1===t,a=r?"--mobile-offset":"--offset",i=r?"16px":"32px";function o(e){["top","right","bottom","left"].forEach(t=>{n[`${a}-${t}`]="number"==typeof e?`${e}px`:e})}"number"==typeof e||"string"==typeof e?o(e):"object"==typeof e?["top","right","bottom","left"].forEach(t=>{void 0===e[t]?n[`${a}-${t}`]=i:n[`${a}-${t}`]="number"==typeof e[t]?`${e[t]}px`:e[t]}):o(i)}),n}var Jr=t.forwardRef(function(e,t){let{invert:n,position:r="bottom-right",hotkey:a=["altKey","KeyT"],expand:i,closeButton:o,className:s,offset:u,mobileOffset:c,theme:l="light",richColors:d,duration:h,style:p,visibleToasts:f=Gr,toastOptions:m,dir:v=Yr(),gap:y=Kr,loadingIcon:b,icons:w,containerAriaLabel:N="Notifications",pauseWhenPageIsHidden:k}=e,[C,j]=g.useState([]),S=g.useMemo(()=>Array.from(new Set([r].concat(C.filter(e=>e.position).map(e=>e.position)))),[C,r]),[E,R]=g.useState([]),[_,I]=g.useState(!1),[T,A]=g.useState(!1),[D,P]=g.useState("system"!==l?l:"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),M=g.useRef(null),F=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),O=g.useRef(null),L=g.useRef(!1),B=g.useCallback(e=>{j(t=>{var n;return null!=(n=t.find(t=>t.id===e.id))&&n.delete||Wr.dismiss(e.id),t.filter(({id:t})=>t!==e.id)})},[]);return g.useEffect(()=>Wr.subscribe(e=>{e.dismiss?j(t=>t.map(t=>t.id===e.id?{...t,delete:!0}:t)):setTimeout(()=>{x.flushSync(()=>{j(t=>{let n=t.findIndex(t=>t.id===e.id);return-1!==n?[...t.slice(0,n),{...t[n],...e},...t.slice(n+1)]:[e,...t]})})})}),[]),g.useEffect(()=>{if("system"!==l)return void P(l);if("system"===l&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?P("dark"):P("light")),"undefined"==typeof window)return;let e=window.matchMedia("(prefers-color-scheme: dark)");try{e.addEventListener("change",({matches:e})=>{P(e?"dark":"light")})}catch(t){e.addListener(({matches:e})=>{try{P(e?"dark":"light")}catch(t){}})}},[l]),g.useEffect(()=>{C.length<=1&&I(!1)},[C]),g.useEffect(()=>{let e=e=>{var t,n;a.every(t=>e[t]||e.code===t)&&(I(!0),null==(t=M.current)||t.focus()),"Escape"===e.code&&(document.activeElement===M.current||null!=(n=M.current)&&n.contains(document.activeElement))&&I(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]),g.useEffect(()=>{if(M.current)return()=>{O.current&&(O.current.focus({preventScroll:!0}),O.current=null,L.current=!1)}},[M.current]),g.createElement("section",{ref:t,"aria-label":`${N} ${F}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},S.map((t,r)=>{var a;let[l,x]=t.split("-");return C.length?g.createElement("ol",{key:t,dir:"auto"===v?Yr():v,tabIndex:-1,ref:M,className:s,"data-sonner-toaster":!0,"data-theme":D,"data-y-position":l,"data-lifted":_&&C.length>1&&!i,"data-x-position":x,style:{"--front-toast-height":`${(null==(a=E[0])?void 0:a.height)||0}px`,"--width":"356px","--gap":`${y}px`,...p,...Qr(u,c)},onBlur:e=>{L.current&&!e.currentTarget.contains(e.relatedTarget)&&(L.current=!1,O.current&&(O.current.focus({preventScroll:!0}),O.current=null))},onFocus:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||L.current||(L.current=!0,O.current=e.relatedTarget)},onMouseEnter:()=>I(!0),onMouseMove:()=>I(!0),onMouseLeave:()=>{T||I(!1)},onDragEnd:()=>I(!1),onPointerDown:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||A(!0)},onPointerUp:()=>A(!1)},C.filter(e=>!e.position&&0===r||e.position===t).map((r,a)=>{var s,u;return g.createElement(Xr,{key:r.id,icons:w,index:a,toast:r,defaultRichColors:d,duration:null!=(s=null==m?void 0:m.duration)?s:h,className:null==m?void 0:m.className,descriptionClassName:null==m?void 0:m.descriptionClassName,invert:n,visibleToasts:f,closeButton:null!=(u=null==m?void 0:m.closeButton)?u:o,interacting:T,position:t,style:null==m?void 0:m.style,unstyled:null==m?void 0:m.unstyled,classNames:null==m?void 0:m.classNames,cancelButtonStyle:null==m?void 0:m.cancelButtonStyle,actionButtonStyle:null==m?void 0:m.actionButtonStyle,removeToast:B,toasts:C.filter(e=>e.position==r.position),heights:E.filter(e=>e.position==r.position),setHeights:R,expandByDefault:i,gap:y,loadingIcon:b,expanded:_,pauseWhenPageIsHidden:k,swipeDirections:e.swipeDirections})})):null}))});const Zr=({...e})=>{const{theme:r="system"}=null!=(a=t.useContext(Ar))?a:Dr;var a;return n.jsx(Jr,{theme:r,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var[ea,ta]=a("Tooltip",[y]),na=y(),ra="TooltipProvider",aa=700,ia="tooltip.open",[oa,sa]=ea(ra),ua=e=>{const{__scopeTooltip:r,delayDuration:a=aa,skipDelayDuration:i=300,disableHoverableContent:o=!1,children:s}=e,u=t.useRef(!0),c=t.useRef(!1),l=t.useRef(0);return t.useEffect(()=>{const e=l.current;return()=>window.clearTimeout(e)},[]),n.jsx(oa,{scope:r,isOpenDelayedRef:u,delayDuration:a,onOpen:t.useCallback(()=>{window.clearTimeout(l.current),u.current=!1},[]),onClose:t.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>u.current=!0,i)},[i]),isPointerInTransitRef:c,onPointerInTransitChange:t.useCallback(e=>{c.current=e},[]),disableHoverableContent:o,children:s})};ua.displayName=ra;var ca="Tooltip",[la,da]=ea(ca),ha="TooltipTrigger";t.forwardRef((e,a)=>{const{__scopeTooltip:i,...s}=e,u=da(ha,i),c=sa(ha,i),d=na(i),h=t.useRef(null),p=o(a,h,u.onTriggerChange),f=t.useRef(!1),m=t.useRef(!1),v=t.useCallback(()=>f.current=!1,[]);return t.useEffect(()=>()=>document.removeEventListener("pointerup",v),[v]),n.jsx(k,{asChild:!0,...d,children:n.jsx(r.button,{"aria-describedby":u.open?u.contentId:void 0,"data-state":u.stateAttribute,...s,ref:p,onPointerMove:l(e.onPointerMove,e=>{"touch"!==e.pointerType&&(m.current||c.isPointerInTransitRef.current||(u.onTriggerEnter(),m.current=!0))}),onPointerLeave:l(e.onPointerLeave,()=>{u.onTriggerLeave(),m.current=!1}),onPointerDown:l(e.onPointerDown,()=>{u.open&&u.onClose(),f.current=!0,document.addEventListener("pointerup",v,{once:!0})}),onFocus:l(e.onFocus,()=>{f.current||u.onOpen()}),onBlur:l(e.onBlur,u.onClose),onClick:l(e.onClick,u.onClose)})})}).displayName=ha;var[pa,fa]=ea("TooltipPortal",{forceMount:void 0}),ma="TooltipContent",va=t.forwardRef((e,t)=>{const r=fa(ma,e.__scopeTooltip),{forceMount:a=r.forceMount,side:i="top",...o}=e,s=da(ma,e.__scopeTooltip);return n.jsx(c,{present:a||s.open,children:s.disableHoverableContent?n.jsx(wa,{side:i,...o,ref:t}):n.jsx(ga,{side:i,...o,ref:t})})}),ga=t.forwardRef((e,r)=>{const a=da(ma,e.__scopeTooltip),i=sa(ma,e.__scopeTooltip),s=t.useRef(null),u=o(r,s),[c,l]=t.useState(null),{trigger:d,onClose:h}=a,p=s.current,{onPointerInTransitChange:f}=i,m=t.useCallback(()=>{l(null),f(!1)},[f]),v=t.useCallback((e,t)=>{const n=e.currentTarget,r={x:e.clientX,y:e.clientY},a=function(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n})}return r}(r,function(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),i=Math.abs(t.left-e.x);switch(Math.min(n,r,a,i)){case i:return"left";case a:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}(r,n.getBoundingClientRect())),i=function(e){const t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const n=e[r];for(;t.length>=2;){const e=t[t.length-1],r=t[t.length-2];if(!((e.x-r.x)*(n.y-r.y)>=(e.y-r.y)*(n.x-r.x)))break;t.pop()}t.push(n)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const t=e[r];for(;n.length>=2;){const e=n[n.length-1],r=n[n.length-2];if(!((e.x-r.x)*(t.y-r.y)>=(e.y-r.y)*(t.x-r.x)))break;n.pop()}n.push(t)}return n.pop(),1===t.length&&1===n.length&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}(t)}([...a,...function(e){const{top:t,right:n,bottom:r,left:a}=e;return[{x:a,y:t},{x:n,y:t},{x:n,y:r},{x:a,y:r}]}(t.getBoundingClientRect())]);l(i),f(!0)},[f]);return t.useEffect(()=>()=>m(),[m]),t.useEffect(()=>{if(d&&p){const e=e=>v(e,p),t=e=>v(e,d);return d.addEventListener("pointerleave",e),p.addEventListener("pointerleave",t),()=>{d.removeEventListener("pointerleave",e),p.removeEventListener("pointerleave",t)}}},[d,p,v,m]),t.useEffect(()=>{if(c){const e=e=>{const t=e.target,n={x:e.clientX,y:e.clientY},r=d?.contains(t)||p?.contains(t),a=!function(e,t){const{x:n,y:r}=e;let a=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const e=t[i],s=t[o],u=e.x,c=e.y,l=s.x,d=s.y;c>r!=d>r&&n<(l-u)*(r-c)/(d-c)+u&&(a=!a)}return a}(n,c);r?m():a&&(m(),h())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[d,p,c,h,m]),n.jsx(wa,{...e,ref:u})}),[xa,ya]=ea(ca,{isInside:!1}),ba=N("TooltipContent"),wa=t.forwardRef((e,r)=>{const{__scopeTooltip:a,children:i,"aria-label":o,onEscapeKeyDown:s,onPointerDownOutside:u,...c}=e,l=da(ma,a),d=na(a),{onClose:h}=l;return t.useEffect(()=>(document.addEventListener(ia,h),()=>document.removeEventListener(ia,h)),[h]),t.useEffect(()=>{if(l.trigger){const e=e=>{const t=e.target;t?.contains(l.trigger)&&h()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[l.trigger,h]),n.jsx(b,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:u,onFocusOutside:e=>e.preventDefault(),onDismiss:h,children:n.jsxs(w,{"data-state":l.stateAttribute,...d,...c,ref:r,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[n.jsx(ba,{children:i}),n.jsx(xa,{scope:a,isInside:!0,children:n.jsx(Ee,{id:l.contentId,role:"tooltip",children:o||i})})]})})});va.displayName=ma;var Na="TooltipArrow";t.forwardRef((e,t)=>{const{__scopeTooltip:r,...a}=e,i=na(r);return ya(Na,r).isInside?null:n.jsx(C,{...i,...a,ref:t})}).displayName=Na;var ka=va;const Ca=ua;t.forwardRef(({className:e,sideOffset:t=4,...r},a)=>n.jsx(ka,{ref:a,sideOffset:t,className:Nr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})).displayName=ka.displayName;var ja=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Sa="undefined"==typeof window||"Deno"in globalThis;function Ea(){}function Ra(e){return"number"==typeof e&&e>=0&&e!==1/0}function _a(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Ia(e,t){return"function"==typeof e?e(t):e}function Ta(e,t){return"function"==typeof e?e(t):e}function Aa(e,t){const{type:n="all",exact:r,fetchStatus:a,predicate:i,queryKey:o,stale:s}=e;if(o)if(r){if(t.queryHash!==Pa(o,t.options))return!1}else if(!Fa(t.queryKey,o))return!1;if("all"!==n){const e=t.isActive();if("active"===n&&!e)return!1;if("inactive"===n&&e)return!1}return!("boolean"==typeof s&&t.isStale()!==s||a&&a!==t.state.fetchStatus||i&&!i(t))}function Da(e,t){const{exact:n,status:r,predicate:a,mutationKey:i}=e;if(i){if(!t.options.mutationKey)return!1;if(n){if(Ma(t.options.mutationKey)!==Ma(i))return!1}else if(!Fa(t.options.mutationKey,i))return!1}return!(r&&t.state.status!==r||a&&!a(t))}function Pa(e,t){return(t?.queryKeyHashFn||Ma)(e)}function Ma(e){return JSON.stringify(e,(e,t)=>za(t)?Object.keys(t).sort().reduce((e,n)=>(e[n]=t[n],e),{}):t)}function Fa(e,t){return e===t||typeof e==typeof t&&!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&Object.keys(t).every(n=>Fa(e[n],t[n]))}function Oa(e,t){if(e===t)return e;const n=Ba(e)&&Ba(t);if(n||za(e)&&za(t)){const r=n?e:Object.keys(e),a=r.length,i=n?t:Object.keys(t),o=i.length,s=n?[]:{},u=new Set(r);let c=0;for(let l=0;l<o;l++){const r=n?l:i[l];(!n&&u.has(r)||n)&&void 0===e[r]&&void 0===t[r]?(s[r]=void 0,c++):(s[r]=Oa(e[r],t[r]),s[r]===e[r]&&void 0!==e[r]&&c++)}return a===o&&c===a?e:s}return t}function La(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function Ba(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function za(e){if(!Ua(e))return!1;const t=e.constructor;if(void 0===t)return!0;const n=t.prototype;return!!Ua(n)&&!!n.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype}function Ua(e){return"[object Object]"===Object.prototype.toString.call(e)}function Wa(e,t,n){return"function"==typeof n.structuralSharing?n.structuralSharing(e,t):!1!==n.structuralSharing?Oa(e,t):t}function Va(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function Ha(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var qa=Symbol();function Ga(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:e.queryFn&&e.queryFn!==qa?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}function Ka(e,t){return"function"==typeof e?e(...t):!!e}var $a=new class extends ja{#e;#t;#n;constructor(){super(),this.#n=e=>{if(!Sa&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#n=e,this.#t?.(),this.#t=e(e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return"boolean"==typeof this.#e?this.#e:"hidden"!==globalThis.document?.visibilityState}},Xa=new class extends ja{#r=!0;#t;#n;constructor(){super(),this.#n=e=>{if(!Sa&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#n=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#r!==e&&(this.#r=e,this.listeners.forEach(t=>{t(e)}))}isOnline(){return this.#r}};function Ya(){let e,t;const n=new Promise((n,r)=>{e=n,t=r});function r(e){Object.assign(n,e),delete n.resolve,delete n.reject}return n.status="pending",n.catch(()=>{}),n.resolve=t=>{r({status:"fulfilled",value:t}),e(t)},n.reject=e=>{r({status:"rejected",reason:e}),t(e)},n}function Qa(e){return Math.min(1e3*2**e,3e4)}function Ja(e){return"online"!==(e??"online")||Xa.isOnline()}var Za=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function ei(e){let t,n=!1,r=0;const a=Ya(),i=()=>"pending"!==a.status,o=()=>$a.isFocused()&&("always"===e.networkMode||Xa.isOnline())&&e.canRun(),s=()=>Ja(e.networkMode)&&e.canRun(),u=e=>{i()||(t?.(),a.resolve(e))},c=e=>{i()||(t?.(),a.reject(e))},l=()=>new Promise(n=>{t=e=>{(i()||o())&&n(e)},e.onPause?.()}).then(()=>{t=void 0,i()||e.onContinue?.()}),d=()=>{if(i())return;let t;const a=0===r?e.initialPromise:void 0;try{t=a??e.fn()}catch(s){t=Promise.reject(s)}Promise.resolve(t).then(u).catch(t=>{if(i())return;const a=e.retry??(Sa?0:3),s=e.retryDelay??Qa,u="function"==typeof s?s(r,t):s,h=!0===a||"number"==typeof a&&r<a||"function"==typeof a&&a(r,t);var p;!n&&h?(r++,e.onFail?.(r,t),(p=u,new Promise(e=>{setTimeout(e,p)})).then(()=>o()?void 0:l()).then(()=>{n?c(t):d()})):c(t)})};return{promise:a,status:()=>a.status,cancel:t=>{i()||(c(new Za(t)),e.abort?.())},continue:()=>(t?.(),a),cancelRetry:()=>{n=!0},continueRetry:()=>{n=!1},canStart:s,start:()=>(s()?d():l().then(d),a)}}var ti=e=>setTimeout(e,0),ni=function(){let e=[],t=0,n=e=>{e()},r=e=>{e()},a=ti;const i=r=>{t?e.push(r):a(()=>{n(r)})};return{batch:i=>{let o;t++;try{o=i()}finally{t--,t||(()=>{const t=e;e=[],t.length&&a(()=>{r(()=>{t.forEach(e=>{n(e)})})})})()}return o},batchCalls:e=>(...t)=>{i(()=>{e(...t)})},schedule:i,setNotifyFunction:e=>{n=e},setBatchNotifyFunction:e=>{r=e},setScheduler:e=>{a=e}}}(),ri=class{#a;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Ra(this.gcTime)&&(this.#a=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Sa?1/0:3e5))}clearGcTimeout(){this.#a&&(clearTimeout(this.#a),this.#a=void 0)}},ai=class extends ri{#i;#o;#s;#u;#c;#l;#d;constructor(e){super(),this.#d=!1,this.#l=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#u=e.client,this.#s=this.#u.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#i=function(e){const t="function"==typeof e.initialData?e.initialData():e.initialData,n=void 0!==t,r=n?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}(this.options),this.state=e.state??this.#i,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#c?.promise}setOptions(e){this.options={...this.#l,...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||this.#s.remove(this)}setData(e,t){const n=Wa(this.state.data,e,this.options);return this.#h({data:n,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),n}setState(e,t){this.#h({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#c?.promise;return this.#c?.cancel(e),t?t.then(Ea).catch(Ea):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#i)}isActive(){return this.observers.some(e=>!1!==Ta(e.options.enabled,this))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===qa||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===Ia(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!_a(this.state.dataUpdatedAt,e))}onFocus(){const e=this.observers.find(e=>e.shouldFetchOnWindowFocus());e?.refetch({cancelRefetch:!1}),this.#c?.continue()}onOnline(){const e=this.observers.find(e=>e.shouldFetchOnReconnect());e?.refetch({cancelRefetch:!1}),this.#c?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#c&&(this.#d?this.#c.cancel({revert:!0}):this.#c.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#h({type:"invalidate"})}async fetch(e,t){if("idle"!==this.state.fetchStatus&&"rejected"!==this.#c?.status())if(void 0!==this.state.data&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#c)return this.#c.continueRetry(),this.#c.promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const n=new AbortController,r=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(this.#d=!0,n.signal)})},a=()=>{const e=Ga(this.options,t),n=(()=>{const e={client:this.#u,queryKey:this.queryKey,meta:this.meta};return r(e),e})();return this.#d=!1,this.options.persister?this.options.persister(e,n,this):e(n)},i=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#u,state:this.state,fetchFn:a};return r(e),e})();this.options.behavior?.onFetch(i,this),this.#o=this.state,"idle"!==this.state.fetchStatus&&this.state.fetchMeta===i.fetchOptions?.meta||this.#h({type:"fetch",meta:i.fetchOptions?.meta}),this.#c=ei({initialPromise:t?.initialPromise,fn:i.fetchFn,abort:n.abort.bind(n),onFail:(e,t)=>{this.#h({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#h({type:"pause"})},onContinue:()=>{this.#h({type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0});try{const e=await this.#c.start();if(void 0===e)throw new Error(`${this.queryHash} data is undefined`);return this.setData(e),this.#s.config.onSuccess?.(e,this),this.#s.config.onSettled?.(e,this.state.error,this),e}catch(o){if(o instanceof Za){if(o.silent)return this.#c.promise;if(o.revert)return this.setState({...this.#o,fetchStatus:"idle"}),this.state.data}throw this.#h({type:"error",error:o}),this.#s.config.onError?.(o,this),this.#s.config.onSettled?.(this.state.data,o,this),o}finally{this.scheduleGc()}}#h(e){this.state=(t=>{switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...ii(t.data,this.options),fetchMeta:e.meta??null};case"success":const n={...t,data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#o=e.manual?n:void 0,n;case"error":const r=e.error;return{...t,error:r,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}})(this.state),ni.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:e})})}};function ii(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Ja(t.networkMode)?"fetching":"paused",...void 0===e&&{error:null,status:"pending"}}}var oi=class extends ja{constructor(e={}){super(),this.config=e,this.#p=new Map}#p;build(e,t,n){const r=t.queryKey,a=t.queryHash??Pa(r,t);let i=this.get(a);return i||(i=new ai({client:e,queryKey:r,queryHash:a,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(r)}),this.add(i)),i}add(e){this.#p.has(e.queryHash)||(this.#p.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#p.get(e.queryHash);t&&(e.destroy(),t===e&&this.#p.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){ni.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#p.get(e)}getAll(){return[...this.#p.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(e=>Aa(t,e))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>Aa(e,t)):t}notify(e){ni.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){ni.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){ni.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},si=class extends ri{#f;#m;#c;constructor(e){super(),this.mutationId=e.mutationId,this.#m=e.mutationCache,this.#f=[],this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#f.includes(e)||(this.#f.push(e),this.clearGcTimeout(),this.#m.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#f=this.#f.filter(t=>t!==e),this.scheduleGc(),this.#m.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#f.length||("pending"===this.state.status?this.scheduleGc():this.#m.remove(this))}continue(){return this.#c?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#h({type:"continue"})};this.#c=ei({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{this.#h({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#h({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#m.canRun(this)});const n="pending"===this.state.status,r=!this.#c.canStart();try{if(n)t();else{this.#h({type:"pending",variables:e,isPaused:r}),await(this.#m.config.onMutate?.(e,this));const t=await(this.options.onMutate?.(e));t!==this.state.context&&this.#h({type:"pending",context:t,variables:e,isPaused:r})}const a=await this.#c.start();return await(this.#m.config.onSuccess?.(a,e,this.state.context,this)),await(this.options.onSuccess?.(a,e,this.state.context)),await(this.#m.config.onSettled?.(a,null,this.state.variables,this.state.context,this)),await(this.options.onSettled?.(a,null,e,this.state.context)),this.#h({type:"success",data:a}),a}catch(a){try{throw await(this.#m.config.onError?.(a,e,this.state.context,this)),await(this.options.onError?.(a,e,this.state.context)),await(this.#m.config.onSettled?.(void 0,a,this.state.variables,this.state.context,this)),await(this.options.onSettled?.(void 0,a,e,this.state.context)),a}finally{this.#h({type:"error",error:a})}}finally{this.#m.runNext(this)}}#h(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),ni.batch(()=>{this.#f.forEach(t=>{t.onMutationUpdate(e)}),this.#m.notify({mutation:this,type:"updated",action:e})})}},ui=class extends ja{constructor(e={}){super(),this.config=e,this.#v=new Set,this.#g=new Map,this.#x=0}#v;#g;#x;build(e,t,n){const r=new si({mutationCache:this,mutationId:++this.#x,options:e.defaultMutationOptions(t),state:n});return this.add(r),r}add(e){this.#v.add(e);const t=ci(e);if("string"==typeof t){const n=this.#g.get(t);n?n.push(e):this.#g.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#v.delete(e)){const t=ci(e);if("string"==typeof t){const n=this.#g.get(t);if(n)if(n.length>1){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}else n[0]===e&&this.#g.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=ci(e);if("string"==typeof t){const n=this.#g.get(t),r=n?.find(e=>"pending"===e.state.status);return!r||r===e}return!0}runNext(e){const t=ci(e);if("string"==typeof t){const n=this.#g.get(t)?.find(t=>t!==e&&t.state.isPaused);return n?.continue()??Promise.resolve()}return Promise.resolve()}clear(){ni.batch(()=>{this.#v.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#v.clear(),this.#g.clear()})}getAll(){return Array.from(this.#v)}find(e){const t={exact:!0,...e};return this.getAll().find(e=>Da(t,e))}findAll(e={}){return this.getAll().filter(t=>Da(e,t))}notify(e){ni.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return ni.batch(()=>Promise.all(e.map(e=>e.continue().catch(Ea))))}};function ci(e){return e.options.scope?.id}function li(e){return{onFetch:(t,n)=>{const r=t.options,a=t.fetchOptions?.meta?.fetchMore?.direction,i=t.state.data?.pages||[],o=t.state.data?.pageParams||[];let s={pages:[],pageParams:[]},u=0;const c=async()=>{let n=!1;const c=Ga(t.options,t.fetchOptions),l=async(e,r,a)=>{if(n)return Promise.reject();if(null==r&&e.pages.length)return Promise.resolve(e);const i=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:r,direction:a?"backward":"forward",meta:t.options.meta};var i;return i=e,Object.defineProperty(i,"signal",{enumerable:!0,get:()=>(t.signal.aborted?n=!0:t.signal.addEventListener("abort",()=>{n=!0}),t.signal)}),e})(),o=await c(i),{maxPages:s}=t.options,u=a?Ha:Va;return{pages:u(e.pages,o,s),pageParams:u(e.pageParams,r,s)}};if(a&&i.length){const e="backward"===a,t={pages:i,pageParams:o},n=(e?hi:di)(r,t);s=await l(t,n,e)}else{const t=e??i.length;do{const e=0===u?o[0]??r.initialPageParam:di(r,s);if(u>0&&null==e)break;s=await l(s,e),u++}while(u<t)}return s};t.options.persister?t.fetchFn=()=>t.options.persister?.(c,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n):t.fetchFn=c}}}function di(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function hi(e,{pages:t,pageParams:n}){return t.length>0?e.getPreviousPageParam?.(t[0],t,n[0],n):void 0}var pi=class extends ja{constructor(e,t){super(),this.options=t,this.#u=e,this.#y=null,this.#b=Ya(),this.options.experimental_prefetchInRender||this.#b.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}#u;#w=void 0;#N=void 0;#k=void 0;#C;#j;#b;#y;#S;#E;#R;#_;#I;#T;#A=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#w.addObserver(this),fi(this.#w,this.options)?this.#D():this.updateResult(),this.#P())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return mi(this.#w,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return mi(this.#w,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#M(),this.#F(),this.#w.removeObserver(this)}setOptions(e){const t=this.options,n=this.#w;if(this.options=this.#u.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof Ta(this.options.enabled,this.#w))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#O(),this.#w.setOptions(this.options),t._defaulted&&!La(this.options,t)&&this.#u.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#w,observer:this});const r=this.hasListeners();r&&vi(this.#w,n,this.options,t)&&this.#D(),this.updateResult(),!r||this.#w===n&&Ta(this.options.enabled,this.#w)===Ta(t.enabled,this.#w)&&Ia(this.options.staleTime,this.#w)===Ia(t.staleTime,this.#w)||this.#L();const a=this.#B();!r||this.#w===n&&Ta(this.options.enabled,this.#w)===Ta(t.enabled,this.#w)&&a===this.#T||this.#z(a)}getOptimisticResult(e){const t=this.#u.getQueryCache().build(this.#u,e),n=this.createResult(t,e);return r=n,!La(this.getCurrentResult(),r)&&(this.#k=n,this.#j=this.options,this.#C=this.#w.state),n;var r}getCurrentResult(){return this.#k}trackResult(e,t){return new Proxy(e,{get:(e,n)=>(this.trackProp(n),t?.(n),Reflect.get(e,n))})}trackProp(e){this.#A.add(e)}getCurrentQuery(){return this.#w}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#u.defaultQueryOptions(e),n=this.#u.getQueryCache().build(this.#u,t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return this.#D({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#k))}#D(e){this.#O();let t=this.#w.fetch(this.options,e);return e?.throwOnError||(t=t.catch(Ea)),t}#L(){this.#M();const e=Ia(this.options.staleTime,this.#w);if(Sa||this.#k.isStale||!Ra(e))return;const t=_a(this.#k.dataUpdatedAt,e)+1;this.#_=setTimeout(()=>{this.#k.isStale||this.updateResult()},t)}#B(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#w):this.options.refetchInterval)??!1}#z(e){this.#F(),this.#T=e,!Sa&&!1!==Ta(this.options.enabled,this.#w)&&Ra(this.#T)&&0!==this.#T&&(this.#I=setInterval(()=>{(this.options.refetchIntervalInBackground||$a.isFocused())&&this.#D()},this.#T))}#P(){this.#L(),this.#z(this.#B())}#M(){this.#_&&(clearTimeout(this.#_),this.#_=void 0)}#F(){this.#I&&(clearInterval(this.#I),this.#I=void 0)}createResult(e,t){const n=this.#w,r=this.options,a=this.#k,i=this.#C,o=this.#j,s=e!==n?e.state:this.#N,{state:u}=e;let c,l={...u},d=!1;if(t._optimisticResults){const a=this.hasListeners(),i=!a&&fi(e,t),o=a&&vi(e,n,t,r);(i||o)&&(l={...l,...ii(u.data,e.options)}),"isRestoring"===t._optimisticResults&&(l.fetchStatus="idle")}let{error:h,errorUpdatedAt:p,status:f}=l;c=l.data;let m=!1;if(void 0!==t.placeholderData&&void 0===c&&"pending"===f){let e;a?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(e=a.data,m=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#R?.state.data,this.#R):t.placeholderData,void 0!==e&&(f="success",c=Wa(a?.data,e,t),d=!0)}if(t.select&&void 0!==c&&!m)if(a&&c===i?.data&&t.select===this.#S)c=this.#E;else try{this.#S=t.select,c=t.select(c),c=Wa(a?.data,c,t),this.#E=c,this.#y=null}catch(N){this.#y=N}this.#y&&(h=this.#y,c=this.#E,p=Date.now(),f="error");const v="fetching"===l.fetchStatus,g="pending"===f,x="error"===f,y=g&&v,b=void 0!==c,w={status:f,fetchStatus:l.fetchStatus,isPending:g,isSuccess:"success"===f,isError:x,isInitialLoading:y,isLoading:y,data:c,dataUpdatedAt:l.dataUpdatedAt,error:h,errorUpdatedAt:p,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>s.dataUpdateCount||l.errorUpdateCount>s.errorUpdateCount,isFetching:v,isRefetching:v&&!g,isLoadingError:x&&!b,isPaused:"paused"===l.fetchStatus,isPlaceholderData:d,isRefetchError:x&&b,isStale:gi(e,t),refetch:this.refetch,promise:this.#b,isEnabled:!1!==Ta(t.enabled,e)};if(this.options.experimental_prefetchInRender){const t=e=>{"error"===w.status?e.reject(w.error):void 0!==w.data&&e.resolve(w.data)},r=()=>{const e=this.#b=w.promise=Ya();t(e)},a=this.#b;switch(a.status){case"pending":e.queryHash===n.queryHash&&t(a);break;case"fulfilled":"error"!==w.status&&w.data===a.value||r();break;case"rejected":"error"===w.status&&w.error===a.reason||r()}}return w}updateResult(){const e=this.#k,t=this.createResult(this.#w,this.options);this.#C=this.#w.state,this.#j=this.options,void 0!==this.#C.data&&(this.#R=this.#w),La(t,e)||(this.#k=t,this.#U({listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,n="function"==typeof t?t():t;if("all"===n||!n&&!this.#A.size)return!0;const r=new Set(n??this.#A);return this.options.throwOnError&&r.add("error"),Object.keys(this.#k).some(t=>{const n=t;return this.#k[n]!==e[n]&&r.has(n)})})()}))}#O(){const e=this.#u.getQueryCache().build(this.#u,this.options);if(e===this.#w)return;const t=this.#w;this.#w=e,this.#N=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#P()}#U(e){ni.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#k)}),this.#u.getQueryCache().notify({query:this.#w,type:"observerResultsUpdated"})})}};function fi(e,t){return function(e,t){return!1!==Ta(t.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===t.retryOnMount)}(e,t)||void 0!==e.state.data&&mi(e,t,t.refetchOnMount)}function mi(e,t,n){if(!1!==Ta(t.enabled,e)&&"static"!==Ia(t.staleTime,e)){const r="function"==typeof n?n(e):n;return"always"===r||!1!==r&&gi(e,t)}return!1}function vi(e,t,n,r){return(e!==t||!1===Ta(r.enabled,e))&&(!n.suspense||"error"!==e.state.status)&&gi(e,n)}function gi(e,t){return!1!==Ta(t.enabled,e)&&e.isStaleByTime(Ia(t.staleTime,e))}var xi=class extends ja{#u;#k=void 0;#W;#V;constructor(e,t){super(),this.#u=e,this.setOptions(t),this.bindMethods(),this.#H()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#u.defaultMutationOptions(e),La(this.options,t)||this.#u.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#W,observer:this}),t?.mutationKey&&this.options.mutationKey&&Ma(t.mutationKey)!==Ma(this.options.mutationKey)?this.reset():"pending"===this.#W?.state.status&&this.#W.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#W?.removeObserver(this)}onMutationUpdate(e){this.#H(),this.#U(e)}getCurrentResult(){return this.#k}reset(){this.#W?.removeObserver(this),this.#W=void 0,this.#H(),this.#U()}mutate(e,t){return this.#V=t,this.#W?.removeObserver(this),this.#W=this.#u.getMutationCache().build(this.#u,this.options),this.#W.addObserver(this),this.#W.execute(e)}#H(){const e=this.#W?.state??{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0};this.#k={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#U(e){ni.batch(()=>{if(this.#V&&this.hasListeners()){const t=this.#k.variables,n=this.#k.context;"success"===e?.type?(this.#V.onSuccess?.(e.data,t,n),this.#V.onSettled?.(e.data,null,t,n)):"error"===e?.type&&(this.#V.onError?.(e.error,t,n),this.#V.onSettled?.(void 0,e.error,t,n))}this.listeners.forEach(e=>{e(this.#k)})})}},yi=t.createContext(void 0),bi=e=>{const n=t.useContext(yi);if(!n)throw new Error("No QueryClient set, use QueryClientProvider to set one");return n},wi=({client:e,children:r})=>(t.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),n.jsx(yi.Provider,{value:e,children:r})),Ni=t.createContext(!1);Ni.Provider;var ki,Ci,ji=t.createContext(function(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}()),Si=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function Ei(e,n,r){const a=t.useContext(Ni),i=t.useContext(ji),o=bi(),s=o.defaultQueryOptions(e);o.getDefaultOptions().queries?._experimental_beforeQuery?.(s),s._optimisticResults=a?"isRestoring":"optimistic",(e=>{if(e.suspense){const t=e=>"static"===e?e:Math.max(e??1e3,1e3),n=e.staleTime;e.staleTime="function"==typeof n?(...e)=>t(n(...e)):t(n),"number"==typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,1e3))}})(s),((e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))})(s,i),(e=>{t.useEffect(()=>{e.clearReset()},[e])})(i);const u=!o.getQueryCache().get(s.queryHash),[c]=t.useState(()=>new n(o,s)),l=c.getOptimisticResult(s),d=!a&&!1!==e.subscribed;if(t.useSyncExternalStore(t.useCallback(e=>{const t=d?c.subscribe(ni.batchCalls(e)):Ea;return c.updateResult(),t},[c,d]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),t.useEffect(()=>{c.setOptions(s)},[s,c]),((e,t)=>e?.suspense&&t.isPending)(s,l))throw Si(s,c,i);if((({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(a&&void 0===e.data||Ka(n,[e.error,r])))({result:l,errorResetBoundary:i,throwOnError:s.throwOnError,query:o.getQueryCache().get(s.queryHash),suspense:s.suspense}))throw l.error;if(o.getDefaultOptions().queries?._experimental_afterQuery?.(s,l),s.experimental_prefetchInRender&&!Sa&&((e,t)=>e.isLoading&&e.isFetching&&!t)(l,a)){const e=u?Si(s,c,i):o.getQueryCache().get(s.queryHash)?.promise;e?.catch(Ea).finally(()=>{c.updateResult()})}return s.notifyOnChangeProps?l:c.trackResult(l)}function Ri(e,t){return Ei(e,pi)}function _i(e,n){const r=bi(),[a]=t.useState(()=>new xi(r,e));t.useEffect(()=>{a.setOptions(e)},[a,e]);const i=t.useSyncExternalStore(t.useCallback(e=>a.subscribe(ni.batchCalls(e)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),o=t.useCallback((e,t)=>{a.mutate(e,t).catch(Ea)},[a]);if(i.error&&Ka(a.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:o,mutateAsync:i.mutate}}
/**
     * @remix-run/router v1.23.0
     *
     * Copyright (c) Remix Software Inc.
     *
     * This source code is licensed under the MIT license found in the
     * LICENSE.md file in the root directory of this source tree.
     *
     * @license MIT
     */function Ii(){return Ii=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ii.apply(this,arguments)}(Ci=ki||(ki={})).Pop="POP",Ci.Push="PUSH",Ci.Replace="REPLACE";const Ti="popstate";function Ai(e){return void 0===e&&(e={}),function(e,t,n,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:i=!1}=r,o=a.history,s=ki.Pop,u=null,c=l();function l(){return(o.state||{idx:null}).idx}function d(){s=ki.Pop;let e=l(),t=null==e?null:e-c;c=e,u&&u({action:s,location:m.location,delta:t})}function h(e,t){s=ki.Push;let n=Fi(m.location,e,t);c=l()+1;let r=Mi(n,c),d=m.createHref(n);try{o.pushState(r,"",d)}catch(h){if(h instanceof DOMException&&"DataCloneError"===h.name)throw h;a.location.assign(d)}i&&u&&u({action:s,location:m.location,delta:1})}function p(e,t){s=ki.Replace;let n=Fi(m.location,e,t);c=l();let r=Mi(n,c),a=m.createHref(n);o.replaceState(r,"",a),i&&u&&u({action:s,location:m.location,delta:0})}function f(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,n="string"==typeof e?e:Oi(e);return n=n.replace(/ $/,"%20"),Di(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==c&&(c=0,o.replaceState(Ii({},o.state,{idx:c}),""));let m={get action(){return s},get location(){return e(a,o)},listen(e){if(u)throw new Error("A history only accepts one active listener");return a.addEventListener(Ti,d),u=e,()=>{a.removeEventListener(Ti,d),u=null}},createHref:e=>t(a,e),createURL:f,encodeLocation(e){let t=f(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:h,replace:p,go:e=>o.go(e)};return m}(function(e,t){let{pathname:n,search:r,hash:a}=e.location;return Fi("",{pathname:n,search:r,hash:a},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"==typeof t?t:Oi(t)},0,e)}function Di(e,t){if(!1===e||null==e)throw new Error(t)}function Pi(e,t){if(!e)try{throw new Error(t)}catch(n){}}function Mi(e,t){return{usr:e.state,key:e.key,idx:t}}function Fi(e,t,n,r){return void 0===n&&(n=null),Ii({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?Li(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function Oi(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function Li(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var Bi,zi;function Ui(e,t,n){return void 0===n&&(n="/"),function(e,t,n){let r="string"==typeof t?Li(t):t,a=Yi(r.pathname||"/",n);if(null==a)return null;let i=Wi(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(i);let o=null;for(let s=0;null==o&&s<i.length;++s){let e=Xi(a);o=Ki(i[s],e)}return o}(e,t,n)}function Wi(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let a=(e,a,i)=>{let o={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};o.relativePath.startsWith("/")&&(Di(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));let s=eo([r,o.relativePath]),u=n.concat(o);e.children&&e.children.length>0&&(Di(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),Wi(e.children,t,u,s)),(null!=e.path||e.index)&&t.push({path:s,score:Gi(s,e.index),routesMeta:u})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of Vi(e.path))a(e,t,r);else a(e,t)}),t}function Vi(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,a=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===r.length)return a?[i,""]:[i];let o=Vi(r.join("/")),s=[];return s.push(...o.map(e=>""===e?i:[i,e].join("/"))),a&&s.push(...o),s.map(t=>e.startsWith("/")&&""===t?"/":t)}(zi=Bi||(Bi={})).data="data",zi.deferred="deferred",zi.redirect="redirect",zi.error="error";const Hi=/^:[\w-]+$/,qi=e=>"*"===e;function Gi(e,t){let n=e.split("/"),r=n.length;return n.some(qi)&&(r+=-2),t&&(r+=2),n.filter(e=>!qi(e)).reduce((e,t)=>e+(Hi.test(t)?3:""===t?1:10),r)}function Ki(e,t,n){let{routesMeta:r}=e,a={},i="/",o=[];for(let s=0;s<r.length;++s){let e=r[s],n=s===r.length-1,u="/"===i?t:t.slice(i.length)||"/",c=$i({path:e.relativePath,caseSensitive:e.caseSensitive,end:n},u),l=e.route;if(!c)return null;Object.assign(a,c.params),o.push({params:a,pathname:eo([i,c.pathname]),pathnameBase:to(eo([i,c.pathnameBase])),route:l}),"/"!==c.pathnameBase&&(i=eo([i,c.pathnameBase]))}return o}function $i(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0),Pi("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":""!==e&&"/"!==e&&(a+="(?:(?=\\/|$))");let i=new RegExp(a,t?void 0:"i");return[i,r]}(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let i=a[0],o=i.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:a}=t;if("*"===r){let e=s[n]||"";o=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const u=s[n];return e[r]=a&&!u?void 0:(u||"").replace(/%2F/g,"/"),e},{}),pathname:i,pathnameBase:o,pattern:e}}function Xi(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return Pi(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function Yi(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function Qi(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function Ji(e,t){let n=function(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function Zi(e,t,n,r){let a;void 0===r&&(r=!1),"string"==typeof e?a=Li(e):(a=Ii({},e),Di(!a.pathname||!a.pathname.includes("?"),Qi("?","pathname","search",a)),Di(!a.pathname||!a.pathname.includes("#"),Qi("#","pathname","hash",a)),Di(!a.search||!a.search.includes("#"),Qi("#","search","hash",a)));let i,o=""===e||""===a.pathname,s=o?"/":a.pathname;if(null==s)i=n;else{let e=t.length-1;if(!r&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;a.pathname=t.join("/")}i=e>=0?t[e]:"/"}let u=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:a=""}="string"==typeof e?Li(e):e,i=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:i,search:no(r),hash:ro(a)}}(a,i),c=s&&"/"!==s&&s.endsWith("/"),l=(o||"."===s)&&n.endsWith("/");return u.pathname.endsWith("/")||!c&&!l||(u.pathname+="/"),u}const eo=e=>e.join("/").replace(/\/\/+/g,"/"),to=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),no=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",ro=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"",ao=["post","put","patch","delete"];new Set(ao);const io=["get",...ao];
/**
     * React Router v6.30.1
     *
     * Copyright (c) Remix Software Inc.
     *
     * This source code is licensed under the MIT license found in the
     * LICENSE.md file in the root directory of this source tree.
     *
     * @license MIT
     */
function oo(){return oo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},oo.apply(this,arguments)}new Set(io);const so=t.createContext(null),uo=t.createContext(null),co=t.createContext(null),lo=t.createContext(null),ho=t.createContext({outlet:null,matches:[],isDataRoute:!1}),po=t.createContext(null);function fo(){return null!=t.useContext(lo)}function mo(){return fo()||Di(!1),t.useContext(lo).location}function vo(e){t.useContext(co).static||t.useLayoutEffect(e)}function go(){let{isDataRoute:e}=t.useContext(ho);return e?function(){let{router:e}=function(){let e=t.useContext(so);return e||Di(!1),e}(jo.UseNavigateStable),n=Eo(So.UseNavigateStable),r=t.useRef(!1);return vo(()=>{r.current=!0}),t.useCallback(function(t,a){void 0===a&&(a={}),r.current&&("number"==typeof t?e.navigate(t):e.navigate(t,oo({fromRouteId:n},a)))},[e,n])}():function(){fo()||Di(!1);let e=t.useContext(so),{basename:n,future:r,navigator:a}=t.useContext(co),{matches:i}=t.useContext(ho),{pathname:o}=mo(),s=JSON.stringify(Ji(i,r.v7_relativeSplatPath)),u=t.useRef(!1);return vo(()=>{u.current=!0}),t.useCallback(function(t,r){if(void 0===r&&(r={}),!u.current)return;if("number"==typeof t)return void a.go(t);let i=Zi(t,JSON.parse(s),o,"path"===r.relative);null==e&&"/"!==n&&(i.pathname="/"===i.pathname?n:eo([n,i.pathname])),(r.replace?a.replace:a.push)(i,r.state,r)},[n,a,s,o,e])}()}function xo(){let{matches:e}=t.useContext(ho),n=e[e.length-1];return n?n.params:{}}function yo(e,n){let{relative:r}=void 0===n?{}:n,{future:a}=t.useContext(co),{matches:i}=t.useContext(ho),{pathname:o}=mo(),s=JSON.stringify(Ji(i,a.v7_relativeSplatPath));return t.useMemo(()=>Zi(e,JSON.parse(s),o,"path"===r),[e,s,o,r])}function bo(e,n){return function(e,n,r,a){fo()||Di(!1);let{navigator:i}=t.useContext(co),{matches:o}=t.useContext(ho),s=o[o.length-1],u=s?s.params:{};!s||s.pathname;let c=s?s.pathnameBase:"/";s&&s.route;let l,d=mo();if(n){var h;let e="string"==typeof n?Li(n):n;"/"===c||(null==(h=e.pathname)?void 0:h.startsWith(c))||Di(!1),l=e}else l=d;let p=l.pathname||"/",f=p;if("/"!==c){let e=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(e.length).join("/")}let m=Ui(e,{pathname:f}),v=function(e,n,r,a){var i;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===a&&(a=null),null==e){var o;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(o=a)&&o.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let s=e,u=null==(i=r)?void 0:i.errors;if(null!=u){let e=s.findIndex(e=>e.route.id&&void 0!==(null==u?void 0:u[e.route.id]));e>=0||Di(!1),s=s.slice(0,Math.min(s.length,e+1))}let c=!1,l=-1;if(r&&a&&a.v7_partialHydration)for(let t=0;t<s.length;t++){let e=s[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(l=t),e.route.id){let{loaderData:t,errors:n}=r,a=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||a){c=!0,s=l>=0?s.slice(0,l+1):[s[0]];break}}}return s.reduceRight((e,a,i)=>{let o,d=!1,h=null,p=null;var f;r&&(o=u&&a.route.id?u[a.route.id]:void 0,h=a.route.errorElement||No,c&&(l<0&&0===i?(Ro[f="route-fallback"]||(Ro[f]=!0),d=!0,p=null):l===i&&(d=!0,p=a.route.hydrateFallbackElement||null)));let m=n.concat(s.slice(0,i+1)),v=()=>{let n;return n=o?h:d?p:a.route.Component?t.createElement(a.route.Component,null):a.route.element?a.route.element:e,t.createElement(Co,{match:a,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:n})};return r&&(a.route.ErrorBoundary||a.route.errorElement||0===i)?t.createElement(ko,{location:r.location,revalidation:r.revalidation,component:h,error:o,children:v(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):v()},null)}(m&&m.map(e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:eo([c,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:eo([c,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,r,a);return n&&v?t.createElement(lo.Provider,{value:{location:oo({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:ki.Pop}},v):v}(e,n)}function wo(){let e=function(){var e;let n=t.useContext(po),r=function(){let e=t.useContext(uo);return e||Di(!1),e}(),a=Eo();return void 0!==n?n:null==(e=r.errors)?void 0:e[a]}(),n=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:a},r):null,null)}const No=t.createElement(wo,null);class ko extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){}render(){return void 0!==this.state.error?t.createElement(ho.Provider,{value:this.props.routeContext},t.createElement(po.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Co(e){let{routeContext:n,match:r,children:a}=e,i=t.useContext(so);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(ho.Provider,{value:n},a)}var jo=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(jo||{}),So=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(So||{});function Eo(e){let n=function(){let e=t.useContext(ho);return e||Di(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||Di(!1),r.route.id}const Ro={};function _o(e){Di(!1)}function Io(e){let{basename:n="/",children:r=null,location:a,navigationType:i=ki.Pop,navigator:o,static:s=!1,future:u}=e;fo()&&Di(!1);let c=n.replace(/^\/*/,"/"),l=t.useMemo(()=>({basename:c,navigator:o,static:s,future:oo({v7_relativeSplatPath:!1},u)}),[c,u,o,s]);"string"==typeof a&&(a=Li(a));let{pathname:d="/",search:h="",hash:p="",state:f=null,key:m="default"}=a,v=t.useMemo(()=>{let e=Yi(d,c);return null==e?null:{location:{pathname:e,search:h,hash:p,state:f,key:m},navigationType:i}},[c,d,h,p,f,m,i]);return null==v?null:t.createElement(co.Provider,{value:l},t.createElement(lo.Provider,{children:r,value:v}))}function To(e){let{children:t,location:n}=e;return bo(Ao(t),n)}function Ao(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,(e,a)=>{if(!t.isValidElement(e))return;let i=[...n,a];if(e.type===t.Fragment)return void r.push.apply(r,Ao(e.props.children,i));e.type!==_o&&Di(!1),e.props.index&&e.props.children&&Di(!1);let o={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=Ao(e.props.children,i)),r.push(o)}),r}
/**
     * React Router DOM v6.30.1
     *
     * Copyright (c) Remix Software Inc.
     *
     * This source code is licensed under the MIT license found in the
     * LICENSE.md file in the root directory of this source tree.
     *
     * @license MIT
     */function Do(){return Do=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Do.apply(this,arguments)}function Po(e){return void 0===e&&(e=""),new URLSearchParams("string"==typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(e=>[n,e]):[[n,r]])},[]))}new Promise(()=>{});const Mo=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(IE){}const Fo=j.startTransition;function Oo(e){let{basename:n,children:r,future:a,window:i}=e,o=t.useRef();null==o.current&&(o.current=Ai({window:i,v5Compat:!0}));let s=o.current,[u,c]=t.useState({action:s.action,location:s.location}),{v7_startTransition:l}=a||{},d=t.useCallback(e=>{l&&Fo?Fo(()=>c(e)):c(e)},[c,l]);return t.useLayoutEffect(()=>s.listen(d),[s,d]),t.useEffect(()=>{return null==(e=a)||e.v7_startTransition,void(null==e||e.v7_relativeSplatPath);var e},[a]),t.createElement(Io,{basename:n,children:r,location:u.location,navigationType:u.action,navigator:s,future:a})}const Lo="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,Bo=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zo=t.forwardRef(function(e,n){let r,{onClick:a,relative:i,reloadDocument:o,replace:s,state:u,target:c,to:l,preventScrollReset:d,viewTransition:h}=e,p=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,Mo),{basename:f}=t.useContext(co),m=!1;if("string"==typeof l&&Bo.test(l)&&(r=l,Lo))try{let e=new URL(window.location.href),t=l.startsWith("//")?new URL(e.protocol+l):new URL(l),n=Yi(t.pathname,f);t.origin===e.origin&&null!=n?l=n+t.search+t.hash:m=!0}catch(IE){}let v=function(e,n){let{relative:r}=void 0===n?{}:n;fo()||Di(!1);let{basename:a,navigator:i}=t.useContext(co),{hash:o,pathname:s,search:u}=yo(e,{relative:r}),c=s;return"/"!==a&&(c="/"===s?a:eo([a,s])),i.createHref({pathname:c,search:u,hash:o})}(l,{relative:i}),g=function(e,n){let{target:r,replace:a,state:i,preventScrollReset:o,relative:s,viewTransition:u}=void 0===n?{}:n,c=go(),l=mo(),d=yo(e,{relative:s});return t.useCallback(t=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(t,r)){t.preventDefault();let n=void 0!==a?a:Oi(l)===Oi(d);c(e,{replace:n,state:i,preventScrollReset:o,relative:s,viewTransition:u})}},[l,c,d,a,i,r,e,o,s,u])}(l,{replace:s,state:u,target:c,preventScrollReset:d,relative:i,viewTransition:h});return t.createElement("a",Do({},p,{href:r||v,onClick:m||o?a:function(e){a&&a(e),e.defaultPrevented||g(e)},ref:n,target:c}))});var Uo,Wo,Vo,Ho;function qo(e){let n=t.useRef(Po(e)),r=t.useRef(!1),a=mo(),i=t.useMemo(()=>function(e,t){let n=Po(e);return t&&t.forEach((e,r)=>{n.has(r)||t.getAll(r).forEach(e=>{n.append(r,e)})}),n}(a.search,r.current?null:n.current),[a.search]),o=go(),s=t.useCallback((e,t)=>{const n=Po("function"==typeof e?e(i):e);r.current=!0,o("?"+n,t)},[o,i]);return[i,s]}(Wo=Uo||(Uo={})).UseScrollRestoration="useScrollRestoration",Wo.UseSubmit="useSubmit",Wo.UseSubmitFetcher="useSubmitFetcher",Wo.UseFetcher="useFetcher",Wo.useViewTransitionState="useViewTransitionState",(Ho=Vo||(Vo={})).UseFetcher="useFetcher",Ho.UseFetchers="useFetchers",Ho.UseScrollRestoration="useScrollRestoration";const Go=[{icon:Gt,label:"Home",href:"/"},{icon:pn,label:"Search",href:"/search"},{icon:$t,label:"Your Library",href:"/library"}],Ko=[{icon:sn,label:"Create Playlist",href:"/create-playlist"},{icon:qt,label:"Liked Songs",href:"/liked"},{icon:zt,label:"Downloaded",href:"/downloaded"}],$o=[{icon:Rt,label:"Analytics",href:"/analytics"},{icon:mn,label:"Social",href:"/social"},{icon:Et,label:"Webcam Studio",href:"/webcam"},{icon:Sn,label:"Face Profiles",href:"/face-profiles"}];function Xo(){const e=mo();return n.jsxs("div",{className:"w-64 bg-vibetune-darker h-full flex flex-col",children:[n.jsx("div",{className:"p-6",children:n.jsxs(zo,{to:"/",className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-8 h-8 bg-vibetune-green rounded-full flex items-center justify-center",children:n.jsx(nn,{className:"w-5 h-5 text-black"})}),n.jsx("span",{className:"text-xl font-bold text-white",children:"VibeTune"})]})}),n.jsx("nav",{className:"px-3 space-y-1",children:Go.map(t=>{const r=e.pathname===t.href;return n.jsxs(zo,{to:t.href,className:Nr("flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium transition-colors",r?"bg-vibetune-gray text-white":"text-vibetune-text-muted hover:text-white hover:bg-vibetune-gray"),children:[n.jsx(t.icon,{className:"w-5 h-5"}),n.jsx("span",{children:t.label})]},t.href)})}),n.jsxs("div",{className:"mt-8 px-3",children:[n.jsx("div",{className:"space-y-1",children:Ko.map(t=>{const r=e.pathname===t.href;return n.jsxs(zo,{to:t.href,className:Nr("flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium transition-colors",r?"bg-vibetune-gray text-white":"text-vibetune-text-muted hover:text-white hover:bg-vibetune-gray"),children:[n.jsx(t.icon,{className:"w-5 h-5"}),n.jsx("span",{children:t.label})]},t.href)})}),n.jsxs("div",{className:"mt-6 border-t border-vibetune-gray pt-4",children:[n.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-vibetune-text-muted uppercase tracking-wider",children:"Features"}),n.jsx("div",{className:"space-y-1",children:$o.map(t=>{const r=e.pathname===t.href;return n.jsxs(zo,{to:t.href,className:Nr("flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium transition-colors",r?"bg-vibetune-gray text-white":"text-vibetune-text-muted hover:text-white hover:bg-vibetune-gray"),children:[n.jsx(t.icon,{className:"w-5 h-5"}),n.jsx("span",{children:t.label})]},t.href)})})]}),n.jsx("div",{className:"mt-6 border-t border-vibetune-gray pt-4",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-vibetune-text-muted uppercase tracking-wider",children:"Recently Created"}),["My Playlist #1","Chill Vibes","Workout Mix","Study Focus"].map(e=>n.jsx(zo,{to:`/playlist/${e.toLowerCase().replace(/\s+/g,"-")}`,className:"block px-3 py-2 text-sm text-vibetune-text-muted hover:text-white transition-colors",children:e},e))]})})]}),n.jsx("div",{className:"mt-auto p-3 border-t border-vibetune-gray",children:n.jsxs("div",{className:"flex items-center space-x-2 text-xs text-vibetune-text-muted",children:[n.jsx("span",{children:"Privacy"}),n.jsx("span",{children:"•"}),n.jsx("span",{children:"Terms"}),n.jsx("span",{children:"•"}),n.jsx("span",{children:"About"})]})})]})}const Yo=vt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Qo=t.forwardRef(({className:e,variant:t,size:r,asChild:a=!1,...i},o)=>{const s=a?S:"button";return n.jsx(s,{className:Nr(Yo({variant:t,size:r,className:e})),ref:o,...i})});Qo.displayName="Button";const Jo=O,Zo=L;t.forwardRef(({className:e,inset:t,children:r,...a},i)=>n.jsxs(E,{ref:i,className:Nr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...a,children:[r,n.jsx(At,{className:"ml-auto h-4 w-4"})]})).displayName=E.displayName,t.forwardRef(({className:e,...t},r)=>n.jsx(R,{ref:r,className:Nr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})).displayName=R.displayName;const es=t.forwardRef(({className:e,sideOffset:t=4,...r},a)=>n.jsx(_,{children:n.jsx(I,{ref:a,sideOffset:t,className:Nr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));es.displayName=I.displayName;const ts=t.forwardRef(({className:e,inset:t,...r},a)=>n.jsx(T,{ref:a,className:Nr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...r}));ts.displayName=T.displayName,t.forwardRef(({className:e,children:t,checked:r,...a},i)=>n.jsxs(A,{ref:i,className:Nr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...a,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(D,{children:n.jsx(_t,{className:"h-4 w-4"})})}),t]})).displayName=A.displayName,t.forwardRef(({className:e,children:t,...r},a)=>n.jsxs(P,{ref:a,className:Nr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(D,{children:n.jsx(Lt,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=P.displayName,t.forwardRef(({className:e,inset:t,...r},a)=>n.jsx(M,{ref:a,className:Nr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r})).displayName=M.displayName;const ns=t.forwardRef(({className:e,...t},r)=>n.jsx(F,{ref:r,className:Nr("-mx-1 my-1 h-px bg-muted",e),...t}));ns.displayName=F.displayName;const rs=t.createContext(void 0);function as({children:e}){const[r,a]=t.useState(null),[i,o]=t.useState(!0);t.useEffect(()=>{(async()=>{try{const e=new URLSearchParams(window.location.search),t=e.get("sessionToken"),n=e.get("user");if(t&&n){localStorage.setItem("vibetune_session",t);const e=JSON.parse(decodeURIComponent(n));a(e),localStorage.setItem("vibetune_user",JSON.stringify(e)),window.history.replaceState({},document.title,window.location.pathname)}else{const e=localStorage.getItem("vibetune_user"),t=localStorage.getItem("vibetune_session");if(e&&t)a(JSON.parse(e));else{const e=localStorage.getItem("spotifySessionToken");if(e)try{const t=await fetch("/api/auth/user",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const n=await t.json();n?.user&&(a({id:n.user.id,displayName:n.user.display_name,email:n.user.email,country:n.user.country,followers:n.user.followers?.total??0,images:n.user.images??[],product:n.user.product}),localStorage.setItem("vibetune_user",JSON.stringify({id:n.user.id,displayName:n.user.display_name,email:n.user.email,country:n.user.country,followers:n.user.followers?.total??0,images:n.user.images??[],product:n.user.product})),localStorage.setItem("vibetune_session",e))}}catch{}}}}catch(e){localStorage.removeItem("vibetune_user"),localStorage.removeItem("vibetune_session")}finally{o(!1)}})()},[]);const s=async()=>{try{const e=await fetch("/api/auth/spotify/url"),{authUrl:t}=await e.json();if(!e.ok)throw new Error("Failed to get auth URL");window.location.href=t}catch(e){throw e}},u={user:r,isLoading:i,isAuthenticated:!!r,login:async(e,t)=>(await s(),!0),loginWithSpotify:s,signup:async(e,t,n)=>(await s(),!0),logout:async()=>{try{localStorage.removeItem("vibetune_user"),localStorage.removeItem("vibetune_session")}catch(e){}finally{a(null)}},updateProfile:async e=>{if(!r)return!1;try{const t={...r,...e};return a(t),localStorage.setItem("vibetune_user",JSON.stringify(t)),!0}catch(t){return!1}},setUser:a};return n.jsx(rs.Provider,{value:u,children:e})}function is(){const e=t.useContext(rs);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}const os=q,ss=G,us=z,cs=t.forwardRef(({className:e,...t},r)=>n.jsx(B,{ref:r,className:Nr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));cs.displayName=B.displayName;const ls=t.forwardRef(({className:e,children:t,...r},a)=>n.jsxs(us,{children:[n.jsx(cs,{}),n.jsxs(U,{ref:a,className:Nr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,n.jsxs(W,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[n.jsx(_n,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ls.displayName=U.displayName;const ds=({className:e,...t})=>n.jsx("div",{className:Nr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});ds.displayName="DialogHeader";const hs=t.forwardRef(({className:e,...t},r)=>n.jsx(V,{ref:r,className:Nr("text-lg font-semibold leading-none tracking-tight",e),...t}));hs.displayName=V.displayName,t.forwardRef(({className:e,...t},r)=>n.jsx(H,{ref:r,className:Nr("text-sm text-muted-foreground",e),...t})).displayName=H.displayName;
/**
     * @license
     * Copyright 2020 Google LLC. All Rights Reserved.
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     * =============================================================================
     */
var ps=function(e,t){return(ps=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function fs(e,t){function n(){this.constructor=e}ps(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function ms(e,t,n,r){return new(n||(n=Promise))(function(t,a){function i(e){try{s(r.next(e))}catch(t){a(t)}}function o(e){try{s(r.throw(e))}catch(t){a(t)}}function s(e){e.done?t(e.value):new n(function(t){t(e.value)}).then(i,o)}s((r=r.apply(e,[])).next())})}function vs(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var gs=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){this.platform,this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(t){var n=t.split(":"),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,a)})}},e}();function xs(){return ys}var ys=null,bs=new Map,ws=new Map;function Ns(e,t){var n=Ss(e,t);return bs.get(n)}function ks(e){for(var t=bs.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=i[0],s=i[1];o.split("_")[0]===e&&n.push(s)}return n}function Cs(e){var t=e.kernelName,n=e.backendName,r=Ss(t,n);if(bs.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");bs.set(r,e)}function js(e){var t=e.kernelName;ws.has(t),ws.set(t,e)}function Ss(e,t){return t+"_"+e}function Es(e,t,n){return Math.max(e,Math.min(t,n))}function Rs(e){return e%2==0?e:e+1}function _s(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Is(e,t,n){void 0===n&&(n=""),_s(Ps(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function Ts(e){_s(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function As(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||Hs(e)&&!n)for(var r=0;r<e.length;++r)As(e[r],t,n);else t.push(e);return t}function Ds(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Ps(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ms(e){return e%1==0}function Fs(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Os(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Ls(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Bs(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,a){var i=0,o=function(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}};o()})}function zs(e,t){var n=t.length;return _s((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),_s(e.every(function(e){return Ms(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function Us(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:zs(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Ws(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Vs(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Hs(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function qs(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function Gs(e){return"string"==typeof e||e instanceof String}function Ks(e){return Array.isArray(e)?Ks(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":function(e){return"number"==typeof e}(e)?"float32":Gs(e)?"string":function(e){return"boolean"==typeof e}(e)?"bool":"float32"}function $s(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Xs(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Ys(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Qs(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=As(e)),n&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}(e,t),a=t,(r=e)instanceof Float32Array&&"float32"===a||r instanceof Int32Array&&"int32"===a||r instanceof Uint8Array&&"bool"===a)return e;var r,a;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var i=new Uint8Array(e.length),o=0;o<i.length;++o)0!==Math.round(e[o])&&(i[o]=1);return i}throw new Error("Unknown data type "+t)}function Js(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var a=new Array;if(1===n.length)for(var i=n[0],o=0;o<i;o++)a[o]=r[t+o];else{i=n[0];var s=n.slice(1),u=s.reduce(function(e,t){return e*t});for(o=0;o<i;o++)a[o]=e(t+o*u,s,r)}return a}(0,e,t)}function Zs(e,t){for(var n=eu(e,t),r=0;r<n.length;r++)n[r]=1;return n}function eu(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function tu(){return xs().platform.now()}function nu(e){e.forEach(function(t){_s(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function ru(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",xs().platform.decode(e,t)}function au(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}var iu=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new ou)}return e.prototype.profileKernel=function(e,t,n){var r,a=this,i=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(e,t){if("float32"!==t)return!1;for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))return!0}}(r,n.dtype),i.then(function(i){var o="";null!=i.getExtraProfileInfo&&(o=i.getExtraProfileInfo()),a.logger.logKernelProfile(e,n,r,i.kernelMs,t,o)})})}),r},e}(),ou=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,a,i){for(var o in"number"==typeof r?Ls(r+"ms",9):r.error,Ls(e,25),t.rank,t.size,Ls(t.shape.toString(),14),a){var s=a[o].shape||t.shape;s.length}},e}();function su(e,t,n){return Ls(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Gs(e)?"'"+e+"'":"bool"===n?uu(e):parseFloat(e.toFixed(7)).toString(),t)}function uu(e){return 0===e?"false":"true"}function cu(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var lu=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=Ds(e),null!=n){var a=n.length;_s(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Vs(t,this.size),this.strides=Ys(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),_s(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var a=this.locToIndex(n);this.values[a]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,a=e;r<a.length;r++){var i=a[r];if(i<0||i>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return du().makeTensor(this.values,this.shape,this.dtype)},e}(),du=null,hu=null,pu=null,fu=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ds(e),this.strides=Ys(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),_s(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),this.reshape([e,t,n,r,a])},e.prototype.asType=function(e){return this.throwIfDisposed(),hu.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return ms(this,0,void 0,function(){var e;return vs(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,hu.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return hu.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return ms(this,0,void 0,function(){var e;return vs(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Js(this.shape,e)]}})})},e.prototype.arraySync=function(){return Js(this.shape,this.dataSync())},e.prototype.data=function(){return ms(this,0,void 0,function(){var e,t;return vs(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=du().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(e){return ru(e)})]}catch(r){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var e=du().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return ru(e)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return ms(this,0,void 0,function(){var e;return vs(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,du().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(du().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),hu.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),hu.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),hu.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),hu.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),hu.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),hu.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),hu.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var a=Ys(t),i=function(e,t,n,r){var a=Ds(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?cu(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,d=0;d<i;d++)o[d]=Math.max(o[d],su(u[l+d],0,n).length);return o}(e,t,n,a),o=t.length,s=function e(t,n,r,a,i,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[su(cu(t)[0],0,r)]:"bool"===r?[uu(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=3*s,d=Array.from(t.slice(0,l)),h=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(d=cu(d),h=cu(h)),["["+d.map(function(e,t){return su(e,i[t],r)}).join(", ")+", ..., "+h.map(function(e,t){return su(e,i[u-3+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?cu(t):Array.from(t)).map(function(e,t){return su(e,i[t],r)}).join(", ")+"]"]}var p=n.slice(1),f=a.slice(1),m=a[0]*s,v=[];if(u>20){for(var g=0;g<3;g++){var x=(y=g*m)+m;v.push.apply(v,e(t.slice(y,x),p,r,f,i,!1))}for(v.push("..."),g=u-3;g<u;g++)x=(y=g*m)+m,v.push.apply(v,e(t.slice(y,x),p,r,f,i,g===u-1))}else for(g=0;g<u;g++){var y;x=(y=g*m)+m,v.push.apply(v,e(t.slice(y,x),p,r,f,i,g===u-1))}var b=2===c?",":"";for(v[0]="["+v[0]+b,g=1;g<v.length-1;g++)v[g]=" "+v[g]+b;var w=",\n";for(g=2;g<c;g++)w+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(o?"":w),v}(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),hu.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),hu.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),hu.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),hu.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),hu.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),hu.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),hu.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),hu.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),hu.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),hu.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),hu.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),hu.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,a){return void 0===n&&(n=.001),pu("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,r,n)},e.prototype.batchNorm=function(e,t,n,r,a){return void 0===a&&(a=.001),this.throwIfDisposed(),hu.batchNorm(this,e,t,n,r,a)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),hu.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),hu.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),hu.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),hu.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),hu.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),hu.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),hu.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),hu.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),hu.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),hu.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),hu.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),hu.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),hu.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),hu.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),hu.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),hu.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),hu.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),hu.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),hu.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),hu.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),hu.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),hu.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),hu.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),hu.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),hu.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),hu.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),hu.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),hu.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),hu.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),hu.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),hu.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),hu.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),hu.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),hu.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),hu.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),hu.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),hu.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),hu.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),hu.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),hu.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),hu.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),hu.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),hu.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),hu.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),hu.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),hu.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),hu.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),hu.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),hu.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),hu.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),hu.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),hu.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),hu.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),hu.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),hu.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),hu.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),hu.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),hu.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),hu.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),hu.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),hu.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),hu.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),hu.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),hu.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),hu.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),hu.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),hu.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),hu.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),hu.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),hu.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),hu.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),hu.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),hu.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),hu.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),hu.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),hu.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),hu.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),hu.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),hu.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),hu.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),hu.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),hu.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),hu.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),hu.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),hu.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),hu.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),hu.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),hu.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),hu.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),hu.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),hu.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),hu.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),hu.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),hu.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),hu.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),hu.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,a,i){return void 0===r&&(r="NWC"),void 0===a&&(a=1),this.throwIfDisposed(),hu.conv1d(this,e,t,n,r,a,i)},e.prototype.conv2d=function(e,t,n,r,a,i){return void 0===r&&(r="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),hu.conv2d(this,e,t,n,r,a,i)},e.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),hu.conv2dTranspose(this,e,t,n,r,a)},e.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return void 0===r&&(r="NHWC"),void 0===a&&(a=[1,1]),this.throwIfDisposed(),hu.depthwiseConv2d(this,e,t,n,r,a,i)},e.prototype.separableConv2d=function(e,t,n,r,a,i){return void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),hu.separableConv2d(this,e,t,n,r,a,i)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),hu.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),hu.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),hu.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),hu.pool(this,e,t,n,r,a)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),du().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),hu.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),hu.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),hu.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),hu.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return void 0===r&&(r=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),hu.stridedSlice(this,e,t,n,r,a,i,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),hu.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),hu.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),hu.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),hu.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),hu.spectral.irfft(this)},e}();Object.defineProperty(fu,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var mu,vu,gu,xu,yu,bu,wu=function(e){function t(t,n,r,a){var i=e.call(this,t.shape,t.dtype,t.dataId,a)||this;return i.trainable=n,i.name=r,i}return fs(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!Ps(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");du().disposeTensor(this),this.dataId=e.dataId,du().incRef(this,null)},t.prototype.dispose=function(){du().disposeVariable(this),this.isDisposedInternal=!0},t}(fu);Object.defineProperty(wu,Symbol.hasInstance,{value:function(e){return e instanceof fu&&null!=e.assign&&e.assign instanceof Function}}),(bu=mu||(mu={})).R0="R0",bu.R1="R1",bu.R2="R2",bu.R3="R3",bu.R4="R4",bu.R5="R5",bu.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(vu||(vu={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(gu||(gu={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(xu||(xu={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(yu||(yu={}));var Nu={float32:xu,int32:vu,bool:gu,complex64:yu};function ku(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Nu[e][t]}function Cu(e){return ku(e,"int32")}function ju(e,t){if(e.dtype===t.dtype)return[e,t];var n=ku(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Su(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof fu)n.push(t);else if(a=t,Array.isArray(a)||"object"==typeof a){var a,i=t;for(var o in i){var s=i[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var Eu,Ru=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),_u=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ru}return e.prototype.ready=function(){return ms(this,0,void 0,function(){var e,t,n;return vs(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),!(e in this.registryFactory)&&(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return ms(this,0,void 0,function(){var t,n,r;return vs(this,function(a){switch(a.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=a.sent(),[3,3];case 2:r=n,a.label=3;case 3:if(!r)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new iu(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var e=this;ks(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},e.prototype.disposeRegisteredKernels=function(e){var t=this;ks(e).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])})},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var a=++this.pendingBackendInitId,i=r.then(function(n){return!(a<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))}).catch(function(e){return!(a<t.pendingBackendInitId||(t.pendingBackendInit=null,1))});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(o){return{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(n)},function(){return n=t()})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(e){return{x:function(){return e.toFloat()}}},[]),t},e.prototype.runKernel=function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach(function(e){a+="complex64"===e.dtype?3:1});var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,a,i,o){var s,u=this;void 0===i&&(i=[]),void 0===o&&(o=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var d,h=function(e){l&&(c=e.map(function(e){return u.keep(u.clone(e))}))},p=this.state.numBytes,f=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=Ns(r,this.backendName);return d=null!=v?function(){var e=u.backend.numDataIds();m=v.kernelFunc({inputs:t,attrs:a,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map(function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}),c=s.filter(function(e,t){return o[t]});return h((i||[]).slice().concat(c)),s}:function(){var t=u.backend.numDataIds();m=u.tidy(function(){return e(u.backend,h)});var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,function(){return d()}):d()}),l&&this.addTapeNode(r,t,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-f,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShapes:s.map(function(e){return e.shape})}),Array.isArray(m)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&Gs(e[0])&&(a=e.map(function(e){return function(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",xs().platform.encode(e,t)}(e)}));var i=r.write(a,t,n),o=new fu(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var a=new fu(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var a=new wu(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*qs(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof wu||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return ms(this,0,void 0,function(){var t,n;return vs(this,function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,a){var i=this,o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},s=function(e){return ws.get(e)}(e);null!=s&&(r=s.gradFunc),null!=r&&(o.gradient=function(e){return e=e.map(function(e,t){if(null==e){var r=n[t],a=eu(r.size,r.dtype);return i.makeTensor(a,r.shape,r.dtype)}return e}),r(e.length>1?e:e[0],a)}),this.state.activeTape.push(o)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Su(e),r=new Set(n.map(function(e){return e.id})),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==o.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var a=this;if(void 0===r&&(r=!1),_s(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",e)});_s(i instanceof fu,function(){return"The result y returned by f() must be a tensor."});var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(i=0;i<e.length;i++){var o=(f=e[i]).inputs;for(var s in o){for(var u=o[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){f.outputs.forEach(function(e){return r[e.id]=!0}),c=!0,a[f.id]=!0;break}if(c)break}}var d={};d[n.id]=!0;var h={};for(i=e.length-1;i>=0;i--)for(o=(f=e[i]).inputs,l=0;l<f.outputs.length;l++)if(d[f.outputs[l].id]){for(var s in o)d[o[s].id]=!0,h[f.id]=!0;break}var p=[];for(i=0;i<e.length;i++){var f;if(a[(f=e[i]).id]&&h[f.id]){var m={};for(var s in f.inputs){var v=f.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},f);g.inputs=m,g.outputs=f.outputs,p.push(g)}}return p}(this.state.activeTape,t,i);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e,r,s={};s[i.id]=null==n?(r=Zs(Ds(e=i.shape),"float32"),Iu.makeTensor(r,e,"float32")):n,function(e,t){for(var n=function(n){var r=t[n],i=[];if(r.outputs.forEach(function(t){var n=e[t.id];null!=n?i.push(n):i.push(null)}),null==r.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+r.kernelName+".");var o=r.gradient(i),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var n=function(e){return a.tidy(e)}(function(){return o[t]()});if("float32"!==n.dtype)throw new Error("Error in gradient for op "+r.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+n.dtype+"'");var i=r.inputs[t];if(!Ps(n.shape,i.shape))throw new Error("Error in gradient for op "+r.kernelName+". The gradient of input '"+t+"' has shape '"+n.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==e[i.id])e[i.id]=n;else{var s=e[i.id];e[i.id]=s.add(n),s.dispose()}};for(var u in r.inputs)s(u)},r=t.length-1;r>=0;r--)n(r)}(s,o);var u=t.map(function(e){return s[e.id]});return 0===a.state.gradientDepth&&(a.state.activeTape.forEach(function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()}),a.state.activeTape=null),{value:i,grads:u}})},e.prototype.customGrad=function(e){var t=this;return _s($s(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];_s(r.every(function(e){return e instanceof fu}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return r.forEach(function(e,t){i[t]=e}),t.runKernelFunc(function(t,a){return _s((n=e.apply(void 0,r.concat([a]))).value instanceof fu,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),_s($s(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},i,function(e,t){var a=n.gradFunc(e,t),i=Array.isArray(a)?a:[a];_s(i.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),_s(i.every(function(e){return e instanceof fu}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var o={};return i.forEach(function(e,t){o[t]=function(){return e}}),o})}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return ms(this,0,void 0,function(){var t,n;return vs(this,function(r){switch(r.label){case 0:return t=tu(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=tu()-t,[2,n]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ru,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),Iu=function(){var e,t=function(){if(null==Eu){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Eu=e}return Eu}();if(null==t._tfengine){var n=new gs(t);t._tfengine=new _u(n)}return e=t._tfengine.ENV,ys=e,du=function(){return t._tfengine},t._tfengine}();function Tu(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Au=xs();Au.registerFlag("DEBUG",function(){return!1},function(e){}),Au.registerFlag("IS_BROWSER",function(){return Tu()}),Au.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Au.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Au.registerFlag("PROD",function(){return!1}),Au.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Au.getBool("DEBUG")}),Au.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Au.registerFlag("IS_TEST",function(){return!1});var Du,Pu,Mu,Fu={},Ou={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Lu(e){e in Fu||(Fu[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Fu[e]},!1),1===e?t.getContext("webgl",Ou)||t.getContext("experimental-webgl",Ou):t.getContext("webgl2",Ou)}(e));var t=Fu[e];return t.isContextLost()?(delete Fu[e],Lu(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Fu[e])}function Bu(e,t){return[t,e]}function zu(e){var t=Ds(e);return Os(Math.ceil(t/4))}function Uu(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Wu(e,t){var n,r,a,i,o,s,u,c,l,d=e;return 2===xs().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,a=d.RGBA16F,i=d.RGBA32F,o=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=d.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Vu(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}(e,t))}(e),r}function Hu(e){return!!(xs().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function qu(e,t,n){return tc(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Du||(Du={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Pu||(Pu={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Mu||(Mu={}));var Gu,Ku,$u=/ERROR: [0-9]+:([0-9]+):/g;function Xu(e,t,n){if(Vu(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw new Error("Shader program validation failed.")}function Yu(e,t,n,r,a,i,o,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Vu(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,a)}),Vu(e,t,function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,o,s)}),Vu(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function Qu(e,t,n,r){(function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")})(e,r),Vu(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),Vu(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function Ju(e,t,n,r){Vu(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),Vu(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function Zu(e,t,n){Vu(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),Vu(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function ec(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}(e,t))}function tc(e,t,n,r){var a=Vu(e,t,function(){return n()});if(null==a)throw new Error(r);return a}function nc(e,t){return void 0===t&&(t=2),Ds(e.slice(0,e.length-t))}function rc(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function ac(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[nc(e)].concat(rc(e))),t}function ic(e){return e%2==0}function oc(e,t){if(Ps(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(ic(n)&&ic(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&ic(e[0])&&ic(t[0])}function sc(e,t){return null!=e.getExtension(t)}function uc(e){try{if(null!=Lu(e))return!0}catch(t){return!1}return!1}function cc(e){var t=Wu(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}var lc=xs();function dc(e){xs().getBool("DEPRECATION_WARNINGS_ENABLED")}function hc(e,t){return Iu.tidy(e,t)}function pc(e){Su(e).forEach(function(e){return e.dispose()})}function fc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];xs().getBool("IS_TEST")}function mc(e,t){var n=e;if(Hs(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Hs(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&xs().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Hs(t)){_s(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),_s(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}else _s(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(e,r,[]),r}function vc(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function gc(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof fu)return vc(r,e.dtype,t,n),e;var a=Ks(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),vc(r,a,t,n),null==e||!Hs(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var o=mc(e,a);Hs(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?Qs(e,a,xs().getBool("DEBUG")):As(e,[],!0);return Iu.makeTensor(s,o,a)}function xc(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return gc(e,t+"["+r+"]",n)},r)}function yc(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function bc(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map(function(t){return e[t]})]}function wc(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map(function(e){return 1}),t)}function Nc(e,t,n){_s(yc(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function kc(e,t){if(yc(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function Cc(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function jc(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Sc(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Ec(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Iu.startScope(n);try{var a=r.apply(void 0,e);return Iu.endScope(a),a}catch(i){throw Iu.endScope(null),i}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}lc.registerFlag("HAS_WEBGL",function(){return lc.getNumber("WEBGL_VERSION")>0}),lc.registerFlag("WEBGL_VERSION",function(){return uc(2)?2:uc(1)?1:0}),lc.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===lc.get("WEBGL_VERSION")}),lc.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),lc.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),lc.registerFlag("WEBGL_PACK",function(){return lc.getBool("HAS_WEBGL")}),lc.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_PACK_CLIP",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),lc.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_PACK_REDUCE",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_LAZILY_UNPACK",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_CONV_IM2COL",function(){return lc.getBool("WEBGL_PACK")}),lc.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return function(e){if(null==Gu){var t=Lu(e);Gu=t.getParameter(t.MAX_TEXTURE_SIZE)}return Gu}(lc.getNumber("WEBGL_VERSION"))}),lc.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return function(e){if(null==Ku){var t=Lu(e);Ku=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ku)}(lc.getNumber("WEBGL_VERSION"))}),lc.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=lc.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=Lu(e);return sc(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:sc(t,"EXT_disjoint_timer_query")?1:0}(e)}),lc.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return lc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),lc.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return function(e){if(0===e)return!1;var t=Lu(e);if(1===e){if(!sc(t,"OES_texture_float"))return!1}else if(!sc(t,"EXT_color_buffer_float"))return!1;return cc(t)}(lc.getNumber("WEBGL_VERSION"))}),lc.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!lc.getBool("WEBGL_FORCE_F16_TEXTURES")&&lc.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),lc.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return function(e){if(0===e)return!1;var t=Lu(e);if(1!==e){if(sc(t,"EXT_color_buffer_float"))return cc(t);if(sc(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=Wu(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!!sc(t,"OES_texture_float")&&!!sc(t,"WEBGL_color_buffer_float")&&cc(t)}(lc.getNumber("WEBGL_VERSION"))}),lc.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return function(e){return 2===e&&null!=Lu(e).fenceSync}(lc.getNumber("WEBGL_VERSION"))}),lc.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return lc.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),pu=dc;var Rc=Ec({complex_:function(e,t){var n=gc(e,"real","complex"),r=gc(t,"imag","complex");return Is(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Iu.runKernelFunc(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),_c=Ec({real_:function(e){var t=gc(e,"input","real");return Iu.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),Ic=Ec({imag_:function(e){var t=gc(e,"input","imag");return Iu.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function Tc(e,t,n){return Ac(e,t,mc(e,n),n)}function Ac(e,t,n,r){if(null==r&&(r=Ks(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Hs(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){nu(t);var a=Ds(t),i=Ds(n);_s(a===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+i});for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==Ds(t.slice(o));_s(n[o]===t[o]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return Hs(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Qs(e,r,xs().getBool("DEBUG")):As(e,[],!0),Iu.makeTensor(e,t,r)}function Dc(e,t){if((Hs(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Hs(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ac(e,[],[],t)}function Pc(e,t){Ts(e);var n=mc(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ac(e,null,n,t)}function Mc(e,t,n){if(Ts(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=mc(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ac(e,t,r,n)}function Fc(e,t,n){if(Ts(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=mc(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ac(e,t,r,n)}function Oc(e,t,n){if(Ts(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=mc(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ac(e,t,r,n)}function Lc(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Lc(e,"float32"),r=Bc(e,"float32");return Rc(n,r)}var a=Zs(Ds(e),t);return Iu.makeTensor(a,e,t)}function Bc(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Bc(e,"float32"),r=Bc(e,"float32");return Rc(n,r)}var a=eu(Ds(e),t);return Iu.makeTensor(a,e,t)}function zc(e,t,n){return Iu.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function Uc(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Bc([0],r);var a=eu(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return Pc(a,r)}var Wc=Ec({onesLike_:function(e){var t=gc(e,"x","onesLike");if("complex64"===t.dtype){var n=Wc(_c(t)),r=Vc(Ic(t));return Rc(n,r)}return Iu.runKernelFunc(function(e){return e.onesLike(t)},{$x:t},function(e,t){return{$x:function(){return Vc(e)}}})}}),Vc=Ec({zerosLike_:function(e){var t=gc(e,"x","zerosLike");return Iu.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,t){return{$x:function(){return Vc(e)}}})}}),Hc=Ec({concat_:function(e,t){void 0===t&&(t=0),_s(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=xc(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")}),t=zs(t,n[0].shape)[0];var r=Sc(n.map(function(e){return e.shape}),t);if(0===Ds(r))return Tc([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var a=n.map(function(e){return e.shape});!function(e,t){var n=e[0].length;e.forEach(function(e,t){_s(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),_s(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,a){for(var i=0;i<n;i++)_s(i===t||e[i]===r[i],function(){return"Error in concat"+n+"D: Shape of tensors["+a+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+a+"."})})}(a,t);var i=n,o={axis:t};return Iu.runKernelFunc(function(e){return e.concat(n,t)},i,function(e){var n=a.map(function(e){return e[t]});return Xc(e,n,t).map(function(e){return function(){return e}})},"Concat",o)}}),qc=Ec({concat1d_:function(e){return Hc(e,0)}}),Gc=Ec({concat2d_:function(e,t){return Hc(e,t)}}),Kc=Ec({concat3d_:function(e,t){return Hc(e,t)}}),$c=Ec({concat4d_:function(e,t){return Hc(e,t)}}),Xc=Ec({split_:function(e,t,n){void 0===n&&(n=0);var r,a=gc(e,"x","split");return n=zs(n,a.shape)[0],"number"==typeof t?(_s(a.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(a.shape[n]/t)):(_s(a.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),Iu.runKernelFunc(function(e){return e.split(a,r,n)},{$x:a},function(e){return{$x:function(){return Hc(e,n)}}})}});function Yc(e,t){return e(t={exports:{}},t.exports),t.exports}var Qc=Yc(function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var a=new n(e),i=t&&t.state,o=a.next;return o.int32=function(){return 4294967296*a.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.alea=a}(0,e)}),Jc=Yc(function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xor128=a}(0,e)}),Zc=Yc(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xorwow=a}(0,e)}),el=Yc(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&(i.x&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xorshift7=a}(0,e)}),tl=Yc(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&(i.X&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.xor4096=a}(0,e)}),nl=Yc(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var a=new n(e),i=t&&t.state,o=function(){return(a.next()>>>0)/4294967296};return o.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=a.next,o.quick=o,i&&("object"==typeof i&&r(i,a),o.state=function(){return r(a,{})}),o}t&&t.exports?t.exports=a:this.tychei=a}(0,e)}),rl=Yc(function(e){!function(t,n){var r,a=this,i=256,o="random",s=n.pow(i,6),u=n.pow(2,52),c=2*u,l=255;function d(e,l,d){var v=[],g=f(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(o){}return a.length?a:"string"==i?t:t+"\0"}((l=1==l?{entropy:!0}:l||{}).entropy?[e,m(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(s){var n=a.navigator,o=n&&n.plugins;return[+new Date,a,o,a.screen,m(t)]}}():e,3),v),x=new h(v),y=function(){for(var e=x.g(6),t=s,n=0;e<u;)e=(e+n)*i,t*=i,n=x.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|x.g(4)},y.quick=function(){return x.g(4)/4294967296},y.double=y,f(m(x.S),t),(l.pass||d||function(e,t,r,a){return a&&(a.S&&p(a,x),e.state=function(){return p(x,{})}),r?(n[o]=e,t):e})(y,g,"global"in l?l.global:this==n,l.state)}function h(e){var t,n=e.length,r=this,a=0,o=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<i;)s[a]=a++;for(a=0;a<i;a++)s[a]=s[o=l&o+e[a%n]+(t=s[a])],s[o]=t;(r.g=function(e){for(var t,n=0,a=r.i,o=r.j,s=r.S;e--;)t=s[a=l&a+1],n=n*i+s[l&(s[a]=s[o=l&o+t])+(s[o]=t)];return r.i=a,r.j=o,n})(i)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){for(var n,r=e+"",a=0;a<r.length;)t[l&a]=l&(n^=19*t[l&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(n["seed"+o]=d,f(n.random(),t),e.exports){e.exports=d;try{r=require("crypto")}catch(v){}}}([],Math)});rl.alea=Qc,rl.xor128=Jc,rl.xorwow=Zc,rl.xorshift7=el,rl.xor4096=tl,rl.tychei=nl;var al=rl.alea,il=function(){function e(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=a||Math.random();this.random=al(i.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),ol=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var a=r||Math.random();this.randu=al(a.toString()),this.randn=new il(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),sl=function(){function e(e,t,n,r){var a=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==a.dtype||"float32"===a.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=al(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function ul(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",nu(e),new lu(e,t,n)}var cl=Ec({batchToSpaceND_:function(e,t,n){var r=gc(e,"x","batchToSpaceND"),a=t.reduce(function(e,t){return e*t});return _s(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),_s(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),_s(r.shape[0]%a==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a}),Iu.runKernelFunc(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),ll=Ec({broadcastTo_:function(e,t){var n=gc(e,"broadcastTo","x"),r=n.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=n.reshape(a)}for(var i=Array.from(t),o=t.length-1;o>=0;o--)if(n.shape[o]===t[o])i[o]=1;else if(1!==n.shape[o])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=i.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0});return 0===s.length?n.clone():Iu.runKernelFunc(function(e){return e.tile(n,i)},{input:n},function(e){return{input:function(){return e.sum(s,!0)}}})}}),dl=Ec({cast_:function(e,t){var n=gc(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return Iu.runKernelFunc(function(e){return e.cast(n,t)},{x:n},function(e){return{x:function(){return e.clone()}}},"Cast",r)}}),hl=Ec({clone_:function(e){var t=gc(e,"x","clone",null);return Iu.runKernelFunc(function(){return Iu.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),pl=Ec({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var a=gc(e,"x","cumsum"),i=kc([t|=0],a.rank),o=a;null!=i&&(o=a.transpose(i));var s=jc(1,a.rank)[0],u=Iu.runKernelFunc(function(e){return e.cumsum(o,s,n,r)},{permutedX:o},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),fl=Ec({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=gc(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return _s(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),_s(i*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),_s(o%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape}),Iu.runKernelFunc(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),ml=Ec({expandDims_:function(e,t){void 0===t&&(t=0);var n=gc(e,"x","expandDims",null);_s(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(_s(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),Rl(n,r)}}),vl=Ec({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var a=ul([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=a.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return Al(ml(s,0),[n[0],1,1]);if(2===n.length)return Al(ml(ml(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Al(ml(ml(ml(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),gl=Ec({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var a=gc(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?a.as2D(1,-1):a,u=Iu.runKernelFunc(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===o?u.as1D():u}}),xl=Ec({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=gc(e,"indices","oneHot","int32"),i=a.shape.concat([t]);return a=a.flatten(),Iu.runKernelFunc(function(e){return e.oneHot(a,t,n,r)},{$indices:a},function(e){return{$indices:function(){return Bc(a.shape,"float32")}}}).reshape(i)}}),yl=Ec({pad_:function(e,t,n){void 0===n&&(n=0);var r=gc(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n};return Iu.runKernelFunc(function(e){return e.pad(r,t,n)},{x:r},function(e){var n=t.map(function(e){return e[0]});return{x:function(){return e.slice(n,r.shape)}}},"PadV2",a)}}),bl=Ec({pad1d_:function(e,t,n){return void 0===n&&(n=0),_s(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),yl(e,[t],n)}}),wl=Ec({pad2d_:function(e,t,n){return void 0===n&&(n=0),_s(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),yl(e,t,n)}}),Nl=Ec({pad3d_:function(e,t,n){return void 0===n&&(n=0),_s(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),yl(e,t,n)}}),kl=Ec({pad4d_:function(e,t,n){return void 0===n&&(n=0),_s(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),yl(e,t,n)}}),Cl=Ec({rand_:function(e,t,n){var r=Ds(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Iu.makeTensor(a,e,n)}}),jl=Ec({randomNormal_:function(e,t,n,r,a){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new il(t,n,r,!1,a),o=ul(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Sl=Ec({randomGamma_:function(e,t,n,r,a){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new ol(t,n,r,a),o=ul(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),El=Ec({randomUniform_:function(e,t,n,r,a){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=ul(e,r),o=new sl(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),Rl=Ec({reshape_:function(e,t){var n=gc(e,"x","reshape",null);t=function(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+a);r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found "+e[a]+" at dim "+a);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}(t,n.size),_s(n.size===Ds(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return Iu.runKernelFunc(function(e){return e.reshape(n,t)},{x:n},function(e){return{x:function(){return e.reshape(n.shape)}}},"Reshape",r)}}),_l=Ec({spaceToBatchND_:function(e,t,n){var r=gc(e,"x","spaceToBatchND");return _s(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),_s(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),_s(r.shape.reduce(function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),Iu.runKernelFunc(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),Il=Ec({squeeze_:function(e,t){var n=gc(e,"x","squeeze");return Rl(n,Us(n.shape,t).newShape)}}),Tl=Ec({stack_:function(e,t){void 0===t&&(t=0);var n=xc(e,"tensors","stack");if(_s(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,a=n[0].shape,i=n[0].dtype;_s(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){Is(a,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){_s(i===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=n.map(function(e){return e.expandDims(t)});return Hc(o,t)}}),Al=Ec({tile_:function(e,t){var n=gc(e,"x","tile",null);_s(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],a={reps:t};return Iu.runKernelFunc(function(e,r){var a=e.tile(n,t);return r([n]),a},{x:n},function(e,n){var r=n[0];return{x:function(){var n=Vc(r);if(1===r.rank)for(var a=0;a<t[0];++a)n=n.add(e.slice([a*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(a=0;a<t[0];++a)for(var i=0;i<t[1];++i)n=n.add(e.slice([a*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(a=0;a<t[0];++a)for(i=0;i<t[1];++i)for(var o=0;o<t[2];++o)n=n.add(e.slice([a*r.shape[0],i*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(a=0;a<t[0];++a)for(i=0;i<t[1];++i)for(o=0;o<t[2];++o)for(var s=0;s<t[3];++s)n=n.add(e.slice([a*r.shape[0],i*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}},"Tile",a,r)}}),Dl=Ec({truncatedNormal_:function(e,t,n,r,a){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new il(t,n,r,!0,a),o=ul(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Pl=Ec({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=gc(e,"x","unstack");_s(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return Iu.runKernelFunc(function(e){return e.unstack(n,t)},{x:n},function(e){return{x:function(){return Tl(e,t)}}},"Unpack",r)}});function Ml(e,t,n,r){void 0===r&&(r=!0);var a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function Fl(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{var i=[],o=[];for(a=1;a<e;++a)a>=2*t+1||a%2==1?o.push(a):i.push(a);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function Ol(e,t,n,r){void 0===r&&(r=!0);var a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function Ll(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Bl(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function zl(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],a=1,i=0;i<n.length-1;++i)a*=n[i];var o=e.shape,s=n.slice();s.pop();var u=1;for(i=r;i<e.rank;++i)u*=o[i],s.push(o[i]);var c=Ys(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,a,u,c]}function Ul(e){return e<=30?e:Xs(e,Math.floor(Math.sqrt(e)))}function Wl(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}!function(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+a+".";if(n.rank<a)throw new Error(i+" update.rank < "+a+". ");if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-a;++o)if(n.shape[o+a]!==e[o+r])throw new Error(i+" updates.shape["+(o+a)+"] ("+n.shape[o+a]+") != shape["+(o+a)+"] ("+e[o+a]+")")}(n,t,e)}function Vl(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:Ds(t.shape)/u,sliceSize:o,strides:Ys(n.slice(0,a)).concat([1]),outputSize:Ds(n)}}function Hl(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function ql(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Gl(e,t,n,r,a){var i=t[a],o=n[a]||1;(e&1<<a||null==i)&&(i=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[a];return i<0&&(i+=s),Es(0,i,s-1)}function Kl(e,t,n,r,a){var i=t[a],o=n[a]||1;(e&1<<a||null==i)&&(i=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[a];return i<0&&(i+=s),o>0?Es(0,i,s):Es(-1,i,s-1)}function $l(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function Xl(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Yl(e){return Iu.customGrad(e)}var Ql=Ec({softmax_:function(e,t){void 0===t&&(t=-1);var n=gc(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return Iu.runKernelFunc(function(e,r){var a=e.softmax(n,t);return r([a]),a},{logits:n},function(e,n){var r=n[0],a=e.mul(r);return{logits:function(){return a.sub(a.sum([t],!0).mul(r))}}},"Softmax",{dim:t},[],[!0])}}),Jl=Ec({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=gc(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Yl(function(e,n){var r=e.max(t,!0),a=e.sub(r),i=a.toFloat().sub(a.exp().sum(t,!0).log());return n([i]),{value:i,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}}),Zl=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),ed=function(){function e(){}return e.prototype.time=function(e){return td("time")},e.prototype.read=function(e){return td("read")},e.prototype.readSync=function(e){return td("readSync")},e.prototype.numDataIds=function(){return td("numDataIds")},e.prototype.disposeData=function(e){return td("disposeData")},e.prototype.write=function(e,t,n){return td("write")},e.prototype.move=function(e,t,n,r){return td("move")},e.prototype.memory=function(){return td("memory")},e.prototype.floatPrecision=function(){return td("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return td("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,td("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return td("slice")},e.prototype.stridedSlice=function(e,t,n,r){return td("stridedSlice")},e.prototype.unstack=function(e,t){return td("unstack")},e.prototype.reverse=function(e,t){return td("reverse")},e.prototype.concat=function(e,t){return td("concat")},e.prototype.neg=function(e){return td("neg")},e.prototype.add=function(e,t){return td("add")},e.prototype.addN=function(e){return td("addN")},e.prototype.subtract=function(e,t){return td("subtract")},e.prototype.multiply=function(e,t){return td("multiply")},e.prototype.realDivide=function(e,t){return td("realDivide")},e.prototype.floorDiv=function(e,t){return td("floorDiv")},e.prototype.sum=function(e,t){return td("sum")},e.prototype.prod=function(e,t){return td("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return td("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return td("argMin")},e.prototype.argMax=function(e,t){return td("argMax")},e.prototype.equal=function(e,t){return td("equal")},e.prototype.notEqual=function(e,t){return td("notEqual")},e.prototype.less=function(e,t){return td("less")},e.prototype.lessEqual=function(e,t){return td("lessEqual")},e.prototype.greater=function(e,t){return td("greater")},e.prototype.greaterEqual=function(e,t){return td("greaterEqual")},e.prototype.logicalNot=function(e){return td("logicalNot")},e.prototype.logicalAnd=function(e,t){return td("logicalAnd")},e.prototype.logicalOr=function(e,t){return td("logicalOr")},e.prototype.where=function(e){return td("where")},e.prototype.select=function(e,t,n){return td("select")},e.prototype.topk=function(e,t,n){return td("topk")},e.prototype.min=function(e,t){return td("min")},e.prototype.minimum=function(e,t){return td("minimum")},e.prototype.mod=function(e,t){return td("mod")},e.prototype.max=function(e,t){return td("max")},e.prototype.maximum=function(e,t){return td("maximum")},e.prototype.all=function(e,t){return td("all")},e.prototype.any=function(e,t){return td("any")},e.prototype.squaredDifference=function(e,t){return td("squaredDifference")},e.prototype.ceil=function(e){return td("ceil")},e.prototype.floor=function(e){return td("floor")},e.prototype.round=function(e){return td("round")},e.prototype.sign=function(e){return td("sign")},e.prototype.isNaN=function(e){return td("isNaN")},e.prototype.isInf=function(e){return td("isInf")},e.prototype.isFinite=function(e){return td("isFinite")},e.prototype.pow=function(e,t){return td("pow")},e.prototype.exp=function(e){return td("exp")},e.prototype.expm1=function(e){return td("expm1")},e.prototype.softmax=function(e,t){return td("softmax")},e.prototype.log=function(e){return td("log")},e.prototype.log1p=function(e){return td("log1p")},e.prototype.sqrt=function(e){return td("sqrt")},e.prototype.rsqrt=function(e){return td("rsqrt")},e.prototype.square=function(e){return td("square")},e.prototype.reciprocal=function(e){return td("reciprocal")},e.prototype.relu=function(e){return td("relu")},e.prototype.relu6=function(e){return td("relu6")},e.prototype.prelu=function(e,t){return td("prelu")},e.prototype.elu=function(e){return td("elu")},e.prototype.eluDer=function(e,t){return td("eluDer")},e.prototype.selu=function(e){return td("selu")},e.prototype.int=function(e){return td("int")},e.prototype.clip=function(e,t,n){return td("clip")},e.prototype.abs=function(e){return td("abs")},e.prototype.complexAbs=function(e){return td("complexAbs")},e.prototype.sigmoid=function(e){return td("sigmoid")},e.prototype.softplus=function(e){return td("softplus")},e.prototype.sin=function(e){return td("sin")},e.prototype.cos=function(e){return td("cos")},e.prototype.tan=function(e){return td("tan")},e.prototype.asin=function(e){return td("asin")},e.prototype.acos=function(e){return td("acos")},e.prototype.atan=function(e){return td("atan")},e.prototype.atan2=function(e,t){return td("atan2")},e.prototype.sinh=function(e){return td("sinh")},e.prototype.cosh=function(e){return td("cosh")},e.prototype.tanh=function(e){return td("tanh")},e.prototype.asinh=function(e){return td("asinh")},e.prototype.acosh=function(e){return td("acosh")},e.prototype.atanh=function(e){return td("atanh")},e.prototype.erf=function(e){return td("erf")},e.prototype.step=function(e,t){return td("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,td("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return td("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return td("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return td("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,td("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return td("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return td("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return td("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return td("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return td("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return td("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return td("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return td("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return td("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return td("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return td("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return td("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return td("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return td("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return td("reshape")},e.prototype.cast=function(e,t){return td("cast")},e.prototype.tile=function(e,t){return td("tile")},e.prototype.pad=function(e,t,n){return td("pad")},e.prototype.transpose=function(e,t){return td("transpose")},e.prototype.gather=function(e,t,n){return td("gather")},e.prototype.gatherND=function(e,t){return td("gatherND")},e.prototype.scatterND=function(e,t,n){return td("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return td("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return td("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return td("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return td("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return td("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return td("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,a,i){return td("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,a){return td("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,a,i,o){return td("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return td("multinomial")},e.prototype.oneHot=function(e,t,n,r){return td("oneHot")},e.prototype.cumsum=function(e,t,n,r){return td("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,a){return td("nonMaxSuppression")},e.prototype.fft=function(e){return td("fft")},e.prototype.ifft=function(e){return td("ifft")},e.prototype.complex=function(e,t){return td("complex")},e.prototype.real=function(e){return td("real")},e.prototype.imag=function(e){return td("imag")},e.prototype.cropAndResize=function(e,t,n,r,a,i){return td("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return td("depthToSpace")},e.prototype.split=function(e,t,n){return td("split")},e.prototype.sparseToDense=function(e,t,n,r){return td("sparseToDense")},e.prototype.diag=function(e){return td("diag")},e.prototype.fill=function(e,t,n){return td("fill")},e.prototype.onesLike=function(e){return td("onesLike")},e.prototype.zerosLike=function(e){return td("zerosLike")},e.prototype.linspace=function(e,t,n){return td("linspace")},e.prototype.dispose=function(){return td("dispose")},e}();function td(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function nd(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function rd(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function ad(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}function id(e,t,n,r,a,i,o){void 0===o&&(o="channelsLast");var s,u=ld(t),c=u[0],l=u[1];if("channelsLast"===o)s=[c,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[c,l,e[1],e[1]]}return sd(e,s,n,r,a,i,!1,o)}function od(e,t,n,r,a,i,o){void 0===o&&(o="NDHWC");var s,u,c=dd(t),l=c[0],d=c[1],h=c[2];if("NDHWC"===o)u="channelsLast",s=[l,d,h,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);u="channelsFirst",s=[l,d,h,e[1],e[1]]}return ud(e,s,n,r,a,!1,u,i)}function sd(e,t,n,r,a,i,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],h=u[3];if("channelsLast"===s)c=e[0],l=e[1],d=e[2],h=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],h=e[1],l=e[2],d=e[3]}var p,f=t[0],m=t[1],v=t[3],g=ld(n),x=g[0],y=g[1],b=ld(r),w=b[0],N=b[1],k=hd(f,w),C=hd(m,N),j=function(e,t,n,r,a,i,o,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=function(e,t,n,r,a){null==r&&(r=cd(e,t,n));var i=e[1],o=pd((e[0]-t+2*r)/n+1,a);_s(Ms(o),function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"});var s=pd((i-t+2*r)/n+1,a);return _s(Ms(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[o,s]}([t,n],i,r,e,s);c=d[0],l=d[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/a);var h=Math.max(0,(c-1)*r+i-t),p=Math.max(0,(l-1)*a+o-n),f=Math.floor(h/2),m=h-f,v=Math.floor(p/2);u={top:f,bottom:m,left:v,right:p-v,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-i+1)/r),l=Math.ceil((n-o+1)/a)}return{padInfo:u,outHeight:c,outWidth:l}}(a,l,d,x,y,k,C,i),S=j.padInfo,E=j.outHeight,R=j.outWidth,_=o?v*h:v;return"channelsFirst"===s?p=[c,_,E,R]:"channelsLast"===s&&(p=[c,E,R,_]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:d,inChannels:h,outHeight:E,outWidth:R,outChannels:_,padInfo:S,strideHeight:x,strideWidth:y,filterHeight:f,filterWidth:m,effectiveFilterHeight:k,effectiveFilterWidth:C,dilationHeight:w,dilationWidth:N,inShape:e,outShape:p,filterShape:t}}function ud(e,t,n,r,a,i,o,s){void 0===i&&(i=!1),void 0===o&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],h=u[3],p=u[4];if("channelsLast"===o)c=e[0],l=e[1],d=e[2],h=e[3],p=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);c=e[0],p=e[1],l=e[2],d=e[3],h=e[4]}var f,m=t[0],v=t[1],g=t[2],x=t[4],y=dd(n),b=y[0],w=y[1],N=y[2],k=dd(r),C=k[0],j=k[1],S=k[2],E=hd(m,C),R=hd(v,j),_=hd(g,S),I=function(e,t,n,r,a,i,o,s,u,c,l){var d,h,p,f;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=cd(e,t,r));var o=e[1],s=e[2],u=pd((e[0]-t+2*a)/r+1,i);_s(Ms(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var c=pd((o-t+2*a)/r+1,i);_s(Ms(c),function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"});var l=pd((s-t+2*a)/r+1,i);return _s(Ms(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,c,l,1]}([t,n,r,1],s,0,a,e,l);h=m[0],p=m[1],f=m[2]}else if("same"===e){var v=((h=Math.ceil(t/a))-1)*a+s-t,g=((p=Math.ceil(n/i))-1)*i+u-n,x=((f=Math.ceil(r/o))-1)*o+c-r,y=Math.floor(v/2),b=v-y,w=Math.floor(g/2),N=g-w,k=Math.floor(x/2);d={top:w,bottom:N,left:k,right:x-k,front:y,back:b,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((t-s+1)/a),p=Math.ceil((n-u+1)/i),f=Math.ceil((r-c+1)/o)}return{padInfo:d,outDepth:h,outHeight:p,outWidth:f}}(a,l,d,h,b,w,N,E,R,_,s),T=I.padInfo,A=I.outDepth,D=I.outHeight,P=I.outWidth,M=i?x*p:x;return"channelsFirst"===o?f=[c,M,A,D,P]:"channelsLast"===o&&(f=[c,A,D,P,M]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:d,inWidth:h,inChannels:p,outDepth:A,outHeight:D,outWidth:P,outChannels:M,padInfo:T,strideDepth:b,strideHeight:w,strideWidth:N,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:E,effectiveFilterHeight:R,effectiveFilterWidth:_,dilationDepth:C,dilationHeight:j,dilationWidth:S,inShape:e,outShape:f,filterShape:t}}function cd(e,t,n,r){void 0===r&&(r=1);var a=hd(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function ld(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function dd(e){return"number"==typeof e?[e,e,e]:e}function hd(e,t){return t<=1?e:e+(e-1)*(t-1)}function pd(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function fd(e){var t=ld(e),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function md(e,t){return fd(e)||fd(t)}function vd(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function gd(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Bc(e.shape),a=e.toFloat(),i=n.complex(a,r);return r.dispose(),a.dispose(),i}if(!function(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}(e.dtype,t))return Iu.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return i=o.cast(t),o.dispose(),i}if("int32"===t)return n.int(e);if("bool"===t){var s=Dc(0,e.dtype);return i=n.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function xd(e,t){return Iu.makeTensorFromDataId(e.dataId,t,e.dtype)}function yd(e,t,n){var r=(t-e)/(n-1),a=eu(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return Pc(a,"float32")}function bd(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function wd(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Nd(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function kd(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Cd(e,t,n){var r=function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||jd),a=r<0?-(r+1):r;e.splice(a,0,t)}function jd(e,t){return e>t?1:e<t?-1:0}function Sd(e,t,n,r,a){return Rd(e,t,n,r,a,0).selectedIndices}function Ed(e,t,n,r,a,i){var o=Rd(e,t,n,r,a,i);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function Rd(e,t,n,r,a,i,o,s){void 0===s&&(s=!1);for(var u=Array.from(t).map(function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}}).filter(function(e){return e.score>a}).sort(Td),c=i>0?-.5/i:0,l=[],d=[];l.length<n&&u.length>0;){var h=u.pop(),p=h.score,f=h.boxIndex,m=h.suppressBeginIndex;if(p<a)break;for(var v=!1,g=l.length-1;g>=m;--g){var x=_d(e,f,l[g]);if(x>=r){v=!0;break}if(h.score=h.score*Id(r,c,x),h.score<=a)break}h.suppressBeginIndex=l.length,v||(h.score===p?(l.push(f),d.push(h.score)):h.score>a&&Cd(u,h,Td))}var y=l.length;return s&&(l.fill(0,y),d.fill(0,y)),{selectedIndices:Pc(l,"int32"),selectedScores:Pc(d,"float32"),numValidOutputs:Dc(y,"int32")}}function _d(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),d=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),f=(d-c)*(h-l);if(p<=0||f<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,d),x=Math.min(u,h),y=Math.max(g-m,0)*Math.max(x-v,0);return y/(p+f-y)}function Id(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Td(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Ad(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map(function(t){a[n]=t;var i=e.slice(r,a);return r[n]+=t,i})}function Dd(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var a=ul(n,e.dtype);for(r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=i[s]%e.shape[s];var u=e.locToIndex(o);a.values[r]=e.values[u]}return a.toTensor()}function Pd(e,t,n,r,a){for(var i=t[t.length-1],o=[e.length/i,i],s=o[0],u=o[1],c=Ws(n,s*r),l=Ws("int32",s*r),d=0;d<s;d++){for(var h=d*u,p=e.subarray(h,h+u),f=[],m=0;m<p.length;m++)f.push({value:p[m],index:m});f.sort(function(e,t){return t.value-e.value});var v=d*r,g=c.subarray(v,v+r),x=l.subarray(v,v+r);for(m=0;m<r;m++)g[m]=f[m].value,x[m]=f[m].index}var y=t.slice();return y[y.length-1]=r,[Tc(c,y,n),Tc(l,y,"int32")]}function Md(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var a=ul(e,"int32"),i=ul([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=a.indexToLoc(n[r]),s=r*e.length;i.values.set(o,s)}return i.toTensor()}var Fd=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Od=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Ld=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function Bd(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function zd(e,t){return 1===t?[e]:Bd(e,t)}function Ud(){var e,t,n,r,a,i,o,s,u,c;return 2===xs().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Wd(e,t,n){void 0===n&&(n="index");var r=Ys(t);return r.map(function(t,a){return"int "+e[a]+" = "+n+" / "+t+"; "+(a===r.length-1?"int "+e[a+1]+" = "+n+" - "+e[a]+" * "+t:"index -= "+e[a]+" * "+t)+";"}).join("")}function Vd(e){var t=Ys(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Hd="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function qd(e,t,n,r){var a=[];e.forEach(function(e){var t=Ds(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(a.push("uniform sampler2D "+e.name+";"),a.push("uniform int offset"+e.name+";"))});var i,o,s=a.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?Kd(e):Gd(e);var a=e.shapeInfo.logicalShape,i=t.logicalShape;return a.length<=i.length&&(r+=n?function(e,t){var n,r,a=e.name,i=a.charAt(0).toUpperCase()+a.slice(1),o="get"+i+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=nd(e.shapeInfo.logicalShape,t.logicalShape),l=eh(u),d=u-s,h=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map(function(e){return"coords."+h[e+d]+" = 0;"}).join("\n"),r=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+h[t+d]}).join(", ");var p="return outputValue;",f=1===Ds(e.shapeInfo.logicalShape),m=1===Ds(t.logicalShape);if(1!==s||f||m){if(f&&!m)p=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var v=s-2,g=s-1;c.indexOf(v)>-1&&c.indexOf(g)>-1?p="return vec4(outputValue.x);":c.indexOf(v)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(g)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+r+");\n      "+p+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Ps(o,i))return"\n      float "+a+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c=eh(u),l=nd(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,h=["x","y","z","w","u","v"];return"\n    float "+a+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&l.length>=1?"coords = 0;":l.map(function(e){return"coords."+h[e+d]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+h[t+d]}).join(", "))+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),c=t.texShape,l=Ud(),d="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",h=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+$d+"\n    "+Xd+"\n    "+Yd+"\n  "}(l);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return n=t,1===(r=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+r[1]+".0);\n      }\n    ":1===r[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+r[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      return 2 * (resTexRC.x * "+r[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ps(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return a=e,i=t,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=(s=Math.ceil(a[2]/2))*Math.ceil(a[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+u+";\n      index -= b * "+u+";\n\n      int r = 2 * (index / "+s+");\n      int c = imod(index, "+s+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",u=2;u<e.length-1;u++)o="\n      int b"+u+" = index / "+(i*=e[e.length-u-1])+";\n      index -= b"+u+" * "+i+";\n    "+o,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,a,i,o,s,u}(t.logicalShape,c),o=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=t)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(e,t){return Ps(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return r=t,a=Wd(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      "+a+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=Wd(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=Wd(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=Wd(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r,a}(t.logicalShape,c),o=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(h+=Qd),[h,d,o,s,i,u,n].join("\n")}function Gd(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===a&&1===i)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+Jd(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Zd(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=Jd(t);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+a+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+i+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&Ps(t,a)){var i=a[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+i+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var o=Us(t),s=o.newShape,u=o.keptDims,c=s;if(c.length<t.length)return"\n      "+Gd(th(e,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+nh(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+Zd(e)+"\n      }\n    ";var l=a[0],d=a[1],h=Jd(n);return 1===d?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+d+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+h+";\n    vec2 uv = uvFromFlat("+l+", "+d+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],i=t[2],o=Us(t),s=o.newShape,u=o.keptDims,c=s;if(c.length<t.length)return"\n        "+Gd(th(e,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+nh(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+i+", 1)));\n        "+Zd(e)+"\n      }\n    ";var l=e.shapeInfo.texShape,d=l[0],h=l[1],p=e.shapeInfo.flatOffset;return h===a&&null==p?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+h+".0, "+d+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":h===i&&null==p?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+h+".0, "+d+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+i+" + depth + "+Jd(n)+";\n        vec2 uv = uvFromFlat("+d+", "+h+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],i=t[2]*a,o=t[1]*i,s=Us(t),u=s.newShape,c=s.keptDims;if(u.length<t.length)return"\n      "+Gd(th(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+nh(["row","col","depth","depth2"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+o+", "+i+", "+a+", 1)));\n        "+Zd(e)+"\n      }\n    ";var l=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],p=d[1];return p===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===a&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+o+" + col * "+i+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+h+", "+p+", index + "+Jd(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=Us(t),c=u.newShape,l=u.keptDims;if(c.length<t.length)return"\n      "+Gd(th(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+nh(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+o+", "+i+", "+a+")) +\n          depth3;\n        "+Zd(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],f=h[1];return f===s&&null==d?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+o+", "+i+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":f===a&&null==d?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" + depth * "+i+" +\n          depth2 * "+a+" + depth3 + "+Jd(n)+";\n      vec2 uv = uvFromFlat("+p+", "+f+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Us(t),i=a.newShape,o=a.keptDims;if(i.length<t.length)return"\n      "+Gd(th(e,i))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+nh(["row","col","depth","depth2","depth3","depth4"],o)+");\n      }\n    ";var s=t[5],u=t[4]*s,c=t[3]*u,l=t[2]*c,d=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+d+", "+l+", "+c+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+Zd(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,f=p[0],m=p[1];return m===d&&null==h?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==h?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+d+" + col * "+l+" + depth * "+c+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+Jd(n)+";\n      vec2 uv = uvFromFlat("+f+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Kd(e){var t,n,r,a,i,o,s;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1)+"() {\n      return "+Ud().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return r=(n=e).name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=Ud(),"\n    vec4 "+a+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+s.texture2D+"("+r+", uv);\n    }\n  ";case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=a[0],o=a[1],s=Ud();if(null!=a&&Ps(t,a))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0])return"\n        "+Kd(th(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+nh(["b","row","col"],[1,2])+");\n        }\n      ";var o=i[0],s=i[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+o+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+Ud().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),d="int b, int row, int col",h="b * "+l+" + (row / 2) * "+c+" + (col / 2)",p=2;p<n-1;p++)d="int b"+p+", "+d,h="b"+p+" * "+(l*=t[n-p-1])+" + "+h;return"\n    vec4 "+a+"("+d+") {\n      int index = "+h+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Ud().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var $d="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Xd="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Yd="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Qd="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Jd(e){return"offset"+e}function Zd(e){var t=e.name,n=Ds(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function eh(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function th(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function nh(e,t){return t.map(function(t){return e[t]}).join(", ")}var rh=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,_s(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var a=e[e.length-1],i=Math.ceil(a/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var o,s,u=this.outputShape,c=u.length,l=eh(c),d=zd("coords",c);if(1===i){var h=eh(s=c+1);o="\n        "+h+" sourceLocR = "+h+"("+d.join()+", 0);\n        ++"+d[c-1]+";\n        "+h+" sourceLocG = "+h+"("+d.join()+", 0);\n        ++"+d[c-2]+";\n        "+h+" sourceLocA = "+h+"("+d.join()+", 0);\n        --"+d[c-1]+";\n        "+h+" sourceLocB = "+h+"("+d.join()+", 0);\n        --"+d[c-2]+";"}else s=c,o="\n        "+l+" sourceLocR = coords;\n        ++"+d[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[c-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),f="."+p[s-1],m=p.map(function(e){return"int "+e}),v=zd("sourceLocR",s-1).concat("inIdx.r"),g=zd("sourceLocG",s-1).concat("inIdx.g"),x=zd("sourceLocB",s-1).concat("inIdx.b"),y=zd("sourceLocA",s-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+x.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",N="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+x.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",k=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+k+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+d[c-2]+" < "+(u[c-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+f+", sourceLocG"+f+",\n          sourceLocB"+f+", sourceLocA"+f+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+N+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+N+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},ah=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,d=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+d+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+i+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ih=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=l-1-e.padInfo.front,f=d-1-e.padInfo.top,m=h-1-e.padInfo.left,v=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n      const float avgMultiplier = float("+v+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+a+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+h+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},oh=function(e,t,n,r,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],ad(e,t),ad(e,n);var o="0.0";null!=r&&(ad(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=a&&(ad(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},sh=function(e,t,n,r,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ad(e,t),ad(e,n);var o="vec4(0.0)";null!=r&&(ad(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=a&&(ad(e,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},uh=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ad(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},ch="return a + b;",lh="return a - b;",dh="return a * b;",hh="return (a < 0.) ? b * a : a;",ph=function(e,t,n){this.variableNames=["A","B"],this.outputShape=ad(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},fh="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",mh=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ad(t,n);var a=this.outputShape.length,i="";if(r)if(0===a||1===Ds(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+eh(a)+" coords = getOutputCoords();\n        ",1===a)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=zd("coords",a);i+="\n            bool nextRowOutOfBounds =\n              ("+o[a-2]+" + 1) >= "+this.outputShape[a-2]+";\n            bool nextColOutOfBounds =\n              ("+o[a-1]+" + 1) >= "+this.outputShape[a-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},vh=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),gh=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),xh=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},yh=function(e){this.outputShape=[],this.outputShape=Sc(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var a=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+a+"));")}var i=t.length,o=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},bh=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Sc(e,t);var n=this.outputShape,r=n.length,a=eh(r),i=zd("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var c=o[t],l=o.slice(-2),d=o.join(),h="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var p=s[u-1];h+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+wh(o,c,p)+"),\n            vec2("+wh(l,c,p)+"));\n        }"}var f=s.length,m=s[s.length-1];h+="\n        return getChannel(\n          getT"+f+"("+wh(o,c,m)+"),\n          vec2("+wh(l,c,m)+"));",this.userCode="\n      float getValue("+o.map(function(e){return"int "+e})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            "+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function wh(e,t,n){var r=e.indexOf(t);return e.map(function(e,t){return t===r?e+" - "+n:e}).join()}var Nh=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+i+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},kh=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=i?1:2,c=i?2:3,l=i?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ch=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,i=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+a+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+i+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jh=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+a+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Sh=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+i+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+a+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Eh=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,i=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+a+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Rh=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.padInfo.top,i=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4,f="channelsLast"===e.dataFormat,m=f?1:2,v=f?2:3,g=f?3:1,x="",y="";n&&(x=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",y="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+f+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===p)+") {\n\n              if ("+f+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+h+") *\n                    getW(wR, wC, "+h+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+h+", xR, xC) *\n                    getW(wR, wC, "+h+", d2);\n              }\n\n            } else if ("+(2===p)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2)\n              );\n\n              if ("+f+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===p)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2),\n                getW(wR, wC, "+h+" + 2, d2)\n              );\n\n              if ("+f+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1),\n                  getX(batch, xR, xC, "+h+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC),\n                  getX(batch, "+h+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+y+"\n        setOutput(result);\n      }\n    "},_h=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,d=e.filterHeight,h=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+a+", "+i+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===f)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+p+") *\n                  getW(wF, wR, wC, "+p+", d2);\n              } else if ("+(2===f)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===f)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1),\n                  getX(batch, xF, xR, xC, "+p+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2),\n                  getW(wF, wR, wC, "+p+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ih=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var a=e.inHeight,i=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,f=e.outChannels/e.inChannels,m="",v="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",v="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+f+";\n        int q = d2 - d1 * "+f+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+h+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+a+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+v+"\n        setOutput(result);\n      }\n    "},Th=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var a=e.inHeight,i=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,f=p,m="int xR; int xC; int xCOffset;",v=0;v<h;v++)for(var g=0;g<p;g++)m+="\n          vec4 xTexelR"+v+"C"+2*g+" = vec4(0.);\n          vec4 wR"+v+"C"+g+" = vec4(0.);\n          vec4 xR"+v+"C"+g+" = vec4(0.);";for(v=0;v<h;v++)for(var x=0;x<f;x++){if(m+="\n          xR = xRCorner + "+v*l+";\n          xC = xCCorner + "+(g=2*x)*d+";\n        ",1===c){if(g<p&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+v+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+a+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+v+"C"+g+" = vec4(previous.zw, xTexelR"+v+"C"+g+".xy);\n                } else {\n                  xR"+v+"C"+g+" = vec4(0, 0, xTexelR"+v+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+a+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = xTexelR"+v+"C"+g+";\n              ",g+1<p)){var y=s%2==0?Rs(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+y+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+a+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+v+"C"+g+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+y+";\n\n                  if(xR >= 0 && xR < "+a+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+v+"C"+(g+1)+" = xTexelR"+v+"C"+(g+2)+";\n                "}}else g<p&&(m+="\n              if(xR >= 0 && xR < "+a+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n              ",g+1<p&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+v+"C"+(g+1)+" = vec4(xTexelR"+v+"C"+(g+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".xy, xTexelR"+v+"C"+(g+2)+".xy);\n              ",g+1<p&&(m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n                ")),m+="}");g<p&&(m+="\n            vec4 wTexelR"+v+"C"+g+" = getW("+v+", "+g+", d1, q);\n            wR"+v+"C"+g+" = vec4(wTexelR"+v+"C"+g+".xz, wTexelR"+v+"C"+g+".xz);\n          ",g+1<p&&(m+="\n              vec4 wTexelR"+v+"C"+(g+1)+" = getW("+v+", "+(g+1)+", d1, q);\n              wR"+v+"C"+(g+1)+" =\n                vec4(wTexelR"+v+"C"+(g+1)+".xz, wTexelR"+v+"C"+(g+1)+".xz);"))}for(v=0;v<h;v++)for(g=0;g<p;g++)m+="dotProd += xR"+v+"C"+g+" * wR"+v+"C"+g+";";var b="",w="";n&&(b=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+N+"\n        "+w+"\n        setOutput(result);\n      }\n    "},Ah=function(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],o=e[1],s=e[2],u=e[3],c=t[0],l=n[0],d=n[1];this.outputShape=[c,l,d,u];var h="bilinear"===r?1:0,p=[o-1+".0",s-1+".0"],f=p[0],m=p[1],v=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+f+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+f],g=v[0],x=v[1],y=v[2],b=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=b[0],N=b[1],k=b[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+x+";\n        float width_scale = "+N+";\n\n        float in_y = "+y+";\n        if( in_y < 0.0 || in_y > "+f+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n        float in_x = "+k+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+a+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+h+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Dh=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,a=e[e.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+a+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+eh(r)+" coords = getOutputCoords();\n        int end = "+Ph(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+a+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+Ph(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Ph(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var Mh=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Du.DENSE;var t=zu(e),n=Ud();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Wd(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},Fh=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Du.DENSE;var t=zu(e),n=Ud();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Wd(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},Oh=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),Lh=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Bh=function(e){this.variableNames=["A"],this.outTexUsage=Pu.DOWNLOAD;var t=Ud();this.outputShape=e,this.userCode="\n      "+Hd+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},zh=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Pu.DOWNLOAD;var t=Ud();this.outputShape=e,this.userCode="\n      "+Hd+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},Uh=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Ud(),a=t[0],i=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+Vd(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+a+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},Wh=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ud(),a=t[0],i=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+e[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+a+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Vd(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "},Vh=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var a=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+a+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+i+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Hh=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),qh=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var a=eh(this.rank),i=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=0;i<e.length;i++)i===t?a.push("int(getIndices("+r[i]+"))"):a.push(""+r[i]);return a.join()}(e,n);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Gh=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=eh(t.length),a=eh(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+a+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+i+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Kh(e,t){var n=Ud();return function(e,t,n){var r=tc(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Vu(e,t,function(){return e.shaderSource(r,n)}),Vu(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader.");return r}(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function $h(e,t){return function(e,t,n){var r=tc(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Vu(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Vu(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Xh(e,t){return function(e,t,n){var r=tc(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Vu(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),Vu(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}(e,t,new Uint16Array([0,1,2,2,1,3]))}function Yh(e,t,n,r,a,i,o){!function(e,t){var n=xs().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}(n,r);var s=function(e,t){return tc(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}(e,t),u=e.TEXTURE_2D;return Vu(e,t,function(){return e.bindTexture(u,s)}),Vu(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),Vu(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),Vu(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),Vu(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),Vu(e,t,function(){return e.texImage2D(u,0,a,n,r,0,i,o,null)}),Vu(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}var Qh=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=xs().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){Fu[e]=t}(t,e)):this.gl=Lu(t);var n="WEBGL_color_buffer_float";if(1===xs().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=qu(this.gl,this.debug,"OES_texture_float"),sc(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=qu(this.gl,this.debug,"OES_texture_half_float");else if(xs().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),sc(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=qu(this.gl,this.debug,"EXT_color_buffer_half_float");else if(xs().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",sc(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!sc(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=$h(this.gl,this.debug),this.indexBuffer=Xh(this.gl,this.debug),this.framebuffer=function(e,t){return tc(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}(this.gl,this.debug),this.textureConfig=Wu(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return xs().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){this.program,this.outputTexture;var t=this.gl;Vu(t,this.debug,function(){return t.finish()}),Vu(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Vu(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Vu(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Vu(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Vu(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=Bu(n,r);return Yh(e,t,i[0],i[1],a.internalFormatFloat,a.textureFormatFloat,e.FLOAT)}(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=Bu(n,r);return Yh(e,t,i[0],i[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Bu(n,r);return Yh(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),function(e,t,n,r){Vu(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?Vu(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):Vu(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),Vu(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i,o){var s,u,c;Vu(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*a*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*a*4),u=e.FLOAT,c=o.internalFormatPackedFloat),s.set(i),Vu(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,a,0,e.RGBA,u,s)}),Vu(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=Uu(n,r);return Yh(e,t,i[0],i[1],a.internalFormatPackedHalfFloat,e.RGBA,a.textureTypeHalfFloat)}(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=Uu(n,r);return Yh(e,t,i[0],i[1],a.internalFormatPackedFloat,e.RGBA,e.FLOAT)}(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Zu(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Vu(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return function(e,t,n,r,a){var i=Bu(n,r),o=i[0],s=i[1],u=new Uint8Array(n*r*4);return Vu(e,t,function(){return e.readPixels(0,0,o,s,a.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,a,i){return function(e,t,n,r,a,i,o){var s,u=e,c=new Float32Array((s=Uu(i,o))[0]*s[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}(this.gl,e,0,0,0,a,i,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();Vu(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)});var i=16*n*r;return Vu(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),Vu(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),Vu(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),a}(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(xs().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return function(e,t,n,r){var a=new Float32Array(n*r*4);return Vu(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,a)}),a}(r.gl,r.debug,t,n)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=function(e,t,n){var r=tc(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Vu(e,t,function(){return e.shaderSource(r,n)}),Vu(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=$u.exec(t);if(null!=n){for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map(function(e,t){return Ls((t+1).toString(),i)+e}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);o.slice(0,r-1),o.slice(r-1,r),o.slice(r)}}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}(t,this.debug,e),r=Kh(t,this.debug),a=function(e,t){return tc(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}(t,this.debug);return Vu(t,this.debug,function(){return t.attachShader(a,r)}),Vu(t,this.debug,function(){return t.attachShader(a,n)}),function(e,t,n){if(Vu(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw new Error("Failed to link vertex and fragment shaders.")}(t,this.debug,a),this.debug&&Xu(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=function(e,t,n,r){return Vu(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Yu(e,t,n,"clipSpacePos",r,3,20,0)&&Yu(e,t,n,"uv",r,2,20,12)}(t,this.debug,this.program,this.vertexBuffer)),a},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Vu(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Xu(this.gl,this.debug,this.program),Vu(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?function(e,t,n,r){return tc(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}(this.gl,this.debug,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Vu(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r,a,i){Vu(e,t,function(){return Qu(e,t,r,i)}),Vu(e,t,function(){return e.uniform1i(a,i)})}(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Uu(t,n),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&Xu(this.gl,this.debug,this.program),ec(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Vu(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Vu(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=qu(this.gl,this.debug,2===xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a},e.prototype.endQuery=function(){if(2!==xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return ms(this,0,void 0,function(){var t=this;return vs(this,function(n){switch(n.label){case 0:return[4,Bs(function(){return t.disposed||t.isQueryAvailable(e,xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Bs(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Ju(this.gl,this.debug,e,this.framebuffer),this.debug&&ec(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Ju(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ec(this.gl)):Zu(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Ju(r,this.debug,e,this.framebuffer),this.debug&&ec(r),this.outputTexture=e,Vu(r,this.debug,function(){return r.viewport(0,0,t,n)}),Vu(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var a=this;this.throwIfDisposed(),Vu(this.gl,this.debug,function(){return a.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Jh(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Ps(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Ps(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}})}var Zh=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,a=n.inChannels,i=n.strideWidth,o=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,d=n.dataFormat,h=s.left,p=s.top,f=a*r,m=Ud(),v="channelsLast"===d,g=v?0:1,x=v?1:2,y="",b=0;b<=1;b++)for(var w=0;w<=1;w++)y+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+o+" - "+p+";\n            d0 = offsetY + "+l+" * (pos / "+f+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+h+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+f+".) / "+a+".));\n\n              if(d1 < "+t[x]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+a+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+m.output+" = result;\n      }\n    "},ep=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];var i,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=.5===a?"inversesqrt("+u+")":1===a?"1.0/("+u+")":"exp(log("+u+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+i+";\n        setOutput(val);\n      }\n    "},tp=function(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+a+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+a+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},np=function(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,o=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=.5===a?"inversesqrt("+u+")":1===a?"1.0/("+u+")":"exp(log("+u+") * float(-"+a+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+i+";\n        setOutput(result);\n      }\n    "},rp=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,i=e.effectiveFilterWidth,o=a-1-e.padInfo.top,s=i-1-e.padInfo.left,u=a*i-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ap=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,d=u-1-e.padInfo.top,h=c-1-e.padInfo.left,p=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+d+", "+h+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+a+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+p+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ip=function(e,t,n,r,a,i,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===i&&(i=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",f="";i&&(p=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",f="result = activation(result);");var m=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+h[0]+");\n          result += ("+d[1]+" * "+h[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+f+"\n\n        setOutput(result);\n      }\n    "},op=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),sp=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},up=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t,n,r,a,i=e.length;if(0===i)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var o=zd("rc",i),s=eh(i),u=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",a=e-2;a<e;a++)r+=n[a]+" >= "+t[a],a<e-1&&(r+="||");return r}(i,e,o),c=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = "+a[0]+";\n    int c = "+a[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(i,e[e.length-1],e[e.length-2],o),l=(n=o,r=(t=e).length,a=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i=(0===r?"r":"rp1")+", "+(0===a?"c":"cp1"),o=2;o<e;o++)i=t[t.length-1-o]+","+i;n.push(i)}return n}(r,n),1===r?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+a[0]+"),\n          cEdge ? 0. : getA("+a[1]+"),\n          rEdge ? 0. : getA("+a[2]+"),\n          rEdge || cEdge ? 0. : getA("+a[3]+")");this.userCode="\n        void main() {\n          "+s+" rc = getOutputCoords();\n\n          if("+u+") {\n            setOutput(vec4(0));\n          } else {\n            "+c+"\n\n            setOutput(vec4("+l+"));\n          }\n        }\n      "}},cp=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,a=eh(r),i=t.map(function(e){return e[0]}).join(","),o=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+a+" start = "+a+"("+i+");\n      "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+a+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},lp=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,a=eh(r),i=t.map(function(e){return e[0]}).join(","),o=t.map(function(t,n){return t[0]+e[n]}).join(","),s=zd("rc",r),u=zd("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",d=[a+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",f=0,m=1===r?2:4;f<m;f++)p+="\n        "+d[f]+"\n        if ("+h+") {\n          result["+f+"] = float("+n+");\n        } else {\n          "+a+" source = rc - start;\n          result["+f+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";p+=1===r?"} ":"}}",this.userCode="\n      const "+a+" start = "+a+"("+i+");\n      const "+a+" end = "+a+"("+o+");\n\n      void main() {\n        "+a+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+p+"\n        setOutput(result);\n      }\n    "},dp=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var h="avg"===t,p="0.0";if(h||(p="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+a+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+o+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var f=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(f="avgValue / count");var m=4*Math.floor(r/4),v=r%4,g="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+d+");\n      const float initializationValue = "+p+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+p+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+o+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+f+");\n      }\n    "}},hp=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,a=e.strideDepth,i=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.front,f=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var v="avg"===t,g="0.0";if(v||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+a+", "+i+", "+o+");\n        const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+h+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+h+" +\n                      wR * "+h+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var x=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(x="avgValue / count");var y=4*Math.floor(r/4),b=r%4,w="\n      if ("+v+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+a+", "+i+", "+o+");\n      const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+y+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+y+";\n            if ("+(1===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+x+");\n        }\n      }\n    "}},pp=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,a=e.inSize,i=Math.ceil(a/n);this.outputShape=[r,i];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,d="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===t?(o="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(o="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var p="";a%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+p+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},fp=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var a="thisRC = rc;";r%2==1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+="\n        "+a+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Wd(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Vd(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},mp=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],i=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?a-1:a,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=c[0]/l[0],h=c[1]/l[1],p=1/d,f=1/h,m=2*Math.ceil(p)+2,v=2*Math.ceil(f)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+f+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(a-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},vp=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},gp=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},xp=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],i=r[2],o=e.shape,s=o[1],u=o[2],c=[n&&s>1?a-1:a,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=c[0]/l[0],h=c[1]/l[1],p=1/d,f=1/h,m=2*Math.ceil(p)+2,v=2*Math.ceil(f)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+f+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},yp=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var a=e[0],i=e[1],o=e[2],s=e[3];this.outputShape=[a,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},bp=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return a=r,-1!==t.indexOf(a)&&1!==e[a]?e[a]+" - coords["+a+"] - 1":"coords["+a+"]";var a}).join(","),a=eh(n);this.userCode="\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},wp=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=zd("rc",n),a=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],o=eh(n);function s(n){var r=e.map(function(r,a){return i=a,o=n,-1!==t.indexOf(i)&&1!==e[i]?e[i]+" - "+o[i]+" - 1":""+o[i];var i,o});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+a+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+a+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+a+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Np=function(e,t,n,r,a,i,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=eh(a.length),u=eh(i.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",d="";1===r?d="i":2===r&&(d="i, coords[1]");var h="getUpdates("+d+")",p=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+a+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+p+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+h+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},kp=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,a=e.inSize,i=e.numSegments,o=i*Math.ceil(a/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";a%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return initializationValue;\n        }\n      ");var d="";a%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+a+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},Cp=function(e,t,n){var r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)a="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],u=0;u<t.length;u++)s.push(""+i[u]),u<e&&o.push(""+i[u]);r=o.join(),a=s.join()}var c=eh(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+a+"));\n        } else {\n          setOutput(getB("+a+"));\n        }\n      }\n    "},jp=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=eh(this.rank),r="uniform int start["+this.rank+"];",a=function(e){if(1===e)return"sourceLoc";if(e<=6)return Sp.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+Sp[t]+" = start["+t+"] + coords."+Sp[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+a+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Sp=["x","y","z","w","u","v"],Ep=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=eh(this.rank),n=zd("coords",this.rank),r=zd("sourceLoc",this.rank),a=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+a+")",o="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Rp=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,a=eh(n.length),i=eh(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map(function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+e+");\n      "+a+" strides = "+a+"("+t+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "},_p=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,a=Ip(t,n),i=Tp(e,a,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[i].shift();return this.usedTextures[i].push(o),o}return this.numUsedTextures++,this.log(),a===Mu.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===Mu.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===Mu.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===Mu.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===Mu.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var a=Tp(t,Ip(n,r),r);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],o=i.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(o,1),this.log()}},e.prototype.log=function(){this.logEnabled&&(this.numFreeTextures,this.numUsedTextures)},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Ip(e,t){if(e===Pu.UPLOAD)return Mu.PACKED_2X2_FLOAT32;if(e===Pu.RENDER||null==e)return n=t,xs().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Mu.PACKED_2X2_FLOAT32:Mu.UNPACKED_FLOAT32:n?Mu.PACKED_2X2_FLOAT16:Mu.UNPACKED_FLOAT16;var n;if(e===Pu.DOWNLOAD||e===Pu.PIXELS)return Mu.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Tp(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var Ap=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var a=eh(this.rank),i=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod("+n[a]+", "+e[a]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Dp=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var a=eh(this.rank),i=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(t);this.userCode="\n    void main() {\n      "+a+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},Pp=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=eh(this.rank),i=Bd("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=i[r];var s="vec2("+o.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+a+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Mp=1.7580993408473768,Fp=1.0507009873554805,Op=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Lp="if (isnan(x)) return x;",Bp="return abs(x);",zp=Lp+"\n  return (x < 0.0) ? 0.0 : x;\n",Up=Lp+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Wp="return (x >= 0.0) ? x : (exp(x) - 1.0);",Vp="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+Mp+";\n  float scale = "+Fp+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",Hp="return -x;",qp="return ceil(x);",Gp="return floor(x);",Kp="return exp(x);",$p="return exp(x) - 1.0;",Xp=Lp+"\n  return sin(x);\n",Yp=Lp+"\n  return cos(x);\n",Qp=Lp+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",Jp=Lp+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",Zp=Lp+"\n  return atan(x);\n",ef=Lp+"return log(x + sqrt(x * x + 1.0));",tf=Lp+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",nf=Lp+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",rf="return x;",af="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",of="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",sf="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",uf=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},cf=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=zd("rc",t),r=eh(t),a=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),o=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+a+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},lf={};function df(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?af:zp;if("elu"===e)return t?sf:Wp;if("relu6"===e)return t?of:Up;if("prelu"===e)return t?fh:hh;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var hf=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!xs().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var a=Lu(xs().getNumber("WEBGL_VERSION"));r.binaryCache=((n=xs().getNumber("WEBGL_VERSION"))in lf||(lf[n]={}),lf[n]),r.gpgpu=new Qh(a),r.canvas=a.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new _p(r.gpgpu),r.numMBBeforeWarning=null==xs().global.screen?1024:xs().global.screen.height*xs().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Zl(r,Iu),r}return fs(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(xs().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Pu.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(xs().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Pu.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensors,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new uf(o,rf):new Op(o,rf);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var d,h,p=null!=this.activeTimers;return p&&(d=tu()),h="complex64"===r?bd(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(e),p&&(this.downloadWaitMs+=tu()-d),this.convertAndCacheOnCPU(e,h)},t.prototype.read=function(e){return ms(this,0,void 0,function(){var t,n,r,a,i,o,s,u,c,l,d,h,p,f,m,v,g,x,y,b,w,N;return vs(this,function(k){switch(k.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(e){return t.push(e)})];if(n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.complexTensors,u=n.isPacked,null!=i)return c=u?new uf(a,rf):new Op(a,rf),l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),d=this.read(l.dataId),this.disposeData(l.dataId),[2,d];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!xs().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===xs().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return h=null,"complex64"!==o&&xs().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(e),f=this.texData.get(p.dataId),h=(N=this.gpgpu).createBufferFromTexture.apply(N,[f.texture].concat(zu(a)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:k.sent(),k.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return v=k.sent(),g=v[0],x=v[1],m=bd(g,x),[3,5];case 4:null==h?m=this.getValuesFromTexture(e):(y=Ds(a),m=this.gpgpu.downloadFloat32MatrixFromBuffer(h,y)),k.label=5;case 5:return null!=p&&this.disposeData(p.dataId),b=this.convertAndCacheOnCPU(e,m),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach(function(e){return e(b)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,b]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Hu(n)){if(xs().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,a=n.dtype,i=n.isPacked,o=Ds(r);if(xs().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(zu(r))).subarray(0,o);return this.disposeData(s.dataId),c}var l=xs().getBool("WEBGL_PACK")&&!0===i,d=l?ac(r):r,h=l?new zh(d):new Bh(d),p=this.runWebGLProgram(h,[{shape:d,dtype:a,dataId:e}],"float32"),f=this.texData.get(p.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture,f.texShape[0],f.texShape[1]).subarray(0,o);return this.disposeData(p.dataId),m},t.prototype.time=function(e){return ms(this,0,void 0,function(){var t,n,r,a,i,o,s;return vs(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),a=As(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),i=As(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return s=u.sent(),o.kernelMs=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}(s),o.getExtraProfileInfo=function(){return s.map(function(e,t){return{name:i[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},[3,3];case 2:o.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,o]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:tu(),endMs:null}},t.prototype.endTimer=function(e){return xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=tu(),e)},t.prototype.getQueryTime=function(e){return ms(this,0,void 0,function(){var t;return vs(this,function(n){return xs().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return xs().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Iu.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&e.size<t})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Iu.keep(e.clone()),imag:Iu.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===Ds(n))return Tc([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,a=$l(e.shape,t,n);if(r||!a){var i=xs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ep(n):new jp(n),o=i.getCustomSetupFunc(t);return this.compileAndRun(i,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),a=this.makeOutput(n,e.dtype),i=this.texData.get(a.dataId);Object.assign(i,r),i.shape=n,i.dtype=e.dtype;var o=Xl(t,e.strides);r.slice&&(o+=r.slice.flatOffset),i.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),a},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var a=ql(t,n,r);if(a.some(function(e){return 0===e}))return Tc([],a);var i=new Rp(t,r,a);return this.compileAndRun(i,[e])},t.prototype.reverse=function(e,t){var n=xs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wp(e.shape,t):new bp(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map(function(e){return _c(e)}),r=e.map(function(e){return Ic(e)});return Rc(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>xs().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),i=this.concat(e.slice(0,a),t),o=this.concat(e.slice(a),t);return this.concat([i,o],t)}if(xs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new bh(e.map(function(e){return e.shape}),t);return this.compileAndRun(s,e)}var u=Sc(e.map(function(e){return e.shape}),t),c=e.map(function(e){return e.as2D(-1,Ds(e.shape.slice(t)))}),l=new yh(c.map(function(e){return e.shape}));return this.compileAndRun(l,c).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(xs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Hp,e.dtype);var t=new Op(e.shape,Hp);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===a||1===i)&&o>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===i?e:e.as3D(s,o,1),c=1===i?2:1,l=1===i?t.as3D(s,1,o):t;return this.multiply(u,l).sum(c,!0)}var d=ku(e.dtype,t.dtype),h=new ip(e.shape,[s,a,i],n,r);return this.compileAndRun(h,[e,t],d)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=a?n.shape[1]:n.shape[2],l=t.shape[0],d=ku(t.dtype,n.dtype),h=null!=i,p=null!=s,f=o?df(o,!0):null,m=new ip(t.shape,[l,u,c],r,a,h,f,p),v=[t,n];return i&&v.push(i),s&&v.push(s),this.compileAndRun(m,v,d)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),a=new uh("return areal * breal - aimag * bimag;",e.shape,t.shape),i=new uh("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(a,o),u=this.compileAndRun(i,o),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,dh,e.dtype);var l=new ph(dh,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,a,i){var o=[e,t,n],s=null;null!=i&&(s=i.shape,o.push(i));var u=null;if(null!=a&&(u=a.shape,o.push(a)),xs().getBool("WEBGL_PACK_NORMALIZATION")){var c=new sh(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,o)}var l=new oh(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,a){var i=xs().getBool("WEBGL_PACK_NORMALIZATION")?new np(e.shape,t,n,r,a):new ep(e.shape,t,n,r,a);return this.compileAndRun(i,[e])},t.prototype.LRNGrad=function(e,t,n,r,a,i,o){var s=new tp(t.shape,r,a,i,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map(function(e){return ru(e)});return Dd(ul(e.shape,e.dtype,n),t)}var r=new Ap(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=xs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lp(e.shape,t,n):new cp(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=xs().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Pp(e.shape,t):new Dp(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new qh(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){_s(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),a=Ml(e.shape,t,r),i=Fl(a.length,t.length),o=Ol(e.shape,t,r),s=Ll(n,t.length),u=Bl(o,n,t.length);return e.reshape(a).transpose(i).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){_s(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),a=[[0,0]];a.push.apply(a,n);for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var o=e.pad(a),s=Ml(o.shape,t,r,!1),u=Fl(s.length,t.length,!1),c=Ol(o.shape,t,r,!1);return o.reshape(s).transpose(u).reshape(c)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],a=e.shape[1],i=Ul(a),o=new pp({windowSize:i,inSize:a,batchSize:r},t),s=this.compileAndRun(o,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],a=e.shape[1];null!=n&&(r=n.shape[0],a=n.shape[1]);var i=Ul(a),o=new Ld({windowSize:i,inSize:a,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(o,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,a=Ul(r[r.length-1]),i=new rh(r,a,t,null==n),o=null==n?[e]:[e,n],s=this.compileAndRun(i,o,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){Nc("sum",t,e.rank);var n=bc(e.shape,t),r=n[0],a=Ds(n[1]),i=e.as2D(-1,a),o=Cu(e.dtype);return this.reduce(i,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=bc(e.shape,t),r=n[0],a=Ds(n[1]),i=e.as2D(-1,a),o=Cu(e.dtype);return this.reduce(i,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,a=kc([r],e.rank),i=e;null!=a&&(i=e.transpose(a),r=jc(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(i.shape,r,n),s=Ds([i.shape[r]]),u=i.as2D(-1,s),c=Cu(e.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(o);return null!=a&&(l=l.transpose(Cc(a))),l},t.prototype.segOpCompute=function(e,t,n,r,a){var i=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Xs(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Xs(e,n+1);return n}(o,a),u=new kp({windowSize:s,inSize:o,batchSize:i,numSegments:a}),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===a?c:(n=Uc(0,a).tile([o/s]),this.segOpCompute(c,t,n,r,a))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(Nc("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!xs().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=bc(e.shape,r),i=a[0],o=Ds(a[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(i)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var a=new Dh(e.shape,n,r);return this.compileAndRun(a,[e])},t.prototype.equal=function(e,t){if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new ph("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new ph("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new ph("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new ph("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new ph("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new ph("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new Op(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new ph("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new ph("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new Cp(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],ku(t.dtype,n.dtype))},t.prototype.where=function(e){fc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Md(e.shape,t)},t.prototype.topk=function(e,t,n){return Pd(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Nc("min",t,e.rank);var n=bc(e.shape,t),r=n[0],a=Ds(n[1]),i=e.as2D(-1,a);return this.reduce(i,"min",i.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mh("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ph("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mh("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ph("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Nc("max",t,e.rank);var n=bc(e.shape,t),r=n[0],a=Ds(n[1]),i=e.as2D(-1,a);return this.reduce(i,"max",i.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mh("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ph("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){Nc("all",t,e.rank);var n=bc(e.shape,t),r=n[0],a=Ds(n[1]),i=e.as2D(-1,a);return this.reduce(i,"all",i.dtype).reshape(r)},t.prototype.any=function(e,t){Nc("any",t,e.rank);var n=bc(e.shape,t),r=n[0],a=Ds(n[1]),i=e.as2D(-1,a);return this.reduce(i,"any",i.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new ph("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new ph("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,ch);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=ku(e.dtype,t.dtype);if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ch,n);var r=new ph(ch,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new uf(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,a){void 0===a&&(a=!1);var i=new mh(n,e.shape,t.shape,a);return this.compileAndRun(i,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,a=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=[[a.complexTensors.real,i.complexTensors.real],[a.complexTensors.imag,i.complexTensors.imag]].map(function(a){var i=a[0],o=a[1],s=r.makeComplexComponentTensorInfo(e,i),u=r.makeComplexComponentTensorInfo(t,o),c=new ph(n,e.shape,t.shape);return r.compileAndRun(c,[s,u],ku(i.dtype,o.dtype))}),s=o[0],u=o[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>xs().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var a=e.map(function(e){return e.dtype}).reduce(function(e,t){return ku(e,t)}),i=e.map(function(e){return e.shape}),o=xs().getBool("WEBGL_PACK")?new Od(e[0].shape,i):new Fd(e[0].shape,i);return this.compileAndRun(o,e,a)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,lh);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=ku(e.dtype,t.dtype);if(xs().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,lh,e.dtype);var r=new ph(lh,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mh("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ph("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=ku(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(xs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,qp,e.dtype);var t=new Op(e.shape,qp);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(xs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Gp,e.dtype);var t=new Op(e.shape,Gp);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new Op(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new Op(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new Op(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new Op(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new Op(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(xs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Kp,e.dtype);var t=new Op(e.shape,Kp);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(xs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,$p,e.dtype);var t=new Op(e.shape,$p);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=zs([t],e.shape),r=this.max(e,n),a=wc(r.shape,n),i=this.subtract(e,r.reshape(a)),o=this.exp(i),s=this.sum(o,n).reshape(a);return this.realDivide(o,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(xs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new Op(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new Op(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new Op(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Op(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new Op(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=xs().getBool("WEBGL_PACK")?new uf(e.shape,af):new Op(e.shape,zp),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=xs().getBool("WEBGL_PACK")?new uf(e.shape,of):new Op(e.shape,Up),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mh(fh,e.shape,t.shape):new ph(hh,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(xs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,sf,e.dtype);var t=new Op(e.shape,Wp);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mh("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new ph("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new Op(e.shape,Vp);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new Op(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,a=(r=xs().getBool("WEBGL_PACK_CLIP")?new gh(e.shape):new vh(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,a)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(xs().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Bp,e.dtype);var t=new Op(e.shape,Bp);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new xh(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new Op(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new Op(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new Op(e.shape,Xp);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new Op(e.shape,Yp);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new Op(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new Op(e.shape,Qp);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new Op(e.shape,Jp);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new Op(e.shape,Zp);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mh("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ph("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new Op(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new Op(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new Op(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new Op(e.shape,ef);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new Op(e.shape,tf);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new Op(e.shape,nf);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new Op(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n,r=new Op(e.shape,(void 0===(n=t)&&(n=0),Lp+"\n    return x > 0.0 ? 1.0 : float("+n+");\n  "));return this.compileAndRun(r,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,a,i){var o=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,c=o[0]*o[1]*o[2],l=n.outChannels,d="channelsLast"===n.dataFormat,h=(1===c||1===l)&&u>1e3,p=o[2]%2!=0&&!!s.isPacked;if(h||!xs().getBool("WEBGL_LAZILY_UNPACK")||!xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var f=d?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],m=this.reshape(e,[1,f,n.inChannels]),v=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:v,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:i}),n.outShape)}var g=d?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),x={dataId:e.dataId,shape:[1,g,n.inChannels],dtype:e.dtype},y=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,_s(oc(s.shape,x.shape),function(){return"packed reshape "+s.shape+" to "+x.shape+" isn't free"});var b=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:x,b:b,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:i}),N=this.texData.get(w.dataId);return _s(N.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=y,N.shape=n.outShape,Iu.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,a,i){var o=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,d="channelsLast"===n.dataFormat,h=o*s*u,p=l*c,f=[h,p],m=e.squeeze([0]),v=t.reshape([1,h,-1]),g=new Zh(f,m.shape,n),x=this.compileAndRun(g,[m]).reshape([1,f[0],f[1]]),y=null!=r,b=null!=i,w=a?df(a,!0):null,N=new ip(x.shape,[1,p,n.outChannels],!0,!1,y,w,b),k=[x,v];r&&k.push(r),b&&k.push(i);var C=this.compileAndRun(N,k);return d?C.reshape([1,l,c,n.outChannels]):C.reshape([1,n.outChannels,l,c])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,a,i,o);if(xs().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,a,i,o);var s=null!=a,u=null!=o,c=i?df(i,!1):null,l=new Rh(r,s,c,u),d=[t,n];return a&&d.push(a),o&&d.push(o),this.compileAndRun(l,d)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(xs().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new Rh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new kh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new Nh(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,a=e.convInfo,i=e.bias,o=e.activation,s=e.preluActivationWeights,u=xs().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,c=o?df(o,u):null,l=[n,r],d=null!=i,h=null!=s;return d&&l.push(i),h&&l.push(s),u?(t=new Th(a,d,c,h),this.compileAndRun(t,l)):(t=new Ih(a,d,c,h),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return xs().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Th(n),this.compileAndRun(r,[e,t])):(r=new Ih(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new Eh(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new Sh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new _h(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new jh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new Ch(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new dp(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new dp(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var a=new dp(r,"max",!0),i=this.compileAndRun(a,[t]),o=new rp(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new ah(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return gd(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(i=0;i<u.length;i++)o[t]=i,u[i]=this.slice(e,o,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new hp(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new ih(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new hp(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var a=new hp(r,"max",!0),i=this.compileAndRun(a,[t]),o=new ap(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!oc(e.shape,t)&&(null===n.texture||!oc(n.shape,t))){var r=this.packedReshape(e,t);return Iu.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return xd(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var a=xs().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new gp(e.shape,t,n,r):new vp(e.shape,t,n,r);return this.compileAndRun(a,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new mp(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var a=new yp(e.shape,t,n,r);return this.compileAndRun(a,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new xp(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var a=t?e:Ql(e),i=a.shape[0],o=a.shape[1],s=new op(i,o,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[a],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var a=new sp(e.size,t,n,r);return this.compileAndRun(a,[e])},t.prototype.diag=function(e){var t=new Lh(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,a){return fc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Sd(e.dataSync(),t.dataSync(),n,r,a)},t.prototype.cropAndResize=function(e,t,n,r,a,i){var o=new Ah(e.shape,t.shape,r,a,i);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){_s(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],a="NHWC"===n?e.shape[1]:e.shape[2],i="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=a*t,u=i*t,c=o/(t*t),l=new Oh("NHWC"===n?[r,s,u,c]:[r,c,s,u],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return Ad(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=Vl(0,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/o,o],l=e.reshape([i,a]),d=t.reshape([i,o]);if(0===u)return xd(Tc([]),n);var h=Dc(0),p=new Np(i,a,l.rank,d.rank,s,c);return this.compileAndRun(p,[d,l,h]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var a=Vl(0,e,n),i=a.sliceRank,o=a.numUpdates,s=a.strides,u=a.outputSize,c=new Np(o,i,e.rank,t.rank,s,[u,1]);return this.compileAndRun(c,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new Vh("return real * expR - imag * expI;",e.shape,t),a=new Vh("return real * expI + imag * expR;",e.shape,t),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,i),s=this.compileAndRun(a,i),u=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],a=zl(e,t),i=a[0],o=a[1],s=a[2],u=a[3],c=t.reshape([o,r]),l=e.reshape([e.size/s,s]),d=new Gh(r,u,[o,s]);return this.compileAndRun(d,[l,c]).reshape(i)},t.prototype.fill=function(e,t,n){if("string"===(n=n||Ks(t))){var r=Vs(n,Ds(e));return r.fill(t),Iu.makeTensor(r,e,n,this)}var a=new Hh(e,t),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[],n,i)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return yd(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return Iu.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new cf(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new up(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[nc(e.shape)].concat(rc(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[nc(t)].concat(rc(t)),i=new fp(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=ac(a);return t=r?new Fh(o):new Mh(o),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,a){var i=this;void 0===a&&(a=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Du.DENSE){var u=zu(e.outputShape);s.texShape=u.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===Ds(o.shape))return s.values=Ws(o.dtype,0),o;var c=[],l=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Ds(t.shape)<=xs().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),c.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!oc(n.shape,t.shape)){var r=t,a=t.shape;t.shape=n.shape,t=i.packedReshape(t,a),c.push(t),n=i.texData.get(t.dataId),r.shape=a}return i.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(o.dataId);var d,h={shape:o.shape,texData:s,isUniform:!1},p=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var a=e.userCode;return e.constructor.name+"_"+r+"_"+a}(e,l,h),f=this.getAndSaveBinary(p,function(){return function(e,t,n,r){var a=t.userCode,i=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),o=i.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=qd(i,s,a,t.packedInputs),c=e.createProgram(u),l=null,d=e.getUniformLocation(c,"NAN",!1);1===xs().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var h={},p=0;p<t.variableNames.length;p++){var f=t.variableNames[p];h[f]=e.getUniformLocation(c,f,!1),h["offset"+f]=e.getUniformLocation(c,"offset"+f,!1)}return{program:t,source:u,webGLProgram:c,uniformLocations:h,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:d}}(i.gpgpu,e,l,h)}),m=null!=this.activeTimers;if(m&&(d=this.startTimer()),function(e,t,n,r,a){Jh(t.inShapeInfos,n),Jh([t.outShapeInfo],[r]);var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i,o[0],o[1]):e.setOutputMatrixTexture(i,o[0],o[1]),e.setProgram(t.webGLProgram),1===xs().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset"+a];if(null!=i)if(n.isUniform)if(Ds(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)}),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,f,l,h,r),c.forEach(function(e){return i.disposeData(e.dataId)}),m&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)})),!xs().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===a){var v=this.unpackTensor(o);return this.disposeData(o.dataId),v}return o},t.prototype.compileAndRun=function(e,t,n,r,a){void 0===a&&(a=!1),n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return Iu.makeTensorFromDataId(i.dataId,i.shape,i.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(xs().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=hc(function(){if(!xs().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=xs().getBool("DEBUG");xs().set("DEBUG",!1);var n=e.abs(Dc(1e-8)).dataSync()[0];if(xs().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,a=n.dtype,i=n.values,o=n.texture,s=n.usage,u=n.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=tu());var d=n.texShape;if(null==d&&(d=function(e,t){var n;void 0===t&&(t=!1);var r=xs().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?Rs(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var a=Us(e);e=a.newShape}var i=Ds(e);if(e.length<=1&&i<=r)return[1,i];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=nc(e),s=2,u=2;return e.length&&(s=(n=rc(e))[0],u=n[1]),Os(i=o*(s/2)*(u/2)).map(function(e){return 2*e})}return Os(i)}(r,u),n.texShape=d),null!=i){var h=ac(r),p=void 0,f=d[1],m=d[0],v=i instanceof Uint8Array;u?(f=(t=Uu(d[0],d[1]))[0],m=t[1],p=new Wh(h,[m,f],v)):p=new Uh(h,[m,f],v);var g=this.makeTensorInfo([m,f],a);this.texData.get(g.dataId).usage=v?Pu.PIXELS:Pu.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),f,m,i);var x=this.runWebGLProgram(p,[g],a,null,!0),y=this.texData.get(x.dataId);n.texture=y.texture,n.texShape=y.texShape,n.isPacked=y.isPacked,n.usage=y.usage,this.disposeData(g.dataId),this.texData.delete(x.dataId),n.values=null,l&&(this.uploadWaitMs+=tu()-c)}else{var b=this.acquireTexture(d,s,a,u);n.texture=b}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){return this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024&&((this.numBytesInGPU/1024/1024).toFixed(2),this.warnedAboutMemory=!0),this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*qs(t)},t}(ed);Tu()&&Iu.registerBackend("webgl",function(){return new hf},2);var pf=Ec({square_:function(e){var t=gc(e,"x","square"),n=[t];return Iu.runKernelFunc(function(e,n){return n([t]),e.square(t)},{x:t},null,"Square",{},n,[])}}),ff="SquaredDifference",mf=Ec({squaredDifference_:function(e,t){var n,r=gc(e,"a","squaredDifference"),a=gc(t,"b","squaredDifference");n=ju(r,a),r=n[0],a=n[1],ad(r.shape,a.shape);var i={a:r,b:a},o=[r,a];return Iu.runKernelFunc(function(e,t){var n=e.squaredDifference(r,a);return t([r,a]),n},i,function(e,t){var n=t[0],r=t[1],a=Dc(2);return{a:function(){return e.mul(n.sub(r).mul(a))},b:function(){return e.mul(r.sub(n).mul(a))}}},ff,{},o,[])}}),vf=Ec({abs_:function(e){var t=gc(e,"x","abs");return"complex64"===t.dtype?Iu.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):Iu.runKernelFunc(function(e,n){var r=e.abs(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}},"Abs")}}),gf=Ec({acos_:function(e){var t=gc(e,"x","acos");return Iu.runKernelFunc(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Dc(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),xf=Ec({acosh_:function(e){var t=gc(e,"x","acosh");return Iu.runKernelFunc(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),yf=Ec({asin_:function(e){var t=gc(e,"x","asin");return Iu.runKernelFunc(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Dc(1).sub(n.toFloat().square()).sqrt())}}})}}),bf=Ec({asinh_:function(e){var t=gc(e,"x","asinh");return Iu.runKernelFunc(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Dc(1).add(n.toFloat().square()).sqrt())}}})}}),wf=Ec({atan_:function(e){var t=gc(e,"x","atan");return Iu.runKernelFunc(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),Nf=Ec({atanh_:function(e){var t=gc(e,"x","atanh");return Iu.runKernelFunc(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(Dc(1).sub(n.toFloat().square()))}}})}}),kf=Ec({ceil_:function(e){var t=gc(e,"x","ceil");return Iu.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Vc(e)}}})}}),Cf=Ec({clipByValue_:function(e,t,n){var r=gc(e,"x","clipByValue");_s(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var a=[r],i={min:t,max:n};return Iu.runKernelFunc(function(e,a){var i=e.clip(r,t,n);return a([r]),i},{x:r},function(e,r){var a=r[0];return{x:function(){return e.where(a.greaterEqual(t).logicalAnd(a.lessEqual(n)),Vc(e))}}},"ClipByValue",i,a)}}),jf=Ec({cos_:function(e){var t=gc(e,"x","cos"),n=[t];return Iu.runKernelFunc(function(e,n){var r=e.cos(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}},"Cos",{},n)}}),Sf=Ec({cosh_:function(e){var t=gc(e,"x","cosh");return Iu.runKernelFunc(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),Ef=Ec({erf_:function(e){var t=gc(e,"x","erf");return _s("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),Iu.runKernelFunc(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Rf=Ec({exp_:function(e){var t=gc(e,"x","exp");return Iu.runKernelFunc(function(e,n){var r=e.exp(t);return n([r]),r},{x:t},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),_f=Ec({expm1_:function(e){var t=gc(e,"x","expm1");return Iu.runKernelFunc(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),If=Ec({floor_:function(e){var t=gc(e,"x","floor");return Iu.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Vc(e)}}})}}),Tf=Ec({log_:function(e){var t=gc(e,"x","log"),n=[t];return Iu.runKernelFunc(function(e,n){var r=e.log(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}},"Log",{},n)}}),Af=Ec({log1p_:function(e){var t=gc(e,"x","log1p");return Iu.runKernelFunc(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),Df=Ec({logSigmoid_:function(e){var t=gc(e,"x","logSigmoid");return Iu.runKernelFunc(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),Pf=Ec({neg_:function(e){var t=gc(e,"x","neg"),n=[t];return Iu.runKernelFunc(function(e){return e.neg(t)},{x:t},function(e){return{x:function(){return e.neg()}}},"Neg",{},n)}}),Mf=Ec({reciprocal_:function(e){var t=gc(e,"x","reciprocal");return Iu.runKernelFunc(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),Ff=Ec({round_:function(e){var t=gc(e,"x","round");return Iu.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Vc(e)}}})}}),Of=Ec({rsqrt_:function(e){var t=gc(e,"x","rsqrt"),n=[t];return Iu.runKernelFunc(function(e,n){var r=e.rsqrt(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),Lf=Ec({sigmoid_:function(e){var t=gc(e,"x","sigmoid");return Iu.runKernelFunc(function(e,n){var r=e.sigmoid(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(Dc(1).sub(n)))}}},"Sigmoid")}}),Bf=Ec({sign_:function(e){var t=gc(e,"x","sign");return Iu.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Vc(e)}}})}}),zf=Ec({isNaN_:function(e){var t=gc(e,"x","isNaN");return Iu.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Vc(e)}}})}}),Uf=Ec({isInf_:function(e){var t=gc(e,"x","isInf");return Iu.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Vc(e)}}})}}),Wf=Ec({isFinite_:function(e){var t=gc(e,"x","isFinite");return Iu.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Vc(e)}}})}}),Vf=Ec({sin_:function(e){var t=gc(e,"x","sin"),n=[t];return Iu.runKernelFunc(function(e,n){var r=e.sin(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}},"Sin",{},n)}}),Hf=Ec({sinh_:function(e){var t=gc(e,"x","sinh");return Iu.runKernelFunc(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),qf=Ec({softplus_:function(e){var t=gc(e,"x","softplus");return Iu.runKernelFunc(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),Gf=Ec({sqrt_:function(e){var t=gc(e,"x","sqrt");return Iu.runKernelFunc(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),Kf=Ec({step_:function(e,t){void 0===t&&(t=0);var n=gc(e,"x","step");return Iu.runKernelFunc(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return Vc(e)}}})}}),$f=Ec({tan_:function(e){var t=gc(e,"x","tan");return Iu.runKernelFunc(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),Xf=Ec({tanh_:function(e){var t=gc(e,"x","tanh");return Iu.runKernelFunc(function(e,n){var r=e.tanh(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return Dc(1).sub(n.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function Yf(e,t,n,r,a,i){var o,s,u=gc(e,"x","batchNorm"),c=gc(t,"mean","batchNorm"),l=gc(n,"variance","batchNorm");return null!=a&&(o=gc(a,"scale","batchNorm")),null!=r&&(s=gc(r,"offset","batchNorm")),_s(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),_s(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),_s(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=o&&_s(2===o.rank||1===o.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),null!=s&&_s(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Zf(u,c,l,s,o,i)}function Qf(e,t,n,r,a,i){var o,s,u=gc(e,"x","batchNorm"),c=gc(t,"mean","batchNorm"),l=gc(n,"variance","batchNorm");return null!=a&&(o=gc(a,"scale","batchNorm")),null!=r&&(s=gc(r,"offset","batchNorm")),_s(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),_s(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),_s(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=o&&_s(3===o.rank||1===o.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),null!=s&&_s(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Zf(u,c,l,s,o,i)}function Jf(e,t,n,r,a,i){var o,s,u=gc(e,"x","batchNorm"),c=gc(t,"mean","batchNorm"),l=gc(n,"variance","batchNorm");return null!=a&&(o=gc(a,"scale","batchNorm")),null!=r&&(s=gc(r,"offset","batchNorm")),_s(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),_s(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),_s(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=o&&_s(4===o.rank||1===o.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),null!=s&&_s(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Zf(u,c,l,s,o,i)}function Zf(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u,c=gc(e,"x","batchNorm"),l=gc(t,"mean","batchNorm"),d=gc(n,"variance","batchNorm");null!=a&&(o=gc(a,"scale","batchNorm")),null!=r&&(s=gc(r,"offset","batchNorm")),_s(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),_s(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),_s(null==o||l.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var h=[c,l,d,o];return Iu.runKernelFunc(function(e,t){var n=e.batchNormalization(u,em(l),em(d),i,em(o),em(s));return t([c,l,d,o]),n},{x:c,mean:l,variance:d,scale:o,offset:s},function(e,t){var n=t,r=n[0],a=n[1],o=n[2],s=n[3],c=null==s?Dc(1):s,l=rd(a.shape,u.shape),d=[];if(1===a.rank){for(var h=0;h<u.shape.length-1;++h)d.push(u.shape[h]);d.push(1)}var p=r.sub(a),f=e.mul(c),m=Of(o.add(Dc(i))),v=m.mul(m).mul(m).mul(Dc(-.5));return{x:function(){return 1===a.rank?e.mul(Al(m.as4D(1,1,1,a.shape[0]),d)).mul(c).reshape(r.shape):e.mul(m).mul(c).reshape(r.shape)},mean:function(){var e=m.mul(Dc(-1)).mul(f);return 1===a.rank&&(e=e.sum(l)),e.reshape(a.shape)},variance:function(){var e=v.mul(p).mul(f);return 1===a.rank&&(e=e.sum(l)),e.reshape(a.shape)},scale:function(){var t=p.mul(m),n=e.mul(t);return 1===a.rank&&(n=n.sum(l)),n.reshape(a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=t.sum(l)),t.reshape(a.shape)}}},"BatchNormalization",{varianceEpsilon:i},h).reshape(c.shape)}function em(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function tm(){dc()}var nm=Ec({batchNormalization2d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),tm(),Yf(e,t,n,i,a,r)}}),rm=Ec({batchNormalization3d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),tm(),Qf(e,t,n,i,a,r)}}),am=Ec({batchNormalization4d_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),tm(),Jf(e,t,n,i,a,r)}}),im=Ec({batchNormalization_:function(e,t,n,r,a,i){return void 0===r&&(r=.001),tm(),Zf(e,t,n,i,a,r)}}),om=Ec({batchNorm_:Zf}),sm=Ec({batchNorm2d_:Yf}),um=Ec({batchNorm3d_:Qf}),cm=Ec({batchNorm4d_:Jf}),lm=Ec({logicalAnd_:function(e,t){var n=gc(e,"a","logicalAnd","bool"),r=gc(t,"b","logicalAnd","bool");return ad(n.shape,r.shape),Iu.runKernelFunc(function(e){return e.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),dm=Ec({logicalNot_:function(e){var t=gc(e,"x","logicalNot","bool");return Iu.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),hm=Ec({logicalOr_:function(e,t){var n=gc(e,"a","logicalOr","bool"),r=gc(t,"b","logicalOr","bool");return ad(n.shape,r.shape),Iu.runKernelFunc(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),pm=Ec({logicalXor_:function(e,t){var n=gc(e,"a","logicalXor","bool"),r=gc(t,"b","logicalXor","bool");return ad(n.shape,r.shape),hm(e,t).logicalAnd(lm(e,t).logicalNot())}}),fm=Ec({where_:function(e,t,n){var r=gc(t,"a","where"),a=gc(n,"b","where"),i=gc(e,"condition","where","bool");return Is(r.shape,a.shape,"Error in where: "),1===i.rank?_s(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Is(i.shape,a.shape,"Error in where: "),Iu.runKernelFunc(function(e,t){var n=e.select(i,r,a);return t([i]),n},{$condition:i,$a:r,$b:a},function(e,t){var n=t[0];return{$condition:function(){return Vc(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),mm=function(e){return ms(this,0,void 0,function(){var t,n,r;return vs(this,function(a){switch(a.label){case 0:return[4,(t=gc(e,"condition","whereAsync","bool")).data()];case 1:return n=a.sent(),r=Md(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},vm=Ec({add_:function(e,t){var n,r=gc(e,"a","add"),a=gc(t,"b","add");n=ju(r,a),r=n[0],a=n[1];var i=ad(r.shape,a.shape);return Iu.runKernelFunc(function(e){return e.add(r,a)},{a:r,b:a},function(e){return{a:function(){var t=e,n=rd(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=rd(a.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(a.shape)}}},"Add")}}),gm=Ec({addN_:function(e){_s(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),_s(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return gc(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!Ps(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return Iu.runKernelFunc(function(e){return e.addN(t)},r,function(e){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n},"AddN")}}),xm=Ec({addStrict_:function(e,t){var n=gc(e,"a","addStrict"),r=gc(t,"b","addStrict");return Is(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),ym=Ec({atan2_:function(e,t){var n,r=gc(e,"a","atan2"),a=gc(t,"b","atan2");n=ju(r,a),r=n[0],a=n[1];var i=ad(r.shape,a.shape);return Iu.runKernelFunc(function(e,t){var n=e.atan2(r,a);return t([r,a]),n},{$a:r,$b:a},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=vm(n.square(),r.square()),a=e.mul(r.div(t)),o=rd(n.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(n.shape)},$b:function(){var t=vm(n.square(),r.square()),a=Pf(e.mul(n.div(t))),o=rd(r.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(r.shape)}}})}}),bm=Ec({div_:function(e,t){var n,r=gc(e,"a","div"),a=gc(t,"b","div");if(n=ju(r,a),r=n[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype)return km(r,a);var i=ad(r.shape,a.shape);return Iu.runKernelFunc(function(e,t){var n=e.realDivide(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),a=rd(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=rd(r.shape,i);a.length>0&&(t=t.sum(a).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}},"Div")}}),wm=Ec({divNoNan_:function(e,t){var n,r=gc(e,"a","div"),a=gc(t,"b","div");r=(n=ju(r,a))[0],a=n[1];var i=bm(r,a),o=Vc(i),s=a.equal(o);return fm(s,o,i)}}),Nm=Ec({divStrict_:function(e,t){var n=gc(e,"a","div"),r=gc(t,"b","div");return Is(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),km=Ec({floorDiv_:function(e,t){var n,r=gc(e,"a","floorDiv"),a=gc(t,"b","floorDiv");n=ju(r,a),r=n[0],a=n[1];var i=ad(r.shape,a.shape);return Iu.runKernelFunc(function(e,t){var n=e.floorDiv(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),a=rd(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=rd(r.shape,i);a.length>0&&(t=t.sum(a).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}},"FloorDiv")}}),Cm=Ec({maximum_:function(e,t){var n,r=gc(e,"a","maximum"),a=gc(t,"b","maximum");return n=ju(r,a),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),ad(r.shape,a.shape),Iu.runKernelFunc(function(e,t){var n=e.maximum(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}},"Maximum")}}),jm=Ec({maximumStrict_:function(e,t){var n=gc(e,"a","maximumStrict"),r=gc(t,"b","maximumStrict");return Is(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Sm=Ec({minimum_:function(e,t){var n,r=gc(e,"a","minimum"),a=gc(t,"b","minimum");return n=ju(r,a),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),ad(r.shape,a.shape),Iu.runKernelFunc(function(e,t){var n=e.minimum(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}},"Minimum")}}),Em=Ec({minimumStrict_:function(e,t){var n=gc(e,"a","minimumStrict"),r=gc(t,"b","minimumStrict");return Is(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Rm=Ec({mod_:function(e,t){var n,r=gc(e,"a","mod"),a=gc(t,"b","mod");n=ju(r,a),r=n[0],a=n[1];var i=ad(r.shape,a.shape);return Iu.runKernelFunc(function(e,t){var n=e.mod(r,a);return t([r,a]),n},{$a:r,$b:a},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=rd(n.shape,i);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),a=rd(r.shape,i);return a.length>0?t.sum(a).reshape(r.shape):t}}})}}),_m=Ec({modStrict_:function(e,t){var n=gc(e,"a","modStrict"),r=gc(t,"b","modStrict");return Is(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Im=Ec({mul_:function(e,t){var n,r=gc(e,"a","mul"),a=gc(t,"b","mul");n=ju(r,a),r=n[0],a=n[1];var i=ad(r.shape,a.shape);return Iu.runKernelFunc(function(e,t){var n=e.multiply(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),a=rd(n.shape,i);return a.length>0?t.sum(a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=rd(r.shape,i);return a.length>0?t.sum(a).reshape(r.shape):t}}},"Mul")}}),Tm=Ec({mulStrict_:function(e,t){var n=gc(e,"a","mul"),r=gc(t,"b","mul");return Is(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Am=Ec({pow_:function(e,t){var n,r=gc(e,"base","pow"),a=gc(t,"exp","pow");n=ju(r,a),r=n[0],a=n[1];var i=ad(r.shape,a.shape),o=[r,a];return Iu.runKernelFunc(function(e,t){var n=e.pow(r,a);return t([r,a,n]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1],a=t[2];return{a:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(Dc(1))))),o=rd(n.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(n.shape)},b:function(){var t=n.greater(0),o=n.log().where(t,Vc(n)),s=e.mul(a.mul(o)),u=rd(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}},"Pow",{},o,[!0])}}),Dm=Ec({powStrict_:function(e,t){return Is(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Pm=Ec({squaredDifferenceStrict_:function(e,t){var n=gc(e,"a","squaredDifferenceStrict"),r=gc(t,"b","squaredDifferenceStrict");return Is(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Mm=Ec({sub_:function(e,t){var n,r=gc(e,"a","sub"),a=gc(t,"b","sub");n=ju(r,a),r=n[0],a=n[1];var i=ad(r.shape,a.shape);return Iu.runKernelFunc(function(e){return e.subtract(r,a)},{a:r,b:a},function(e){return{a:function(){var t=e,n=rd(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=rd(a.shape,i);return n.length>0&&(t=t.sum(n)),t.neg().reshape(a.shape)}}},"Sub")}}),Fm=Ec({subStrict_:function(e,t){var n=gc(e,"a","subStrict"),r=gc(t,"b","subStrict");return Is(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Om=Ec({equal_:function(e,t){var n,r=gc(e,"a","equal"),a=gc(t,"b","equal");return n=ju(r,a),r=n[0],a=n[1],ad(r.shape,a.shape),Iu.runKernelFunc(function(e){return e.equal(r,a)},{$a:r,$b:a})}}),Lm=Ec({equalStrict_:function(e,t){var n=gc(e,"a","equalStrict"),r=gc(t,"b","equalStrict");return Is(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Bm=Ec({greater_:function(e,t){var n,r=gc(e,"a","greater"),a=gc(t,"b","greater");return n=ju(r,a),r=n[0],a=n[1],ad(r.shape,a.shape),Iu.runKernelFunc(function(e){return e.greater(r,a)},{a:r,b:a},null,"Greater")}}),zm=Ec({greaterEqual_:function(e,t){var n,r=gc(e,"a","greaterEqual"),a=gc(t,"b","greaterEqual");return n=ju(r,a),r=n[0],a=n[1],ad(r.shape,a.shape),Iu.runKernelFunc(function(e,t){var n=e.greaterEqual(r,a);return t([r,a]),n},{a:r,b:a},function(e,t){var n=t[0],r=t[1];return{a:function(){return Vc(n)},b:function(){return Vc(r)}}},"GreaterEqual")}}),Um=Ec({greaterEqualStrict_:function(e,t){var n=gc(e,"a","greaterEqualStrict"),r=gc(t,"b","greaterEqualStrict");return Is(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Wm=Ec({greaterStrict_:function(e,t){var n=gc(e,"a","greaterStrict"),r=gc(t,"b","greaterStrict");return Is(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Vm=Ec({less_:function(e,t){var n,r=gc(e,"a","less"),a=gc(t,"b","less");return n=ju(r,a),r=n[0],a=n[1],ad(r.shape,a.shape),Iu.runKernelFunc(function(e){return e.less(r,a)},{a:r,b:a},null,"Less")}}),Hm=Ec({lessEqual_:function(e,t){var n,r=gc(e,"a","lessEqual"),a=gc(t,"b","lessEqual");return n=ju(r,a),r=n[0],a=n[1],ad(r.shape,a.shape),Iu.runKernelFunc(function(e,t){var n=e.lessEqual(r,a);return t([r,a]),n},{a:r,b:a},null,"LessEqual")}}),qm=Ec({lessEqualStrict_:function(e,t){var n=gc(e,"a","lessEqualStrict"),r=gc(t,"b","lessEqualStrict");return Is(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Gm=Ec({lessStrict_:function(e,t){var n=gc(e,"a","lessStrict"),r=gc(t,"b","lessStrict");return Is(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Km=Ec({notEqual_:function(e,t){var n,r=gc(e,"a","notEqual"),a=gc(t,"b","notEqual");return n=ju(r,a),r=n[0],a=n[1],ad(r.shape,a.shape),Iu.runKernelFunc(function(e){return e.notEqual(r,a)},{a:r,b:a},null,"NotEqual")}}),$m=Ec({notEqualStrict_:function(e,t){var n=gc(e,"a","notEqualStrict"),r=gc(t,"b","notEqualStrict");return Is(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Xm(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Ym(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Qm=Ec({gather_:function(e,t,n){void 0===n&&(n=0);var r=gc(e,"x","gather"),a=gc(t,"indices","gather","int32");n=zs(n,r.shape)[0];var i=function(e,t,n){for(var r=e.shape[n],a=[],i=1,o=1,s=0;s<n;s++)a.push(e.shape[s]),i*=e.shape[s];for(s=0;s<t.rank;s++)a.push(t.shape[s]);for(s=n+1;s<e.rank;s++)a.push(e.shape[s]),o*=e.shape[s];return{batchSize:i,sliceSize:o,dimSize:r,outputShape:a}}(r,a,n);return Iu.runKernelFunc(function(e,t){var i=e.gather(r,a.flatten(),n);return t([a]),i},{x:r,indices:a},function(e,t){var a=t[0];return{x:function(){var t=r.shape,i=a.size,o=t.slice(0,n),s=o.length,u=t.slice(n,t.length).slice(1),c=u.length,l=Xm(0,s),d=Xm(s+1,s+1+c),h=Ym([o,[i],u]),p=e.reshape(h),f=a.reshape([i]),m=Ym([[s],l,d]),v=p.transpose(m),g=Jm(v,f,r.shape[n]),x=Cc(m);return g.transpose(x)},indices:function(){return a}}},"Gather",{axis:n}).reshape(i.outputShape)}}),Jm=Ec({unsortedSegmentSum_:function(e,t,n){var r=gc(e,"x","unsortedSegmentSum"),a=gc(t,"segmentIds","unsortedSegmentSum","int32");return _s(Ms(n),function(){return"numSegments must be of dtype int"}),Iu.runKernelFunc(function(e,t){var i=e.unsortedSegmentSum(r,a,n);return t([a]),i},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Cm(t,Vc(t)),r=Qm(e,n),a=zm(t,Dc(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=ml(a,o+1);a=lm(a,Lc(r.shape,"bool"));var s=Vc(r);return fm(a,r,s)}(e,n)}}})}});function Zm(e,t,n,r,a,i,o){void 0===i&&(i="NHWC"),_s(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),_s(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),_s(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),_s(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var l="NHWC"===i?s[3]:s[1],d="NHWC"===i?u.shape[3]:u.shape[1];_s(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),_s(d===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+n.shape[3]+"."}),null!=o&&_s(Ms(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var h=vd(i),p=sd(s,n.shape,r,1,a,o,!1,h),f=Iu.runKernelFunc(function(e,t){var r=e.conv2dDerInput(u,n,p);return t([n,u]),r},{dy4D:u,filter:n},function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return rv(e,n,r,a,i,1,o)},filter:function(){return iv(e,s,n.shape,r,a,i,o)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function ev(e){var t,n="number"==typeof(t=e)?[t,t,t]:2===t.length?[t[0],t[1],1]:t,r=n[0],a=n[1],i=n[2];return 1===r&&1===a&&1===i}function tv(e,t,n,r,a){_s(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];_s(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),_s(5===o.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),_s(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),_s(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),_s(c===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."});var l=ud(i,n.shape,r,1,a),d=Iu.runKernelFunc(function(e){return e.conv3dDerInput(o,n,l)},{dy5D:o});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var nv=Ec({conv1d_:function(e,t,n,r,a,i,o){void 0===a&&(a="NWC"),void 0===i&&(i=1);var s=gc(e,"x","conv1d"),u=gc(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),_s(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),_s(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=o&&_s(Ms(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}),_s(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),_s(md(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),_s("NWC"===a,function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),p=rv(h,d,[1,n],r,"NHWC",[1,i],o);return l?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),rv=Ec({conv2d_:function(e,t,n,r,a,i,o){void 0===a&&(a="NHWC"),void 0===i&&(i=[1,1]);var s=gc(e,"x","conv2d"),u=gc(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),_s(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),_s(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=o&&_s(Ms(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var d="NHWC"===a?c.shape[3]:c.shape[1];_s(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),_s(md(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"});var h=vd(a),p=sd(c.shape,u.shape,n,i,r,o,!1,h),f=[u,c],m=Iu.runKernelFunc(function(e,t){var n=e.conv2d(c,u,p);return t([u,c]),n},{x:c,filter:u},function(e,t){var o=t,s=o[0],u=o[1];return _s(fd(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return ov(u.shape,e,s,n,r,a)},filter:function(){return iv(u,e,s.shape,n,r,a)}}},"Conv2D",p,f);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),av=Ec({conv3d_:function(e,t,n,r,a,i){void 0===a&&(a="NDHWC"),void 0===i&&(i=[1,1,1]);var o,s=gc(e,"x","conv3d"),u=gc(t,"filter","conv3d"),c=s,l=!1;4===s.rank&&(l=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),_s(5===c.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),_s(5===u.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."}),_s(c.shape[4]===u.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+u.shape[3]+"."}),_s((o=i,ev(n)||ev(o)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),_s("NDHWC"===a,function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var d=ud(c.shape,u.shape,n,i,r),h=Iu.runKernelFunc(function(e,t){var n=e.conv3d(c,u,d);return t([c,u]),n},{x:c,$filter:u},function(e,t){_s(ev(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var a=t[0],o=t[1];return{x:function(){return tv(a.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,a){var i=e;4===e.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),_s(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),_s(5===o.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."}),_s(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),_s(i.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."}),_s(o.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=ud(i.shape,n,r,1,a);return Iu.runKernelFunc(function(e){return e.conv3dDerFilter(i,o,s)},{x5D:i,dy5D:o})}(a,e,o.shape,n,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),iv=Ec({conv2dDerFilter_:function(e,t,n,r,a,i,o){void 0===i&&(i="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),_s(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),_s(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),_s(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];_s(c===n[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."}),_s(l===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."}),null!=o&&_s(Ms(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var d=vd(i),h=sd(s.shape,n,r,1,a,o,!1,d);return Iu.runKernelFunc(function(e){return e.conv2dDerFilter(s,u,h)},{x4D:s,dy4D:u})}}),ov=Ec({conv2dDerInput_:Zm}),sv=Ec({depthwiseConv2d_:function(e,t,n,r,a,i,o){void 0===i&&(i=[1,1]);var s=gc(e,"x","depthwiseConv2d"),u=gc(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),_s(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),_s(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),_s(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),_s(md(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&_s(Ms(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var d=sd(c.shape,u.shape,n,i,r,o,!0),h=[c,u],p=Iu.runKernelFunc(function(e,t){var n=e.depthwiseConv2D(c,u,d);return t([c,u]),n},{x:c,filter:u},function(e,t){_s(fd(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var n=t[0],r=t[1];return{x:function(){return uv(n.shape,e,r,d)},filter:function(){return cv(n,e,r.shape,d)}}},"DepthwiseConv2dNative",d,h);return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),uv=Ec({depthwiseConv2dDerInput_:function(e,t,n,r){var a=t,i=!1;3===t.rank&&(i=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=Iu.runKernelFunc(function(e){return e.depthwiseConv2DDerInput(a,n,r)},{dy4D:a});return i?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),cv=Ec({depthwiseConv2dDerFilter_:function(e,t,n,r){var a=e;3===e.rank&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return 3===i.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Iu.runKernelFunc(function(e){return e.depthwiseConv2DDerFilter(a,i,r)},{x4D:a,dy4D:i})}}),lv=Ec({separableConv2d_:function(e,t,n,r,a,i,o){void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC");var s=gc(e,"x","separableConv2d"),u=gc(t,"depthwiseFilter","separableConv2d"),c=gc(n,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");_s(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),_s(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),_s(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),_s(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),_s(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var h=u.shape[2],p=u.shape[3];_s(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*p+", but got "+c.shape[2]+"."});var f=sv(l,u,r,a,o,i),m=rv(f,c,1,"valid",o);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),dv=Ec({conv2dTranspose_:function(e,t,n,r,a,i){return Zm(n,gc(e,"x","conv2dTranspose"),gc(t,"filter","conv2dTranspose"),r,a,"NHWC",i)}}),hv=Ec({conv3dTranspose_:function(e,t,n,r,a){return tv(n,gc(e,"x","conv3dTranspose"),gc(t,"filter","conv3dTranspose"),r,a)}}),pv=Ec({matMul_:function(e,t,n,r){var a;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=gc(e,"a","matMul"),o=gc(t,"b","matMul");a=ju(i,o),i=a[0],o=a[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?o.shape[o.rank-1]:o.shape[o.rank-2],c=n?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?o.shape[o.rank-2]:o.shape[o.rank-1],d=i.shape.slice(0,-2),h=o.shape.slice(0,-2),p=Ds(d),f=Ds(h);_s(i.rank>=2&&o.rank>=2&&i.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+o.rank+"."}),_s(Ps(d,h),function(){return"Error in matMul: outer dimensions ("+d+") and ("+h+") of Tensors with shapes "+i.shape+" and "+o.shape+" must match."}),_s(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([c,l]),v=n?i.as3D(p,s,c):i.as3D(p,c,s),g=r?o.as3D(f,l,u):o.as3D(f,u,l),x={transposeA:n,transposeB:r};return Iu.runKernelFunc(function(e,t){var a=e.batchMatMul(v,g,n,r);return t([v,g]),a},{a:v,b:g},function(e,t){var a=t,i=a[0],o=a[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(i,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return i.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(i,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return i.matMul(e,!0,!1)}}},"BatchMatMul",x).reshape(m)}}),fv=Ec({dot_:function(e,t){var n=gc(e,"t1","dot"),r=gc(t,"t2","dot");_s(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return _s(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+i+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),mv=Ec({outerProduct_:function(e,t){var n=gc(e,"v1","outerProduct"),r=gc(t,"v2","outerProduct");return _s(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),vv=Ec({reverse_:function(e,t){var n=gc(e,"x","reverse");if(0===n.rank)return n.clone();var r=zs(t,n.shape);return Iu.runKernelFunc(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),gv=Ec({reverse1d_:function(e){var t=gc(e,"x","reverse");return _s(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),vv(t,0)}}),xv=Ec({reverse2d_:function(e,t){var n=gc(e,"x","reverse");return _s(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),vv(n,t)}}),yv=Ec({reverse3d_:function(e,t){var n=gc(e,"x","reverse");return _s(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),vv(n,t)}}),bv=Ec({reverse4d_:function(e,t){var n=gc(e,"x","reverse");return _s(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),vv(n,t)}});function wv(e,t,n,r,a,i){var o=gc(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),_s(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),_s(md(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=i&&_s(Ms(a),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var c=id(s.shape,t,n,r,a,i);if(1===c.filterWidth&&1===c.filterHeight&&Ps(c.inShape,c.outShape))return o.clone();var l=[s],d=Iu.runKernelFunc(function(e,t){var n=e.maxPool(s,c);return t([s,n]),n},{x:s},function(e,i){var o=i[0],s=i[1];return{x:function(){return function(e,t,n,r,a,i,o){var s=gc(e,"dy","maxPoolBackprop"),u=gc(t,"input","maxPoolBackprop"),c=gc(n,"output","maxPoolBackprop");_s(u.rank===s.rank,function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+s.rank+")"}),_s(md(a,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}),_s(4===s.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."}),_s(4===u.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var l=id(u.shape,r,a,i,o,void 0);return Iu.runKernelFunc(function(e){return e.maxPoolBackprop(s,u,c,l)},{$dy:s,$input:u})}(e,o,s,t,n,r,a)}}},"MaxPool",c,l);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Nv(e,t,n,r,a,i){var o=gc(e,"x","avgPool","float32");_s(md(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),_s(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&_s(Ms(a),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var c=id(s.shape,t,n,r,a,i);if(1===c.filterWidth&&1===c.filterHeight&&Ps(c.inShape,c.outShape))return o.clone();var l=Iu.runKernelFunc(function(e){return e.avgPool(s,c)},{x:s},function(e){return{x:function(){return function(e,t,n,r,a,i){var o=gc(e,"dy","avgPoolBackprop"),s=gc(t,"input","avgPoolBackprop");_s(s.rank===o.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"}),_s(md(r,a),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"});var u=s,c=o,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),_s(4===c.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."}),_s(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var d=id(u.shape,n,r,a,i),h=Iu.runKernelFunc(function(e){return e.avgPoolBackprop(c,u,d)},{dy4D:c,input4D:u});return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(e,s,t,n,r,a)}}},"AvgPool",c);return l=l.cast(o.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var kv=Ec({maxPool_:function(e,t,n,r,a){return wv(e,t,n,1,r,a)}}),Cv=Ec({avgPool_:function(e,t,n,r,a){return Nv(e,t,n,1,r,a)}}),jv=Ec({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=gc(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),_s(md(i,a),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"});var c,l,d,h,p,f,m=id(s.shape,t,i,a,r),v=[m.dilationHeight,m.dilationWidth];c="same"===r?(l=[m.filterHeight,m.filterWidth],d=v,h=l.map(function(e,t){return e+(e-1)*(d[t]-1)}).map(function(e){return e-1}),p=h.map(function(e){return Math.floor(e/2)}),f=h.map(function(e,t){return e-p[t]}),h.map(function(e,t){return[p[t],f[t]]})):[[0,0],[0,0]];var g=1===v[0]&&1===v[1],x=function(e,t,n){var r=n.map(function(e){return e[0]}),a=n.map(function(e){return e[1]}),i=e.concat(r,a),o=t.map(function(e,t){return(e-i[t]%e)%e}),s=a.map(function(e,t){return e+o[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,o[t]]})]}([m.inHeight,m.inWidth],v,c),y=x[0],b=x[1],w=g?r:"valid",N=g?s:_l(s,v,y),k=("avg"===n?function(){return Nv(N,t,i,1,w)}:function(){return wv(N,t,i,1,w)})(),C=g?k:cl(k,v,b);return u?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Sv=Ec({maxPool3d_:function(e,t,n,r,a,i,o){void 0===i&&(i="NDHWC");var s=gc(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),_s(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),_s("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),_s(md(n,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),null!=a&&_s(Ms(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var l=od(u.shape,t,n,o,r,a,i),d=Iu.runKernelFunc(function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n},{x:u},function(e,i){var s=i[0],u=i[1];return{x:function(){return function(e,t,n,r,a,i,o,s){var u=gc(e,"dy","maxPool3dBackprop"),c=gc(t,"input","maxPool3dBackprop"),l=gc(n,"output","maxPool3dBackprop"),d=u,h=c,p=l,f=!1;4===c.rank&&(f=!0,d=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),h=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),p=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),_s(5===d.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+d.rank+"."}),_s(5===h.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."}),_s(5===p.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+p.rank+"."}),null==i&&(i=[1,1,1]),_s(md(a,i),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}),null!=s&&_s(Ms(o),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."});var m=od(h.shape,r,a,i,o,s),v=Iu.runKernelFunc(function(e){return e.maxPool3dBackprop(d,h,p,m)},{dy5D:d,input5D:h});return f?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}(e,s,u,t,n,o,r,a)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Ev=Ec({avgPool3d_:function(e,t,n,r,a,i,o){void 0===i&&(i="NDHWC");var s=gc(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),_s(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),_s("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),_s(md(n,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),null!=a&&_s(Ms(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var l=od(u.shape,t,n,o,r,a,i),d=Iu.runKernelFunc(function(e){return e.avgPool3d(u,l)},{x:u},function(e){return{x:function(){return function(e,t,n,r,a,i,o){var s=gc(e,"dy","avgPool3dBackprop"),u=gc(t,"input","avgPool3dBackprop"),c=s,l=u,d=!1;4===u.rank&&(d=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),_s(5===c.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."}),_s(5===l.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."}),null==a&&(a=[1,1,1]),_s(md(r,a),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"}),null!=o&&_s(Ms(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var h=od(l.shape,n,r,a,i,o),p=Iu.runKernelFunc(function(e){return e.avgPool3dBackprop(c,l,h)},{dy5D:c,input5D:l});return d?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}(e,u,t,n,o,r,a)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Rv=Ec({slice_:function(e,t,n){var r,a,i=gc(e,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach(function(e){_s(-1!==e,function(){return"slice() does not support negative begin indexing."})}),a=(a=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(_s(-1===e,function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."}),i.shape[t]-r[t])}),function(e,t,n){_s(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),_s(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){_s(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},a=0;a<e.rank;++a)r(a)}(i,r,a);var o=i.shape,s={begin:r,size:a};return Iu.runKernelFunc(function(e){return e.slice(i,r,a)},{x:i},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-a[n]]);return{x:function(){return e.pad(t)}}},"Slice",s)}}),_v=Ec({slice1d_:function(e,t,n){var r=gc(e,"x","slice1d");return _s(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Rv(r,[t],[n])}}),Iv=Ec({slice2d_:function(e,t,n){var r=gc(e,"x","slice2d");return _s(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Rv(r,t,n)}}),Tv=Ec({slice3d_:function(e,t,n){var r=gc(e,"x","slice3d");return _s(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Rv(r,t,n)}}),Av=Ec({slice4d_:function(e,t,n){var r=gc(e,"x","slice4d");return _s(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Rv(r,t,n)}});function Dv(e,t,n,r,a){return t.rank<n.rank&&(t=t.reshape(wc(t.shape,r))),e.rank<n.rank&&(e=e.reshape(wc(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==a?r:r.transpose(a)}}}var Pv=Ec({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=gc(e,"x","all","bool"),a=zs(t,r.shape),i=a,o=kc(i,r.rank);null!=o&&(r=r.transpose(o),i=jc(i.length,r.rank));var s=Iu.runKernelFunc(function(e){return e.all(r,i)},{$x:r});if(n){var u=wc(s.shape,a);return s.reshape(u)}return s}}),Mv=Ec({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=gc(e,"x","any","bool"),a=zs(t,r.shape),i=a,o=kc(i,r.rank);null!=o&&(r=r.transpose(o),i=jc(i.length,r.rank));var s=Iu.runKernelFunc(function(e){return e.any(r,i)},{$x:r});if(n){var u=wc(s.shape,a);return s.reshape(u)}return s}}),Fv=Ec({argMax_:function(e,t){void 0===t&&(t=0);var n=gc(e,"x","argMax");null==t&&(t=0);var r=zs(t,n.shape),a=kc(r,n.rank);null!=a&&(n=n.transpose(a),r=jc(r.length,n.rank));var i={axis:r[0]},o=[n];return Iu.runKernelFunc(function(e,t){var a=e.argMax(n,r[0]);return t([n]),a},{x:n},function(e,t){var n=t[0];return{x:function(){return Vc(n)}}},"ArgMax",i,o)}}),Ov=Ec({argMin_:function(e,t){void 0===t&&(t=0);var n=gc(e,"x","argMin");null==t&&(t=0);var r=zs(t,n.shape),a=kc(r,n.rank);return null!=a&&(n=n.transpose(a),r=jc(r.length,n.rank)),Iu.runKernelFunc(function(e,t){var a=e.argMin(n,r[0]);return t([n]),a},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Vc(n)}}})}}),Lv=Ec({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=gc(e,"x","logSumExp"),a=zs(t,r.shape),i=r.max(a,!0),o=r.sub(i).exp().sum(a).log(),s=i.reshape(o.shape).add(o);if(n){var u=wc(s.shape,a);return s.reshape(u)}return s}}),Bv=Ec({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=gc(e,"x","max"),a=r,i=zs(t,r.shape),o=i,s=kc(o,r.rank);null!=s&&(r=r.transpose(s),o=jc(o.length,r.rank));var u=[r],c=Iu.runKernelFunc(function(e,t){var n=e.max(r,o);return t([a,n]),n},{x:r},function(e,t){return Dv(e,t[1],t[0],i,s)},"Max",{axes:o},u,[!0]);if(n){var l=wc(c.shape,i);c=c.reshape(l)}return c}}),zv=Ec({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=gc(e,"x","mean"),a=zs(t,r.shape),i=Ds(bc(r.shape,a)[1]);return Yl(function(e){var r=Dc(i);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return a.forEach(function(e){n[e]=1}),t.reshape(n).mul(Lc(e.shape,"float32")).div(i)}}})(r)}}),Uv=Ec({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=gc(e,"x","min"),a=r,i=zs(t,r.shape),o=i,s=kc(o,r.rank);null!=s&&(r=r.transpose(s),o=jc(o.length,r.rank));var u=[r],c=Iu.runKernelFunc(function(e,t){var n=e.min(r,o);return t([a,n]),n},{x:r},function(e,t){return Dv(e,t[1],t[0],i,s)},"Min",{axes:o},u,[!0]);if(n){var l=wc(c.shape,i);c=c.reshape(l)}return c}}),Wv=Ec({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=zs(t,(e=gc(e,"x","moments")).shape),a=e.mean(r,n),i=a.shape;n||(i=wc(a.shape,r));var o=e.toFloat().sub(a.reshape(i)).square();return{mean:a,variance:o.mean(r,n)}}}),Vv=Ec({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=gc(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var a=zs(t,r.shape);return Yl(function(e){var t=kc(a,e.rank),r=a,i=e;null!=t&&(i=e.transpose(t),r=jc(r.length,e.rank));var o=function(t){var n=e.shape.slice();return a.forEach(function(e){n[e]=1}),t.reshape(n).mul(Lc(e.shape,"float32"))},s={axes:r},u=Iu.runKernelFunc(function(e){return e.sum(i,r)},{x:i},function(e){return{x:function(){return o(e)}}},"Sum",s);if(n){var c=wc(u.shape,a);u=u.reshape(c)}return{value:u,gradFunc:o}})(r)}}),Hv=Ec({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=gc(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var a=zs(t,r.shape),i=kc(a,r.rank),o=a,s=r;null!=i&&(s=r.transpose(i),o=jc(o.length,r.rank));var u=Iu.runKernelFunc(function(e){return e.prod(s,o)},{permutedX:s});if(n){var c=wc(u.shape,a);u=u.reshape(c)}return u}}),qv=Ec({elu_:function(e){var t=gc(e,"x","elu");return Iu.runKernelFunc(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return Iu.runKernelFunc(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),Gv=Ec({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=gc(e,"x","leakyRelu");return Cm(Dc(t).mul(n),n)}}),Kv=Ec({prelu_:function(e,t){var n=gc(e,"x","prelu"),r=gc(t,"alpha","prelu");return Iu.runKernelFunc(function(e,t){var a=e.prelu(n,r);return t([n,r]),a},{x:n,alpha:r},function(e,t){var n=t[0],r=t[1],a=n.greater(0);return{x:function(){return fm(a,e,e.mul(r))},alpha:function(){var t=fm(a,Vc(e),e.mul(n)),i=rd(r.shape,e.shape);return i.length>0&&(t=t.sum(i)),t.reshape(r.shape)}}},"Prelu")}}),$v=Ec({relu_:function(e){var t=gc(e,"x","relu");return"bool"===t.dtype?t.toInt():Iu.runKernelFunc(function(e,n){var r=e.relu(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}},"Relu")}}),Xv=Ec({relu6_:function(e){var t=gc(e,"x","relu6");return"bool"===t.dtype?t.toInt():Iu.runKernelFunc(function(e,n){var r=e.relu6(t);return n([t]),r},{x:t},function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}},"Relu6")}}),Yv=Ec({selu_:function(e){var t=gc(e,"x","selu");return Iu.runKernelFunc(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(Dc(0)),r=Dc(Mp),a=Dc(Fp),i=e.mul(a),o=e.mul(r).mul(n.toFloat().exp());return fm(t,i,o)}}})}}),Qv=Ec({transpose_:function(e,t){var n=gc(e,"x","transpose");if(null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),_s(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){_s(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return Iu.runKernelFunc(function(e){return e.transpose(n,t)},{x:n},function(e){var n=Cc(t);return{x:function(){return e.transpose(n)}}},"Transpose",r)}}),Jv=Ec({localResponseNormalization_:function(e,t,n,r,a){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=.5);var i=gc(e,"x","localResponseNormalization");_s(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),_s(Ms(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var o=i,s=!1;3===i.rank&&(s=!0,o=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=Iu.runKernelFunc(function(e,i){var s=e.localResponseNormalization4D(o,t,n,r,a);return i([o,s]),s},{x4D:o},function(e,i){var o=i[0],s=i[1];return{x4D:function(){return Iu.runKernelFunc(function(i){return i.LRNGrad(e,o,s,t,n,r,a)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Zv=Ec({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var a=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(Dc(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=gc(e,"x","norm"),t,n),i=a.shape;if(r){var o=zs(n,e.shape);i=wc(a.shape,o)}return a.reshape(i)}}),eg=Ec({basicLSTMCell_:function(e,t,n,r,a,i){var o=gc(e,"forgetBias","basicLSTMCell"),s=gc(t,"lstmKernel","basicLSTMCell"),u=gc(n,"lstmBias","basicLSTMCell"),c=gc(r,"data","basicLSTMCell"),l=gc(a,"c","basicLSTMCell"),d=gc(i,"h","basicLSTMCell"),h=c.concat(d,1).matMul(s).add(u),p=h.shape[0],f=h.shape[1]/4,m=[p,f],v=h.slice([0,0],m),g=h.slice([0,f],m),x=h.slice([0,2*f],m),y=h.slice([0,3*f],m),b=v.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(o.add(x).sigmoid())),w=b.tanh().mulStrict(y.sigmoid());return[b,w]}}),tg=Ec({multiRNNCell_:function(e,t,n,r){for(var a=gc(t,"data","multiRNNCell"),i=xc(n,"c","multiRNNCell"),o=xc(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var d=[],h=[];for(c=0;c<u.length;c+=2)d.push(u[c]),h.push(u[c+1]);return[d,h]}}),ng=Ec({movingAverage_:function(e,t,n,r,a){void 0===a&&(a=!0);var i=gc(e,"v","movingAverage"),o=gc(t,"x","movingAverage"),s=gc(n,"decay","movingAverage");(function(e,t){_s(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})})(i,o),_s(Ps(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Dc(1),c=u.sub(s),l=o.sub(i).mul(c);if(a){_s(null!=r,function(){return"When using zeroDebias: true, step is required."});var d=gc(r,"step","movingAverage");l=l.div(u.sub(Am(s,d)))}return i.add(l)}}),rg=Ec({stridedSlice_:function(e,t,n,r,a,i,o,s,u){if(void 0===a&&(a=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var c=gc(e,"x","stridedSlice"),l=Hl(s),d=c.shape.slice();l.forEach(function(e){t[e]=0,n[e]=1,d.splice(e,0,1)}),c=c.reshape(d);for(var h=0;h<c.rank;h++)t[h]=Gl(a,t,r,c.shape,h),n[h]=Kl(i,n,r,c.shape,h),r[h]=r[h]||1;var p=Hl(u);p.forEach(function(e){n[e]=t[e]+1,r[e]=1});var f=ql(t,n,r),m=f.filter(function(e,t){return-1===p.indexOf(t)});return r.every(function(e){return 1===e})?Rv(c,t,f).reshape(m):Iu.runKernelFunc(function(e){return e.stridedSlice(c,t,n,r)},{$x:c}).reshape(m)}}),ag=Ec({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=gc(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var i=Iu.runKernelFunc(function(e){return e.topk(r,t,n)},{$x:r});return{values:i[0],indices:i[1]}}}),ig=Ec({scatterND_:function(e,t,n){var r=gc(e,"indices","scatterND","int32"),a=gc(t,"updates","scatterND");return Wl(a,r,n),Iu.runKernelFunc(function(e){return e.scatterND(r,a,n)},{indices:r,updates:a},null,"ScatterNd",{shape:n})}}),og=Ec({fft_:function(e){_s("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Iu.runKernelFunc(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),sg=Ec({ifft_:function(e){_s("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return Iu.runKernelFunc(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),ug=Ec({rfft_:function(e,t){_s("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map(function(e){return 0}),o=e.shape.map(function(e){return e});o[e.shape.length-1]=t,n=e.slice(i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=e.concat(Bc(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=Rc(n,u).as2D(a,r),l=og(c),d=Math.floor(r/2)+1,h=_c(l),p=Ic(l),f=h.split([d,r-d],h.shape.length-1),m=p.split([d,r-d],p.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=d,Rc(f[0],m[0]).reshape(v)}}),cg=Ec({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),a=sg(r);return _c(a)}var i=[n,2*(t-1)],o=_c(e).as2D(n,t),s=Ic(e).as2D(n,t),u=o.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(Dc(-1)),l=o.concat(u,1),d=s.concat(c,1);return r=Rc(l,d).as2D(i[0],i[1]),a=sg(r),_c(a)}}),lg=Object.freeze({fft:og,ifft:sg,rfft:ug,irfft:cg}),dg=Ec({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var a=gc(e,"sparseIndices","sparseToDense","int32"),i=gc(t,"sparseValues","sparseToDense"),o=gc(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+a+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o),Iu.runKernelFunc(function(e){return e.sparseToDense(a,i,n,o)},{$sparseIndices:a,$sparseValues:i,$defaultValue:o})}}),hg=Ec({gatherND_:function(e,t){var n=gc(t,"indices","gatherND","int32"),r=gc(e,"x","gatherND");return Iu.runKernelFunc(function(e){return e.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),pg=Ec({diag_:function(e){var t=gc(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return Iu.runKernelFunc(function(e){return e.diag(t)},{$x:t}).reshape(n)}}),fg=Ec({dropout_:function(e,t,n,r){var a=gc(e,"x","dropout");if(_s("float32"===a.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."}),_s(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return e instanceof fu?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(Ps(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=El(i,0,1,"float32",r).add(o).floor().div(o);return a.mul(s)}});function mg(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return Pc(a,"float32")}var vg,gg=Ec({hannWindow_:function(e){return mg(e,.5,.5)}}),xg=Ec({hammingWindow_:function(e){return mg(e,.54,.46)}}),yg=Ec({frame_:function(e,t,n,r,a){void 0===r&&(r=!1),void 0===a&&(a=0);for(var i=0,o=[];i+t<=e.size;)o.push(Rv(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Hc([Rv(e,i,t-s),zc([s],a)]);o.push(u),i+=n}return 0===o.length?Mc([],[0,t]):Hc(o).as2D(o.length,t)}}),bg=Ec({stft_:function(e,t,n,r,a){var i;void 0===a&&(a=gg),null==r&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var o=yg(e,t,n),s=Im(o,a(t)),u=[],c=0;c<o.shape[0];c++)u.push(ug(s.slice([c,0],[1,t]),r));return Hc(u)}}),wg=Object.freeze({hannWindow:gg,hammingWindow:xg,frame:yg,stft:bg});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(vg||(vg={}));var Ng=Ec({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=vg.SUM_BY_NONZERO_WEIGHTS);var a=gc(e,"labels","absoluteDifference"),i=gc(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=gc(n,"weights","absoluteDifference")),Is(a.shape,i.shape,"Error in absoluteDifference: ");var s=a.sub(i).abs();return kg(s,o,r)}}),kg=Ec({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=vg.SUM_BY_NONZERO_WEIGHTS);var r=gc(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=gc(t,"weights","computeWeightedLoss"));var i=null==a?r:r.mul(a);if(n===vg.NONE)return i;if(n===vg.SUM)return i.sum();if(n===vg.MEAN){if(null==a)return i.mean();var o=r.size/a.size,s=i.sum().div(a.sum());return o>1?s.div(Dc(o)):s}if(n===vg.SUM_BY_NONZERO_WEIGHTS){if(null==a)return i.sum().div(Dc(r.size));var u=a.mul(Lc(r.shape)).notEqual(Dc(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),Cg=Ec({cosineDistance_:function(e,t,n,r,a){void 0===a&&(a=vg.SUM_BY_NONZERO_WEIGHTS);var i=gc(e,"labels","cosineDistance"),o=gc(t,"predictions","cosineDistance"),s=null;null!=r&&(s=gc(r,"weights","cosineDistance")),Is(i.shape,o.shape,"Error in cosineDistance: ");var u=Dc(1).sub(i.mul(o).sum(n,!0));return kg(u,s,a)}}),jg=Ec({hingeLoss_:function(e,t,n,r){void 0===r&&(r=vg.SUM_BY_NONZERO_WEIGHTS);var a=gc(e,"labels","hingeLoss"),i=gc(t,"predictions","hingeLoss"),o=null;null!=n&&(o=gc(n,"weights","hingeLoss")),Is(a.shape,i.shape,"Error in hingeLoss: ");var s=Dc(1);a=Dc(2).mul(a).sub(s);var u=s.sub(a.mul(i)).relu();return kg(u,o,r)}}),Sg=Ec({huberLoss_:function(e,t,n,r,a){void 0===r&&(r=1),void 0===a&&(a=vg.SUM_BY_NONZERO_WEIGHTS);var i=gc(e,"labels","huberLoss"),o=gc(t,"predictions","huberLoss"),s=null;null!=n&&(s=gc(n,"weights","huberLoss")),Is(i.shape,o.shape,"Error in huberLoss: ");var u=Dc(r),c=o.sub(i).abs(),l=Sm(c,u),d=c.sub(l),h=Dc(.5).mul(l.square()).add(u.mul(d));return kg(h,s,a)}}),Eg=Ec({logLoss_:function(e,t,n,r,a){void 0===r&&(r=1e-7),void 0===a&&(a=vg.SUM_BY_NONZERO_WEIGHTS);var i=gc(e,"labels","logLoss"),o=gc(t,"predictions","logLoss"),s=null;null!=n&&(s=gc(n,"weights","logLoss")),Is(i.shape,o.shape,"Error in logLoss: ");var u=Dc(1),c=Dc(r),l=i.mul(o.add(c).log()).neg().sub(u.sub(i).mul(u.sub(o).add(c).log()));return kg(l,s,a)}}),Rg=Ec({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=vg.SUM_BY_NONZERO_WEIGHTS);var a=gc(e,"labels","meanSquaredError"),i=gc(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=gc(n,"weights","meanSquaredError")),Is(a.shape,i.shape,"Error in meanSquaredError: ");var s=a.squaredDifference(i);return kg(s,o,r)}}),_g=Ec({sigmoidCrossEntropy_:function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=vg.SUM_BY_NONZERO_WEIGHTS);var i=gc(e,"multiClassLabels","sigmoidCrossEntropy"),o=gc(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=gc(n,"weights","sigmoidCrossEntropy")),Is(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Dc(r),c=Dc(1),l=Dc(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var d=function(e,t){var n=gc(e,"labels","sigmoidCrossEntropyWithLogits"),r=gc(t,"logits","sigmoidCrossEntropyWithLogits");Is(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=r.relu(),i=r.mul(n),o=r.abs().neg().exp().log1p();return a.sub(i).add(o)}(i,o);return kg(d,s,a)}}),Ig=Ec({softmaxCrossEntropy_:function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=vg.SUM_BY_NONZERO_WEIGHTS);var i=gc(e,"onehotLabels","softmaxCrossEntropy"),o=gc(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=gc(n,"weights","softmaxCrossEntropy")),Is(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Dc(r),c=Dc(1),l=Dc(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var d=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return Yl(function(e,t,r){var a=t.logSumExp([n],!0),i=t.toFloat().sub(a);return r([e,i]),{value:i.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],a=t[1],i=wc(e.shape,[n]);return[e.reshape(i).mul(r.toFloat().sub(a.exp())),e.reshape(i).mul(a.exp().sub(r.toFloat()))]}}})(e,t)}(i,o);return kg(d,s,a)}}),Tg=Object.freeze({get Reduction(){return vg},absoluteDifference:Ng,computeWeightedLoss:kg,cosineDistance:Cg,hingeLoss:jg,huberLoss:Sg,logLoss:Eg,meanSquaredError:Rg,sigmoidCrossEntropy:_g,softmaxCrossEntropy:Ig});function Ag(e,t){return void 0===t&&(t=!1),Iu.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],a=vl(n),i=e.clone(),o=Mc([[1]],[1,1]),s=o.clone(),u=n>=r?r:n,c=function(e){var t,u=i,c=s,l=a;t=Iu.tidy(function(){var t=i.slice([e,e],[n-e,1]),u=t.norm(),c=i.slice([e,e],[1,1]),l=Mc([[-1]]).where(c.greater(0),Mc([[1]])),d=c.sub(l.mul(u)),h=t.div(d);s=1===h.shape[0]?o.clone():o.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var p=l.matMul(d).div(u).neg(),f=i.slice([e,0],[n-e,r]),m=p.mul(s);if(0===e)i=f.sub(m.matMul(s.transpose().matMul(f)));else{var v=f.sub(m.matMul(s.transpose().matMul(f)));i=i.slice([0,0],[e,r]).concat(v,0)}var g=a.slice([0,e],[n,a.shape[1]-e]);if(0===e)a=g.sub(g.matMul(s).matMul(m.transpose()));else{var x=g.sub(g.matMul(s).matMul(m.transpose()));a=a.slice([0,0],[n,e]).concat(x,1)}return[s,i,a]}),s=t[0],i=t[1],a=t[2],pc([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=a.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[a,i]})}var Dg=Ec({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=gc(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var a=r.shape,i=r.shape.slice(-2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var u=Uc(0,o,1,"int32").reshape([-1,1]),c=Uc(0,s,1,"int32"),l=Mm(u,c),d=lm(l.lessEqual(Dc(+t,"int32")),l.greaterEqual(Dc(-n,"int32"))),h=Bc([o,s],r.dtype);return Tl(Pl(r.reshape([-1,o,s])).map(function(e){return fm(d,e,h)})).reshape(a)}}),Pg=Ec({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,_s(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){_s(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},a=1;a<e.length;++a)r(a)}else t=!0,e=Xc(e,e.shape[0],0).map(function(e){return Il(e,[0])});_s(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var i=[],o=e,s=function(e){i.push(Iu.tidy(function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Vv(i[n].mulStrict(t)).mul(i[n]);t=t.sub(r)}return t.div(Zv(t,"euclidean"))}))};for(a=0;a<e.length;++a)s(a);return t?Tl(i,0):i}}),Mg=Ec({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return Ag(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=Pl(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach(function(e){var n=Ag(e,t),r=n[0],o=n[1];a.push(r),i.push(o)}),[Tl(a,0).reshape(e.shape),Tl(i,0).reshape(e.shape)]}}),Fg=Object.freeze({bandPart:Dg,gramSchmidt:Pg,qr:Mg});function Og(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),_s(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),_s(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),_s(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),_s(1===t.rank,function(){return"scores must be a 1D tensor"}),_s(t.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]}),_s(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Lg=Ec({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=gc(e,"images","resizeBilinear");_s(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),_s(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=Iu.runKernelFunc(function(e,t){return t([a]),e.resizeBilinear(a,o,s,n)},{x:a},function(e,t){return{x:function(){return Iu.runKernelFunc(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Bg=Ec({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=gc(e,"images","resizeNearestNeighbor");_s(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),_s(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),_s("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],u=Iu.runKernelFunc(function(e,t){return t([a]),e.resizeNearestNeighbor(a,o,s,n)},{batchImages:a},function(e,t){return{batchImages:function(){return Iu.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),zg=Ec({nonMaxSuppression_:function(e,t,n,r,a){void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY);var i=gc(e,"boxes","nonMaxSuppression"),o=gc(t,"scores","nonMaxSuppression"),s=Og(i,o,n,r,a);n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return Iu.runKernelFunc(function(e){return e.nonMaxSuppression(i,o,n,r,a)},{boxes:i,scores:o},null,"NonMaxSuppressionV3",u)}}),Ug=Ec({nonMaxSuppressionWithScore_:function(e,t,n,r,a,i){void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var o=gc(e,"boxes","nonMaxSuppression"),s=gc(t,"scores","nonMaxSuppression"),u=Og(o,s,n,r,a,i),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=Iu.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Wg=Ec({cropAndResize_:function(e,t,n,r,a,i){var o=gc(e,"image","cropAndResize"),s=gc(t,"boxes","cropAndResize","float32"),u=gc(n,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var c=s.shape[0];return _s(4===o.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),_s(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),_s(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),_s(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),_s(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),_s("bilinear"===a||"nearest"===a,function(){return"method must be bilinear or nearest, but was "+a}),Iu.runKernelFunc(function(e,t){return e.cropAndResize(o,s,u,r,a,i)},{images:o,boxes:s,boxInd:u},null,"CropAndResize",{method:a,extrapolationValue:i,cropSize:r})}}),Vg=Object.freeze({resizeBilinear:Lg,resizeNearestNeighbor:Bg,nonMaxSuppression:zg,nonMaxSuppressionAsync:function(e,t,n,r,a){return void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),ms(this,0,void 0,function(){var i,o,s,u,c,l,d;return vs(this,function(h){switch(h.label){case 0:return i=gc(e,"boxes","nonMaxSuppressionAsync"),o=gc(t,"scores","nonMaxSuppressionAsync"),s=Og(i,o,n,r,a),n=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],d=Sd(c,l,n,r,a),i!==e&&i.dispose(),o!==t&&o.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:Ug,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,a,i){return void 0===r&&(r=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),ms(this,0,void 0,function(){var o,s,u,c,l,d,h;return vs(this,function(p){switch(p.label){case 0:return o=gc(e,"boxes","nonMaxSuppressionAsync"),s=gc(t,"scores","nonMaxSuppressionAsync"),u=Og(o,s,n,r,a,i),n=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=p.sent(),l=c[0],d=c[1],h=Ed(l,d,n,r,a,i),o!==e&&o.dispose(),s!==t&&s.dispose(),[2,h]}})})},cropAndResize:Wg}),Hg=function(e,t){return!(e>0)||"linear"===t},qg=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Gg=function(e,t){var n=t,r=rd(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Kg=function(e,t,n){if("linear"===t)return e;if("relu"===t)return $v(e);if("elu"===t)return qv(e);if("relu6"===t)return Xv(e);if("prelu"===t)return Kv(e,n);throw new Error("Unknown fused activation "+t+".")},$g=Ec({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,d=e.preluActivationWeights;if(!1===Hg(Iu.state.gradientDepth,l)){var h=pv(n,r,i,s);return null!=u&&(h=vm(h,u)),Kg(h,l,d)}var p=gc(n,"a","fused matMul"),f=gc(r,"b","fused matMul");t=ju(p,f),p=t[0],f=t[1];var m=i?p.shape[p.rank-2]:p.shape[p.rank-1],v=s?f.shape[f.rank-1]:f.shape[f.rank-2],g=i?p.shape[p.rank-1]:p.shape[p.rank-2],x=s?f.shape[f.rank-2]:f.shape[f.rank-1],y=p.shape.slice(0,-2),b=f.shape.slice(0,-2),w=Ds(y),N=Ds(b);_s(p.rank>=2&&f.rank>=2&&p.rank===f.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+f.rank+"."}),_s(Ps(y,b),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+b+") of Tensors with shapes "+p.shape+" and "+f.shape+" must match."}),_s(m===v,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+v+") of Tensors with shapes "+p.shape+" and "+f.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var k,C,j=p.shape.slice(0,-2).concat([g,x]),S=i?p.as3D(w,m,g):p.as3D(w,g,m),E=s?f.as3D(N,x,v):f.as3D(N,v,x);null!=u&&ad(j,(k=ju(k=gc(u,"bias","fused matMul"),p)[0]).shape),null!=d&&(C=gc(d,"prelu weights","fused matMul"));var R={a:S,b:E};null!=u&&(R.bias=k),null!=d&&(R.preluActivationWeights=C);var _=[S,E];return Iu.runKernelFunc(function(e,t){var n=e.fusedBatchMatMul({a:S,b:E,transposeA:i,transposeB:s,bias:k,activation:l,preluActivationWeights:C});return t([S,E,n]),n},R,function(e,t){var n=t[0],r=t[1],a=t[2],o=qg(e,a,l),c={};return null!=u&&(c={bias:function(){return Gg(k,o)}}),i||s?!i&&s?Object.assign({a:function(){return o.matMul(r,!1,!1)},b:function(){return o.matMul(n,!0,!1)}},c):i&&!s?Object.assign({a:function(){return r.matMul(o,!1,!0)},b:function(){return n.matMul(o,!1,!1)}},c):Object.assign({a:function(){return r.matMul(o,!0,!0)},b:function(){return o.matMul(n,!0,!0)}},c):Object.assign({a:function(){return o.matMul(r,!1,!0)},b:function(){return n.matMul(o,!0,!1)}},c)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},_,[!0]).reshape(j)}}),Xg=Ec({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,d=e.activation,h=void 0===d?"linear":d,p=e.preluActivationWeights;if(h=h||"linear",!1===Hg(Iu.state.gradientDepth,h)){var f=rv(t,n,r,a,o,u,c);return null!=l&&(f=vm(f,l)),Kg(f,h,p)}var m=gc(t,"x","conv2d"),v=gc(n,"filter","conv2d"),g=m,x=!1;3===m.rank&&(x=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),_s(4===g.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),_s(4===v.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),null!=c&&_s(Ms(a),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+a+"."}),_s(g.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),_s(md(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),_s("NHWC"===o,function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var y,b,w=sd(g.shape,v.shape,r,u,a,c);null!=l&&(y=ju(y=gc(l,"bias","fused conv2d"),m)[0],ad(w.outShape,y.shape)),null!=p&&(b=gc(p,"prelu weights","fused conv2d"));var N={x:g,filter:v};null!=l&&(N.bias=y),null!=p&&(N.preluActivationWeights=b);var k=[v,g],C=Iu.runKernelFunc(function(e,t){var n=e.fusedConv2d({input:g,filter:v,convInfo:w,bias:y,activation:h,preluActivationWeights:b});return t([v,g,n]),n},N,function(e,t){var n=t,i=n[0],o=n[1],s=n[2],c=qg(e,s,h);_s(fd(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var d={};return null!=l&&(d={bias:function(){return Gg(y,c)}}),Object.assign({x:function(){return ov(o.shape,c,i,r,a)},filter:function(){return iv(o,c,i.shape,r,a)}},d)},"FusedConv2D",{convInfo:w,activation:h},k,[!0]);return x?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Yg=Ec({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,d=e.activation,h=void 0===d?"linear":d,p=e.preluActivationWeights;if(!1===Hg(Iu.state.gradientDepth,h)){var f=sv(t,n,r,a,o,u,c);return null!=l&&(f=vm(f,l)),Kg(f,h,p)}var m=gc(t,"x","depthwiseConv2d"),v=gc(n,"filter","depthwiseConv2d"),g=m,x=!1;3===m.rank&&(x=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),_s(4===g.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),_s(4===v.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),_s(g.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),null==u&&(u=[1,1]),_s(md(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&_s(Ms(a),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+a+"."});var y,b,w=sd(g.shape,v.shape,r,u,a,c,!0);null!=l&&(y=ju(y=gc(l,"bias","fused conv2d"),m)[0],ad(w.outShape,y.shape)),null!=p&&(b=gc(p,"prelu weights","fused depthwiseConv2d"));var N={x:g,filter:v};null!=l&&(N.bias=y),null!=p&&(N.preluActivationWeights=b);var k=[v,g],C=Iu.runKernelFunc(function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:v,convInfo:w,bias:y,activation:h,preluActivationWeights:b});return t([v,g,n]),n},N,function(e,t){_s(fd(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var n=t[0],r=t[1],a=t[2],i=qg(e,a,h),o={};return null!=l&&(o={bias:function(){return Gg(y,i)}}),Object.assign({x:function(){return uv(r.shape,i,n,w)},filter:function(){return cv(r,i,n.shape,w)}},o)},"FusedDepthwiseConv2D",{convInfo:w,activation:h},k,[!0]);return x?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Qg=Object.freeze({matMul:$g,conv2d:Xg,depthwiseConv2d:Yg}),Jg=Object.freeze({image:Vg,linalg:Fg,losses:Tg,spectral:lg,fused:Qg,signal:wg,square:pf,squaredDifference:mf,conv1d:nv,conv2d:rv,conv3d:av,depthwiseConv2d:sv,separableConv2d:lv,conv2dTranspose:dv,conv3dTranspose:hv,op:Ec,batchNormalization2d:nm,batchNormalization3d:rm,batchNormalization4d:am,batchNormalization:im,batchNorm:om,batchNorm2d:sm,batchNorm3d:um,batchNorm4d:cm,booleanMaskAsync:function(e,t,n){return ms(this,0,void 0,function(){var r,a,i,o,s,u,c,l,d,h,p,f,m;return vs(this,function(v){switch(v.label){case 0:for(r=gc(e,"tensor","boolMask"),a=gc(t,"mask","boolMask","bool"),i=null==n?0:n,o=a.rank,s=r.shape,_s(o>0,function(){return"mask cannot be scalar"}),Is(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),d=r.reshape(l),h=a.reshape([-1]),[4,mm(h)];case 1:return p=v.sent(),f=p.squeeze([1]),m=Qm(d,f,i),e!==r&&r.dispose(),t!==a&&a.dispose(),f.dispose(),d.dispose(),h.dispose(),p.dispose(),[2,m]}})})},complex:Rc,real:_c,imag:Ic,concat:Hc,concat1d:qc,concat2d:Gc,concat3d:Kc,concat4d:$c,split:Xc,matMul:pv,dot:fv,outerProduct:mv,reverse:vv,reverse1d:gv,reverse2d:xv,reverse3d:yv,reverse4d:bv,maxPool:kv,avgPool:Cv,pool:jv,maxPool3d:Sv,avgPool3d:Ev,slice:Rv,slice1d:_v,slice2d:Iv,slice3d:Tv,slice4d:Av,abs:vf,acos:gf,acosh:xf,asin:yf,asinh:bf,atan:wf,atanh:Nf,ceil:kf,clipByValue:Cf,cos:jf,cosh:Sf,erf:Ef,exp:Rf,expm1:_f,floor:If,log:Tf,log1p:Af,logSigmoid:Df,neg:Pf,reciprocal:Mf,round:Ff,rsqrt:Of,sigmoid:Lf,sign:Bf,isNaN:zf,isInf:Uf,isFinite:Wf,sin:Vf,sinh:Hf,softplus:qf,sqrt:Gf,step:Kf,tan:$f,tanh:Xf,all:Pv,any:Mv,argMax:Fv,argMin:Ov,logSumExp:Lv,max:Bv,mean:zv,min:Uv,moments:Wv,sum:Vv,prod:Hv,equal:Om,equalStrict:Lm,greater:Bm,greaterEqual:zm,greaterEqualStrict:Um,greaterStrict:Wm,less:Vm,lessEqual:Hm,lessEqualStrict:qm,lessStrict:Gm,notEqual:Km,notEqualStrict:$m,add:vm,addN:gm,addStrict:xm,atan2:ym,div:bm,divNoNan:wm,divStrict:Nm,floorDiv:km,maximum:Cm,maximumStrict:jm,minimum:Sm,minimumStrict:Em,mod:Rm,modStrict:_m,mul:Im,mulStrict:Tm,pow:Am,powStrict:Dm,squaredDifferenceStrict:Pm,sub:Mm,subStrict:Fm,elu:qv,leakyRelu:Gv,prelu:Kv,relu:$v,relu6:Xv,selu:Yv,logicalAnd:lm,logicalNot:dm,logicalOr:hm,logicalXor:pm,where:fm,whereAsync:mm,buffer:ul,print:function(e,t){void 0===t&&(t=!1)},batchToSpaceND:cl,broadcastTo:ll,cast:dl,clone:hl,cumsum:pl,depthToSpace:fl,expandDims:ml,eye:vl,multinomial:gl,oneHot:xl,pad:yl,pad1d:bl,pad2d:wl,pad3d:Nl,pad4d:kl,rand:Cl,randomNormal:jl,randomGamma:Sl,randomUniform:El,reshape:Rl,spaceToBatchND:_l,squeeze:Il,stack:Tl,tile:Al,truncatedNormal:Dl,unstack:Pl,setdiff1dAsync:function(e,t){return ms(this,0,void 0,function(){var n,r,a,i,o,s,u,c,l,d;return vs(this,function(h){switch(h.label){case 0:return n=gc(e,"x","setdiff1d"),r=gc(t,"y","setdiff1d"),_s(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),_s(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),_s(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return a=h.sent(),[4,r.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new lu([s],n.dtype),c=new lu([s],"int32"),l=0,d=0;l<a.length;l++)o.has(a[l])||(u.values[d]=a[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:zc,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Iu.runKernelFunc(function(r){return r.linspace(e,t,n)},{})},ones:Lc,range:Uc,scalar:Dc,tensor:Tc,tensor1d:Pc,tensor2d:Mc,tensor3d:Fc,tensor4d:Oc,tensor5d:function(e,t,n){if(Ts(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=mc(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ac(e,t,r,n)},tensor6d:function(e,t,n){if(Ts(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=mc(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Ac(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),Iu.makeVariable(e,t,n,r)},zeros:Bc,onesLike:Wc,zerosLike:Vc,transpose:Qv,softmax:Ql,logSoftmax:Jl,localResponseNormalization:Jv,norm:Zv,gather:Qm,unsortedSegmentSum:Jm,basicLSTMCell:eg,multiRNNCell:tg,movingAverage:ng,stridedSlice:rg,topk:ag,scatterND:ig,fft:og,ifft:sg,rfft:ug,irfft:cg,sparseToDense:dg,gatherND:hg,diag:pg,dropout:fg,hannWindow:gg,hammingWindow:xg,frame:yg,stft:bg,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),ms(this,0,void 0,function(){var r,a,i,o,s,u,c,l,d,h,p,f,m,v;return vs(this,function(g){switch(g.label){case 0:return r=gc(e,"predictions","inTopK"),a=gc(t,"targets","inTopK"),_s(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),_s(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+a.rank}),Is(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],_s(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=[o.length/i,i],l=u[1],d=Ws("bool",c=u[0]),h=0;h<c;h++){for(p=h*l,f=o.subarray(p,p+l),m=[],v=0;v<f.length;v++)m.push({value:f[v],index:v});for(m.sort(function(e,t){return t.value-e.value}),d[h]=0,v=0;v<n;v++)if(m[v].index===s[h]){d[h]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),[2,Tc(d,a.shape,"bool")]}})})}});function Zg(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&_s("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function ex(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var tx=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Zl(t,Iu),t}return fs(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,xs().get("IS_NODE")&&fc("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return ms(this,0,void 0,function(){return vs(this,function(t){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?bd(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return ru(e)})}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return ul(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return Iu.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return ms(this,0,void 0,function(){var t;return vs(this,function(n){return t=tu(),e(),[2,{kernelMs:tu()-t}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:Iu.keep(e.clone()),imag:Iu.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(Zg(e,"slice"),$l(e.shape,t,n)){var r=Xl(t,e.strides),a=Ds(n);return Tc(this.readSync(e.dataId).subarray(r,r+a),n,e.dtype)}for(var i=ul(n,e.dtype),o=this.bufferSync(e),s=0;s<i.size;++s){var u=i.indexToLoc(s).map(function(e,n){return e+t[n]});i.values[s]=o.get.apply(o,u)}return i.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){Zg(e,"stridedSlice");var a=ql(t,n,r);if(a.some(function(e){return 0===e}))return Tc([],a);for(var i=ul(a,e.dtype),o=this.bufferSync(e),s=0;s<i.size;s++){for(var u=i.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];i.set.apply(i,[o.get.apply(o,c)].concat(u))}return i.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=ul([e.size,e.size],e.dtype),r=n.values,a=0;a<t.length;a++)r[a*e.size+a]=t[a];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(i=0;i<u.length;i++)o[t]=i,u[i]=this.slice(e,o,s).reshape(r);return u},t.prototype.reverse=function(e,t){Zg(e,"reverse");for(var n=ul(e.shape,e.dtype),r=this.bufferSync(e),a=function(a){var i=n.indexToLoc(a),o=i.slice();t.forEach(function(t){return o[t]=e.shape[t]-1-o[t]}),n.set.apply(n,[r.get.apply(r,o)].concat(i))},i=0;i<n.size;i++)a(i);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map(function(e){return _c(e)}),a=e.map(function(e){return Ic(e)});return Rc(this.concat(r,t),this.concat(a,t))}var i=e.map(function(e){var n=Ds(e.shape.slice(t));return e.as2D(-1,n)}),o=Sc(i.map(function(e){return e.shape}),1),s=ul(o,e[0].dtype).values;if(1===i[0].shape[0]){var u=0;i.forEach(function(e){s.set(n.readSync(e.dataId),u),u+=e.size})}else{var c=0;i.forEach(function(e){for(var t=n.readSync(e.dataId),r=0,a=0;a<e.shape[0];++a)for(var i=a*o[1]+c,u=0;u<e.shape[1];++u)s[i+u]=t[r++];c+=e.shape[1]})}var l=Sc(e.map(function(e){return e.shape}),t);return Tc(s,l,e[0].dtype)},t.prototype.neg=function(e){return Zg(e,"neg"),this.multiply(Dc(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,ku(e.dtype,t.dtype),function(e,t){return e+t})},t.prototype.addN=function(e){var t=this;Zg(e,"addN");for(var n=e.map(function(e){return t.readSync(e.dataId)}),r=ul(e[0].shape,e[0].dtype),a=r.values,i=0;i<e.length;i++)for(var o=n[i],s=0;s<a.length;s++)a[s]+=o[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=zs([t],e.shape),r=this.max(e,n),a=wc(r.shape,n),i=this.subtract(e,r.reshape(a)),o=this.exp(i),s=this.sum(o,n).reshape(a);return this.realDivide(o,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,ku(e.dtype,t.dtype),function(e,t){return e-t})},t.prototype.pow=function(e,t){return Zg([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},t.prototype.batchMatMul=function(e,t,n,r){Zg([e,t],"matMul");for(var a=n?e.shape[1]:e.shape[2],i=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],d=l[0],h=l[1],p=l[2],f=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=f[0],v=f[1],g=f[2],x=i*o,y=ul([s,i,o],e.dtype),b=y.values,w=this.blockSize,N=0;N<s;N++)for(var k=0;k<i;k+=w)for(var C=0;C<o;C+=w)for(var j=0;j<a;j+=w)for(var S=Math.min(k+w,i),E=Math.min(C+w,o),R=Math.min(j+w,a),_=k;_<S;_++)for(var I=C;I<E;I++){for(var T=0,A=j;A<R;A++)T+=u[N*d+_*h+A*p]*c[A*m+I*v+N*g];b[N*x+(_*o+I)]+=T}return y.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,a);return i&&(u=this.add(u,i)),o&&(u=ex(this,u,o,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,ku(e.dtype,t.dtype),function(e,t){return e*t})},t.prototype.realDivide=function(e,t){return Zg([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(e,t){return e/t})},t.prototype.floorDiv=function(e,t){return Zg([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},t.prototype.sum=function(e,t){Zg(e,"sum"),Nc("sum",t,e.rank);for(var n=bc(e.shape,t),r=n[0],a=n[1],i=Bc(r,ku(e.dtype,"int32")),o=Ds(a),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,d=0,h=0;h<o;++h)d+=u[l+h];s[c]=d}return i},t.prototype.prod=function(e,t){Zg(e,"sum");for(var n=bc(e.shape,t),r=n[0],a=n[1],i=Bc(r,ku(e.dtype,"int32")),o=Ds(a),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,d=1,h=0;h<o;++h)d*=u[l+h];s[c]=d}return i},t.prototype.unsortedSegmentSum=function(e,t,n){Zg(e,"unsortedSegmentSum");for(var r=[],a=e.rank-t.rank,i=0;i<a;++i)t=t.expandDims(i+1);for(i=0;i<n;++i){var o=Dc(i,"int32"),s=Om(o,t).asType("float32").mul(e).sum(0);r.push(s)}return Tl(r)},t.prototype.argMin=function(e,t){Zg(e,"argMin");var n=[t];Nc("argMin",n,e.rank);for(var r=bc(e.shape,n),a=r[0],i=r[1],o=Bc(a,"int32"),s=Ds(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var d=l*s,h=c[d],p=0,f=0;f<s;++f){var m=c[d+f];m<h&&(h=m,p=f)}u[l]=p}return o},t.prototype.argMax=function(e,t){Zg(e,"argMax");var n=[t];Nc("argMax",n,e.rank);for(var r=bc(e.shape,n),a=r[0],i=r[1],o=Bc(a,"int32"),s=Ds(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var d=l*s,h=c[d],p=0,f=0;f<s;++f){var m=c[d+f];m>h&&(h=m,p=f)}u[l]=p}return o},t.prototype.cumsum=function(e,t,n,r){if(Zg(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var a=ku(e.dtype,"int32"),i=Bc(e.shape,a),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var d=0;d<u;d++){var h=c(l,d);if(0===d)o[h]=n?0:s[h];else{var p=c(l,d-1);o[h]=n?s[p]+o[p]:s[h]+o[p]}}return i},t.prototype.equal=function(e,t){return Zg([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},t.prototype.notEqual=function(e,t){return Zg([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},t.prototype.less=function(e,t){return Zg([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},t.prototype.lessEqual=function(e,t){return Zg([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},t.prototype.greater=function(e,t){return Zg([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},t.prototype.greaterEqual=function(e,t){return Zg([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},t.prototype.logicalNot=function(e){Zg(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return Zg([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},t.prototype.logicalOr=function(e,t){return Zg([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},t.prototype.select=function(e,t,n){Zg([e,t,n],"select");for(var r=this.readSync(e.dataId),a=this.readSync(t.dataId),i=this.readSync(n.dataId),o=Bc(t.shape,ku(t.dtype,n.dtype)),s=this.readSync(o.dataId),u=0,c=0===e.rank||e.rank>1||1===t.rank?1:Ds(t.shape.slice(1)),l=0;l<r.length;l++)for(var d=0;d<c;d++)1===r[l]?s[u++]=a[l]:s[u++]=i[l];return o},t.prototype.where=function(e){Zg([e],"where");var t=this.readSync(e.dataId);return Md(e.shape,t)},t.prototype.topk=function(e,t,n){return Zg(e,"topk"),Pd(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Zg(e,"min"),Nc("min",t,e.rank);for(var n=bc(e.shape,t),r=n[0],a=n[1],i=Bc(r,e.dtype),o=Ds(a),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,d=u[l],h=0;h<o;++h){var p=u[l+h];p<d&&(d=p)}s[c]=d}return i},t.prototype.minimum=function(e,t){return Zg([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},t.prototype.mod=function(e,t){return Zg([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},t.prototype.max=function(e,t){Zg(e,"max"),Nc("max",t,e.rank);for(var n=bc(e.shape,t),r=n[0],a=n[1],i=Bc(r,e.dtype),o=Ds(a),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,d=u[l],h=0;h<o;++h){var p=u[l+h];p>d&&(d=p)}s[c]=d}return i},t.prototype.maximum=function(e,t){return Zg([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},t.prototype.all=function(e,t){Zg(e,"all"),Nc("all",t,e.rank);for(var n=bc(e.shape,t),r=n[0],a=n[1],i=Bc(r,e.dtype),o=Ds(a),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,d=u[l],h=0;h<o;++h){var p=u[l+h];d=d&&p}s[c]=d}return i},t.prototype.any=function(e,t){Zg(e,"any"),Nc("any",t,e.rank);for(var n=bc(e.shape,t),r=n[0],a=n[1],i=Bc(r,e.dtype),o=Ds(a),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*o,d=u[l],h=0;h<o;++h){var p=u[l+h];d=d||p}s[c]=d}return i},t.prototype.squaredDifference=function(e,t){return Zg([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},t.prototype.ceil=function(e){Zg(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){Zg(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){Zg(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){Zg(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){Zg(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){Zg(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){Zg(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=Math.floor(t[r]);t[r]-a<.5?n[r]=Math.floor(t[r]):t[r]-a>.5?n[r]=Math.ceil(t[r]):n[r]=a%2==0?a:a+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){Zg(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){Zg(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){Zg(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.log(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){Zg(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.log1p(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){Zg(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=Math.sqrt(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){Zg(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=t[r];n[r]=1/Math.sqrt(a)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){Zg(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Zg(e,"relu");for(var t=Bc(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.max(0,r[a]);return t},t.prototype.relu6=function(e){Zg(e,"relu");for(var t=Bc(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.min(Math.max(0,r[a]),6);return t},t.prototype.prelu=function(e,t){return Zg([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},t.prototype.elu=function(e){Zg(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=n[r];t[r]=a>=0?a:Math.exp(a)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){Zg([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),a=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i];n[i]=o>=1?a[i]:a[i]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){Zg(e,"selu");for(var t=Mp,n=Fp,r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];r[i]=o>=0?n*o:t*(Math.exp(o)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){Zg(e,"clip");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];r[i]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var a=n[2*r],i=n[2*r+1];t[r]=Math.hypot(a,i)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){Zg(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){Zg(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){Zg(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i,o=r[a]>-t,s=r[a]<t,u=Math.exp(r[a]);i=s?u:o?r[a]:Math.log(1+u),n[a]=i}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){Zg(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){Zg(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){Zg(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){Zg(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){Zg(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){Zg(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return Zg([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},t.prototype.sinh=function(e){Zg(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){Zg(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){Zg(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Fs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){Zg(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){Zg(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){Zg(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){Zg(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=Math.sign(n[r]),i=Math.abs(n[r]),o=1/(1+.3275911*i);t[r]=a*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-i*i))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),Zg(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];isNaN(i)?n[a]=NaN:n[a]=i>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return a&&(s=this.add(s,a)),i&&(s=ex(this,s,i,o)),s},t.prototype.conv2d=function(e,t,n){Zg([e,t],"conv2d");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=ul(n.outShape,e.dtype),d=e.strides[0],h=c?e.strides[1]:e.strides[2],p=c?e.strides[2]:1,f=c?1:e.strides[1],m=l.strides[0],v=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,x=c?1:l.strides[1],y=this.readSync(e.dataId),b=this.readSync(t.dataId),w=l.values,N=0;N<n.batchSize;++N)for(var k=N*d,C=N*m,j=0;j<n.outHeight;++j)for(var S=C+j*v,E=j*n.strideHeight-u,R=0;R<r;R++){var _=E+R*i;if(!(_<0||_>=n.inHeight))for(var I=R*t.strides[0],T=k+_*h,A=0;A<n.outWidth;++A)for(var D=S+A*g,P=A*n.strideWidth-s,M=0;M<a;M++){var F=P+M*o;if(!(F<0||F>=n.inWidth))for(var O=T+F*p,L=I+M*t.strides[1],B=0;B<n.inChannels;++B){for(var z=y[O+B*f],U=0;U<n.outChannels;++U)w[D+U*x]+=z*b[L+U];L+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,a=n.filterHeight,i=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,d=n.padInfo.top,h=ul(n.outShape,e.dtype),p=this.readSync(e.dataId),f=this.readSync(t.dataId),m=h.values,v=0;v<n.batchSize;++v)for(var g=v*e.strides[0],x=v*h.strides[0],y=0;y<n.outDepth;++y)for(var b=x+y*h.strides[1],w=y*n.strideDepth-c,N=0;N<r;N++){var k=w+N*o;if(!(k<0||k>=n.inDepth))for(var C=N*t.strides[0],j=g+k*e.strides[1],S=0;S<n.outHeight;++S)for(var E=b+S*h.strides[2],R=S*n.strideHeight-d,_=0;_<a;_++){var I=R+_*s;if(!(I<0||I>=n.inHeight))for(var T=C+_*t.strides[1],A=j+I*e.strides[2],D=0;D<n.outWidth;++D)for(var P=E+D*n.outChannels,M=D*n.strideWidth-l,F=0;F<i;F++){var O=M+F*u;if(!(O<0||O>=n.inWidth))for(var L=T+F*t.strides[2],B=A+O*n.inChannels,z=L,U=0;U<n.inChannels;++U){for(var W=p[B+U],V=0;V<n.outChannels;++V)m[P+V]+=W*f[z+V];z+=n.outChannels}}}}return h.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){Zg([e,t],"conv2dDerInput");for(var r=ul(n.inShape,"float32"),a=r.values,i=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,u=s[0],c=s[1],l=s[2],d=n.batchSize,h=n.filterHeight,p=n.filterWidth,f=n.inChannels,m=n.inHeight,v=n.inWidth,g=n.outChannels,x=n.outHeight,y=n.outWidth,b=n.strideHeight,w=n.strideWidth,N=n.dataFormat,k=h-1-n.padInfo.top,C=p-1-n.padInfo.left,j="channelsLast"===N,S=r.strides[0],E=j?r.strides[1]:r.strides[2],R=j?r.strides[2]:1,_=j?1:r.strides[1],I=e.strides[0],T=j?e.strides[1]:e.strides[2],A=j?e.strides[2]:1,D=j?1:e.strides[1],P=0;P<d;++P)for(var M=0;M<f;++M)for(var F=0;F<m;++F)for(var O=F-k,L=Math.max(0,Math.ceil(O/b)),B=Math.min(x,(h+O)/b),z=0;z<v;++z){for(var U=z-C,W=Math.max(0,Math.ceil(U/w)),V=Math.min(y,(p+U)/w),H=0,q=L;q<B;++q)for(var G=q*b-O,K=W;K<V;++K)for(var $=I*P+T*q+A*K,X=u*(h-1-G)+c*(p-1-(K*w-U))+l*M,Y=0;Y<g;++Y)H+=i[$+D*Y]*o[X+Y];a[S*P+E*F+R*z+_*M]=H}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=ul(n.inShape,"float32"),a=r.values,i=r.strides,o=i[0],s=i[1],u=i[2],c=i[3],l=this.readSync(e.dataId),d=e.strides,h=d[0],p=d[1],f=d[2],m=d[3],v=this.readSync(t.dataId),g=t.strides,x=g[0],y=g[1],b=g[2],w=g[3],N=n.batchSize,k=n.filterDepth,C=n.filterHeight,j=n.filterWidth,S=n.inChannels,E=n.inDepth,R=n.inHeight,_=n.inWidth,I=n.outChannels,T=n.outDepth,A=n.outHeight,D=n.outWidth,P=n.strideDepth,M=n.strideHeight,F=n.strideWidth,O=k-1-n.padInfo.front,L=C-1-n.padInfo.top,B=j-1-n.padInfo.left,z=0;z<N;++z)for(var U=0;U<S;++U)for(var W=0;W<E;++W)for(var V=W-O,H=Math.max(0,Math.ceil(V/P)),q=Math.min(T,(k+V)/P),G=0;G<R;++G)for(var K=G-L,$=Math.max(0,Math.ceil(K/M)),X=Math.min(A,(C+K)/M),Y=0;Y<_;++Y){for(var Q=Y-B,J=Math.max(0,Math.ceil(Q/F)),Z=Math.min(D,(j+Q)/F),ee=0,te=H;te<q;++te)for(var ne=te*P-V,re=$;re<X;++re)for(var ae=re*M-K,ie=J;ie<Z;++ie)for(var oe=h*z+p*te+f*re+m*ie,se=x*(k-1-ne)+y*(C-1-ae)+b*(j-1-(ie*F-Q))+w*U,ue=0;ue<I;++ue)ee+=l[oe+ue]*v[se+ue];a[o*z+s*W+u*G+c*Y+U]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){Zg([e,t],"conv2dDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,u=ul(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,d=this.bufferSync(e),h=this.bufferSync(t),p=0;p<i;++p)for(var f=Math.max(0,Math.ceil((l-p)/r)),m=Math.min(n.outHeight,(n.inHeight+l-p)/r),v=0;v<o;++v)for(var g=Math.max(0,Math.ceil((c-v)/a)),x=Math.min(n.outWidth,(n.inWidth+c-v)/a),y=0;y<n.inChannels;++y)for(var b=0;b<n.outChannels;++b){for(var w=0,N=0;N<n.batchSize;++N)for(var k=f;k<m;++k)for(var C=p+k*r-l,j=g;j<x;++j){var S=v+j*a-c;w+=s?d.get(N,C,S,y)*h.get(N,k,j,b):d.get(N,y,C,S)*h.get(N,b,k,j)}u.set(w,p,v,y,b)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=ul(n.filterShape,"float32"),l=c.values,d=c.strides,h=d[0],p=d[1],f=d[2],m=d[3],v=this.readSync(t.dataId),g=t.strides,x=g[0],y=g[1],b=g[2],w=g[3],N=this.readSync(e.dataId),k=e.strides,C=k[0],j=k[1],S=k[2],E=k[3],R=n.padInfo.front,_=n.padInfo.left,I=n.padInfo.top,T=0;T<o;++T)for(var A=Math.max(0,Math.ceil((R-T)/r)),D=Math.min(n.outDepth,(n.inDepth+R-T)/r),P=T*h,M=0;M<s;++M)for(var F=Math.max(0,Math.ceil((I-M)/a)),O=Math.min(n.outHeight,(n.inHeight+I-M)/a),L=M*p+P,B=0;B<u;++B)for(var z=Math.max(0,Math.ceil((_-B)/i)),U=Math.min(n.outWidth,(n.inWidth+_-B)/i),W=B*f+L,V=0;V<n.inChannels;++V)for(var H=V*m+W,q=0;q<n.outChannels;++q){for(var G=0,K=0;K<n.batchSize;++K)for(var $=K*C,X=K*x,Y=A;Y<D;++Y)for(var Q=(T+Y*r-R)*j+$,J=Y*y+X,Z=F;Z<O;++Z)for(var ee=(M+Z*a-I)*S+Q,te=Z*b+J,ne=z;ne<U;++ne){var re=ne*w+te;G+=N[(B+ne*i-_)*E+ee+V]*v[re+q]}l[H+q]=G}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return a&&(s=this.add(s,a)),i&&(s=ex(this,s,i,o)),s},t.prototype.depthwiseConv2D=function(e,t,n){Zg([e,t],"depthwiseConv2D");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=ul(n.outShape,e.dtype),d=this.readSync(e.dataId),h=this.readSync(t.dataId),p=l.values,f=0;f<n.batchSize;++f)for(var m=f*e.strides[0],v=f*l.strides[0],g=0;g<n.outHeight;++g)for(var x=v+g*l.strides[1],y=g*n.strideHeight-s,b=0;b<r;++b){var w=y+b*i;if(!(w<0||w>=n.inHeight))for(var N=b*t.strides[0],k=m+w*e.strides[1],C=0;C<n.outWidth;++C)for(var j=x+C*l.strides[2],S=C*n.strideWidth-u,E=0;E<a;++E){var R=S+E*o;if(!(R<0||R>=n.inWidth))for(var _=N+E*t.strides[1],I=k+R*n.inChannels,T=j,A=_,D=0;D<n.inChannels;++D){for(var P=d[I+D],M=0;M<c;++M)p[T+M]+=P*h[A+M];T+=c,A+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){Zg([e,t],"depthwiseConv2DDerInput");for(var r=ul(n.inShape,"float32"),a=r.values,i=r.strides,o=i[0],s=i[1],u=i[2],c=this.readSync(e.dataId),l=e.strides,d=l[0],h=l[1],p=l[2],f=this.readSync(t.dataId),m=t.strides,v=m[0],g=m[1],x=m[2],y=n.batchSize,b=n.filterHeight,w=n.filterWidth,N=n.inChannels,k=n.inHeight,C=n.inWidth,j=n.outChannels,S=n.outHeight,E=n.outWidth,R=n.strideHeight,_=n.strideWidth,I=b-1-n.padInfo.top,T=w-1-n.padInfo.left,A=j/N,D=0;D<y;++D)for(var P=0;P<N;++P)for(var M=0;M<k;++M)for(var F=M-I,O=Math.max(0,Math.ceil(F/R)),L=Math.min(S,(b+F)/R),B=0;B<C;++B){for(var z=B-T,U=Math.max(0,Math.ceil(z/_)),W=Math.min(E,(w+z)/_),V=0,H=O;H<L;++H)for(var q=H*R-F,G=U;G<W;++G)for(var K=d*D+h*H+p*G,$=v*(b-1-q)+g*(w-1-(G*_-z))+x*P,X=0;X<A;++X)V+=c[K+(P*A+X)]*f[$+X];a[o*D+s*M+u*B+P]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){Zg([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s=ul(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,d=this.bufferSync(e),h=this.bufferSync(t),p=0;p<i;++p)for(var f=Math.max(0,Math.ceil((c-p)/r)),m=Math.min(n.outHeight,(n.inHeight+c-p)/r),v=0;v<o;++v)for(var g=Math.max(0,Math.ceil((u-v)/a)),x=Math.min(n.outWidth,(n.inWidth+u-v)/a),y=0;y<n.outChannels;++y){for(var b=Math.trunc(y/l),w=y%l,N=0,k=0;k<n.batchSize;++k)for(var C=f;C<m;++C)for(var j=p+C*r-c,S=g;S<x;++S){var E=v+S*a-u;N+=d.get(k,j,E,b)*h.get(k,C,S,y)}s.set(N,p,v,b,w)}return s.toTensor()},t.prototype.tile=function(e,t){return Zg(e,"tile"),Dd(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){Zg(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),a=t.map(function(e){return e[0]}),i=this.bufferSync(e),o=ul(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var u=i.indexToLoc(s),c=u.map(function(e,t){return e+a[t]});o.set.apply(o,[i.get.apply(i,u)].concat(c))}return o.toTensor()},t.prototype.transpose=function(e,t){Zg(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var a=this.readSync(e.dataId),i=ul(n,e.dtype),o=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=o.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[t[c]];var l=i.locToIndex(u);i.values[l]=a[r]}return i.toTensor()},t.prototype.gather=function(e,t,n){Zg([e,t],"gather");var r=e.shape.slice(),a=this.readSync(t.dataId);r[n]=a.length;for(var i=ul(r,e.dtype),o=this.bufferSync(e),s=0;s<i.size;++s){var u=i.indexToLoc(s),c=u.slice();c[n]=a[u[n]];var l=o.locToIndex(c);i.values[s]=o.values[l]}return i.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){Zg([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),a=Ml(e.shape,t,r),i=Fl(a.length,t.length),o=Ol(e.shape,t,r),s=Ll(n,t.length),u=Bl(o,n,t.length);return e.reshape(a).transpose(i).reshape(o).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Zg([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),a=[[0,0]];a.push.apply(a,n);for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var o=e.pad(a),s=Ml(o.shape,t,r,!1),u=Fl(s.length,t.length,!1),c=Ol(o.shape,t,r,!1);return o.reshape(s).transpose(u).reshape(c)},t.prototype.pool=function(e,t,n){Zg(e,"pool");for(var r=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,d="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=this.readSync(e.dataId),p=ul(t.outShape,e.dtype),f=p.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],v=t.outShape[2]*t.outShape[3],g=t.outShape[3],x=0;x<t.batchSize;++x)for(var y=x*m,b=x*e.strides[0],w=0;w<t.inChannels;++w)for(var N=0;N<t.outHeight;++N)for(var k=N*r-c,C=Math.max(0,k),j=Math.min(t.inHeight,s+k),S=y+N*v,E=0;E<t.outWidth;++E){for(var R=E*a-l,_=Math.max(0,R),I=Math.min(t.inWidth,u+R),T=d,A=0,D=0,P=C;P<j;P+=i){for(var M=b+P*e.strides[1],F=_;F<I;F+=o){var O=h[M+F*e.strides[2]+w];"max"===n&&O>T?T=O:"avg"===n&&(A+=O,D++)}if(isNaN(T))break}f[S+E*g+w]="avg"===n?A/D:T}return p.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=ul(t.outShape,"int32"),r=t.strideHeight,a=t.strideWidth,i=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,d=this.bufferSync(e),h=0;h<t.batchSize;++h)for(var p=0;p<t.inChannels;++p)for(var f=0;f<t.outHeight;++f){for(var m=f*r-c,v=m;v<0;)v+=i;for(var g=Math.min(t.inHeight,s+m),x=0;x<t.outWidth;++x){for(var y=x*a-l,b=y;b<0;)b+=o;for(var w=Math.min(t.inWidth,u+y),N=Number.NEGATIVE_INFINITY,k=-1,C=v;C<g;C+=i)for(var j=C-m,S=b;S<w;S+=o){var E=S-y,R=d.get(h,C,S,p);R>N&&(N=R,k=j*u+E)}n.set(k,h,f,x,p)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){Zg([t,n],"maxPoolBackprop");for(var a=this.maxPoolPositions(t,r),i=r.strideHeight,o=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=l-1-r.padInfo.left,h=c-1-r.padInfo.top,p=ul(t.shape,"float32"),f=this.bufferSync(a),m=this.bufferSync(e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var x=0;x<r.inHeight;++x)for(var y=0;y<r.inWidth;++y){for(var b=x-h,w=y-d,N=0,k=0;k<c;k+=s){var C=(b+k)/i;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var j=0;j<l;j+=u){var S=(w+j)/o;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var E=c*l-1-f.get(v,C,S,g)===k*l+j?1:0;0!==E&&(N+=m.get(v,C,S,g)*E)}}}p.set(N,v,x,y,g)}return p.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){Zg([e,t],"avgPoolBackprop");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,d=l-1-n.padInfo.left,h=c-1-n.padInfo.top,p=ul(t.shape,"float32"),f=1/(i*o),m=this.bufferSync(e),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var x=0;x<n.inHeight;++x)for(var y=0;y<n.inWidth;++y){for(var b=x-h,w=y-d,N=0,k=0;k<c;k+=s){var C=(b+k)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var j=0;j<l;j+=u){var S=(w+j)/a;S<0||S>=n.outWidth||Math.floor(S)!==S||(N+=m.get(v,C,S,g))}}p.set(N*f,v,x,y,g)}return p.toTensor()},t.prototype.pool3d=function(e,t,n){Zg(e,"pool3d");for(var r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(e.dataId),g=ul(t.outShape,e.dtype),x=g.values,y=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],b=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],N=t.outShape[4],k=0;k<t.batchSize;++k)for(var C=k*y,j=k*e.strides[0],S=0;S<t.inChannels;++S)for(var E=0;E<t.outDepth;++E){for(var R=E*r-h,_=R;_<0;)_+=o;for(var I=Math.min(t.inDepth,c+R),T=C+E*b,A=0;A<t.outHeight;++A){for(var D=A*a-p,P=D;P<0;)P+=s;for(var M=Math.min(t.inHeight,l+D),F=T+A*w,O=0;O<t.outWidth;++O){for(var L=O*i-f,B=L;B<0;)B+=u;for(var z=Math.min(t.inWidth,d+L),U=F+O*N,W=m,V=0,H=0,q=_;q<I;q+=o){for(var G=j+q*e.strides[1],K=P;K<M;K+=s){for(var $=G+K*e.strides[2],X=B;X<z;X+=u){var Y=v[$+X*e.strides[3]+S];if("max"===n&&Y>W?W=Y:"avg"===n&&(V+=Y,H++),isNaN(W))break}if(isNaN(W))break}if(isNaN(W))break}x[U+S]="avg"===n?V/H:W}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return Zg(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){Zg([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,d=n.dilationWidth,h=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=h-1-n.padInfo.front,v=f-1-n.padInfo.left,g=p-1-n.padInfo.top,x=ul(t.shape,"float32"),y=1/(o*s*u),b=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var N=0;N<n.inChannels;++N)for(var k=0;k<n.inDepth;++k)for(var C=0;C<n.inHeight;++C)for(var j=0;j<n.inWidth;++j){for(var S=k-m,E=C-g,R=j-v,_=0,I=0;I<h;I+=c){var T=(S+I)/r;if(!(T<0||T>=n.outDepth||Math.floor(T)!==T))for(var A=0;A<p;A+=l){var D=(E+A)/a;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var P=0;P<f;P+=d){var M=(R+P)/i;M<0||M>=n.outWidth||Math.floor(M)!==M||(_+=b.get(w,T,D,M,N))}}}x.set(_*y,w,k,C,j,N)}return x.toTensor()},t.prototype.maxPool3d=function(e,t){return Zg(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=ul(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left,m=this.bufferSync(e),v=0;v<t.batchSize;++v)for(var g=0;g<t.inChannels;++g)for(var x=0;x<t.outDepth;++x){for(var y=x*r-h,b=y;b<0;)b+=o;for(var w=Math.min(t.inDepth,c+y),N=0;N<t.outHeight;++N){for(var k=N*a-p,C=k;C<0;)C+=s;for(var j=Math.min(t.inHeight,l+k),S=0;S<t.outWidth;++S){for(var E=S*i-f,R=E;R<0;)R+=u;for(var _=Math.min(t.inWidth,d+E),I=Number.NEGATIVE_INFINITY,T=-1,A=b;A<w;A+=o)for(var D=A-y,P=C;P<j;P+=s)for(var M=P-k,F=R;F<_;F+=u){var O=F-E,L=m.get(v,A,P,F,g);L>=I&&(I=L,T=D*l*d+M*l+O)}n.set(T,v,x,N,S,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){Zg([t,n],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(t,r),i=r.strideDepth,o=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=d-1-r.padInfo.front,m=p-1-r.padInfo.left,v=h-1-r.padInfo.top,g=ul(t.shape,"float32"),x=this.bufferSync(a),y=this.bufferSync(e),b=0;b<r.batchSize;++b)for(var w=0;w<r.inChannels;++w)for(var N=0;N<r.inDepth;++N)for(var k=0;k<r.inHeight;++k)for(var C=0;C<r.inWidth;++C){for(var j=N-f,S=k-v,E=C-m,R=0,_=0;_<d;_+=u){var I=(j+_)/i;if(!(I<0||I>=r.outDepth||Math.floor(I)!==I))for(var T=0;T<h;T+=c){var A=(S+T)/o;if(!(A<0||A>=r.outHeight||Math.floor(A)!==A))for(var D=0;D<p;D+=l){var P=(E+D)/s;if(!(P<0||P>=r.outWidth||Math.floor(P)!==P)){var M=d*h*p-1-x.get(b,I,A,P,w)===_*h*p+T*p+D?1:0;0!==M&&(R+=y.get(b,I,A,P,w)*M)}}}}g.set(R,b,N,k,C,w)}return g.toTensor()},t.prototype.cast=function(e,t){return gd(e,t,this)},t.prototype.reshape=function(e,t){return xd(e,t)},t.prototype.avgPool=function(e,t){return Zg(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){Zg(e,"resizeBilinear");for(var a=e.shape,i=a[0],o=a[1],s=a[2],u=a[3],c=this.readSync(e.dataId),l=new Float32Array(Ds([i,t,n,u])),d=[r&&t>1?o-1:o,r&&n>1?s-1:s],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=0,f=d[0]/h[0],m=d[1]/h[1],v=0;v<i;v++)for(var g=0;g<t;g++)for(var x=f*g,y=Math.floor(x),b=x-y,w=Math.min(o-1,Math.ceil(x)),N=v*e.strides[0]+y*e.strides[1],k=v*e.strides[0]+w*e.strides[1],C=0;C<n;C++)for(var j=m*C,S=Math.floor(j),E=j-S,R=Math.min(s-1,Math.ceil(j)),_=N+S*e.strides[2],I=k+S*e.strides[2],T=N+R*e.strides[2],A=k+R*e.strides[2],D=0;D<u;D++){var P=c[_+D],M=c[I+D],F=P+(c[T+D]-P)*E,O=F+(M+(c[A+D]-M)*E-F)*b;l[p++]=O}return Tc(l,[i,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){Zg([e,t],"resizeBilinearBackprop");for(var r=t.shape,a=r[0],i=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],d=new Float32Array(a*i*o*s),h=[n&&c>1?i-1:i,n&&l>1?o-1:o],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],f=h[0]/p[0],m=h[1]/p[1],v=this.readSync(e.dataId),g=0,x=0;x<a;x++)for(var y=x*t.strides[0],b=0;b<c;b++)for(var w=b*f,N=Math.floor(w),k=Math.min(Math.ceil(w),i-1),C=y+N*t.strides[1],j=y+k*t.strides[1],S=w-N,E=1-S,R=0;R<l;R++)for(var _=R*m,I=Math.floor(_),T=Math.min(Math.ceil(_),o-1),A=_-I,D=1-A,P=C+I*t.strides[2],M=C+T*t.strides[2],F=j+I*t.strides[2],O=j+T*t.strides[2],L=E*D,B=E*A,z=S*D,U=S*A,W=0;W<s;W++){var V=v[g++];d[P+W]+=V*L,d[M+W]+=V*B,d[F+W]+=V*z,d[O+W]+=V*U}return Oc(d,[a,o,i,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){Zg(e,"resizeNearestNeighbor");for(var a=e.shape,i=a[0],o=a[1],s=a[2],u=a[3],c=this.readSync(e.dataId),l=new Float32Array(i*t*n*u),d=[r&&t>1?o-1:o,r&&n>1?s-1:s],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],p=d[0]/h[0],f=d[1]/h[1],m=0,v=0;v<i;v++)for(var g=v*e.strides[0],x=0;x<t;x++)for(var y=p*x,b=g+Math.min(o-1,r?Math.round(y):Math.floor(y))*e.strides[1],w=0;w<n;w++)for(var N=f*w,k=b+Math.min(s-1,r?Math.round(N):Math.floor(N))*e.strides[2],C=0;C<u;C++){var j=c[k+C];l[m++]=j}return Tc(l,[i,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){Zg([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,a=r[0],i=r[1],o=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],d=new Float32Array(a*i*o*s),h=this.readSync(e.dataId),p=[n&&c>1?i-1:i,n&&l>1?o-1:o],f=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=p[0]/f[0],v=p[1]/f[1],g=1/m,x=1/v,y=2*Math.ceil(g)+2,b=2*Math.ceil(x)+2,w=0;w<a;w++)for(var N=w*t.strides[0],k=0;k<i;k++)for(var C=N+k*t.strides[1],j=Math.floor(k*g),S=Math.floor(j-y/2),E=0;E<o;E++)for(var R=C+E*t.strides[2],_=Math.floor(E*x),I=Math.floor(_-b/2),T=0;T<s;T++){for(var A=0,D=0;D<y;D++){var P=D+S;if(!(P<0||P>=c)){var M=N+P*e.strides[1],F=P*m;if(k===Math.min(i-1,n?Math.round(F):Math.floor(F)))for(var O=0;O<b;O++){var L=O+I;if(!(L<0||L>=l)){var B=M+L*e.strides[2],z=L*v;E===Math.min(o-1,n?Math.round(z):Math.floor(z))&&(A+=h[B+T])}}}}d[R+T]=A}return Oc(d,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,a,i){Zg([e,t,n,a,i],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=a?this.readSync(a.dataId):new Float32Array([1]),l=i?this.readSync(i.dataId):new Float32Array([0]),d=new Float32Array(o.length),h=l.length,p=c.length,f=u.length,m=s.length,v=0,g=0,x=0,y=0,b=0;b<o.length;++b)d[b]=l[v++]+(o[b]-s[g++])*c[x++]/Math.sqrt(u[y++]+r),v>=h&&(v=0),g>=m&&(g=0),x>=p&&(x=0),y>=f&&(y=0);return Oc(d,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,a){Zg(e,"localResponseNormalization4D");var i=e.shape[3],o=i-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%i,r=e-n+Math.max(0,n-t),a=e-n+Math.min(n+t,o),u=0;r<=a;r++){var c=s[r];u+=c*c}return u}for(var d=0;d<u;d++){var h=l(d),p=s[d]*Math.pow(n+r*h,-a);c[d]=p}return Oc(c,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,a,i,o){Zg(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),d=new Float32Array(e.size),h=e.size,p=0;p<h;p++){for(var f=p%s,m=p-f+Math.max(0,f-r),v=p-f+Math.min(s,f+r+1),g=0,x=m;x<v;x++)g+=Math.pow(c[x],2);for(g=i*g+a,x=m;x<v;x++){var y=-2*i*o*c[x]*l[p]/g;p===x&&(y+=Math.pow(g,-o)),y*=u[p],d[x]+=y}}return Oc(d,e.shape)},t.prototype.multinomial=function(e,t,n,r){Zg(e,"multinomial");for(var a=t?e:Ql(e),i=a.shape[0],o=a.shape[1],s=Bc([i,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(a.dataId),l=0;l<i;++l){var d=l*o,h=new Float32Array(o-1);h[0]=c[d];for(var p=1;p<h.length;++p)h[p]=h[p-1]+c[d+p];for(var f=al(r.toString()),m=l*n,v=0;v<n;++v){var g=f();u[m+v]=h.length;for(var x=0;x<h.length;x++)if(g<h[x]){u[m+v]=x;break}}}return s},t.prototype.oneHot=function(e,t,n,r){Zg(e,"oneHot");var a=new Float32Array(e.size*t);a.fill(r);for(var i=this.readSync(e.dataId),o=0;o<e.size;++o)i[o]>=0&&i[o]<t&&(a[o*t+i[o]]=n);return Mc(a,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,a){return Zg(e,"nonMaxSuppression"),Sd(this.readSync(e.dataId),this.readSync(t.dataId),n,r,a)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],a=ul(e.shape,"float32"),i=ul(e.shape,"float32"),o=_c(e).as2D(n,r),s=Ic(e).as2D(n,r),u=0;u<n;u++)for(var c=o.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),d=Rc(c,l),h=this.readSync(this.fftImpl(d,t).dataId),p=0;p<r;p++){var f=wd(h,p);a.values[u*r+p]=f.real,i.values[u*r+p]=f.imag}return Rc(a.toTensor(),i.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var a=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(a=Rc(_c(a).div(Dc(r)),Ic(a).div(Dc(r)))),a}var i=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(i,r,t));return Rc(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return!(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),a=t/2,i=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(r),o=Rc(i.real,i.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(r),u=Rc(s.real,s.imag).as1D();o=this.fftRadix2(o,a,n),u=this.fftRadix2(u,a,n);var c=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(t,n),l=Rc(c.real,c.imag).mul(u),d=o.add(l),h=o.sub(l),p=_c(d).concat(_c(h)),f=Ic(d).concat(Ic(h));return Rc(p,f).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=kd(a*s,t,n),c=wd(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),Nd(r,i,o,a)}return r},t.prototype.depthToSpace=function(e,t,n){_s("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),_s(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],a=e.shape[1],i=e.shape[2],o=e.shape[3],s=a*t,u=i*t,c=o/(t*t),l=this.readSync(e.dataId),d=new Float32Array(r*s*u*c),h=0,p=0;p<r;++p)for(var f=0;f<s;++f)for(var m=Math.floor(f/t),v=f%t,g=0;g<u;++g)for(var x=Math.floor(g/t),y=(v*t+g%t)*c,b=0;b<c;++b){var w=b+y+o*(x+i*(m+a*p));d[h++]=l[w]}return Oc(d,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var a=ad(e.shape,t.shape),i=ul(a,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=nd(e.shape,a),c=nd(t.shape,a),l=i.values;if(u.length+c.length===0)for(var d=0;d<l.length;++d)l[d]=r(o[d%o.length],s[d%s.length]);else{var h=this.bufferSync(e),p=this.bufferSync(t),f=function(n){var a=i.indexToLoc(n),d=a.slice(-e.rank);u.forEach(function(e){return d[e]=0});var f=h.locToIndex(d),m=a.slice(-t.rank);c.forEach(function(e){return m[e]=0});var v=p.locToIndex(m);l[n]=r(o[f],s[v])};for(d=0;d<l.length;++d)f(d)}return i.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=ad(e.shape,t.shape),a=ul(r,"float32"),i=ul(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=nd(e.shape,r),c=nd(t.shape,r),l=a.values,d=i.values;if(u.length+c.length===0)for(var h=0;h<l.length;h++){var p=h%o.length,f=h%s.length,m=n(o[2*p],o[2*p+1],s[2*f],s[2*f+1]);l[h]=m.real,d[h]=m.imag}else{var v=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),x=function(r){var i=a.indexToLoc(r),h=i.slice(-e.rank);u.forEach(function(e){return h[e]=0});var p=v.locToIndex(h),f=i.slice(-t.rank);c.forEach(function(e){return f[e]=0});var m=g.locToIndex(f),x=n(o[2*p],o[2*p+1],s[2*m],s[2*m+1]);l[r]=x.real,d[r]=x.imag};for(h=0;h<l.length;h++)x(h)}return this.complex(a.toTensor(),i.toTensor())},t.prototype.split=function(e,t,n){return Ad(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,a,i){for(var o=e.shape,s=o[0],u=o[1],c=o[2],l=o[3],d=t.shape[0],h=r[0],p=r[1],f=ul([d,h,p,l],"float32"),m=this.readSync(t.dataId),v=this.readSync(n.dataId),g=this.readSync(e.dataId),x=e.strides,y=f.strides,b=0;b<d;b++){var w=4*b,N=m[w],k=m[w+1],C=m[w+2],j=m[w+3],S=v[b];if(!(S>=s))for(var E=h>1?(C-N)*(u-1)/(h-1):0,R=p>1?(j-k)*(c-1)/(p-1):0,_=0;_<h;_++){var I=h>1?N*(u-1)+_*E:.5*(N+C)*(u-1);if(I<0||I>u-1)for(var T=0;T<p;T++)for(var A=0;A<l;A++){var D=A+T*y[2]+_*y[1]+b*y[0];f.values[D]=i}else if("bilinear"===a){var P=Math.floor(I),M=Math.ceil(I),F=I-P;for(T=0;T<p;T++)if((q=p>1?k*(c-1)+T*R:.5*(k+j)*(c-1))<0||q>c-1)for(A=0;A<l;A++)D=A+T*y[2]+_*y[1]+b*y[0],f.values[D]=i;else{var O=Math.floor(q),L=Math.ceil(q),B=q-O;for(A=0;A<l;A++){var z=g[D=A+O*x[2]+P*x[1]+S*x[0]],U=g[D=A+L*x[2]+P*x[1]+S*x[0]],W=g[D=A+O*x[2]+M*x[1]+S*x[0]],V=z+(U-z)*B,H=W+(g[D=A+L*x[2]+M*x[1]+S*x[0]]-W)*B;D=A+T*y[2]+_*y[1]+b*y[0],f.values[D]=V+(H-V)*F}}}else for(T=0;T<p;++T){var q;if((q=p>1?k*(c-1)+T*R:.5*(k+j)*(c-1))<0||q>c-1)for(A=0;A<l;A++)D=A+T*y[2]+_*y[1]+b*y[0],f.values[D]=i;else{var G=Math.round(q),K=Math.round(I);for(A=0;A<l;A++){var $=A+G*x[2]+K*x[1]+S*x[0],X=A+T*y[2]+_*y[1]+b*y[0];f.values[X]=g[$]}}}}}return f.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var a=Vl(0,e,n),i=a.sliceRank,o=a.numUpdates,s=a.sliceSize,u=a.strides,c=a.outputSize;return this.scatter(e,t,n,c,s,o,i,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],a=zl(e,t),i=a[0],o=a[1],s=a[2],u=a[3];if(0===o)return Tc([],i,e.dtype);for(var c=new lu([o,s],e.dtype),l=this.readSync(t.dataId),d=this.readSync(e.dataId),h=0;h<o;h++){for(var p=[],f=0,m=0;m<r;m++){var v=l[h*r+m];f+=v*u[m],p.push(v)}if(f<0||f>=e.size/s)throw new Error("Invalid indices: "+p+" does not index into "+e.shape);for(var g=0;g<s;g++)c.values[h*s+g]=d[f*s+g]}return c.toTensor().reshape(i)},t.prototype.scatterND=function(e,t,n){var r=Vl(0,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=Dc(0);return this.scatter(e,t,n,u,o,i,a,s,c,!0)},t.prototype.fill=function(e,t,n){var r=Vs(n=n||Ks(t),Ds(e));return r.fill(t),Iu.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=Vs(e.dtype,Ds(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return yd(e,t,n)},t.prototype.scatter=function(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],d=this.readSync(e.dataId),h=this.readSync(t.dataId);if(0===r)return Tc([],n,t.dtype);var p=new lu(l,t.dtype);p.values.fill(this.readSync(u.dataId)[0]);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var x=d[f*o+g];m.push(x),v+=x*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var y=0;y<a;y++)c?p.values[v*a+y]+=h[f*a+y]:p.values[v*a+y]=0===t.rank?h[0]:h[f*a+y]}return p.toTensor().reshape(n)},t}(ed);Iu.registerBackend("cpu",function(){return new tx},1);for(var nx=0,rx=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t,i=a.boxes,o=a.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,h=n;Zg(i,"NonMaxSuppressionWithScore");var p=Ed(h.data.get(i.dataId).values,h.data.get(o.dataId).values,u,c,l,d);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;Zg(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:ff,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,i=r.b,o=n;Zg([a,i],ff);var s=o.data.get(a.dataId).values,u=o.data.get(i.dataId).values,c=function(e,t,n,r,a,i){var o=ad(e,t),s=o.length,u=Ys(o),c=Ws(a,Ds(o)),l=e.length,d=t.length,h=Ys(e),p=Ys(t),f=nd(e,o),m=nd(t,o);if(f.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=i(n[v%n.length],r[v%r.length]);else{var g=function(e){var t=function(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}(e,s,u),a=t.slice(-l);f.forEach(function(e){return a[e]=0});var o=au(a,l,h),v=t.slice(-d);m.forEach(function(e){return v[e]=0});var g=au(v,d,p);c[e]=i(n[o],r[g])};for(v=0;v<c.length;++v)g(v)}return[c,o]}(a.shape,i.shape,s,u,a.dtype,function(e,t){var n=e-t;return n*n}),l=c[0],d=c[1];return{dataId:o.write(l,d,a.dtype),shape:d,dtype:a.dtype}}}];nx<rx.length;nx++)Cs(rx[nx]);for(var ax,ix=function(e){this.variableNames=["A"];var t=Ud(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},ox=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Ud(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},sx=0,ux=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=u[0],l=u[1],d=[l,c],h=[l,c,i];(s||o)&&(null==ax&&(ax=document.createElement("canvas").getContext("2d")),ax.canvas.width=c,ax.canvas.height=l,ax.drawImage(a,0,0,c,l),a=ax.canvas);var p=n.makeTensorInfo(d,"int32");n.texData.get(p.dataId).usage=Pu.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);var f=xs().getBool("WEBGL_PACK")?new ox(h):new ix(h),m=n.runWebGLProgram(f,[p],"int32");return n.disposeData(p.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;fc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t,i=a.boxes,o=a.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,h=n,p=Ed(h.readSync(i.dataId),h.readSync(o.dataId),u,c,l,d);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n,i=new Op(r.shape,"return x * x;");return a.runWebGLProgram(i,[r],r.dtype)}},{kernelName:ff,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=r.a,i=r.b,o=n,s=xs().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new mh("return (a - b) * (a - b);",a.shape,i.shape):new ph("return (a - b) * (a - b);",a.shape,i.shape);return o.compileAndRun(s,[a,i])}}];sx<ux.length;sx++)Cs(ux[sx]);for(var cx=0,lx=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:ff,gradFunc:function(e,t){var n=t[0],r=t[1],a=Dc(2);return{a:function(){return Im(e,Im(a,Mm(n,r)))},b:function(){return Im(e,Im(a,Mm(r,n)))}}}}];cx<lx.length;cx++)js(lx[cx]);var dx=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();xs().get("IS_BROWSER")&&xs().setPlatform("browser",new dx);var hx,px=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=xs().global.fetch?xs().global.fetch(e,t):(null==hx&&(hx=require("node-fetch")),hx(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();xs().get("IS_NODE")&&xs().setPlatform("node",new px);var fx={float32:4,int32:4,uint16:2,uint8:1,bool:1};function mx(e,t){for(var n={},r=0,a=function(t){var a=t.name,i=t.dtype,o=t.shape,s=Ds(o),u=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=fx[c.dtype],d=e.slice(r,r+s*l),h="uint8"===c.dtype?new Uint8Array(d):new Uint16Array(d);if("float32"===i)u=Float32Array.from(h,function(e){return e*c.scale+c.min});else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+a+"': "+i);u=Int32Array.from(h,function(e){return Math.round(e*c.scale+c.min)})}r+=s*l}else if("string"===i){var p=Ds(t.shape);u=[];for(var f=0;f<p;f++){var m=new Uint32Array(e.slice(r,r+4))[0];r+=4;var v=new Uint8Array(e.slice(r,r+m));u.push(v),r+=m}}else{var g=fx[i];if(d=e.slice(r,r+s*g),"float32"===i)u=new Float32Array(d);else if("int32"===i)u=new Int32Array(d);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+a+"': "+i);u=new Uint8Array(d)}r+=s*g}n[a]=Tc(u,o,i)},i=0,o=t;i<o.length;i++)a(o[i]);return n}function vx(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),a=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength}),r.buffer}var gx="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function xx(e){return gx?Buffer.byteLength(e):new Blob([e]).size}function yx(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function bx(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function wx(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:xx(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:xx(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var Nx=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&a.push(n)}),a},e}(),kx="://",Cx=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){_s(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(kx)&&(t=t.slice(0,t.indexOf(kx))),_s(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();_s(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function jx(e){if(-1===e.indexOf(kx))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Cx.getSchemes().join(","));return{scheme:e.split(kx)[0],path:e.split(kx)[1]}}function Sx(e,t,n){return void 0===n&&(n=!1),ms(this,0,void 0,function(){var r,a,i,o,s,u,c,l,d;return vs(this,function(h){switch(h.label){case 0:return _s(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),_s((r=Nx.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),_s(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),a=r[0],_s((i=Nx.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),_s(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),o=i[0],s=jx(e).scheme,u=jx(e).path,c=s===jx(e).scheme,[4,a.load()];case 1:return l=h.sent(),n&&c?[4,Cx.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return d=h.sent(),!n||c?[3,6]:[4,Cx.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var Ex="models_store",Rx="model_info_store";function _x(){if(!xs().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Ix(e){var t=e.result;t.createObjectStore(Ex,{keyPath:"modelPath"}),t.createObjectStore(Rx,{keyPath:"modelPath"})}var Tx=function(){function e(e){if(this.indexedDB=_x(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return ms(this,0,void 0,function(){return vs(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return ms(this,0,void 0,function(){return vs(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Ix(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(Ex,"readonly"),s=o.objectStore(Ex).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=wx(t),l=i.transaction(Rx,"readwrite"),d=l.objectStore(Rx),h=d.put({modelPath:n.modelPath,modelArtifactsInfo:c});h.onsuccess=function(){var a=(u=i.transaction(Ex,"readwrite")).objectStore(Ex).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(d=l.objectStore(Rx)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},h.onerror=function(e){return i.close(),r(h.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}})},e.URL_SCHEME="indexeddb://",e}(),Ax=function(e){return xs().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Tx.URL_SCHEME)?(t=e.slice(Tx.URL_SCHEME.length),new Tx(t)):null;var t};Nx.registerSaveRouter(Ax),Nx.registerLoadRouter(Ax);var Dx=function(){function e(){this.indexedDB=_x()}return e.prototype.listModels=function(){return ms(this,0,void 0,function(){var e=this;return vs(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return Ix(r)},r.onsuccess=function(){var e=r.result,a=e.transaction(Rx,"readonly"),i=a.objectStore(Rx).getAll();i.onsuccess=function(){for(var e={},n=0,r=i.result;n<r.length;n++){var a=r[n];e[a.modelPath]=a.modelArtifactsInfo}t(e)},i.onerror=function(t){return e.close(),n(i.error)},a.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return ms(this,0,void 0,function(){var t=this;return vs(this,function(n){var r;return e=(r=e).startsWith(Tx.URL_SCHEME)?r.slice(Tx.URL_SCHEME.length):r,[2,new Promise(function(n,r){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Ix(a)},a.onsuccess=function(){var t,i=a.result,o=i.transaction(Rx,"readwrite"),s=o.objectStore(Rx),u=s.get(e);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var a=s.delete(e),o=function(){var a=(t=i.transaction(Ex,"readwrite")).objectStore(Ex).delete(e);a.onsuccess=function(){return n(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==t?i.close():t.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})]})})},e}();if(xs().getBool("IS_BROWSER"))try{Cx.registerManager(Tx.URL_SCHEME,new Dx)}catch(bu){}var Px="/",Mx="tensorflowjs_models",Fx="info",Ox="model_topology",Lx="weight_specs",Bx="weight_data",zx="model_metadata";function Ux(e){return{info:[Mx,e,Fx].join(Px),topology:[Mx,e,Ox].join(Px),weightSpecs:[Mx,e,Lx].join(Px),weightData:[Mx,e,Bx].join(Px),modelMetadata:[Mx,e,zx].join(Px)}}function Wx(e){var t=e.split(Px);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Px)}var Vx=function(){function e(e){if(!xs().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Ux(this.modelPath)}return e.prototype.save=function(e){return ms(this,0,void 0,function(){var t,n,r;return vs(this,function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=wx(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(gx)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(i){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return ms(this,0,void 0,function(){var e,t,n,r,a,i,o;return vs(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(a),t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,t.userDefinedMetadata=i.userDefinedMetadata),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(gx){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(o),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),Hx=function(e){return xs().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Vx.URL_SCHEME)?(t=e.slice(Vx.URL_SCHEME.length),new Vx(t)):null;var t};Nx.registerSaveRouter(Hx),Nx.registerLoadRouter(Hx);var qx=function(){function e(){_s(xs().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),_s("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return ms(this,0,void 0,function(){var e,t,n,r,a,i;return vs(this,function(o){for(e={},t=Mx+Px,n=Px+Fx,r=0;r<this.LS.length;++r)(a=this.LS.key(r)).startsWith(t)&&a.endsWith(n)&&(i=Wx(a),e[i]=JSON.parse(this.LS.getItem(a)));return[2,e]})})},e.prototype.removeModel=function(e){return ms(this,0,void 0,function(){var t,n;return vs(this,function(r){var a;if(e=(a=e).startsWith(Vx.URL_SCHEME)?a.slice(Vx.URL_SCHEME.length):a,t=Ux(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(xs().getBool("IS_BROWSER"))try{Cx.registerManager(Vx.URL_SCHEME,new qx)}catch(bu){}function Gx(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var Kx=function(){function e(t){if(!xs().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return ms(this,0,void 0,function(){var t,n,r,a,i,o;return vs(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,Gx(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,Gx(function(){return o.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:wx(e)}]}})})},e.URL_SCHEME="downloads://",e}(),$x=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return ms(this,0,void 0,function(){var e,t,n=this;return vs(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,a){var i=new FileReader;i.onload=function(i){var o=JSON.parse(i.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,t)}catch(p){return void a(p)}var l=[],d=[],h=[];u.forEach(function(e){e.paths.forEach(function(e){d.push(e),h.push(null)}),l.push.apply(l,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,a=d.indexOf(e);h[a]=n,-1===h.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:yx(h),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return a("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},i.onerror=function(t){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return bx(e.name)}),a={},i=0,o=e;i<o.length;i++)o[i].paths.forEach(function(e){var i=bx(e);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");a[e]=t[r.indexOf(i)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return a},e}();function Xx(e,t,n,r){var a;_s(null!=(a=e)&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"}),function(e,t){_s(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),_s(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),_s(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map(function(a){return a.then(function(a){var o=n+ ++i/e.length*(r-n);return t(o),a}),a}))}function Yx(e,t){return ms(this,0,void 0,function(){var n,r,a,i,o,s,u,c,l;return vs(this,function(d){switch(d.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?xs().platform.fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit,{isBinary:!0})}),a=0,i=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=d.sent(),[3,4];case 2:return[4,Xx(r,t.onProgress,a,i)];case 3:o=d.sent(),d.label=4;case 4:return s=o.map(function(e){return e.arrayBuffer()}),u=.5,c=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,Xx(s,t.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function Qx(e){var t=this;return function(n,r,a){return void 0===r&&(r=""),ms(t,0,void 0,function(){var t,i,o,s,u,c,l,d,h,p;return vs(this,function(f){switch(f.label){case 0:if(t=n.map(function(){return!1}),i={},o=null!=a?a.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,c=fx[u]*Ds(e.shape),l=function(){t[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:e,groupOffset:r,sizeBytes:c})};null!=a?a.forEach(function(t,n){t===e.name&&(l(),o[n]=!0)}):l(),s.push(e.name),r+=c})}),!o.every(function(e){return e}))throw u=a.filter(function(e,t){return!o[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return c=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),l=[],c.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;l.push(t)})}),[4,e(l)];case 1:return d=f.sent(),h={},p=0,c.forEach(function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=d[p+a].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,c=0;c<t;c++){var l=new Uint8Array(d[p+c]);s.set(l,u),u+=l.byteLength}i[e].forEach(function(e){var t=mx(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]}),p+=t}),[2,h]}})})}}Nx.registerSaveRouter(function(e){return xs().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Kx.URL_SCHEME)?(void 0===(t=e.slice(Kx.URL_SCHEME.length))&&(t="model"),new Kx(t)):null;var t});var Jx=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(_s("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=xs().platform.fetch,_s(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&_s(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return ms(this,0,void 0,function(){var t,n,r,a;return vs(this,function(i){switch(i.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=i.sent()).ok)return[2,{modelArtifactsInfo:wx(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},e.prototype.load=function(){return ms(this,0,void 0,function(){var e,t,n,r,a,i,o,s,u,c,l,d;return vs(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,e.json()];case 3:return t=h.sent(),[3,5];case 4:throw h.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,a=t.weightsManifest,i=t.generatedBy,o=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==a)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==a?[3,7]:[4,this.loadWeights(a)];case 6:d=h.sent(),c=d[0],l=d[1],h.label=7;case 7:return[2,{modelTopology:r,weightSpecs:c,weightData:l,userDefinedMetadata:u,generatedBy:i,convertedBy:o,format:s}]}})})},e.prototype.loadWeights=function(e){return ms(this,0,void 0,function(){var t,n,r,a,i,o,s,u,c,l,d;return vs(this,function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,f=void 0,m=void 0,f=(p=t).lastIndexOf("/"),m=p.lastIndexOf("?"),n=[p.substring(0,f)+"/",m>f?p.substring(m):""],r=n[0],a=n[1],i=this.weightPathPrefix||r,o=[],s=0,u=e;s<u.length;s++)c=u[s],o.push.apply(o,c.weights);return l=[],e.forEach(function(e){e.paths.forEach(function(e){l.push(i+e+a)})}),[4,Yx(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=h.sent(),[2,[o,yx(d)]]}var p,f,m})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Zx(e){return null!=e.match(Jx.URL_SCHEME_REGEX)}var ey=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return Zx(e)}):Zx(e))?ty(e,{onProgress:t}):null};function ty(e,t){return new Jx(e,t)}Nx.registerSaveRouter(ey),Nx.registerLoadRouter(ey);var ny,ry=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return ms(this,0,void 0,function(){return vs(this,function(e){return[2,this.modelArtifacts]})})},e}(),ay=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return ms(this,0,void 0,function(){return vs(this,function(t){return[2,this.saveHandler(e)]})})},e}(),iy=Object.freeze({browserFiles:function(e){return new $x(e)},browserHTTPRequest:function(e,t){return ty(e,t)},concatenateArrayBuffers:yx,decodeWeights:mx,encodeWeights:function(e,t){return ms(this,0,void 0,function(){var n,r,a,i,o,s=this;return vs(this,function(u){switch(u.label){case 0:for(n=[],r=[],a=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),i=function(i){var o=a[i],u=Array.isArray(e)?e[i].tensor:e[o];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+u.dtype);var c={name:o,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var l=new Promise(function(e){return ms(s,0,void 0,function(){var t,n,r,a,i,o,s;return vs(this,function(c){switch(c.label){case 0:return[4,u.bytes()];case 1:for(t=c.sent(),n=t.reduce(function(e,t){return e+t.length},0)+4*t.length,r=new Uint8Array(n),a=0,i=0;i<t.length;i++)o=t[i],s=new Uint8Array(new Uint32Array([o.length]).buffer),r.set(s,a),a+=4,r.set(o,a),a+=o.length;return e(r),[2]}})})});r.push(l)}else r.push(u.data());null!=t&&(c.group=t),n.push(c)},o=0;o<a.length;++o)i(o);return[4,Promise.all(r)];case 1:return[2,{data:vx(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new ry(e):new ry({modelTopology:e}):new ry({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})},getLoadHandlers:function(e,t){return Nx.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:wx,getSaveHandlers:function(e){return Nx.getSaveHandlers(e)},http:ty,isHTTPScheme:Zx,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),ms(this,0,void 0,function(){return vs(this,function(a){return[2,Qx(function(e){return Yx(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return Nx.registerLoadRouter(e)},registerSaveRouter:function(e){return Nx.registerSaveRouter(e)},weightsLoaderFactory:Qx,withSaveHandler:function(e){return new ay(e)},copyModel:function(e,t){return ms(this,0,void 0,function(){return vs(this,function(n){return[2,Sx(e,t,!1)]})})},listModels:function(){return ms(this,0,void 0,function(){var e,t,n,r,a,i,o;return vs(this,function(s){switch(s.label){case 0:e=Cx.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(a=r[n],[4,Cx.getManager(a).listModels()]):[3,4];case 2:for(o in i=s.sent())t[a+kx+o]=i[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return ms(this,0,void 0,function(){return vs(this,function(n){return[2,Sx(e,t,!0)]})})},removeModel:function(e){return ms(this,0,void 0,function(){var t;return vs(this,function(n){return t=jx(e),[2,Cx.getManager(t.scheme).removeModel(t.path)]})})}});Ec({confusionMatrix_:function(e,t,n){var r=gc(e,"labels","confusionMatrix"),a=gc(t,"predictions","confusionMatrix");_s(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),_s(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),_s(1===a.rank,function(){return"Expected the rank of predictions to be 1, but got "+a.rank}),_s(r.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."}),_s(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=xl(r.asType("int32"),n),o=xl(a.asType("int32"),n);return i.transpose().matMul(o).asType("int32")}});var oy=Ec({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(a&&a&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=Ns("FromPixels",Iu.backendName))return Iu.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,c=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],d=c[1];if(o?s=e.getContext("2d").getImageData(0,0,l,d).data:r||n?s=e.data:(i||a)&&(null==ny&&(ny=document.createElement("canvas").getContext("2d")),ny.canvas.width=l,ny.canvas.height=d,ny.drawImage(e,0,0,l,d),s=ny.getImageData(0,0,l,d).data),4===t)u=new Int32Array(s);else{var h=l*d;u=new Int32Array(h*t);for(var p=0;p<h;p++)for(var f=0;f<t;++f)u[p*t+f]=s[4*p+f]}return Fc(u,[d,l,t],"int32")}}),sy=Object.freeze({toPixels:function(e,t){return ms(this,0,void 0,function(){var n,r,a,i,o,s,u,c,l,d,h,p,f,m,v,g,x,y,b,w,N,k,C;return vs(this,function(j){switch(j.label){case 0:if(n=gc(e,"img","toPixels"),e instanceof fu||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),a=r[0],i=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=j.sent(),u=n.min(),c=n.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=j.sent(),d=l[0],h=l[1],p=d[0],f=h[0],u.dispose(),c.dispose(),"float32"===n.dtype){if(p<0||f>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+f+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||f>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+f+"].")}for(m="float32"===n.dtype?255:1,v=new Uint8ClampedArray(i*a*4),g=0;g<a*i;++g)x=void 0,y=void 0,b=void 0,w=void 0,1===o?(x=s[g]*m,y=s[g]*m,b=s[g]*m,w=255):3===o?(x=s[3*g]*m,y=s[3*g+1]*m,b=s[3*g+2]*m,w=255):4===o&&(x=s[4*g]*m,y=s[4*g+1]*m,b=s[4*g+2]*m,w=s[4*g+3]*m),v[0+(N=4*g)]=Math.round(x),v[N+1]=Math.round(y),v[N+2]=Math.round(b),v[N+3]=Math.round(w);return null!=t&&(t.width=i,t.height=a,k=t.getContext("2d"),C=new ImageData(v,i,a),k.putImageData(C,0,0)),n!==e&&n.dispose(),[2,v]}})})},fromPixels:oy}),uy=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),cy=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function ly(e){_s(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),_s("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),_s(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),cy.register(e)}var dy=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fs(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map(function(e){return{name:e.name,tensor:i[e.name]}});this.applyGradients(o)}else this.applyGradients(i);return pc(i),t?a:(a.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){_s($s(e),function(){return"The f passed in variableGrads(f) must be a function"}),_s(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof wu}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],Iu.registeredVariables)t.push(Iu.registeredVariables[r]);var a=n?t.filter(function(e){return!e.trainable}):null,i=t.length;_s((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var o=Iu.gradients(e,t,null,!0),s=o.value,u=o.grads;_s(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),_s(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return t.forEach(function(e,t){null!=u[t]&&(c[e.name]=u[t])}),null!=a&&a.forEach(function(e){return c[e.name]=null}),{value:s,grads:c}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&pc(this.iterations_)},t.prototype.saveIterations=function(){return ms(this,0,void 0,function(){return vs(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Dc(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return ms(this,0,void 0,function(){return vs(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return ms(this,0,void 0,function(){return vs(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return ms(this,0,void 0,function(){var t;return vs(this,function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}})})},t}(uy);Object.defineProperty(dy,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var hy=function(e){function t(t,n,r){void 0===r&&(r=null);var a=e.call(this)||this;return a.learningRate=t,a.rho=n,a.epsilon=r,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==r&&(a.epsilon=Iu.backend.epsilon()),a}return fs(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Iu.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:hc(function(){return Vc(a).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:hc(function(){return Vc(a).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;hc(function(){var e=o.mul(t.rho).add(i.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(i),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(a);a.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(pc(this.accumulatedGrads.map(function(e){return e.variable})),pc(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return ms(this,0,void 0,function(){var e;return vs(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ms(this,0,void 0,function(){var t;return vs(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(dy);ly(hy);var py=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return fs(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Iu.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:hc(function(){return zc(a.shape,t.initialAccumulatorValue).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;hc(function(){var e=o.add(i.square());o.assign(e);var n=i.div(e.add(Iu.backend.epsilon()).sqrt()).mul(-t.learningRate).add(a);a.assign(n)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&pc(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return ms(this,0,void 0,function(){return vs(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ms(this,0,void 0,function(){return vs(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(dy);ly(py);var fy=function(e){function t(t,n,r,a){void 0===a&&(a=null);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=a,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],hc(function(){i.accBeta1=Dc(n).variable(),i.accBeta2=Dc(r).variable()}),null==a&&(i.epsilon=Iu.backend.epsilon()),i}return fs(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);hc(function(){var r=Mm(1,t.accBeta1),a=Mm(1,t.accBeta2);n.forEach(function(n,i){var o=Iu.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:hc(function(){return Vc(o).variable(!1)})}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:n+"/v",variable:hc(function(){return Vc(o).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),d=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),h=l.div(r),p=d.div(a);u.assign(l),c.assign(d);var f=h.div(p.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(f)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&pc(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&pc(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return ms(this,0,void 0,function(){var e;return vs(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ms(this,0,void 0,function(){var t,n=this;return vs(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),hc(function(){n.accBeta1.assign(Am(n.beta1,n.iterations_+1)),n.accBeta2.assign(Am(n.beta2,n.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(dy);ly(fy);var my=function(e){function t(t,n,r,a,i){void 0===a&&(a=null),void 0===i&&(i=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=a,o.decay=i,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],hc(function(){o.iteration=Dc(0).variable(),o.accBeta1=Dc(n).variable()}),null==a&&(o.epsilon=Iu.backend.epsilon()),o}return fs(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);hc(function(){var r=Mm(1,t.accBeta1),a=bm(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach(function(n,i){var o=Iu.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Vc(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:Vc(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),d=c.mul(t.beta2),h=s.abs(),p=d.maximum(h);u.assign(l),c.assign(p);var f=a.div(r).mul(l.div(p.add(t.epsilon))).add(o);o.assign(f)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&pc(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&pc(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return ms(this,0,void 0,function(){return vs(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return ms(this,0,void 0,function(){return vs(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(dy);ly(my);var vy=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return fs(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Iu.registeredVariables[n];hc(function(){var e=t.c.mul(a).add(i);i.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return Iu.keep(e)}(Dc(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return ms(this,0,void 0,function(){return vs(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return ms(this,0,void 0,function(){return vs(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(dy);ly(vy);var gy=function(e){function t(t,n,r){void 0===r&&(r=!1);var a=e.call(this,t)||this;return a.learningRate=t,a.momentum=n,a.useNesterov=r,a.accumulations=[],a.m=Dc(a.momentum),a}return fs(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Iu.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:hc(function(){return Vc(a).variable(!1)})});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&hc(function(){var e,n=t.m.mul(i).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(a):t.c.mul(n).add(a),i.assign(n),a.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&pc(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return ms(this,0,void 0,function(){return vs(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ms(this,0,void 0,function(){return vs(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(vy);ly(gy);var xy=function(e){function t(t,n,r,a,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===a&&(a=null),void 0===i&&(i=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=a,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=i,null==a&&(o.epsilon=Iu.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return fs(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var a=Iu.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:hc(function(){return Vc(a).variable(!1)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:hc(function(){return Vc(a).variable(!1)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:hc(function(){return Vc(a).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;hc(function(){var e=o.mul(t.decay).add(i.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(i.mul(1-t.decay)),c=s.mul(t.momentum).add(i.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(u),s.assign(c);var l=a.sub(c);a.assign(l)}else{var d=o.mul(t.decay).add(i.square().mul(1-t.decay));c=s.mul(t.momentum).add(i.mul(t.learningRate).div(d.add(t.epsilon).sqrt())),o.assign(d),s.assign(c),l=a.sub(c),a.assign(l)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&pc(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&pc(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&pc(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return ms(this,0,void 0,function(){var e;return vs(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return ms(this,0,void 0,function(){var t;return vs(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(dy);ly(xy),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate,fu.prototype.squaredDifference=function(e){return mf(this,e)},hu=Jg;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var yy=function(e,t){return(yy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function by(e,t){function n(){this.constructor=e}yy(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var wy=function(){return wy=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},wy.apply(this,arguments)};function Ny(e,t,n,r){return new(n||(n=Promise))(function(t,a){function i(e){try{s(r.next(e))}catch(IE){a(IE)}}function o(e){try{s(r.throw(e))}catch(IE){a(IE)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(i,o)}s((r=r.apply(e,[])).next())})}function ky(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(IE){i=[6,IE],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function Cy(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)r[a]=i[o];return r}var jy=function(){function e(e,t){if(!Dy(e)||!Dy(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Sy(e,t){return e instanceof fu&&e.shape.length===t}function Ey(e){return Sy(e,3)}function Ry(e){return Sy(e,4)}function _y(e){return e%2==0}function Iy(e){return e&&e.width&&e.height}function Ty(e){return e.reduce(function(e,t){return e.add(t)},new My(0,0)).div(new My(e.length,e.length))}function Ay(e,t,n){return Array(e).fill(0).map(function(e,r){return t+r*n})}function Dy(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function Py(e){return Dy(e)&&0<=e&&e<=1}var My=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),Fy=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(Dy),i=[r.x,r.y,r.width,r.height].every(Dy);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=o[0],u=o[1],c=o[2],l=o[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Dy)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new My(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new My(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new My(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new My(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.round(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.floor(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,a=t.width,i=t.height,o=Math.abs(a-i);return a<i&&(n-=o/2,a+=o),i<a&&(r-=o/2,i+=o),new e({x:n,y:r,width:a,height:i})},e.prototype.rescale=function(t){var n=Iy(t)?t.width:t,r=Iy(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,a=r.x,i=r.y,o=r.right,s=r.bottom,u=Math.max(a,0),c=Math.max(i,0),l=o-u,d=s-c;return new e({x:u,y:c,width:Math.min(l,t-u),height:Math.min(d,n-c)}).floor()},e.prototype.shift=function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,o=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(a=-u+t+n,u=t),c>e&&(i=-c+e+r,c=e),o<1&&(i=2-o,o=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:a,y:s,ey:c,x:o,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),Oy=function(e){function t(t,n,r,a,i){return void 0===i&&(i=!1),e.call(this,{left:t,top:n,right:r,bottom:a},i)||this}return by(t,e),t}(Fy),Ly=function(){function e(e,t,n,r,a){this._imageDims=new jy(a.width,a.height),this._score=e,this._classScore=t,this._className=n,this._box=new Fy(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Fy(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),By=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return by(t,e),t.prototype.forSize=function(n,r){var a=e.prototype.forSize.call(this,n,r);return new t(a.score,a.relativeBox,a.imageDims)},t}(Ly);function zy(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function Uy(e,t,n,r){void 0===r&&(r=!0);for(var a=t.map(function(e,t){return{score:e,boxIndex:t}}).sort(function(e,t){return e.score-t.score}).map(function(e){return e.boxIndex}),i=[],o=function(){var t=a.pop();i.push(t);for(var o=a,s=[],u=0;u<o.length;u++){var c=o[u],l=e[t],d=e[c];s.push(zy(l,d,r))}a=a.filter(function(e,t){return s[t]<=n})};a.length>0;)o();return i}function Wy(e,t){return hc(function(){var n=t[0],r=t[1],a=t[2],i=zc(Cy(e.shape.slice(0,3),[1]),n),o=zc(Cy(e.shape.slice(0,3),[1]),r),s=zc(Cy(e.shape.slice(0,3),[1]),a),u=Hc([i,o,s],3);return Mm(e,u)})}function Vy(e){return 1/(1+Math.exp(-e))}var Hy,qy=function(e){function t(t,n,r,a,i){return void 0===i&&(i=!1),e.call(this,{x:t,y:n,width:r,height:a},i)||this}return by(t,e),t}(Fy),Gy=function(){function e(e,t,n){void 0===n&&(n=new My(0,0));var r=t.width,a=t.height;this._imgDims=new jy(r,a),this._shift=n,this._positions=e.map(function(e){return e.mul(new My(r,a)).add(n)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new My(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new My(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new My(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof By?e.box.floor():new Fy(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=r.useDlibAlignment,i=r.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],a=function(e){return r.sub(e).magnitude()},i=(a(t)+a(n))/2,o=Math.floor(i/.45),s=Ty(e),u=Math.floor(Math.max(0,s.x-.5*o)),c=Math.floor(Math.max(0,s.y-.43*o));return new qy(u,c,Math.min(o,this.imageWidth+u),Math.min(o,this.imageHeight+c))},e.prototype.alignMinBbox=function(e){var t,n,r,a,i,o,s,u=(t=this.positions,n=t.map(function(e){return e.x}),r=t.map(function(e){return e.y}),a=n.reduce(function(e,t){return t<e?t:e},1/0),i=r.reduce(function(e,t){return t<e?t:e},1/0),o=n.reduce(function(e,t){return e<t?t:e},0),s=r.reduce(function(e,t){return e<t?t:e},0),new Oy(a,i,o,s));return u.pad(u.width*e,u.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),Ky=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Ty([e[3],e[4]])]},t}(Gy),$y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Ty)},t}(Gy),Xy=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+function(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}(this.distance)+")":"")},e}(),Yy=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return by(t,e),t.assertIsValidLabeledBox=function(e,t){if(Fy.assertIsValidBox(e,t),!Dy(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Fy),Qy=function(){function e(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(e){return new Float32Array(e)});return new e(t.label,n)},e}();function Jy(e,t){var n={detection:t};return Object.assign({},e,n)}function Zy(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function eb(e){var t="";if(!e)try{e=require("fs")}catch(n){t=n.toString()}return{readFile:e?function(t){return new Promise(function(n,r){e.readFile(t,function(e,t){return e?r(e):n(t)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function tb(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},r=eb();return wy({Canvas:e||function(){return function(){}}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){return function(){}}(),Image:t||function(){return function(){}}(),ImageData:global.ImageData||function(){return function(){}}(),Video:global.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:n},r)}function nb(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function rb(){return"object"==typeof global&&"function"==typeof require&&void 0!==ve&&"undefined"!=typeof process&&!!process.version}function ab(e){Hy=e}function ib(){nb()&&ab(Zy()),rb()&&ab(tb())}!function(e){function t(t,n,r,a){var i=e.call(this,t,n)||this;return i._score=r,i._classScore=a,i}by(t,e),t.assertIsValidPredictedBox=function(e,t){if(Yy.assertIsValidLabeledBox(e,t),!Py(e.score)||!Py(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(Yy);var ob,sb,ub={getEnv:function(){if(!Hy)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Hy},setEnv:ab,initialize:ib,createBrowserEnv:Zy,createFileSystem:eb,createNodejsEnv:tb,monkeyPatch:function(e){if(Hy||ib(),!Hy)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?Hy.Canvas:t,r=e.Image,a=void 0===r?Hy.Image:r;Hy.Canvas=n,Hy.Image=a,Hy.createCanvasElement=e.createCanvasElement||function(){return new n},Hy.createImageElement=e.createImageElement||function(){return new a},Hy.ImageData=e.ImageData||Hy.ImageData,Hy.Video=e.Video||Hy.Video,Hy.fetch=e.fetch||Hy.fetch,Hy.readFile=e.readFile||Hy.readFile},isBrowser:nb,isNodejs:rb};function cb(e){return ub.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function lb(e){var t=ub.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=cb(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}function db(e){var t=ub.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function hb(e){var t=ub.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new jy(e.naturalWidth,e.naturalHeight):e instanceof r?new jy(e.videoWidth,e.videoHeight):new jy(e.width,e.height)}function pb(e){var t=e.width,n=e.height,r=(0,ub.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function fb(e,t){var n=ub.getEnv().ImageData;if(!(e instanceof n||db(e)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=hb(e),a=r.width,i=r.height,o=pb({width:a,height:i});return e instanceof n?lb(o).putImageData(e,0,0):lb(o).drawImage(e,0,0,a,i),o}function mb(e,t){return Ny(this,0,void 0,function(){var t,n,r,a,i,o;return ky(this,function(s){switch(s.label){case 0:return t=ub.getEnv().createCanvasElement(),n=e.shape.slice(Ry(e)?1:0),r=n[0],a=n[1],i=n[2],o=hc(function(){return e.as3D(r,a,i).toInt()}),[4,sy.toPixels(o,t)];case 1:return s.sent(),o.dispose(),[2,t]}})})}function vb(e){var t=ub.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}ib(),(sb=ob||(ob={})).TOP_LEFT="TOP_LEFT",sb.TOP_RIGHT="TOP_RIGHT",sb.BOTTOM_LEFT="BOTTOM_LEFT",sb.BOTTOM_RIGHT="BOTTOM_RIGHT";var gb=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(e,t){if(Ey(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(Ry(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof ub.getEnv().Canvas?e:fb(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Ay(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new jy(Math.round(n*a),Math.round(r*a))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,hc(function(){var r=Ay(n.batchSize,0,1).map(function(r){var a=n.getInput(r);if(a instanceof fu){var i=Ry(a)?a:a.expandDims();return i=function(e,t){return void 0===t&&(t=!1),hc(function(){var n=e.shape.slice(1),r=n[0],a=n[1];if(r===a)return e;var i=Math.abs(r-a),o=Math.round(i*(t?.5:1)),s=r>a?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,zc(n,0)},c=u(o),l=i-c.shape[s],d=[t&&l?u(l):null,e,c].filter(function(e){return!!e}).map(function(e){return e.toFloat()});return Hc(d,s)})}(i,t),i.shape[1]===e&&i.shape[2]===e||(i=Vg.resizeBilinear(i,[e,e])),i.as3D(e,e,3)}if(a instanceof ub.getEnv().Canvas)return sy.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=ub.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=hb(e),s=t/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=pb({width:t,height:t}),d=e instanceof i?e:fb(e),h=Math.abs(u-c)/2,p=n&&u<c?h:0,f=n&&c<u?h:0;return lb(l).drawImage(d,p,f,u,c),l}(a,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),a=Tl(r.map(function(e){return e.toFloat()})).as4D(n.batchSize,e,e,3);return a})},e}();function xb(e){return Ny(this,0,void 0,function(){var t,n,r;return ky(this,function(a){switch(a.label){case 0:if(e instanceof gb)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(cb)).forEach(function(e,r){if(!vb(e)&&!Ey(e)&&!Ry(e)){if("string"==typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(Ry(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(e){return vb(e)&&(t=e,new Promise(function(e,n){if(t instanceof ub.getEnv().Canvas||db(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",a),e(t))}function a(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",a),n(e))}t.addEventListener("load",r),t.addEventListener("error",a)}));var t}))];case 1:return a.sent(),[2,new gb(r,Array.isArray(e))]}})})}function yb(e,t){return Ny(this,0,void 0,function(){var n,r,a,i,o,s;return ky(this,function(u){switch(u.label){case 0:return n=ub.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,xb(e)];case 1:if((a=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=a.getInput(0))instanceof n?(o=i,[3,4]):[3,2];case 2:return[4,mb(i)];case 3:o=u.sent(),u.label=4;case 4:r=o,u.label=5;case 5:return s=lb(r),[2,t.map(function(e){return e instanceof By?e.forSize(r.width,r.height).box.floor():e}).map(function(e){return e.clipAtImageBorders(r.width,r.height)}).map(function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=pb({width:r,height:a});return lb(i).putImageData(s.getImageData(t,n,r,a),0,0),i})]}})})}function bb(e,t){return Ny(this,0,void 0,function(){return ky(this,function(n){if(!Ey(e)&&!Ry(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Ry(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,hc(function(){var n=e.shape.slice(Ry(e)?1:0),r=n[0],a=n[1],i=n[2];return t.map(function(e){return e instanceof By?e.forSize(a,r).box:e}).map(function(e){return e.clipAtImageBorders(a,r)}).map(function(t){var n=t.x,o=t.y,s=t.width,u=t.height;return Tv(e.as3D(r,a,i),[o,n,0],[u,s,i])})})]})})}function wb(e,t){return Ny(this,0,void 0,function(){var n;return ky(this,function(r){switch(r.label){case 0:return[4,(0,ub.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function Nb(e){return Ny(this,0,void 0,function(){return ky(this,function(t){switch(t.label){case 0:return[4,wb(e)];case 1:return[2,t.sent().json()]}})})}function kb(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter(function(e){return e}),i=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:o=e.startsWith("/")?"/"+o:o,manifestUri:"/"===o?"/"+i:o+"/"+i}}function Cb(e,t){return Ny(this,0,void 0,function(){var n,r,a,i;return ky(this,function(o){switch(o.label){case 0:return n=kb(e,t),r=n.manifestUri,a=n.modelBaseUri,[4,Nb(r)];case 1:return i=o.sent(),[2,iy.loadWeights(i,a)]}})})}var jb=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof wu})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof wu)})},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())})},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,r=t.tensor,a=Tc(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},e.prototype.load=function(e){return Ny(this,0,void 0,function(){return ky(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Cb(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(e){return Ny(this,0,void 0,function(){var t,n,r,a,i,o,s,u,c,l;return ky(this,function(d){switch(d.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=ub.getEnv().readFile,n=kb(e,this.getDefaultModelName()),r=n.manifestUri,a=n.modelBaseUri,i=function(e){return Promise.all(e.map(function(e){return t(e).then(function(e){return e.buffer})}))},o=iy.weightsLoaderFactory(i),c=(u=JSON).parse,[4,t(r)];case 1:return s=c.apply(u,[d.sent().toString()]),[4,o(s,a)];case 2:return l=d.sent(),this.loadFromWeightMap(l),[2]}})})},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}},{nextObj:this.params}),n=t.obj,r=t.objProp;if(!(n&&r&&n[r]instanceof fu))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function Sb(e,t,n){return hc(function(){var r=lv(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=vm(r,t.bias)})}function Eb(e,t,n){return void 0===n&&(n=!1),hc(function(){var r=$v(n?vm(rv(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Sb(e,t.conv0,[2,2])),a=Sb(r,t.conv1,[1,1]),i=Sb($v(vm(r,a)),t.conv2,[1,1]);return $v(vm(r,vm(a,i)))})}function Rb(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),hc(function(){var a=$v(n?vm(rv(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Sb(e,t.conv0,r?[2,2]:[1,1])),i=Sb(a,t.conv1,[1,1]),o=Sb($v(vm(a,i)),t.conv2,[1,1]),s=Sb($v(vm(a,vm(i,o))),t.conv3,[1,1]);return $v(vm(a,vm(i,vm(o,s))))})}function _b(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),hc(function(){var a=vm(rv(e,t.filters,[1,1],n),t.bias);return r?$v(a):a})}function Ib(e,t){Object.keys(e).forEach(function(n){t.some(function(e){return e.originalPath===n})||e[n].dispose()})}function Tb(e,t){return function(n,r,a,i){var o=Oc(e(n*r*a*a),[a,a,n,r]),s=Pc(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:s}}}function Ab(e,t){return function(n,r,a){var i=Mc(e(n*r),[n,r]),o=Pc(e(r));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:i,bias:o}}}var Db=function(){return function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}}();function Pb(e,t){return function(n,r,a){var i=Oc(e(9*n),[3,3,n,1]),o=Oc(e(n*r),[1,1,n,r]),s=Pc(e(r));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new Db(i,o,s)}}function Mb(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),a=e(t+"/bias",1);return new Db(n,r,a)}}function Fb(e,t){return function(n,r,a){var i=e[n];if(!Sy(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:a||n}),i}}function Ob(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function Lb(e,t){var n=Tb(e,t),r=Pb(e,t);function a(e,t,a,i){return void 0===i&&(i=!1),{conv0:i?n(e,t,3,a+"/conv0"):r(e,t,a+"/conv0"),conv1:r(t,t,a+"/conv1"),conv2:r(t,t,a+"/conv2")}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n,i){void 0===i&&(i=!1);var o=a(e,t,n,i);return{conv0:o.conv0,conv1:o.conv1,conv2:o.conv2,conv3:r(t,t,n+"/conv3")}}}}function Bb(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function zb(e,t){var n=Fb(e,t),r=Bb(n),a=Mb(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):a(e+"/conv0"),conv1:a(e+"/conv1"),conv2:a(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):a(e+"/conv0"),conv1:a(e+"/conv1"),conv2:a(e+"/conv2"),conv3:a(e+"/conv3")}}}}var Ub=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return by(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return hc(function(){var n=Rb(Wy(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Dc(255)),t.dense0,!0);return n=Rb(n,t.dense1),n=Rb(n,t.dense2),n=Rb(n,t.dense3),n=Cv(n,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,xb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=zb(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Ib(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Ob(e),r=n.extractWeights,a=n.getRemainingWeights,i=Lb(r,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}(e)},t}(jb);function Wb(e,t){return hc(function(){return vm(pv(e,t.weights),t.bias)})}function Vb(e){var t={},n={};return Object.keys(e).forEach(function(r){(r.startsWith("fc")?n:t)[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var Hb=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return by(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return hc(function(){var r=e instanceof gb?t.faceFeatureExtractor.forwardInput(e):e;return Wb(r.as2D(r.shape[0],-1),n.fc)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],a=Ob(e),i=a.extractWeights,o=a.getRemainingWeights,s=Ab(i,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=Vb(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=Fb(e,n),a={fc:(t="fc",{weights:r(t+"/weights",2),bias:r(t+"/bias",1)})};return Ib(e,n),{params:a,paramMappings:n}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)},t}(jb),qb=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Gb=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);qb.forEach(function(n,r){t[n]=e[r]})}return e.prototype.asSortedArray=function(){var e=this;return qb.map(function(t){return{expression:t,probability:e[t]}}).sort(function(e,t){return t.probability-e.probability})},e}(),Kb=function(e){function t(t){return void 0===t&&(t=new Ub),e.call(this,"FaceExpressionNet",t)||this}return by(t,e),t.prototype.forwardInput=function(e){var t=this;return hc(function(){return Ql(t.runNet(e))})},t.prototype.forward=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,xb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictExpressions=function(e){return Ny(this,0,void 0,function(){var t,n,r,a,i=this;return ky(this,function(o){switch(o.label){case 0:return[4,xb(e)];case 1:return t=o.sent(),[4,this.forwardInput(t)];case 2:return n=o.sent(),[4,Promise.all(Pl(n).map(function(e){return Ny(i,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}})})}))];case 3:return r=o.sent(),n.dispose(),a=r.map(function(e){return new Gb(e)}),[2,t.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(Hb);function $b(e,t){var n={expressions:t};return Object.assign({},e,n)}function Xb(e){return function(e){return e.detection instanceof By}(e)&&e.landmarks instanceof Gy&&e.unshiftedLandmarks instanceof Gy&&e.alignedRect instanceof By}function Yb(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),i=e.detection.imageDims,o={landmarks:r,unshiftedLandmarks:t,alignedRect:new By(e.detection.score,a.rescale(i.reverse()),i)};return Object.assign({},e,o)}function Qb(e,t){var n=[],r=Ob(e),a=r.extractWeights,i=r.getRemainingWeights,o=function(e,t){var n=Tb(e,t),r=Pb(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,a+"/separable_conv0"),separable_conv1:r(t,t,a+"/separable_conv1"),expansion_conv:n(e,t,1,a+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(a,n),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,d={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},h={};Ay(t,0,1).forEach(function(e){h["main_block_"+e]=l(128,"middle_flow/main_block_"+e)});var p={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:d,middle_flow:h,exit_flow:p}}}function Jb(e,t){var n=[],r=function(e,t){var n=Fb(e,t),r=Bb(n),a=Mb(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a(e+"/separable_conv0"),separable_conv1:a(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:a(e+"/separable_conv0"),separable_conv1:a(e+"/separable_conv1"),separable_conv2:a(e+"/separable_conv2")}}}}(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:a("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},c={};Ay(t,0,1).forEach(function(e){c["main_block_"+e]=s("middle_flow/main_block_"+e)});var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return Ib(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function Zb(e,t,n){return vm(rv(e,t.filters,n,"same"),t.bias)}function ew(e,t,n){void 0===n&&(n=!0);var r=n?$v(e):e;return r=Sb(r,t.separable_conv0,[1,1]),r=Sb($v(r),t.separable_conv1,[1,1]),r=kv(r,[3,3],[2,2],"same"),r=vm(r,Zb(e,t.expansion_conv,[2,2]))}var tw,nw,rw=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return by(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return hc(function(){var r=Wy(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Dc(256)),a=$v(Zb(r,n.entry_flow.conv_in,[2,2]));return a=ew(a,n.entry_flow.reduction_block_0,!1),a=ew(a,n.entry_flow.reduction_block_1),Ay(t._numMainBlocks,0,1).forEach(function(e){a=function(e,t){var n=Sb($v(e),t.separable_conv0,[1,1]);return n=Sb($v(n),t.separable_conv1,[1,1]),n=Sb($v(n),t.separable_conv2,[1,1]),vm(n,e)}(a,n.middle_flow["main_block_"+e])}),a=ew(a,n.exit_flow.reduction_block),a=$v(Sb(a,n.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,xb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Jb(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return Qb(e,this._numMainBlocks)},t}(jb);(nw=tw||(tw={})).FEMALE="female",nw.MALE="male";var aw=function(e){function t(t){void 0===t&&(t=new rw(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return by(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return hc(function(){var r=e instanceof gb?t.faceFeatureExtractor.forwardInput(e):e,a=Cv(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:Wb(a,n.fc.age).as1D(),gender:Wb(a,n.fc.gender)}})},t.prototype.forwardInput=function(e){var t=this;return hc(function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:Ql(a)}})},t.prototype.forward=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,xb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return Ny(this,0,void 0,function(){var t,n,r,a,i,o,s=this;return ky(this,function(u){switch(u.label){case 0:return[4,xb(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=Pl(n.age),a=Pl(n.gender),i=r.map(function(e,t){return{ageTensor:e,genderTensor:a[t]}}),[4,Promise.all(i.map(function(e){var t=e.ageTensor,n=e.genderTensor;return Ny(s,0,void 0,function(){var e,r,a,i,o;return ky(this,function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],i=(a=r>.5)?tw.MALE:tw.FEMALE,o=a?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:i,genderProbability:o}]}})})}))];case 3:return o=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=Ob(e),r=n.extractWeights,a=n.getRemainingWeights,i=Ab(r,t),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=Vb(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=Fb(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Ib(e,t),{params:a,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(jb),iw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map(function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}}),a=r.length;return hc(function(){var n=function(e,t){return Tl([zc([68],e),zc([68],t)],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0};return e.mul(zc([a,136],t)).sub(Tl(Array.from(Array(a),function(e,t){return n(function(e){return i(e,function(e,t){return e<t})}(t),function(e){return i(e,function(e,t){return t<e})}(t))}))).div(Tl(Array.from(Array(a),function(e,t){return n(r[t].width,r[t].height)})))})},t.prototype.forwardInput=function(e){var t=this;return hc(function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map(function(e){return{height:e[0],width:e[1]}}))})},t.prototype.forward=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,xb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.detectLandmarks=function(e){return Ny(this,0,void 0,function(){var t,n,r,a=this;return ky(this,function(i){switch(i.label){case 0:return[4,xb(e)];case 1:return t=i.sent(),n=hc(function(){return Pl(a.forwardInput(t))}),[4,Promise.all(n.map(function(e,n){return Ny(a,0,void 0,function(){var r,a,i,o,s;return ky(this,function(u){switch(u.label){case 0:return i=(a=Array).from,[4,e.data()];case 1:return r=i.apply(a,[u.sent()]),o=r.filter(function(e,t){return _y(t)}),s=r.filter(function(e,t){return!_y(t)}),[2,new $y(Array(68).fill(0).map(function(e,t){return new My(o[t],s[t])}),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}})})}))];case 2:return r=i.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(Hb),ow=function(e){function t(t){return void 0===t&&(t=new Ub),e.call(this,"FaceLandmark68Net",t)||this}return by(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(iw),sw=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return by(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return hc(function(){var n=Eb(Wy(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Dc(255)),t.dense0,!0);return n=Eb(n,t.dense1),n=Eb(n,t.dense2),n=Cv(n,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,xb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=zb(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Ib(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Ob(e),r=n.extractWeights,a=n.getRemainingWeights,i=Lb(r,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u}}}(e)},t}(jb),uw=function(e){function t(t){return void 0===t&&(t=new sw),e.call(this,"FaceLandmark68TinyNet",t)||this}return by(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(iw);function cw(e,t,n,r,a){void 0===a&&(a="same");var i=t.conv,o=i.filters,s=i.bias,u=rv(e,o,n,a);return u=function(e,t){return vm(Im(e,t.weights),t.biases)}(u=vm(u,s),t.scale),r?$v(u):u}function lw(e,t){return cw(e,t,[1,1],!1)}function dw(e,t){return cw(e,t,[2,2],!0,"valid")}function hw(e,t){function n(n,r,a,i){var o=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if(i%1!=0)throw new Error("depth has to be an integer: "+i+", weights.length: "+a.length+", numFilters: "+n+", filterSize: "+r);return hc(function(){return Qv(Oc(a,[n,i,r,r]),[2,3,1,0])})}(n,r,a),s=Pc(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:s}}function r(r,a,i,o){var s=n(r,a,i,o+"/conv"),u=function(n,r){var a=Pc(e(n)),i=Pc(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:a,biases:i}}(a,o+"/scale");return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*e,t,n,a+"/conv1"),conv2:r(e,t,n,a+"/conv2")}}}}function pw(e,t){var n=Fb(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),a=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:a}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function fw(e){var t=[],n=pw(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),u=a("conv32_3"),c=a("conv64_down"),l=a("conv64_1"),d=a("conv64_2"),h=a("conv64_3"),p=a("conv128_down"),f=a("conv128_1"),m=a("conv128_2"),v=a("conv256_down"),g=a("conv256_1"),x=a("conv256_2"),y=a("conv256_down_out"),b=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!Sy(b,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var w={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:h,conv128_down:p,conv128_1:f,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:x,conv256_down_out:y,fc:b};return Ib(e,t),{params:w,paramMappings:t}}function mw(e,t){var n=function(e,t){return cw(e,t,[1,1],!0)}(e,t.conv1);return n=lw(n,t.conv2),n=vm(n,e),n=$v(n)}function vw(e,t){var n=dw(e,t.conv1);n=lw(n,t.conv2);var r=Cv(e,2,2,"valid"),a=Bc(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=Cy(n.shape);o[1]=1;var s=Bc(o),u=Cy((n=Hc([n,s],1)).shape);u[2]=1;var c=Bc(u);n=Hc([n,c],2)}return r=i?Hc([r,a],3):r,n=vm(r,n),n=$v(n)}!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}by(t,e)}(ow);var gw=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return by(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return hc(function(){var n=dw(Wy(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Dc(256)),t.conv32_down);n=mw(n=kv(n,3,2,"valid"),t.conv32_1),n=mw(n,t.conv32_2),n=mw(n,t.conv32_3),n=mw(n=vw(n,t.conv64_down),t.conv64_1),n=mw(n,t.conv64_2),n=mw(n,t.conv64_3),n=mw(n=vw(n,t.conv128_down),t.conv128_1),n=mw(n,t.conv128_2),n=mw(n=vw(n,t.conv256_down),t.conv256_1);var r=(n=vw(n=mw(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return pv(r,t.fc)})},t.prototype.forward=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,xb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return Ny(this,0,void 0,function(){var t,n,r,a=this;return ky(this,function(i){switch(i.label){case 0:return[4,xb(e)];case 1:return t=i.sent(),n=hc(function(){return Pl(a.forwardInput(t))}),[4,Promise.all(n.map(function(e){return e.data()}))];case 2:return r=i.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return fw(e)},t.prototype.extractParams=function(e){return function(e){var t=Ob(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=hw(n,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),h=s(36864,64,3,"conv64_down",!0),p=s(36864,64,3,"conv64_1"),f=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),N=s(589824,256,3,"conv256_down_out"),k=hc(function(){return Qv(Mc(n(32768),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:h,conv64_1:p,conv64_2:f,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:x,conv256_down:y,conv256_1:b,conv256_2:w,conv256_down_out:N,fc:k},paramMappings:a}}(e)},t}(jb);function xw(e,t){var n={descriptor:t};return Object.assign({},e,n)}function yw(e,t){var n={age:t};return Object.assign({},e,n)}function bw(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var ww=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,a=t.maxNumScales,i=t.scoreThresholds,o=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=a||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=o,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(e){return"number"!=typeof e}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(e){return"number"!=typeof e})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function Nw(e,t){function n(n,r,a,i,o){var s=Oc(e(n*r*a*a),[a,a,n,r]),u=Pc(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/"+(o?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){var o=function(n,r){var a=Oc(e(9*n),[3,3,n,1]),i=Pc(e(n)),o=Pc(e(n)),s=Pc(e(n)),u=Pc(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:a,batch_norm_scale:i,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:u}}(n,i+"/depthwise_conv");return{depthwise_conv:o,pointwise_conv:r(n,a,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function kw(e){var t=[],n=function(e,t){var n=Fb(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function a(e){var t="mobilenetv1/conv_"+e,a="MobilenetV1/Conv2d_"+e+"_depthwise",i=t+"/depthwise_conv",o=t+"/pointwise_conv";return{depthwise_conv:{filters:n(a+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(a+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(a+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(a+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(a+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,o)}}function i(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function o(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Ey(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return Ib(e,t),{params:o,paramMappings:t}}function Cw(e,t,n){return hc(function(){var r=rv(e,t.filters,n,"same");return r=vm(r,t.batch_norm_offset),Cf(r,0,6)})}function jw(e,t){return hc(function(){var n=null,r=Cw(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(e,t){var a=t+1,i=function(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}(a);r=function(e,t,n){return hc(function(){var r=sv(e,t.filters,n,"same");return r=om(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),Cf(r,0,6)})}(r,e.depthwise_conv,i),r=Cw(r,e.pointwise_conv,[1,1]),11===a&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function Sw(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),d=Math.max(r[n][1],r[n][3]),h=(o-a)*(s-i),p=(l-u)*(d-c);if(h<=0||p<=0)return 0;var f=Math.max(a,u),m=Math.max(i,c),v=Math.min(o,l),g=Math.min(s,d),x=Math.max(v-f,0)*Math.max(g-m,0);return x/(h+p-x)}function Ew(e,t){var n=function(e){var t=Pl(Qv(e,[1,0])),n=[Mm(t[2],t[0]),Mm(t[3],t[1])];return{sizes:n,centers:[vm(t[0],bm(n[0],Dc(2))),vm(t[1],bm(n[1],Dc(2)))]}}(e),r=n.sizes,a=n.centers,i=Pl(Qv(t,[1,0])),o=bm(Im(Rf(bm(i[2],Dc(5))),r[0]),Dc(2)),s=vm(Im(bm(i[0],Dc(10)),r[0]),a[0]),u=bm(Im(Rf(bm(i[3],Dc(5))),r[1]),Dc(2)),c=vm(Im(bm(i[1],Dc(10)),r[1]),a[1]);return Qv(Tl([Mm(s,o),Mm(c,u),vm(s,o),vm(c,u)]),[1,0])}function Rw(e,t){return hc(function(){var n=e.shape[0];return{boxPredictionEncoding:Rl(_b(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Rl(_b(e,t.class_predictor),[n,-1,3])}})}var _w=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),Iw=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return by(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return hc(function(){var n=e.toBatchTensor(512,!1).toFloat(),r=jw(Mm(Im(n,Dc(.007843137718737125)),Dc(1)),t.mobilenetv1),a=function(e,t,n){return hc(function(){var r=Cw(e,n.conv_0,[1,1]),a=Cw(r,n.conv_1,[2,2]),i=Cw(a,n.conv_2,[1,1]),o=Cw(i,n.conv_3,[2,2]),s=Cw(o,n.conv_4,[1,1]),u=Cw(s,n.conv_5,[2,2]),c=Cw(u,n.conv_6,[1,1]),l=Cw(c,n.conv_7,[2,2]),d=Rw(t,n.box_predictor_0),h=Rw(e,n.box_predictor_1),p=Rw(a,n.box_predictor_2),f=Rw(o,n.box_predictor_3),m=Rw(u,n.box_predictor_4),v=Rw(l,n.box_predictor_5);return{boxPredictions:Hc([d.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:Hc([d.classPrediction,h.classPrediction,p.classPrediction,f.classPrediction,m.classPrediction,v.classPrediction],1)}})}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return hc(function(){var r=e.shape[0],a=Ew(Rl(Al(n.extra_dim,[r,1,1]),[-1,4]),Rl(e,[-1,4]));a=Rl(a,[r,a.shape[0]/r,4]);var i=Lf(Rv(t,[0,0,1],[-1,-1,-1])),o=Rv(i,[0,0,0],[-1,-1,1]);return o=Rl(o,[r,o.shape[1]]),{boxes:Pl(a),scores:Pl(o)}})}(a.boxPredictions,a.classPredictions,t.output_layer)})},t.prototype.forward=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,xb(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),Ny(this,0,void 0,function(){var n,r,a,i,o,s,u,c,l,d,h,p,f,m,v,g,x,y,b,w;return ky(this,function(N){switch(N.label){case 0:return n=new _w(t),r=n.maxResults,a=n.minConfidence,[4,xb(e)];case 1:for(i=N.sent(),o=this.forwardInput(i),s=o.boxes,u=o.scores,c=s[0],l=u[0],d=1;d<s.length;d++)s[d].dispose(),u[d].dispose();return f=(p=Array).from,[4,l.data()];case 2:return h=f.apply(p,[N.sent()]),m=function(e,t,n,r,a){var i=e.shape[0],o=Math.min(n,i),s=t.map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>a}).sort(function(e,t){return t.score-e.score}),u=function(e){return e<=r?1:0},c=[];return s.forEach(function(t){if(!(c.length>=o)){for(var n=t.score,r=c.length-1;r>=0;--r){var i=Sw(e,t.boxIndex,c[r]);if(0!==i&&(t.score*=u(i),t.score<=a))break}n===t.score&&c.push(t.boxIndex)}}),c}(c,h,r,.5,a),v=i.getReshapedInputDimensions(0),g=i.inputSize,x=g/v.width,y=g/v.height,b=c.arraySync(),w=m.map(function(e){var t=[Math.max(0,b[e][0]),Math.min(1,b[e][2])].map(function(e){return e*y}),n=t[0],r=t[1],a=[Math.max(0,b[e][1]),Math.min(1,b[e][3])].map(function(e){return e*x}),o=a[0],s=a[1];return new By(h[e],new qy(o,n,s-o,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),c.dispose(),l.dispose(),[2,w]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return kw(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Ob(e),r=n.extractWeights,a=n.getRemainingWeights,i=Nw(r,t),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=o(),c=s(),l={extra_dim:Fc(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)},t}(jb);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}by(t,e)}(Iw);var Tw,Aw,Dw=[new My(.738768,.874946),new My(2.42204,2.65704),new My(4.30971,7.04493),new My(10.246,4.59428),new My(12.6868,11.8741)],Pw=[new My(1.603231,2.094468),new My(6.041143,7.080126),new My(2.882459,3.518061),new My(4.266906,5.178857),new My(9.041765,10.66308)],Mw=[117.001,114.697,97.404],Fw=function(e){return"number"==typeof e};function Ow(e){return hc(function(){var t=Im(e,Dc(.10000000149011612));return vm($v(Mm(e,t)),t)})}function Lw(e,t){return hc(function(){var n=yl(e,[[0,0],[1,1],[1,1],[0,0]]);return n=rv(n,t.conv.filters,[1,1],"valid"),n=Mm(n,t.bn.sub),n=Im(n,t.bn.truediv),Ow(n=vm(n,t.conv.bias))})}function Bw(e,t){return hc(function(){var n=yl(e,[[0,0],[1,1],[1,1],[0,0]]);return n=lv(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),Ow(n=vm(n,t.bias))})}function zw(e,t){var n=Tb(e,t),r=Pb(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){var o=n(r,a,3,i+"/conv"),s=function(n,r){var a=Pc(e(n)),i=Pc(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:a,truediv:i}}(a,i+"/bn");return{conv:o,bn:s}},extractSeparableConvParams:r}}function Uw(e,t){var n=Fb(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),a=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:a}},extractSeparableConvParams:Mb(n)}}(Aw=Tw||(Tw={}))[Aw.XS=224]="XS",Aw[Aw.SM=320]="SM",Aw[Aw.MD=416]="MD",Aw[Aw.LG=608]="LG";var Ww=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),Vw=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Fw(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(e){return"string"==typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(e){return e||{}}).every(function(e){return Fw(e.x)&&Fw(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(Fw)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return by(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=Lw(e,t.conv0);return n=Lw(n=kv(n,[2,2],[2,2],"same"),t.conv1),n=Lw(n=kv(n,[2,2],[2,2],"same"),t.conv2),n=Lw(n=kv(n,[2,2],[2,2],"same"),t.conv3),n=Lw(n=kv(n,[2,2],[2,2],"same"),t.conv4),n=Lw(n=kv(n,[2,2],[2,2],"same"),t.conv5),n=Lw(n=kv(n,[2,2],[1,1],"same"),t.conv6),_b(n=Lw(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?Ow(_b(e,t.conv0,"valid",!1)):Bw(e,t.conv0);return n=Bw(n=kv(n,[2,2],[2,2],"same"),t.conv1),n=Bw(n=kv(n,[2,2],[2,2],"same"),t.conv2),n=Bw(n=kv(n,[2,2],[2,2],"same"),t.conv3),n=Bw(n=kv(n,[2,2],[2,2],"same"),t.conv4),n=Bw(n=kv(n,[2,2],[2,2],"same"),t.conv5),n=kv(n,[2,2],[1,1],"same"),n=t.conv6?Bw(n,t.conv6):n,_b(n=t.conv7?Bw(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return hc(function(){var a=e.toBatchTensor(t,!1).toFloat();return a=(a=n.config.meanRgb?Wy(a,n.config.meanRgb):a).div(Dc(256)),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)})},t.prototype.forward=function(e,t){return Ny(this,0,void 0,function(){var n;return ky(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,xb(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}})})},t.prototype.detect=function(e,t){return void 0===t&&(t={}),Ny(this,0,void 0,function(){var n,r,a,i,o,s,u,c,l,d,h,p,f=this;return ky(this,function(m){switch(m.label){case 0:return n=new Ww(t),r=n.inputSize,a=n.scoreThreshold,[4,xb(e)];case 1:return i=m.sent(),[4,this.forwardInput(i,r)];case 2:return o=m.sent(),s=hc(function(){return Pl(o)[0].expandDims()}),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(s,i.getReshapedInputDimensions(0),a)];case 3:return c=m.sent(),o.dispose(),s.dispose(),l=c.map(function(e){return e.box}),d=c.map(function(e){return e.score}),h=c.map(function(e){return e.classScore}),p=c.map(function(e){return f.config.classes[e.label]}),[2,Uy(l.map(function(e){return e.rescale(r)}),d,this.config.iouThreshold,!0).map(function(e){return new Ly(d[e],h[e],p[e],l[e],u)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],a=Uw(e,r),i=a.extractConvParams,o=a.extractConvWithBatchNormParams,s=a.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return Ib(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var a,i=Ob(e),o=i.extractWeights,s=i.getRemainingWeights,u=[],c=zw(o,u),l=c.extractConvParams,d=c.extractConvWithBatchNormParams,h=c.extractSeparableConvParams;if(t.withSeparableConvs){var p=r[0],f=r[1],m=r[2],v=r[3],g=r[4],x=r[5],y=r[6],b=r[7],w=r[8];a={conv0:t.isFirstLayerConv2d?l(p,f,3,"conv0"):h(p,f,"conv0"),conv1:h(f,m,"conv1"),conv2:h(m,v,"conv2"),conv3:h(v,g,"conv3"),conv4:h(g,x,"conv4"),conv5:h(x,y,"conv5"),conv6:b?h(y,b,"conv6"):void 0,conv7:w?h(b,w,"conv7"):void 0,conv8:l(w||b||y,5*n,1,"conv8")}}else p=r[0],f=r[1],m=r[2],v=r[3],g=r[4],x=r[5],y=r[6],b=r[7],w=r[8],a={conv0:d(p,f,"conv0"),conv1:d(f,m,"conv1"),conv2:d(m,v,"conv2"),conv3:d(v,g,"conv3"),conv4:d(g,x,"conv4"),conv5:d(x,y,"conv5"),conv6:d(y,b,"conv6"),conv7:d(b,w,"conv7"),conv8:l(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:a,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return Ny(this,0,void 0,function(){var r,a,i,o,s,u,c,l,d,h,p,f,m,v,g,x,y,b,w,N,k,C,j,S,E,R,_,I,T,A=this;return ky(this,function(D){switch(D.label){case 0:return r=t.width,a=t.height,i=Math.max(r,a),o=i/r,s=i/a,u=e.shape[1],c=this.config.anchors.length,l=hc(function(){var t=e.reshape([u,u,c,A.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,c,4]),t.slice([0,0,0,4],[u,u,c,1]),A.withClassScores?Ql(t.slice([0,0,0,5],[u,u,c,A.config.classes.length]),3):Dc(0)]}),d=l[0],h=l[1],p=l[2],f=[],[4,h.array()];case 1:return m=D.sent(),[4,d.array()];case 2:v=D.sent(),g=0,D.label=3;case 3:if(!(g<u))return[3,12];x=0,D.label=4;case 4:if(!(x<u))return[3,11];y=0,D.label=5;case 5:return y<c?(b=Vy(m[g][x][y][0]),!n||b>n?(w=(x+Vy(v[g][x][y][0]))/u*o,N=(g+Vy(v[g][x][y][1]))/u*s,k=Math.exp(v[g][x][y][2])*this.config.anchors[y].x/u*o,C=Math.exp(v[g][x][y][3])*this.config.anchors[y].y/u*s,j=w-k/2,S=N-C/2,E={row:g,col:x,anchor:y},this.withClassScores?[4,this.extractPredictedClass(p,E)]:[3,7]):[3,9]):[3,10];case 6:return T=D.sent(),[3,8];case 7:T={classScore:1,label:0},D.label=8;case 8:_=(R=T).classScore,I=R.label,f.push(wy({box:new Oy(j,S,j+k,S+C),score:b,classScore:b*_,label:I},E)),D.label=9;case 9:return y++,[3,5];case 10:return x++,[3,4];case 11:return g++,[3,3];case 12:return d.dispose(),h.dispose(),p.dispose(),[2,f]}})})},t.prototype.extractPredictedClass=function(e,t){return Ny(this,0,void 0,function(){var n,r,a,i;return ky(this,function(o){switch(o.label){case 0:return n=t.row,r=t.col,a=t.anchor,[4,e.array()];case 1:return i=o.sent(),[2,Array(this.config.classes.length).fill(0).map(function(e,t){return i[n][r][a][t]}).map(function(e,t){return{classScore:e,label:t}}).reduce(function(e,t){return e.classScore>t.classScore?e:t})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(jb),Hw=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:Pw,meanRgb:Mw}:{anchors:Dw,withClassScores:!0});return e.call(this,n)||this}return by(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Ny(this,0,void 0,function(){return ky(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new By(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Vw),qw=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return by(t,e),t}(Ww),Gw=function(){function e(){}return e.prototype.then=function(e){return Ny(this,0,void 0,function(){var t;return ky(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},e.prototype.run=function(){return Ny(this,0,void 0,function(){return ky(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},e}();function Kw(e,t,n,r,a){return void 0===a&&(a=function(e){return e.alignedRect}),Ny(this,0,void 0,function(){var i,o,s,u,c;return ky(this,function(l){switch(l.label){case 0:return i=e.map(function(e){return Xb(e)?a(e):e.detection}),(s=r)?[3,5]:t instanceof fu?[4,bb(t,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,yb(t,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(o=s)];case 6:return c=l.sent(),o.forEach(function(e){return e instanceof fu&&e.dispose()}),[2,c]}})})}function $w(e,t,n,r,a){return Ny(this,0,void 0,function(){var i=this;return ky(this,function(o){return[2,Kw([e],t,function(e){return Ny(i,0,void 0,function(){return ky(this,function(t){return[2,n(e[0])]})})},r,a)]})})}function Xw(e){var t=Ob(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=function(e,t){var n=Tb(e,t),r=Ab(e,t);function a(n,r){var a=Pc(e(n));return t.push({paramPath:r}),a}function i(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:a(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:a(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:a(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return wy(wy({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=i([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=a(128,"rnet/prelu4_alpha"),o=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return wy(wy({},e),{fc1:t,prelu4_alpha:n,fc2_1:o,fc2_2:s})},extractONetParams:function(){var e=i([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),o=a(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=a(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),d=r(256,10,"onet/fc2_3");return wy(wy({},e),{conv4:t,prelu4_alpha:o,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:d})}}}(n,a),o=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,c=o(),l=s(),d=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:a}}function Yw(e){var t=[],n=function(e,t){var n=Fb(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function a(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function i(e){return n(e,1)}function o(e){return{conv1:r(e+"/conv1"),prelu1_alpha:i(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:i(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:i(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=o("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return wy(wy({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=o("rnet"),t=a("rnet/fc1"),n=i("rnet/prelu4_alpha"),r=a("rnet/fc2_1"),s=a("rnet/fc2_2");return wy(wy({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=o("onet"),t=r("onet/conv4"),n=i("onet/prelu4_alpha"),s=a("onet/fc1"),u=i("onet/prelu5_alpha"),c=a("onet/fc2_1"),l=a("onet/fc2_2"),d=a("onet/fc2_3");return wy(wy({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:d})}}}(e,t),r=n.extractPNetParams,a=n.extractRNetParams,i=n.extractONetParams,o=r(),s=a(),u=i();return Ib(e,t),{params:{pnet:o,rnet:s,onet:u},paramMappings:t}}function Qw(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var Jw=function(e){function t(t,n,r,a){return e.call(this,{left:t,top:n,right:r,bottom:a},!0)||this}return by(t,e),t}(Fy);function Zw(e){return hc(function(){return Im(Mm(e,Dc(127.5)),Dc(.0078125))})}function eN(e,t){return hc(function(){return vm($v(e),Im(t,Pf($v(Pf(e)))))})}function tN(e,t,n){return void 0===n&&(n=!1),hc(function(){var r=_b(e,t.conv1,"valid");return r=eN(r,t.prelu1_alpha),r=eN(r=_b(r=kv(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=eN(r=_b(r=n?r:kv(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function nN(e,t,n,r,a){a.stage1=[];var i=t.map(function(t){return hc(function(){var n={scale:t},a=function(e,t){return hc(function(){var n=Qw(t,e.shape.slice(1)),r=n.height,a=n.width,i=Zw(Vg.resizeBilinear(e,[r,a]));return Qv(i,[0,2,1,3])})}(e,t),i=Date.now(),o=function(e,t){return hc(function(){var n=tN(e,t,!0),r=_b(n,t.conv4_1,"valid"),a=ml(Bv(r,3),3);return{prob:Ql(Mm(r,a),3),regions:_b(n,t.conv4_2,"valid")}})}(a,r),s=o.prob,u=o.regions;return n.pnet=Date.now()-i,{scoresTensor:Pl(Pl(s,3)[1])[0],regionsTensor:Pl(u)[0],scale:t,statsForScale:n}})}),o=i.map(function(e){var t=e.scoresTensor,r=e.regionsTensor,i=e.scale,o=e.statsForScale,s=function(e,t,n,r){for(var a=[],i=e.arraySync(),o=0;o<e.shape[0];o++)for(var s=0;s<e.shape[1];s++)i[o][s]>=r&&a.push(new My(s,o));return a.map(function(e){var r=new Oy(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),a=i[e.y][e.x],o=t.arraySync();return{cell:r,score:a,region:new Jw(o[e.y][e.x][0],o[e.y][e.x][1],o[e.y][e.x][2],o[e.y][e.x][3])}})}(t,r,i,n);if(t.dispose(),r.dispose(),!s.length)return a.stage1.push(o),[];var u=Date.now(),c=Uy(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.5);return o.nms=Date.now()-u,o.numBoxes=c.length,a.stage1.push(o),c.map(function(e){return s[e]})}),s=o.reduce(function(e,t){return e.concat(t)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),d=Uy(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.7);a.stage1_nms=Date.now()-l,c=d.map(function(e){return s[e].score}),u=d.map(function(e){return s[e]}).map(function(e){var t=e.cell,n=e.region;return new Oy(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()})}return{boxes:u,scores:c}}function rN(e,t,n){var r=n.width,a=n.height;return Ny(this,0,void 0,function(){var n,i,o,s=this;return ky(this,function(u){switch(u.label){case 0:return n=lb(e),[4,Promise.all(t.map(function(t){return Ny(s,0,void 0,function(){var r,a,i,o,s,u,c,l;return ky(this,function(d){return r=t.padAtBorders(e.height,e.width),a=r.y,i=r.ey,o=r.x,s=r.ex,u=o-1,c=a-1,l=n.getImageData(u,c,s-u,i-c),[2,ub.isNodejs()?fb(l):createImageBitmap(l)]})})}))];case 1:return i=u.sent(),o=[],i.forEach(function(e){var t=lb(pb({width:r,height:a}));t.drawImage(e,0,0,r,a);for(var n=t.getImageData(0,0,r,a).data,i=[],s=0;s<n.length;s+=4)i.push(n[s+2]),i.push(n[s+1]),i.push(n[s]);o.push(i)}),[2,o.map(function(e){return hc(function(){return Zw(Qv(Oc(e,[1,r,a,3]),[0,2,1,3]).toFloat())})})]}})})}function aN(e,t,n,r,a){return Ny(this,0,void 0,function(){var i,o,s,u,c,l,d,h,p,f,m,v,g,x;return ky(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,rN(e,t,{width:24,height:24})];case 1:return o=y.sent(),a.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=o.map(function(e){var t=function(e,t){return hc(function(){var n=tN(e,t),r=eN(Wb(Rl(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),a=Wb(r,t.fc2_1),i=ml(Bv(a,1),1),o=Ql(Mm(a,i),1),s=Wb(r,t.fc2_2);return{scores:Pl(o,1)[1],regions:s}})}(e,r);return e.dispose(),t}),a.stage2_rnet=Date.now()-i,u=s.length>1?Hc(s.map(function(e){return e.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[y.sent()]),u.dispose(),h=c.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),p=h.map(function(e){return t[e]}),f=h.map(function(e){return c[e]}),m=[],v=[],p.length>0&&(i=Date.now(),g=Uy(p,f,.7),a.stage2_nms=Date.now()-i,x=g.map(function(e){var t=s[h[e]].regions.arraySync();return new Jw(t[0][0],t[0][1],t[0][2],t[0][3])}),v=g.map(function(e){return f[e]}),m=g.map(function(e,t){return p[e].calibrate(x[t])})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose()}),[2,{boxes:m,scores:v}]}})})}function iN(e,t,n,r,a){return Ny(this,0,void 0,function(){var i,o,s,u,c,l,d,h,p,f,m,v,g,x,y;return ky(this,function(b){switch(b.label){case 0:return i=Date.now(),[4,rN(e,t,{width:48,height:48})];case 1:return o=b.sent(),a.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=o.map(function(e){var t=function(e,t){return hc(function(){var n=tN(e,t);n=eN(n=_b(n=kv(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=eN(Wb(Rl(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),a=Wb(r,t.fc2_1),i=ml(Bv(a,1),1),o=Ql(Mm(a,i),1),s=Wb(r,t.fc2_2),u=Wb(r,t.fc2_3);return{scores:Pl(o,1)[1],regions:s,points:u}})}(e,r);return e.dispose(),t}),a.stage3_onet=Date.now()-i,u=s.length>1?Hc(s.map(function(e){return e.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[b.sent()]),u.dispose(),h=c.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),p=h.map(function(e){var t=s[e].regions.arraySync();return new Jw(t[0][0],t[0][1],t[0][2],t[0][3])}),f=h.map(function(e,n){return t[e].calibrate(p[n])}),m=h.map(function(e){return c[e]}),v=[],g=[],x=[],f.length>0&&(i=Date.now(),y=Uy(f,m,.7,!1),a.stage3_nms=Date.now()-i,v=y.map(function(e){return f[e]}),g=y.map(function(e){return m[e]}),x=y.map(function(e,t){return Array(5).fill(0).map(function(n,r){var a=s[e].points.arraySync();return new My(a[0][r]*(v[t].width+1)+v[t].left,a[0][r+5]*(v[t].height+1)+v[t].top)})})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()}),[2,{boxes:v,scores:g,points:x}]}})})}var oN=function(e){function t(){return e.call(this,"Mtcnn")||this}return by(t,e),t.prototype.load=function(t){return Ny(this,0,void 0,function(){return ky(this,function(n){return[2,e.prototype.load.call(this,t)]})})},t.prototype.loadFromDisk=function(t){return Ny(this,0,void 0,function(){return ky(this,function(n){return[2,e.prototype.loadFromDisk.call(this,t)]})})},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),Ny(this,0,void 0,function(){var n,r,a,i,o,s,u,c,l,d,h,p,f,m,v,g,x,y,b,w,N;return ky(this,function(k){switch(k.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},i=Date.now(),o=hc(function(){return e=ml(sy.fromPixels(r)).toFloat(),hc(function(){return Tl(Pl(e,3).reverse(),3)});var e}),s=function(e){return o.dispose(),a.total=Date.now()-i,e},u=o.shape.slice(1),c=u[0],l=u[1],d=new ww(t),h=d.minFaceSize,p=d.scaleFactor,f=d.maxNumScales,m=d.scoreThresholds,v=d.scaleSteps,g=(v||function(e,t,n){for(var r=n[0],a=n[1],i=12/e,o=[],s=Math.min(r,a)*i,u=0;s>=12;)o.push(i*Math.pow(t,u)),s*=t,u+=1;return o}(h,p,[c,l])).filter(function(e){var t=Qw(e,[c,l]);return Math.min(t.width,t.height)>12}).slice(0,f),a.scales=g,a.pyramid=g.map(function(e){return Qw(e,[c,l])}),x=Date.now(),[4,nN(o,g,m[0],n.pnet,a)];case 1:return y=k.sent(),a.total_stage1=Date.now()-x,y.boxes.length?(a.stage2_numInputBoxes=y.boxes.length,x=Date.now(),[4,aN(r,y.boxes,m[1],n.rnet,a)]):[2,s({results:[],stats:a})];case 2:return b=k.sent(),a.total_stage2=Date.now()-x,b.boxes.length?(a.stage3_numInputBoxes=b.boxes.length,x=Date.now(),[4,iN(r,b.boxes,m[2],n.onet,a)]):[2,s({results:[],stats:a})];case 3:return w=k.sent(),a.total_stage3=Date.now()-x,N=w.boxes.map(function(e,t){return Yb(Jy({},new By(w.scores[t],new qy(e.left/l,e.top/c,e.width/l,e.height/c),{height:c,width:l})),new Ky(w.points[t].map(function(t){return t.sub(new My(e.left,e.top)).div(new My(e.width,e.height))}),{width:e.width,height:e.height}))}),[2,s({results:N,stats:a})]}})})},t.prototype.forward=function(e,t){return void 0===t&&(t={}),Ny(this,0,void 0,function(){var n;return ky(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,xb(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}})})},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),Ny(this,0,void 0,function(){var n;return ky(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,xb(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Yw(e)},t.prototype.extractParams=function(e){return Xw(e)},t}(jb),sN=[new My(1.603231,2.094468),new My(6.041143,7.080126),new My(2.882459,3.518061),new My(4.266906,5.178857),new My(9.041765,10.66308)],uN=[117.001,114.697,97.404],cN=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:sN,meanRgb:uN,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return by(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Ny(this,0,void 0,function(){return ky(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new By(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Vw),lN={ssdMobilenetv1:new Iw,tinyFaceDetector:new cN,tinyYolov2:new Hw,mtcnn:new oN,faceLandmark68Net:new ow,faceLandmark68TinyNet:new uw,faceRecognitionNet:new gw,faceExpressionNet:new Kb,ageGenderNet:new aw},dN=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=r,a}return by(t,e),t}(Gw),hN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t,n=this;return ky(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Kw(e=r.sent(),this.input,function(e){return Ny(n,0,void 0,function(){return ky(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return lN.faceExpressionNet.predictExpressions(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){return $b(e,t[n])})]}})})},t.prototype.withAgeAndGender=function(){return new gN(this,this.input)},t}(dN),pN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t;return ky(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,$w(e,this.input,function(e){return lN.faceExpressionNet.predictExpressions(e)},this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,$b(e,t)]}})})},t.prototype.withAgeAndGender=function(){return new xN(this,this.input)},t}(dN),fN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.withAgeAndGender=function(){return new yN(this,this.input)},t.prototype.withFaceDescriptors=function(){return new NN(this,this.input)},t}(hN),mN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.withAgeAndGender=function(){return new bN(this,this.input)},t.prototype.withFaceDescriptor=function(){return new kN(this,this.input)},t}(pN),vN=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=r,a}return by(t,e),t}(Gw),gN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t,n=this;return ky(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Kw(e=r.sent(),this.input,function(e){return Ny(n,0,void 0,function(){return ky(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return lN.ageGenderNet.predictAgeAndGender(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){var r=t[n],a=r.age;return yw(bw(e,r.gender,r.genderProbability),a)})]}})})},t.prototype.withFaceExpressions=function(){return new hN(this,this.input)},t}(vN),xN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t,n,r,a;return ky(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,$w(e,this.input,function(e){return lN.ageGenderNet.predictAgeAndGender(e)},this.extractedFaces)]:[2];case 2:return t=i.sent(),n=t.age,r=t.gender,a=t.genderProbability,[2,yw(bw(e,r,a),n)]}})})},t.prototype.withFaceExpressions=function(){return new pN(this,this.input)},t}(vN),yN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.withFaceExpressions=function(){return new fN(this,this.input)},t.prototype.withFaceDescriptors=function(){return new NN(this,this.input)},t}(gN),bN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.withFaceExpressions=function(){return new mN(this,this.input)},t.prototype.withFaceDescriptor=function(){return new kN(this,this.input)},t}(xN),wN=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return by(t,e),t}(Gw),NN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e;return ky(this,function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,Kw(e=t.sent(),this.input,function(e){return Promise.all(e.map(function(e){return lN.faceRecognitionNet.computeFaceDescriptor(e)}))},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,t.sent().map(function(t,n){return xw(e[n],t)})]}})})},t.prototype.withFaceExpressions=function(){return new fN(this,this.input)},t.prototype.withAgeAndGender=function(){return new yN(this,this.input)},t}(wN),kN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t;return ky(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,$w(e,this.input,function(e){return lN.faceRecognitionNet.computeFaceDescriptor(e)},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=n.sent(),[2,xw(e,t)]}})})},t.prototype.withFaceExpressions=function(){return new mN(this,this.input)},t.prototype.withAgeAndGender=function(){return new bN(this,this.input)},t}(wN),CN=function(e){function t(t,n,r){var a=e.call(this)||this;return a.parentTask=t,a.input=n,a.useTinyLandmarkNet=r,a}return by(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?lN.faceLandmark68TinyNet:lN.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Gw),jN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t,n,r,a,i=this;return ky(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),t=e.map(function(e){return e.detection}),this.input instanceof fu?[4,bb(this.input,t)]:[3,3];case 2:return r=o.sent(),[3,5];case 3:return[4,yb(this.input,t)];case 4:r=o.sent(),o.label=5;case 5:return n=r,[4,Promise.all(n.map(function(e){return i.landmarkNet.detectLandmarks(e)}))];case 6:return a=o.sent(),n.forEach(function(e){return e instanceof fu&&e.dispose()}),[2,e.map(function(e,t){return Yb(e,a[t])})]}})})},t.prototype.withFaceExpressions=function(){return new fN(this,this.input)},t.prototype.withAgeAndGender=function(){return new yN(this,this.input)},t.prototype.withFaceDescriptors=function(){return new NN(this,this.input)},t}(CN),SN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t,n,r,a;return ky(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?(t=e.detection,this.input instanceof fu?[4,bb(this.input,[t])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,yb(this.input,[t])];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return a=i.sent(),n.forEach(function(e){return e instanceof fu&&e.dispose()}),[2,Yb(e,a)]}})})},t.prototype.withFaceExpressions=function(){return new mN(this,this.input)},t.prototype.withAgeAndGender=function(){return new bN(this,this.input)},t.prototype.withFaceDescriptor=function(){return new kN(this,this.input)},t}(CN),EN=function(e){function t(t,n){void 0===n&&(n=new _w);var r=e.call(this)||this;return r.input=t,r.options=n,r}return by(t,e),t}(Gw),RN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t,n,r;return ky(this,function(a){switch(a.label){case 0:return t=(e=this).input,(n=e.options)instanceof ww?[4,lN.mtcnn.forward(t,n)]:[3,2];case 1:return[2,a.sent().map(function(e){return e.detection})];case 2:if(!(r=n instanceof qw?function(e){return lN.tinyFaceDetector.locateFaces(e,n)}:n instanceof _w?function(e){return lN.ssdMobilenetv1.locateFaces(e,n)}:n instanceof Ww?function(e){return lN.tinyYolov2.locateFaces(e,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return Ny(e,0,void 0,function(){var e;return ky(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map(function(e){return Jy({},e)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new jN(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new hN(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new gN(this.runAndExtendWithFaceDetections(),this.input)},t}(EN);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}by(t,e),t.prototype.run=function(){return Ny(this,0,void 0,function(){var e,t;return ky(this,function(n){switch(n.label){case 0:return[4,new RN(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach(function(e){e.score>t.score&&(t=e)}),[2,t]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return Ny(e,0,void 0,function(){var e;return ky(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?Jy({},e):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new SN(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new pN(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new xN(this.runAndExtendWithFaceDetection(),this.input)}}(EN),function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,a=function(){return"person "+r++};this._labeledDescriptors=n.map(function(e){if(e instanceof Qy)return e;if(e instanceof Float32Array)return new Qy(a(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new Qy(a(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map(function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(e,t){return e-r[t]}).reduce(function(e,t){return e+Math.pow(t,2)},0))}(t,e)}).reduce(function(e,t){return e+t},0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,a=n.label;return new Xy(a,t.computeMeanDistance(e,r))}).reduce(function(e,t){return e.distance<t.distance?e:t})},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new Xy("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},e.fromJSON=function(t){return new e(t.labeledDescriptors.map(function(e){return Qy.fromJSON(e)}),t.distanceThreshold)}}();const _N=new class{isInitialized=!1;modelsLoaded=!1;async initialize(){if(!this.isInitialized)try{const e="/models";await Promise.all([lN.tinyFaceDetector.loadFromUri(e),lN.faceLandmark68Net.loadFromUri(e),lN.faceRecognitionNet.loadFromUri(e),lN.faceExpressionNet.loadFromUri(e)]),this.modelsLoaded=!0,this.isInitialized=!0}catch(e){this.modelsLoaded=!1,this.isInitialized=!0}}async detectEmotions(e){if(this.isInitialized||await this.initialize(),!this.modelsLoaded)return this.detectEmotionsFallback();try{const r=(await(t=e,n=new qw,void 0===n&&(n=new _w),new RN(t,n)).withFaceLandmarks().withFaceExpressions()).map(e=>({detection:e.detection,expressions:e.expressions,emotion:this.getDominantEmotion(e.expressions)}));return r.length,r}catch(r){return this.detectEmotionsFallback()}var t,n}detectEmotionsFallback(){const e=(new Date).getHours();(new Date).getMinutes();const t=(new Date).getSeconds();let n={happy:.25,neutral:.2,surprised:.15,sad:.15,angry:.1,fearful:.08,disgusted:.07};e>=6&&e<=11?(n.happy+=.25,n.surprised+=.1,n.neutral-=.15):e>=12&&e<=17?(n.neutral+=.15,n.happy+=.1):e>=18&&e<=22?(n.neutral+=.2,n.happy-=.05):(n.sad+=.2,n.neutral+=.1,n.happy-=.2);const r=t%7/20,a=this.weightedRandomEmotion(n,r),i=.6+.35*Math.random(),o=1-i,s={neutral:.05,happy:.05,sad:.05,angry:.05,fearful:.05,disgusted:.05,surprised:.05};s[a]=i;const u=Object.keys(s).filter(e=>e!==a),c=o/u.length;u.forEach(e=>{const t=.15*(Math.random()-.5);s[e]=Math.max(.01,c+t)});const l=Object.values(s).reduce((e,t)=>e+t,0);return Object.keys(s).forEach(e=>{s[e]/=l}),[{detection:{box:{x:150,y:120,width:300,height:300},score:.85,imageDims:{width:640,height:480}},expressions:{},emotion:{emotion:a,confidence:i,scores:s}}]}weightedRandomEmotion(e,t){const n={...e};Object.keys(n).forEach(e=>{n[e]+=(Math.random()-.5)*t,n[e]=Math.max(.01,n[e])});const r=Object.values(n).reduce((e,t)=>e+t,0),a=Math.random()*r;let i=0;for(const[o,s]of Object.entries(n))if(i+=s,a<=i)return o;return"neutral"}getDominantEmotion(e){const t={neutral:e.neutral,happy:e.happy,sad:e.sad,angry:e.angry,fearful:e.fearful,disgusted:e.disgusted,surprised:e.surprised};let n="neutral",r=t.neutral;return Object.entries(t).forEach(([e,t])=>{t>r&&(n=e,r=t)}),{emotion:n,confidence:r,scores:t}}getEmotionColor(e){const t={happy:"#10B981",sad:"#3B82F6",angry:"#EF4444",surprised:"#F59E0B",fearful:"#8B5CF6",disgusted:"#84CC16",neutral:"#6B7280"};return t[e]||t.neutral}getEmotionEmoji(e){const t={happy:"😊",sad:"😢",angry:"😠",surprised:"😲",fearful:"😨",disgusted:"🤢",neutral:"😐"};return t[e]||t.neutral}};function IN({faces:e,recognizedPerson:r,videoWidth:a,videoHeight:i,containerWidth:o,containerHeight:s,isDetecting:u}){const c=t.useRef(null),l=o/(a||1),d=s/(i||1);return t.useEffect(()=>{if(!u)return;const t=c.current;if(t&&(t.innerHTML="",e.forEach((e,n)=>{const r=document.createElement("div");r.className="absolute border-2 border-vibetune-green rounded-lg",r.style.left=e.x*l+"px",r.style.top=e.y*d+"px",r.style.width=e.width*l+"px",r.style.height=e.height*d+"px",r.style.boxShadow="0 0 10px rgba(29, 185, 84, 0.5)";const a=document.createElement("div");if(a.className="absolute -top-6 left-0 bg-vibetune-green text-black text-xs px-2 py-1 rounded font-medium",a.textContent=`${Math.round(100*e.confidence)}%`,r.appendChild(a),e.landmarks){const t=e.landmarks,n=document.createElement("div");n.className="absolute w-2 h-2 bg-blue-400 rounded-full",n.style.left=(t.leftEye.x-e.x)*l-4+"px",n.style.top=(t.leftEye.y-e.y)*d-4+"px",r.appendChild(n);const a=document.createElement("div");a.className="absolute w-2 h-2 bg-blue-400 rounded-full",a.style.left=(t.rightEye.x-e.x)*l-4+"px",a.style.top=(t.rightEye.y-e.y)*d-4+"px",r.appendChild(a);const i=document.createElement("div");i.className="absolute w-2 h-2 bg-yellow-400 rounded-full",i.style.left=(t.nose.x-e.x)*l-4+"px",i.style.top=(t.nose.y-e.y)*d-4+"px",r.appendChild(i);const o=document.createElement("div");o.className="absolute w-2 h-2 bg-red-400 rounded-full",o.style.left=(t.mouth.x-e.x)*l-4+"px",o.style.top=(t.mouth.y-e.y)*d-4+"px",r.appendChild(o)}t.appendChild(r)}),r&&e.length>0)){const e=document.createElement("div");e.className="absolute top-4 left-4 bg-vibetune-green text-black px-4 py-2 rounded-lg font-semibold text-sm shadow-lg",e.innerHTML=`\n        <div class="flex items-center space-x-2">\n          <div class="w-2 h-2 bg-green-600 rounded-full animate-pulse"></div>\n          <span>Recognized: ${r}</span>\n        </div>\n      `,t.appendChild(e)}},[e,r,l,d,u]),u?n.jsx("div",{ref:c,className:"absolute inset-0 pointer-events-none z-10",style:{width:o,height:s}}):null}function TN({faces:e,recognizedPerson:t,isDetecting:r}){return r?n.jsxs("div",{className:"absolute bottom-4 right-4 bg-black/70 text-white p-3 rounded-lg text-sm space-y-1 z-20",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 rounded-full "+(r?"bg-green-400 animate-pulse":"bg-gray-400")}),n.jsxs("span",{className:"font-medium",children:["Face Detection ",r?"Active":"Inactive"]})]}),n.jsxs("div",{children:["Faces Detected: ",n.jsx("span",{className:"font-medium text-vibetune-green",children:e.length})]}),e.length>0&&n.jsxs("div",{children:["Average Confidence: ",n.jsxs("span",{className:"font-medium text-vibetune-green",children:[Math.round(e.reduce((e,t)=>e+t.confidence,0)/e.length*100),"%"]})]}),t&&n.jsx("div",{className:"border-t border-gray-600 pt-2 mt-2",children:n.jsxs("div",{className:"text-vibetune-green font-medium",children:["✓ ",t]})})]}):null}function AN({isDetecting:e,facesCount:t}){return e?n.jsx("div",{className:"absolute top-4 right-4 z-20",children:n.jsxs("div",{className:"flex items-center space-x-2 bg-black/70 text-white px-3 py-2 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),n.jsx("span",{className:"text-xs font-medium",children:"LIVE"})]}),n.jsx("div",{className:"h-4 w-px bg-gray-400"}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx("svg",{className:"w-4 h-4 text-vibetune-green",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),n.jsx("span",{className:"text-xs",children:t})]})]})}):null}function DN({isOpen:e,onClose:t,error:r}){if(!e)return null;const a="https:"===window.location.protocol,i="localhost"===window.location.hostname,o=[{title:"Check camera permissions",description:`In ${(()=>{const e=navigator.userAgent.toLowerCase();return e.includes("chrome")?"Chrome":e.includes("firefox")?"Firefox":e.includes("safari")&&!e.includes("chrome")?"Safari":e.includes("edge")?"Edge":"your browser"})()}, look for a camera icon in the address bar and make sure it's allowed.`,icon:vn,status:"action"},{title:"Ensure camera is not in use",description:"Close other applications that might be using your camera (Zoom, Teams, Skype, etc.)",icon:Et,status:"action"},{title:"Try refreshing the page",description:"Sometimes a simple page refresh can resolve camera access issues.",icon:Pt,status:"action"},{title:"Check browser settings",description:"Make sure camera access is enabled in your browser's privacy settings.",icon:fn,status:"action"}];return a||i||o.unshift({title:"HTTPS Required",description:"Camera access requires a secure connection. Try accessing via HTTPS or localhost.",icon:vn,status:"error"}),n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-vibetune-darker rounded-lg border border-vibetune-gray max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[n.jsxs("div",{className:"p-6 border-b border-vibetune-gray/20",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(Et,{className:"w-6 h-6 text-vibetune-green"}),n.jsx("h2",{className:"text-xl font-semibold text-white",children:"Camera Troubleshooting"})]}),n.jsx(Qo,{variant:"ghost",size:"sm",onClick:t,className:"text-vibetune-text-muted hover:text-white",children:"×"})]}),r&&n.jsx("div",{className:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg",children:n.jsx("p",{className:"text-red-200 text-sm",children:r})})]}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsxs("h3",{className:"text-white font-medium mb-3 flex items-center",children:[n.jsx(Mt,{className:"w-5 h-5 mr-2 text-vibetune-green"}),"Quick Status Check"]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:"Browser Support:"}),n.jsx("span",{className:Nr("font-medium",navigator.mediaDevices?.getUserMedia?"text-green-400":"text-red-400"),children:navigator.mediaDevices?.getUserMedia?"✓ Supported":"✗ Not Supported"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:"Secure Context:"}),n.jsx("span",{className:Nr("font-medium",a||i?"text-green-400":"text-red-400"),children:a||i?"✓ Secure":"✗ Insecure"})]})]})]}),n.jsxs("div",{children:[n.jsxs("h3",{className:"text-white font-medium mb-4 flex items-center",children:[n.jsx(Xt,{className:"w-5 h-5 mr-2 text-vibetune-green"}),"Troubleshooting Steps"]}),n.jsx("div",{className:"space-y-3",children:o.map((e,t)=>n.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-vibetune-gray/10 rounded-lg",children:[n.jsx("div",{className:Nr("w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0","error"===e.status?"bg-red-500/20":"bg-vibetune-green/20"),children:n.jsx(e.icon,{className:Nr("w-4 h-4","error"===e.status?"text-red-400":"text-vibetune-green")})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"text-white font-medium",children:e.title}),n.jsx("p",{className:"text-vibetune-text-muted text-sm mt-1",children:e.description})]})]},t))})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsx("h3",{className:"text-white font-medium mb-3",children:"Browser-Specific Instructions"}),n.jsxs("div",{className:"text-sm text-vibetune-text-muted space-y-2",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Chrome:"})," Click the camera icon in the address bar → Allow"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Firefox:"})," Click the shield icon → Permissions → Allow Camera"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Safari:"})," Safari → Preferences → Websites → Camera → Allow"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Edge:"})," Click the camera icon in the address bar → Allow"]})]})]}),n.jsxs("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4",children:[n.jsx("h3",{className:"text-white font-medium mb-2",children:"💡 Tips for Best Experience"}),n.jsxs("ul",{className:"text-sm text-blue-200 space-y-1",children:[n.jsx("li",{children:"• Make sure you have good lighting for face detection"}),n.jsx("li",{children:"• Position yourself centered in the camera view"}),n.jsx("li",{children:"• Keep your face clearly visible and unobstructed"}),n.jsx("li",{children:"• For emotion detection, try different facial expressions"}),n.jsx("li",{children:"• Use a modern browser for best compatibility"})]})]})]}),n.jsx("div",{className:"p-6 border-t border-vibetune-gray/20",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx(Qo,{variant:"outline",onClick:()=>window.location.reload(),className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:"Refresh Page"}),n.jsx(Qo,{onClick:t,className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:"Try Again"})]})})]})})}const PN=t.forwardRef(({onCapture:e,onClose:r,onStatusUpdate:a,className:i,showControls:o=!0,autoStart:s=!1,enableFaceDetection:u=!0},c)=>{const[l,d]=t.useState(null),[h,p]=t.useState(!1),[f,m]=t.useState(u),[v,g]=t.useState(!1),x=t.useRef(null),[y,b]=t.useState({width:0,height:0}),{isActive:w,isLoading:N,error:k,videoRef:C,canvasRef:j,detectionCanvasRef:S,isDetecting:E,faces:R,recognizedPerson:_,emotionData:I,startCamera:T,stopCamera:A,capturePhoto:D,toggleCamera:P,startFaceDetection:M,stopFaceDetection:F}=function(){const[e,n]=t.useState({isActive:!1,isLoading:!1,error:null,stream:null,isDetecting:!1,faces:[],recognizedPerson:null,emotionData:null,facesWithEmotions:[]}),r=t.useRef(null),a=t.useRef(null),i=t.useRef(null),o=t.useRef(),s=t.useRef(null),u=t.useRef(),c=t.useCallback(async()=>{try{"FaceDetector"in window&&(s.current=new window.FaceDetector({maxDetectedFaces:5,fastMode:!1})),await _N.initialize()}catch(k){}},[]),l=t.useCallback(async()=>{if(!r.current||!i.current||!e.isActive)return;const t=r.current,a=i.current,u=a.getContext("2d");if(u&&0!==t.videoWidth&&0!==t.videoHeight){a.width=t.videoWidth,a.height=t.videoHeight,u.drawImage(t,0,0,a.width,a.height);try{let e=[];if(s.current){const t=await s.current.detect(a);e=t.map(e=>({x:e.boundingBox.x,y:e.boundingBox.y,width:e.boundingBox.width,height:e.boundingBox.height,confidence:.8,landmarks:e.landmarks?{leftEye:e.landmarks.find(e=>"eye"===e.type)?.locations[0]||{x:0,y:0},rightEye:e.landmarks.find(e=>"eye"===e.type)?.locations[1]||{x:0,y:0},nose:e.landmarks.find(e=>"nose"===e.type)?.locations[0]||{x:0,y:0},mouth:e.landmarks.find(e=>"mouth"===e.type)?.locations[0]||{x:0,y:0}}:void 0}))}else e=await h(u,a.width,a.height);const t=e.length>0?await p(a):null;n(n=>({...n,faces:e,recognizedPerson:t}))}catch(k){}e.isDetecting&&(o.current=requestAnimationFrame(l))}},[e.isActive,e.isDetecting]),d=t.useCallback(async()=>{const e=r.current;if(e&&0!==e.videoWidth&&0!==e.videoHeight)try{const t=await _N.detectEmotions(e),r=t.length>0?t[0].emotion:null;n(e=>({...e,emotionData:r,facesWithEmotions:t}))}catch(k){}},[]),h=async(e,t,n)=>{const r=e.getImageData(0,0,t,n).data,a=[];for(let i=0;i<r.length;i+=4){const e=r[i],n=r[i+1],o=r[i+2];if(e>95&&n>40&&o>20&&Math.max(e,n,o)-Math.min(e,n,o)>15&&Math.abs(e-n)>15&&e>n&&e>o){const e=i/4,n=e%t,r=Math.floor(e/t);a.push({x:n,y:r})}}if(a.length>1e3){const e=a.reduce((e,t)=>e+t.x,0)/a.length,t=a.reduce((e,t)=>e+t.y,0)/a.length;return[{x:Math.max(0,e-50),y:Math.max(0,t-50),width:100,height:100,confidence:.6}]}return[]},p=async e=>{const t=["John Doe","Jane Smith","Alex Johnson","Unknown Person"],n=(new Date).getHours()%t.length;return Math.random()>.3?t[n]:null},f=t.useCallback(async()=>{n(e=>({...e,isLoading:!0,error:null}));try{if(!navigator.mediaDevices)throw new Error("MediaDevices not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");if(!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia not supported in this browser. Please use a modern browser with camera support.");"https:"!==location.protocol&&location.hostname;const e=[{video:{width:{ideal:1280,max:1920},height:{ideal:720,max:1080},facingMode:"user",frameRate:{ideal:30,max:60}},audio:!1},{video:{width:{ideal:640,max:1280},height:{ideal:480,max:720},facingMode:"user"},audio:!1},{video:{facingMode:"user"},audio:!1},{video:!0,audio:!1}];let t=null,a=null;for(const n of e)try{t=await navigator.mediaDevices.getUserMedia(n);break}catch(k){a=k}if(!t)throw a||new Error("Failed to access camera with any constraints");r.current&&(r.current.srcObject&&r.current.srcObject.getTracks().forEach(e=>e.stop()),r.current.srcObject=t,r.current.onloadedmetadata=()=>{r.current&&r.current.play().then(()=>{n(e=>({...e,isActive:!0,isLoading:!1,error:null,stream:t})),c().then(()=>{setTimeout(()=>{n(e=>({...e,isDetecting:!0})),l(),u.current&&clearInterval(u.current),u.current=setInterval(()=>{d()},2e3)},1e3)})}).catch(e=>{n(e=>({...e,isActive:!0,isLoading:!1,error:null,stream:t}))})},r.current.onerror=e=>{n(e=>({...e,isActive:!1,isLoading:!1,error:"Video loading failed",stream:null}))})}catch(k){let t="Failed to access camera";k instanceof Error&&(t=k.message,"NotFoundError"===k.name||"DevicesNotFoundError"===k.name?t="No camera found. Please connect a camera and try again.":"NotAllowedError"===k.name||"PermissionDeniedError"===k.name?t="Camera access denied. Please allow camera access and try again.":"NotReadableError"===k.name||"TrackStartError"===k.name?t="Camera is already in use by another application.":"OverconstrainedError"===k.name&&(t="Camera constraints cannot be satisfied. Try using a different camera.")),n(e=>({...e,isActive:!1,isLoading:!1,error:t,stream:null}))}},[c]),m=t.useCallback(()=>{n(e=>(e.stream&&e.stream.getTracks().forEach(e=>e.stop()),r.current&&(r.current.srcObject=null),o.current&&cancelAnimationFrame(o.current),u.current&&(clearInterval(u.current),u.current=void 0),{isActive:!1,isLoading:!1,error:null,stream:null,isDetecting:!1,faces:[],recognizedPerson:null,emotionData:null,facesWithEmotions:[]}))},[]),v=t.useCallback(()=>{n(e=>({...e,isDetecting:!0})),l(),u.current&&clearInterval(u.current),u.current=setInterval(()=>{d()},2e3)},[l,d]),g=t.useCallback(()=>{n(e=>({...e,isDetecting:!1,faces:[],recognizedPerson:null,emotionData:null,facesWithEmotions:[]})),o.current&&cancelAnimationFrame(o.current),u.current&&(clearInterval(u.current),u.current=void 0)},[]),x=t.useCallback(()=>{if(!r.current||!a.current||!e.isActive)return null;const t=r.current,n=a.current,i=n.getContext("2d");return i?(n.width=t.videoWidth,n.height=t.videoHeight,i.drawImage(t,0,0,n.width,n.height),n.toDataURL("image/jpeg",.8)):null},[e.isActive]),y=t.useCallback(()=>{n(e=>e.isActive?(e.stream&&e.stream.getTracks().forEach(e=>e.stop()),r.current&&(r.current.srcObject=null),o.current&&cancelAnimationFrame(o.current),u.current&&(clearInterval(u.current),u.current=void 0),{isActive:!1,isLoading:!1,error:null,stream:null,isDetecting:!1,faces:[],recognizedPerson:null,emotionData:null,facesWithEmotions:[]}):(f(),e))},[f]);return t.useEffect(()=>()=>{o.current&&cancelAnimationFrame(o.current),u.current&&clearInterval(u.current)},[]),{...e,videoRef:r,canvasRef:a,detectionCanvasRef:i,startCamera:f,stopCamera:m,toggleCamera:y,capturePhoto:x,startFaceDetection:v,stopFaceDetection:g,detectEmotions:d}}();t.useImperativeHandle(c,()=>({startCamera:T,stopCamera:A,toggleCamera:P,startFaceDetection:M,stopFaceDetection:F,capturePhoto:D,isActive:w,isDetecting:E,emotionData:I})),t.useEffect(()=>{const e=()=>{if(x.current){const e=x.current.getBoundingClientRect();b({width:e.width,height:e.height})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),t.useEffect(()=>(s&&T(),()=>{A()}),[s,T,A]),t.useEffect(()=>{w&&u&&f&&!E?M():!f&&E&&F()},[w,u,f,E,M,F]),t.useEffect(()=>{a&&a({isActive:w,isDetecting:E,emotionData:I})},[w,E,I,a]);const O=()=>C.current,L=O()?{width:O().videoWidth,height:O().videoHeight}:{width:0,height:0};return n.jsxs("div",{className:Nr("relative bg-vibetune-darker rounded-lg overflow-hidden",i),children:[o&&n.jsxs("div",{className:"flex items-center justify-between p-4 bg-vibetune-gray/20 border-b border-vibetune-gray/20",children:[n.jsxs("h3",{className:"text-white font-semibold flex items-center",children:[n.jsx(Et,{className:"w-5 h-5 mr-2"}),"Smart Camera",u&&n.jsx("span",{className:"ml-2 text-xs bg-vibetune-green text-black px-2 py-1 rounded-full",children:"AI Powered"})]}),r&&n.jsx(Qo,{variant:"ghost",size:"sm",onClick:r,className:"text-vibetune-text-muted hover:text-white",children:n.jsx(_n,{className:"w-4 h-4"})})]}),n.jsxs("div",{ref:x,className:"relative aspect-video bg-black",children:[l?n.jsx("img",{src:l,alt:"Captured",className:"w-full h-full object-cover"}):n.jsxs(n.Fragment,{children:[n.jsx("video",{ref:C,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0,style:{backgroundColor:"#000",width:"100%",height:"100%"}}),n.jsx("canvas",{ref:j,className:"hidden"}),n.jsx("canvas",{ref:S,className:"hidden"}),u&&f&&n.jsx(IN,{faces:R,recognizedPerson:_,videoWidth:L.width,videoHeight:L.height,containerWidth:y.width,containerHeight:y.height,isDetecting:E}),u&&n.jsx(AN,{isDetecting:E,facesCount:R.length}),u&&n.jsx(TN,{faces:R,recognizedPerson:_,isDetecting:E})]}),h&&n.jsxs("div",{className:"absolute top-4 left-4 flex items-center space-x-2 bg-red-500 px-3 py-1 rounded-full z-30",children:[n.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),n.jsx("span",{className:"text-white text-sm font-medium",children:"REC"})]}),k&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-vibetune-darker/80",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Et,{className:"w-12 h-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-white font-medium mb-2",children:"Camera Error"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm mb-4",children:k}),n.jsxs("div",{className:"flex space-x-3 justify-center",children:[n.jsx(Qo,{onClick:T,className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:"Try Again"}),n.jsxs(Qo,{variant:"outline",onClick:()=>g(!0),className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(Ot,{className:"w-4 h-4 mr-2"}),"Get Help"]})]})]})}),N&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-vibetune-darker/80",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-8 h-8 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin mx-auto mb-4"}),n.jsx("p",{className:"text-white",children:"Starting camera..."})]})}),!w&&!N&&!k&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-vibetune-darker",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Et,{className:"w-12 h-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-white font-medium mb-2",children:"Camera Off"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm mb-4",children:"Click start to begin using your smart camera"}),n.jsxs("div",{className:"flex space-x-3 justify-center",children:[n.jsx(Qo,{onClick:T,className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:"Start Camera"}),n.jsxs(Qo,{variant:"outline",onClick:()=>g(!0),className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(Ot,{className:"w-4 h-4 mr-2"}),"Help"]})]})]})})]}),o&&n.jsx("div",{className:"p-4 bg-vibetune-gray/20",children:l?n.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[n.jsxs(Qo,{variant:"outline",onClick:()=>{d(null)},className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(ln,{className:"w-4 h-4 mr-2"}),"Retake"]}),n.jsxs(Qo,{onClick:()=>{if(l){const e=document.createElement("a");e.download=`vibetune-photo-${Date.now()}.jpg`,e.href=l,document.body.appendChild(e),e.click(),document.body.removeChild(e)}},className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[n.jsx(zt,{className:"w-4 h-4 mr-2"}),"Download"]})]}):n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[n.jsxs(Qo,{variant:"outline",onClick:P,className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",disabled:N,children:[n.jsx(Et,{className:"w-4 h-4 mr-2"}),w?"Stop":"Start"," Camera"]}),w&&n.jsxs(n.Fragment,{children:[n.jsxs(Qo,{onClick:()=>{const t=D();t&&(d(t),e?.(t))},className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",disabled:N,children:[n.jsx(Et,{className:"w-4 h-4 mr-2"}),"Capture Photo"]}),n.jsx(Qo,{variant:"outline",onClick:h?()=>{p(!1)}:async()=>{w&&(p(!0),setTimeout(()=>{p(!1)},3e3))},className:Nr("border-vibetune-gray hover:bg-vibetune-gray/40",h?"text-red-400 border-red-400":"text-white"),disabled:N,children:h?n.jsxs(n.Fragment,{children:[n.jsx(bn,{className:"w-4 h-4 mr-2"}),"Stop Recording"]}):n.jsxs(n.Fragment,{children:[n.jsx(on,{className:"w-4 h-4 mr-2"}),"Record Video"]})})]})]}),u&&w&&n.jsxs("div",{className:"flex items-center justify-center space-x-3 pt-2 border-t border-vibetune-gray/20",children:[n.jsxs(Qo,{variant:"outline",size:"sm",onClick:()=>{E?F():M()},className:Nr("border-vibetune-gray hover:bg-vibetune-gray/40",E?"text-vibetune-green border-vibetune-green":"text-white"),children:[n.jsx(hn,{className:"w-4 h-4 mr-2"}),E?"Stop":"Start"," Face Detection"]}),n.jsxs(Qo,{variant:"outline",size:"sm",onClick:()=>m(!f),className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[f?n.jsx(Wt,{className:"w-4 h-4 mr-2"}):n.jsx(Vt,{className:"w-4 h-4 mr-2"}),f?"Hide":"Show"," Overlay"]}),n.jsxs("div",{className:"flex items-center space-x-2 text-sm text-vibetune-text-muted",children:[n.jsx(Sn,{className:"w-4 h-4"}),n.jsxs("span",{children:[R.length," face",1!==R.length?"s":""]})]})]})]})}),n.jsx(DN,{isOpen:v,onClose:()=>g(!1),error:k})]})});function MN({isOpen:e,onClose:t,onCapture:r,title:a="Take a Photo",enableFaceDetection:i=!0}){return n.jsx(os,{open:e,onOpenChange:t,children:n.jsxs(ls,{className:"max-w-4xl bg-vibetune-darker border-vibetune-gray",children:[n.jsx(ds,{className:"border-b border-vibetune-gray/20 pb-4",children:n.jsxs(hs,{className:"text-white flex items-center",children:[a,i&&n.jsx("span",{className:"ml-2 text-xs bg-vibetune-green text-black px-2 py-1 rounded-full",children:"AI Enhanced"})]})}),n.jsx("div",{className:"p-0",children:n.jsx(PN,{onCapture:e=>{r?.(e),t()},onClose:t,autoStart:!0,enableFaceDetection:i,className:"border-0"})})]})})}PN.displayName="WebcamCaptureWithFaceDetection";const FN=()=>{const{isAuthenticated:e}=is(),{toast:r}=Ce(),[a,i]=t.useState(null),[o,s]=t.useState(!1);t.useEffect(()=>{const e=async()=>{const e=localStorage.getItem("spotifySessionToken"),t=localStorage.getItem("spotify_access_token");if(e||t)try{const n=t||e,r=await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${n}`}});if(r.ok){const e=await r.json();i(e)}else localStorage.removeItem("spotifySessionToken"),localStorage.removeItem("spotify_access_token"),i(null)}catch(n){localStorage.removeItem("spotifySessionToken"),localStorage.removeItem("spotify_access_token"),i(null)}};e();const t=()=>{e()};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[]);const u=async()=>{s(!0);try{const e=await fetch("/api/auth/spotify/url"),t=await e.json();t.authUrl?(localStorage.setItem("vibetune_return_url",window.location.href),window.location.href=t.authUrl):(s(!1),r({title:"❌ Server Error",description:"Failed to get Spotify authorization URL from server.",variant:"destructive"}))}catch(e){s(!1),r({title:"❌ Connection Error",description:"Failed to initiate Spotify connection. Please try again.",variant:"destructive"})}},c=async()=>{try{window.Spotify&&new window.Spotify.Player({name:"VibeTune Player",getOAuthToken:()=>localStorage.getItem("spotify_access_token")||""}).disconnect(),localStorage.removeItem("spotifySessionToken"),localStorage.removeItem("spotify_access_token"),i(null),r({title:"👋 Disconnected from Spotify",description:"You have been disconnected from Spotify.",duration:3e3})}catch(e){r({title:"Error",description:"Failed to disconnect from Spotify.",variant:"destructive"})}};return e&&a?n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[a.images?.[0]?n.jsx("img",{src:a.images[0].url,alt:a.display_name,className:"w-8 h-8 rounded-full border-2 border-green-500"}):n.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center",children:n.jsx(jn,{className:"w-4 h-4 text-white"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-medium text-white",children:a.display_name}),n.jsxs("span",{className:"text-xs text-green-400 flex items-center gap-1",children:[n.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),"Spotify Connected"]})]})]}),n.jsx(Qo,{onClick:c,variant:"outline",size:"sm",className:"text-white border-white hover:bg-white hover:text-black",children:n.jsx(Jt,{className:"w-4 h-4"})})]}):n.jsxs(Qo,{onClick:u,disabled:o,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[n.jsx(nn,{className:"w-4 h-4"}),o?"Connecting...":"Connect Spotify"]})};function ON(){const{user:e,logout:r,loginWithSpotify:a}=is();go();const[i,o]=t.useState(!1),[s,u]=t.useState(!1);return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-vibetune-dark border-b border-vibetune-gray",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 bg-vibetune-darker hover:bg-vibetune-gray text-vibetune-text-muted hover:text-white",onClick:()=>window.history.back(),children:n.jsx(Tt,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 bg-vibetune-darker hover:bg-vibetune-gray text-vibetune-text-muted hover:text-white",onClick:()=>window.history.forward(),children:n.jsx(At,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"flex items-center space-x-4",children:e?n.jsxs(n.Fragment,{children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"text-vibetune-text-muted hover:text-white",onClick:()=>o(!0),children:n.jsx(Et,{className:"w-5 h-5"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"text-vibetune-text-muted hover:text-white",children:n.jsx(Ct,{className:"w-5 h-5"})}),n.jsxs(Jo,{children:[n.jsx(Zo,{asChild:!0,children:n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full",children:e.images&&e.images.length>0?n.jsx("img",{src:e.images[0].url,alt:e.displayName,className:"w-full h-full object-cover rounded-full"}):n.jsx(jn,{className:"w-4 h-4"})})}),n.jsxs(es,{align:"end",className:"w-56 bg-vibetune-gray border-vibetune-light-gray",children:[n.jsxs("div",{className:"px-3 py-2 border-b border-vibetune-light-gray",children:[n.jsx("p",{className:"text-sm font-medium text-white",children:e.displayName}),n.jsx("p",{className:"text-xs text-vibetune-text-muted",children:e.email||"Spotify User"})]}),n.jsx(ts,{asChild:!0,className:"text-white hover:bg-vibetune-light-gray",children:n.jsxs(zo,{to:"/profile",className:"flex items-center",children:[n.jsx(jn,{className:"w-4 h-4 mr-2"}),"Profile"]})}),n.jsxs(ts,{className:"text-white hover:bg-vibetune-light-gray",onClick:()=>o(!0),children:[n.jsx(Et,{className:"w-4 h-4 mr-2"}),"Take Photo"]}),n.jsx(ts,{asChild:!0,className:"text-white hover:bg-vibetune-light-gray",children:n.jsxs(zo,{to:"/settings",className:"flex items-center",children:[n.jsx(fn,{className:"w-4 h-4 mr-2"}),"Settings"]})}),n.jsx(ns,{className:"bg-vibetune-light-gray"}),n.jsxs(ts,{className:"text-red-400 hover:bg-vibetune-light-gray",onClick:()=>{r()},children:[n.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Log out"]})]})]})]}):n.jsx(FN,{size:"sm"})})]}),n.jsx(MN,{isOpen:i,onClose:()=>o(!1),onCapture:e=>{},title:"Take a Photo"})]})}function LN(e,[t,n]){return Math.min(n,Math.max(t,e))}function BN(e){const n=t.useRef({value:e,previous:e});return t.useMemo(()=>(n.current.value!==e&&(n.current.previous=n.current.value,n.current.value=e),n.current.previous),[e])}var zN=["PageUp","PageDown"],UN=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],WN={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},VN="Slider",[HN,qN,GN]=i(VN),[KN,$N]=a(VN,[GN]),[XN,YN]=KN(VN),QN=t.forwardRef((e,r)=>{const{name:a,min:i=0,max:o=100,step:s=1,orientation:c="horizontal",disabled:d=!1,minStepsBetweenThumbs:h=0,defaultValue:p=[i],value:f,onValueChange:m=()=>{},onValueCommit:v=()=>{},inverted:g=!1,form:x,...y}=e,b=t.useRef(new Set),w=t.useRef(0),N="horizontal"===c?ek:tk,[k=[],C]=u({prop:f,defaultProp:p,onChange:e=>{const t=[...b.current];t[w.current]?.focus(),m(e)}}),j=t.useRef(k);function S(e,t,{commit:n}={commit:!1}){const r=function(e){return(String(e).split(".")[1]||"").length}(s),a=function(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-i)/s)*s+i,r),u=LN(a,[i,o]);C((e=[])=>{const r=function(e=[],t,n){const r=[...e];return r[n]=t,r.sort((e,t)=>e-t)}(e,u,t);if(function(e,t){if(t>0){const n=function(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}(e);return Math.min(...n)>=t}return!0}(r,h*s)){w.current=r.indexOf(u);const t=String(r)!==String(e);return t&&n&&v(r),t?r:e}return e})}return n.jsx(XN,{scope:e.__scopeSlider,name:a,disabled:d,min:i,max:o,valueIndexToChangeRef:w,thumbs:b.current,values:k,orientation:c,form:x,children:n.jsx(HN.Provider,{scope:e.__scopeSlider,children:n.jsx(HN.Slot,{scope:e.__scopeSlider,children:n.jsx(N,{"aria-disabled":d,"data-disabled":d?"":void 0,...y,ref:r,onPointerDown:l(y.onPointerDown,()=>{d||(j.current=k)}),min:i,max:o,inverted:g,onSlideStart:d?void 0:function(e){const t=function(e,t){if(1===e.length)return 0;const n=e.map(e=>Math.abs(e-t)),r=Math.min(...n);return n.indexOf(r)}(k,e);S(e,t)},onSlideMove:d?void 0:function(e){S(e,w.current)},onSlideEnd:d?void 0:function(){const e=j.current[w.current];k[w.current]!==e&&v(k)},onHomeKeyDown:()=>!d&&S(i,0,{commit:!0}),onEndKeyDown:()=>!d&&S(o,k.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!d){const n=zN.includes(e.key)||e.shiftKey&&UN.includes(e.key)?10:1,r=w.current;S(k[r]+s*n*t,r,{commit:!0})}}})})})})});QN.displayName=VN;var[JN,ZN]=KN(VN,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ek=t.forwardRef((e,r)=>{const{min:a,max:i,dir:s,inverted:u,onSlideStart:c,onSlideMove:l,onSlideEnd:d,onStepKeyDown:h,...p}=e,[f,m]=t.useState(null),v=o(r,e=>m(e)),g=t.useRef(void 0),x=K(s),y="ltr"===x,b=y&&!u||!y&&u;function w(e){const t=g.current||f.getBoundingClientRect(),n=hk([0,t.width],b?[a,i]:[i,a]);return g.current=t,n(e-t.left)}return n.jsx(JN,{scope:e.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:n.jsx(nk,{dir:x,"data-orientation":"horizontal",...p,ref:v,style:{...p.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{const t=w(e.clientX);c?.(t)},onSlideMove:e=>{const t=w(e.clientX);l?.(t)},onSlideEnd:()=>{g.current=void 0,d?.()},onStepKeyDown:e=>{const t=WN[b?"from-left":"from-right"].includes(e.key);h?.({event:e,direction:t?-1:1})}})})}),tk=t.forwardRef((e,r)=>{const{min:a,max:i,inverted:s,onSlideStart:u,onSlideMove:c,onSlideEnd:l,onStepKeyDown:d,...h}=e,p=t.useRef(null),f=o(r,p),m=t.useRef(void 0),v=!s;function g(e){const t=m.current||p.current.getBoundingClientRect(),n=hk([0,t.height],v?[i,a]:[a,i]);return m.current=t,n(e-t.top)}return n.jsx(JN,{scope:e.__scopeSlider,startEdge:v?"bottom":"top",endEdge:v?"top":"bottom",size:"height",direction:v?1:-1,children:n.jsx(nk,{"data-orientation":"vertical",...h,ref:f,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{const t=g(e.clientY);u?.(t)},onSlideMove:e=>{const t=g(e.clientY);c?.(t)},onSlideEnd:()=>{m.current=void 0,l?.()},onStepKeyDown:e=>{const t=WN[v?"from-bottom":"from-top"].includes(e.key);d?.({event:e,direction:t?-1:1})}})})}),nk=t.forwardRef((e,t)=>{const{__scopeSlider:a,onSlideStart:i,onSlideMove:o,onSlideEnd:s,onHomeKeyDown:u,onEndKeyDown:c,onStepKeyDown:d,...h}=e,p=YN(VN,a);return n.jsx(r.span,{...h,ref:t,onKeyDown:l(e.onKeyDown,e=>{"Home"===e.key?(u(e),e.preventDefault()):"End"===e.key?(c(e),e.preventDefault()):zN.concat(UN).includes(e.key)&&(d(e),e.preventDefault())}),onPointerDown:l(e.onPointerDown,e=>{const t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),p.thumbs.has(t)?t.focus():i(e)}),onPointerMove:l(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&o(e)}),onPointerUp:l(e.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),s(e))})})}),rk="SliderTrack",ak=t.forwardRef((e,t)=>{const{__scopeSlider:a,...i}=e,o=YN(rk,a);return n.jsx(r.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...i,ref:t})});ak.displayName=rk;var ik="SliderRange",ok=t.forwardRef((e,a)=>{const{__scopeSlider:i,...s}=e,u=YN(ik,i),c=ZN(ik,i),l=t.useRef(null),d=o(a,l),h=u.values.length,p=u.values.map(e=>dk(e,u.min,u.max)),f=h>1?Math.min(...p):0,m=100-Math.max(...p);return n.jsx(r.span,{"data-orientation":u.orientation,"data-disabled":u.disabled?"":void 0,...s,ref:d,style:{...e.style,[c.startEdge]:f+"%",[c.endEdge]:m+"%"}})});ok.displayName=ik;var sk="SliderThumb",uk=t.forwardRef((e,r)=>{const a=qN(e.__scopeSlider),[i,s]=t.useState(null),u=o(r,e=>s(e)),c=t.useMemo(()=>i?a().findIndex(e=>e.ref.current===i):-1,[a,i]);return n.jsx(ck,{...e,ref:u,index:c})}),ck=t.forwardRef((e,a)=>{const{__scopeSlider:i,index:s,name:u,...c}=e,d=YN(sk,i),h=ZN(sk,i),[p,f]=t.useState(null),m=o(a,e=>f(e)),v=!p||d.form||!!p.closest("form"),g=$(p),x=d.values[s],y=void 0===x?0:dk(x,d.min,d.max),b=function(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}(s,d.values.length),w=g?.[h.size],N=w?function(e,t,n){const r=e/2,a=hk([0,50],[0,r]);return(r-a(t)*n)*n}(w,y,h.direction):0;return t.useEffect(()=>{if(p)return d.thumbs.add(p),()=>{d.thumbs.delete(p)}},[p,d.thumbs]),n.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[h.startEdge]:`calc(${y}% + ${N}px)`},children:[n.jsx(HN.ItemSlot,{scope:e.__scopeSlider,children:n.jsx(r.span,{role:"slider","aria-label":e["aria-label"]||b,"aria-valuemin":d.min,"aria-valuenow":x,"aria-valuemax":d.max,"aria-orientation":d.orientation,"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,tabIndex:d.disabled?void 0:0,...c,ref:m,style:void 0===x?{display:"none"}:e.style,onFocus:l(e.onFocus,()=>{d.valueIndexToChangeRef.current=s})})}),v&&n.jsx(lk,{name:u??(d.name?d.name+(d.values.length>1?"[]":""):void 0),form:d.form,value:x},s)]})});uk.displayName=sk;var lk=t.forwardRef(({__scopeSlider:e,value:a,...i},s)=>{const u=t.useRef(null),c=o(u,s),l=BN(a);return t.useEffect(()=>{const e=u.current;if(!e)return;const t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"value").set;if(l!==a&&n){const t=new Event("input",{bubbles:!0});n.call(e,a),e.dispatchEvent(t)}},[l,a]),n.jsx(r.input,{style:{display:"none"},...i,ref:c,defaultValue:a})});function dk(e,t,n){return LN(100/(n-t)*(e-t),[0,100])}function hk(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}lk.displayName="RadioBubbleInput";var pk=QN,fk=ak,mk=ok,vk=uk;const gk=t.forwardRef(({className:e,...t},r)=>n.jsxs(pk,{ref:r,className:Nr("relative flex w-full touch-none select-none items-center",e),...t,children:[n.jsx(fk,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:n.jsx(mk,{className:"absolute h-full bg-primary"})}),n.jsx(vk,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));gk.displayName=pk.displayName;const xk=t.createContext(void 0),yk=()=>{const e=t.useContext(xk);if(!e)throw new Error("useMusicPlayer must be used within a MusicPlayerProvider");return e},bk=({children:e})=>{const[r,a]=t.useState(null),[i,o]=t.useState(!1),[s,u]=t.useState(!1),[c,l]=t.useState(75),[d,h]=t.useState(0),[p,f]=t.useState(0),[m,v]=t.useState([]),[g,x]=t.useState([]),[y,b]=t.useState(0),[w,N]=t.useState(!1),[k,C]=t.useState("none"),[j,S]=t.useState(null),[E,R]=t.useState(!1),[_,I]=t.useState(null),[T,A]=t.useState(!1),D=t.useRef(null),[P,M]=t.useState(new Map),[F,O]=t.useState(new Map),L=t.useRef(null);t.useRef(null);const B=p>0?d/p*100:0,z=y<m.length-1||"playlist"===k,U=y>0||"playlist"===k;t.useEffect(()=>{if(!L.current){L.current=new Audio,L.current.crossOrigin="anonymous";const e=L.current,t=()=>{f(1e3*e.duration)},n=()=>{h(1e3*e.currentTime)},r=()=>{re()},a=e=>{u(!1),o(!1),te()},i=()=>{u(!1)},s=()=>{u(!0)};return e.addEventListener("loadedmetadata",t),e.addEventListener("timeupdate",n),e.addEventListener("ended",r),e.addEventListener("error",a),e.addEventListener("canplay",i),e.addEventListener("waiting",s),()=>{e.removeEventListener("loadedmetadata",t),e.removeEventListener("timeupdate",n),e.removeEventListener("ended",r),e.removeEventListener("error",a),e.removeEventListener("canplay",i),e.removeEventListener("waiting",s),e.pause(),e.src=""}}},[]),t.useEffect(()=>{L.current&&(L.current.volume=c/100),j&&j.setVolume(c/100)},[c,j]),t.useEffect(()=>{W()},[]);const W=()=>{if(!window.Spotify&&!document.querySelector('script[src="https://sdk.scdn.co/spotify-player.js"]')){const e=document.createElement("script");e.src="https://sdk.scdn.co/spotify-player.js",e.async=!0,document.body.appendChild(e)}window.onSpotifyWebPlaybackSDKReady=()=>{A(!0)}};t.useEffect(()=>{const e=localStorage.getItem("spotify_access_token");T&&e&&!j&&D.current&&D.current().catch(()=>{})},[T,j]);const V=t.useCallback(async()=>{try{if(!_)return;const e=localStorage.getItem("spotify_access_token");if(!e)return;await fetch("https://api.spotify.com/v1/me/player",{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({device_ids:[_],play:!1})})}catch(IE){}},[_]),H=t.useCallback(async e=>{try{if(e.isSpotifyTrack&&e.spotifyId&&localStorage.getItem("spotify_access_token")&&j&&_)return`spotify:track:${e.spotifyId}`;if(e.previewUrl)return e.previewUrl;if(e.url&&(e.url.startsWith("http")||e.url.startsWith("https")))return e.url;if(e.isSpotifyTrack&&e.spotifyId)try{const t=await fetch(`/api/spotify/track/${e.spotifyId}`);if(t.ok){const e=await t.json();if(e.preview_url)return e.preview_url}}catch(t){}else if(e.id)try{const t=await fetch(`/api/spotify/track/${e.id}`);if(t.ok){const e=await t.json();if(e.preview_url)return e.preview_url}}catch(t){}return e.isSpotifyTrack&&e.spotifyId?`spotify:track:${e.spotifyId}`:null}catch(t){return null}},[]);t.useCallback(e=>{try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.sampleRate,n=2*t,r=e.createBuffer(1,n,t).getChannelData(0);for(let c=0;c<n;c++)r[c]=.1*Math.sin(2*Math.PI*440*c/t);const a=new ArrayBuffer(44+2*n),i=new DataView(a),o=(e,t)=>{for(let n=0;n<t.length;n++)i.setUint8(e+n,t.charCodeAt(n))};o(0,"RIFF"),i.setUint32(4,36+2*n,!0),o(8,"WAVE"),o(12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,t,!0),i.setUint32(28,2*t,!0),i.setUint16(32,2,!0),i.setUint16(34,16,!0),o(36,"data"),i.setUint32(40,2*n,!0);let s=44;for(let c=0;c<n;c++){const e=Math.max(-1,Math.min(1,r[c]));i.setInt16(s,e<0?32768*e:32767*e,!0),s+=2}const u=new Blob([a],{type:"audio/wav"});return URL.createObjectURL(u)}catch(t){return null}},[]);const q=t.useCallback(async(e,t)=>{if(L.current){L.current.src=t,L.current.load();const n=async()=>{try{await L.current.play(),o(!0),"undefined"!=typeof window&&"toast"in window&&window.toast?.success?.(`🎵 Now playing: ${e.title}`)}catch(t){if("NotAllowedError"!==t.name)throw"undefined"!=typeof window&&"toast"in window&&window.toast?.error?.("❌ Failed to play audio"),t;o(!1),"undefined"!=typeof window&&"toast"in window&&window.toast?.info?.("🔇 Click the play button to start music")}};await n()}},[]),G=t.useCallback(async e=>{try{u(!0),a(e),e.previewUrl||e.isSpotifyTrack;const i=P.get(e.id)||0;M(t=>new Map(t.set(e.id,i+1))),O(t=>new Map(t.set(e.id,new Date)));try{const{recentlyPlayedService:t}=await pe(async()=>{const{recentlyPlayedService:e}=await import("./recentlyPlayedService-Dsp-bgAf.js");return{recentlyPlayedService:e}},[]);t.addTrack(e)}catch(t){}const s=await H(e);if(s&&s.startsWith("spotify:track:"))try{const t=localStorage.getItem("spotify_access_token");if(!t)throw new Error("No Spotify access token found");if(j||await oe(),!(await ue())||!_)throw new Error("Spotify Web Playback SDK not ready or no device ID");{await V();const n=await fetch(`https://api.spotify.com/v1/me/player/play?device_id=${_}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({uris:[s]})});if(!n.ok)throw await n.text(),new Error(`Spotify API error: ${n.status}`);o(!0),"undefined"!=typeof window&&"toast"in window&&window.toast?.success?.(`🎵 Now playing full track: ${e.title}`)}}catch(n){try{const t=await fetch(`/api/spotify/track/${e.spotifyId}`);if(t.ok){const n=await t.json();if(n.preview_url)return void(await q(e,n.preview_url))}}catch(r){}o(!1),"undefined"!=typeof window&&"toast"in window&&window.toast?.error?.(`❌ Cannot play: ${e.title}. Please ensure you have Spotify Premium and are connected.`)}else s?await q(e,s):(o(!1),"undefined"!=typeof window&&"toast"in window&&window.toast?.error?.(`❌ Cannot play: ${e.title}. Please ensure you have Spotify Premium and are connected.`),setTimeout(()=>{te()},1500));const c=m.findIndex(t=>t.id===e.id);-1===c?(J(e),b(m.length)):b(c)}catch(t){throw o(!1),t}finally{u(!1)}},[m,j,E,_,P,H]),K=t.useCallback(async()=>{try{if(E&&j)await j.resume(),o(!0);else if(L.current){if(!L.current.src&&r)return void(await G(r));await L.current.play(),o(!0)}}catch(e){e.name,o(!1)}},[E,j,r,G]),$=t.useCallback(async()=>{try{E&&j?await j.pause():L.current&&L.current.pause(),o(!1)}catch(e){o(!1)}},[E,j]),X=t.useCallback(()=>{i?$():K()},[i,K,$]),Y=t.useCallback(async e=>{const t=e/1e3;E&&j?await j.seek(e):L.current&&(L.current.currentTime=t),h(e)},[E,j]),Q=t.useCallback(e=>{l(e),localStorage.setItem("vibetune_volume",e.toString())},[]),J=t.useCallback(e=>{const t=Array.isArray(e)?e:[e];v(e=>[...e,...t]),w||x(e=>[...e,...t])},[w]),Z=t.useCallback(e=>{v(t=>t.filter((t,n)=>n!==e)),x(t=>t.filter((t,n)=>n!==e)),e===y?($(),a(null)):e<y&&b(e=>e-1)},[y,$]),ee=t.useCallback(()=>{v([]),x([]),b(0),$(),a(null)},[$]),te=t.useCallback(()=>{let e=y+1;if("track"===k)e=y;else if(e>=m.length){if("playlist"!==k)return void $();e=0}m[e]&&(b(e),G(m[e]))},[y,m,k,G,$]),ne=t.useCallback(()=>{let e=y-1;if(e<0){if("playlist"!==k)return;e=m.length-1}m[e]&&(b(e),G(m[e]))},[y,m,k,G]),re=t.useCallback(()=>{"track"===k?L.current&&(L.current.currentTime=0,L.current.play()):te()},[k,te]),ae=t.useCallback(()=>{if(w){if(v(g),N(!1),r){const e=g.findIndex(e=>e.id===r.id);b(e>=0?e:0)}}else{x(m);const e=(e=>{const t=[...e];for(let n=t.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t})(m);if(r){const t=e.findIndex(e=>e.id===r.id);t>0&&([e[0],e[t]]=[e[t],e[0]]),b(0)}v(e),N(!0)}},[w,m,g,r]),ie=t.useCallback(e=>{C(e),localStorage.setItem("vibetune_repeat_mode",e)},[]),oe=t.useCallback(async()=>{const e=localStorage.getItem("spotify_access_token");if(!e||!window.Spotify)throw new Error("Spotify token not found or SDK not loaded");try{const t=new window.Spotify.Player({name:"VibeTune Web Player",getOAuthToken:t=>{t(e)},volume:c/100});t.addListener("ready",({device_id:e})=>{I(e),R(!0),S(t)}),t.addListener("not_ready",({device_id:e})=>{R(!1)}),t.addListener("player_state_changed",e=>{if(!e)return;const t=e.track_window.current_track;t&&r?.spotifyId!==t.id&&a({id:t.id,title:t.name,artist:t.artists.map(e=>e.name).join(", "),albumArt:t.album.images[0]?.url||"",duration:t.duration_ms,url:t.external_urls?.spotify||"",spotifyId:t.id,isSpotifyTrack:!0}),h(e.position),f(e.duration),o(!e.paused)}),await t.connect()}catch(t){throw t}},[c,r]);t.useEffect(()=>{D.current=oe},[oe]);const se=t.useCallback(()=>{j&&(j.disconnect(),S(null),R(!1),I(null))},[j]),ue=t.useCallback(async()=>{try{if(!localStorage.getItem("spotify_access_token"))return!1;!j&&D.current&&await D.current();const e=Date.now();for(;!_&&Date.now()-e<3e3;)await new Promise(e=>setTimeout(e,100));return!!_&&(await V(),!0)}catch{return!1}},[j,_,oe,V]);t.useEffect(()=>{const e=localStorage.getItem("vibetune_volume");e&&l(parseInt(e));const t=localStorage.getItem("vibetune_repeat_mode");t&&C(t)},[]);const ce={currentTrack:r,isPlaying:i,isLoading:s,volume:c,progress:B,currentTime:d,duration:p,playTrack:G,pause:$,play:K,togglePlayPause:X,setVolume:Q,seekTo:Y,queue:m,currentIndex:y,addToQueue:J,removeFromQueue:Z,clearQueue:ee,skipToNext:te,skipToPrevious:ne,isShuffled:w,repeatMode:k,toggleShuffle:ae,setRepeatMode:ie,canPlayPrevious:U,canPlayNext:z,spotifyPlayer:j,isSpotifyConnected:E,connectSpotify:oe,disconnectSpotify:se,getAudioStreamUrl:H,playCount:P,lastPlayed:F};return n.jsx(xk.Provider,{value:ce,children:e})},wk=t.createContext(void 0),Nk=()=>{const e=t.useContext(wk);if(!e)throw new Error("useLibrary must be used within a LibraryProvider");return e},kk=({children:e})=>{const[r,a]=t.useState([]),[i,o]=t.useState([]);t.useEffect(()=>{try{const e=localStorage.getItem("vibetune_liked_songs");e&&a(JSON.parse(e));const t=localStorage.getItem("vibetune_playlists");if(t){const e=JSON.parse(t).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}));o(e)}else o([{id:"my-playlist-1",name:"My Playlist #1",description:"A collection of my favorite tracks",tracks:[],createdAt:new Date,updatedAt:new Date},{id:"chill-vibes",name:"Chill Vibes",description:"Perfect for relaxing",tracks:[],createdAt:new Date,updatedAt:new Date},{id:"workout-mix",name:"Workout Mix",description:"High energy tracks for exercise",tracks:[],createdAt:new Date,updatedAt:new Date},{id:"study-focus",name:"Study Focus",description:"Concentration music",tracks:[],createdAt:new Date,updatedAt:new Date}])}catch(e){}},[]),t.useEffect(()=>{try{localStorage.setItem("vibetune_liked_songs",JSON.stringify(r))}catch(e){}},[r]),t.useEffect(()=>{try{localStorage.setItem("vibetune_playlists",JSON.stringify(i))}catch(e){}},[i]);const s=e=>r.some(t=>t.id===e),u=e=>{a(t=>t.some(t=>t.id===e.id)?t:[...t,e])},c=e=>{a(t=>t.filter(t=>t.id!==e))},l={likedSongs:r,playlists:i,isLiked:s,toggleLike:e=>{s(e.id)?c(e.id):u(e)},addToLiked:u,removeFromLiked:c,createPlaylist:(e,t)=>{const n={id:`playlist_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:e,description:t||"",tracks:[],createdAt:new Date,updatedAt:new Date};return o(e=>[...e,n]),n},deletePlaylist:e=>{o(t=>t.filter(t=>t.id!==e))},updatePlaylist:(e,t)=>{o(n=>n.map(n=>n.id===e?{...n,...t,updatedAt:new Date}:n))},addToPlaylist:(e,t)=>{o(n=>n.map(n=>n.id!==e||n.tracks.some(e=>e.id===t.id)?n:{...n,tracks:[...n.tracks,t],updatedAt:new Date}))},removeFromPlaylist:(e,t)=>{o(n=>n.map(n=>n.id===e?{...n,tracks:n.tracks.filter(e=>e.id!==t),updatedAt:new Date}:n))},getPlaylist:e=>i.find(t=>t.id===e)};return n.jsx(wk.Provider,{value:l,children:e})},Ck=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`;function jk(){const{currentTrack:e,isPlaying:r,volume:a,progress:i,currentTime:o,duration:s,togglePlayPause:u,setVolume:c,seekTo:l,skipToNext:d,skipToPrevious:h,isShuffled:p,repeatMode:f,toggleShuffle:m,setRepeatMode:v}=yk(),{isLiked:g,toggleLike:x}=Nk(),y=t.useMemo(()=>f,[f]);return e?n.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-vibetune-darker border-t border-vibetune-gray px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3 w-1/3",children:[n.jsx("div",{className:"w-14 h-14 bg-vibetune-gray rounded-md overflow-hidden",children:n.jsx("img",{src:e.albumArt||"/placeholder.svg",alt:`${e.title} - ${e.artist}`,className:"w-full h-full object-cover"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"text-sm font-medium text-white truncate",children:e.title}),n.jsx("div",{className:"text-xs text-vibetune-text-muted truncate",children:e.artist})]}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 "+(g(e.id)?"text-vibetune-green":"text-vibetune-text-muted hover:text-white"),onClick:()=>x(e),children:n.jsx(qt,{className:"w-4 h-4 "+(g(e.id)?"fill-current":"")})})]}),n.jsxs("div",{className:"flex flex-col items-center space-y-2 w-1/3",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 "+(p?"text-vibetune-green":"text-vibetune-text-muted hover:text-white"),onClick:m,children:n.jsx(gn,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-white hover:text-vibetune-green",onClick:h,children:n.jsx(xn,{className:"w-5 h-5"})}),n.jsx(Qo,{className:"w-8 h-8 p-0 bg-white hover:bg-gray-200 text-black rounded-full",onClick:u,children:r?n.jsx(rn,{className:"w-4 h-4"}):n.jsx(on,{className:"w-4 h-4 ml-0.5"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-white hover:text-vibetune-green",onClick:d,children:n.jsx(yn,{className:"w-5 h-5"})}),n.jsxs(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 "+("none"!==y?"text-vibetune-green":"text-vibetune-text-muted hover:text-white"),onClick:()=>{v("none"===y?"playlist":"playlist"===y?"track":"none")},children:[n.jsx(cn,{className:"w-4 h-4"}),"track"===y&&n.jsx("span",{className:"absolute top-0 right-0 w-1 h-1 bg-vibetune-green rounded-full"})]})]}),n.jsxs("div",{className:"flex items-center space-x-2 w-full max-w-md",children:[n.jsx("span",{className:"text-xs text-vibetune-text-muted w-10 text-right",children:Ck(o)}),n.jsx(gk,{value:[i],onValueChange:e=>{const t=e[0]/100*s;l(t)},max:100,step:.1,className:"flex-1"}),n.jsx("span",{className:"text-xs text-vibetune-text-muted w-10",children:Ck(s)})]})]}),n.jsxs("div",{className:"flex items-center justify-end space-x-3 w-1/3",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-text-muted hover:text-white",children:n.jsx(tn,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Rn,{className:"w-4 h-4 text-vibetune-text-muted"}),n.jsx(gk,{value:[a],onValueChange:e=>{c(e[0])},max:100,step:1,className:"w-24"})]})]})]})}):null}const Sk=new class{baseUrl="/api";sessionToken=null;constructor(){this.sessionToken=localStorage.getItem("spotifySessionToken")}getHeaders(){const e={"Content-Type":"application/json"};return this.sessionToken&&(e.Authorization=`Bearer ${this.sessionToken}`),e}async handleResponse(e){if(!e.ok){const t=await e.json().catch(()=>({error:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(t.error||"Unknown error occurred")}return e.json()}async getAuthUrl(){const e=await fetch(`${this.baseUrl}/auth/spotify/url`);return this.handleResponse(e)}async handleCallback(e,t){const n=new URLSearchParams({code:e});t&&n.append("state",t);const r=await fetch(`${this.baseUrl}/auth/spotify/callback?${n}`,{headers:{Accept:"application/json"}}),a=await this.handleResponse(r);return this.sessionToken=a.sessionToken,localStorage.setItem("spotifySessionToken",a.sessionToken),a}async refreshToken(){const e=await fetch(`${this.baseUrl}/auth/refresh`,{method:"POST",headers:this.getHeaders()});return this.handleResponse(e)}async getCurrentUser(){const e=await fetch(`${this.baseUrl}/auth/user`,{headers:this.getHeaders()});return this.handleResponse(e)}async logout(){try{await fetch(`${this.baseUrl}/auth/logout`,{method:"POST",headers:this.getHeaders()})}finally{this.sessionToken=null,localStorage.removeItem("spotifySessionToken")}}async search(e,t="track,album,artist,playlist",n=20,r=0){const a=new URLSearchParams({q:e,type:t,limit:n.toString(),offset:r.toString()}),i=await fetch(`${this.baseUrl}/spotify/search?${a}`,{headers:this.getHeaders()});return this.handleResponse(i)}async getTrack(e){const t=await fetch(`${this.baseUrl}/spotify/track/${e}`,{headers:this.getHeaders()});return this.handleResponse(t)}async getTracks(e){const t=new URLSearchParams({ids:e.join(",")}),n=await fetch(`${this.baseUrl}/spotify/tracks?${t}`,{headers:this.getHeaders()});return this.handleResponse(n)}async getAlbum(e){const t=await fetch(`${this.baseUrl}/spotify/album/${e}`,{headers:this.getHeaders()});return this.handleResponse(t)}async getAlbumTracks(e,t=20,n=0){const r=new URLSearchParams({limit:t.toString(),offset:n.toString()}),a=await fetch(`${this.baseUrl}/spotify/album/${e}/tracks?${r}`,{headers:this.getHeaders()});return this.handleResponse(a)}async getArtist(e){const t=await fetch(`${this.baseUrl}/spotify/artist/${e}`,{headers:this.getHeaders()});return this.handleResponse(t)}async getArtistTopTracks(e,t="US"){const n=new URLSearchParams({market:t}),r=await fetch(`${this.baseUrl}/spotify/artist/${e}/top-tracks?${n}`,{headers:this.getHeaders()});return this.handleResponse(r)}async getArtistAlbums(e,t=20,n=0,r="album,single"){const a=new URLSearchParams({limit:t.toString(),offset:n.toString(),include_groups:r}),i=await fetch(`${this.baseUrl}/spotify/artist/${e}/albums?${a}`,{headers:this.getHeaders()});return this.handleResponse(i)}async getRelatedArtists(e){const t=await fetch(`${this.baseUrl}/spotify/artist/${e}/related-artists`,{headers:this.getHeaders()});return this.handleResponse(t)}async getFeaturedPlaylists(e=20,t=0,n){const r=new URLSearchParams({limit:e.toString(),offset:t.toString()});n&&r.append("country",n);const a=await fetch(`${this.baseUrl}/spotify/featured-playlists?${r}`,{headers:this.getHeaders()});return this.handleResponse(a)}async getNewReleases(e=20,t=0,n){const r=new URLSearchParams({limit:e.toString(),offset:t.toString()});n&&r.append("country",n);const a=await fetch(`${this.baseUrl}/spotify/new-releases?${r}`,{headers:this.getHeaders()});return this.handleResponse(a)}async getTopArtists(e=20,t=0){const n=new URLSearchParams({limit:e.toString(),offset:t.toString()}),r=await fetch(`${this.baseUrl}/spotify/top-artists?${n}`,{headers:this.getHeaders()});return this.handleResponse(r)}async getCategories(e=20,t=0,n){const r=new URLSearchParams({limit:e.toString(),offset:t.toString()});n&&r.append("country",n);const a=await fetch(`${this.baseUrl}/spotify/categories?${r}`,{headers:this.getHeaders()});return this.handleResponse(a)}async getCategoryPlaylists(e,t=20,n=0,r){const a=new URLSearchParams({limit:t.toString(),offset:n.toString()});r&&a.append("country",r);const i=await fetch(`${this.baseUrl}/spotify/categories/${e}/playlists?${a}`,{headers:this.getHeaders()});return this.handleResponse(i)}async getRecommendations(e){const t=new URLSearchParams;e.seedArtists?.length&&t.append("seed_artists",e.seedArtists.join(",")),e.seedGenres?.length&&t.append("seed_genres",e.seedGenres.join(",")),e.seedTracks?.length&&t.append("seed_tracks",e.seedTracks.join(",")),void 0!==e.limit&&t.append("limit",e.limit.toString()),void 0!==e.targetValence&&t.append("target_valence",e.targetValence.toString()),void 0!==e.targetEnergy&&t.append("target_energy",e.targetEnergy.toString()),void 0!==e.targetDanceability&&t.append("target_danceability",e.targetDanceability.toString());const n=await fetch(`${this.baseUrl}/spotify/recommendations?${t}`,{headers:this.getHeaders()});return this.handleResponse(n)}async getGenreSeeds(){const e=await fetch(`${this.baseUrl}/spotify/genre-seeds`,{headers:this.getHeaders()});return this.handleResponse(e)}async getUserPlaylists(e=20,t=0){const n=new URLSearchParams({limit:e.toString(),offset:t.toString()}),r=await fetch(`${this.baseUrl}/spotify/me/playlists?${n}`,{headers:this.getHeaders()});return this.handleResponse(r)}async getPlaylist(e){const t=await fetch(`${this.baseUrl}/spotify/playlist/${e}`,{headers:this.getHeaders()});return this.handleResponse(t)}async getPlaylistTracksAll(e,t=100){let n=[],r=0;for(let a=0;a<10;a++){const a=new URLSearchParams({limit:String(t),offset:String(r)}),i=await fetch(`${this.baseUrl}/spotify/playlist/${e}/tracks?${a}`,{headers:this.getHeaders()}),o=await this.handleResponse(i);if(n=n.concat(o.items||[]),!o.items||o.items.length<t)break;r+=t}return n}async getPlaylistTracks(e,t=50,n=0){const r=new URLSearchParams({limit:t.toString(),offset:n.toString()}),a=await fetch(`${this.baseUrl}/spotify/playlist/${e}/tracks?${r}`,{headers:this.getHeaders()});return this.handleResponse(a)}async getSavedTracks(e=20,t=0){const n=new URLSearchParams({limit:e.toString(),offset:t.toString()}),r=await fetch(`${this.baseUrl}/spotify/me/tracks?${n}`,{headers:this.getHeaders()});return this.handleResponse(r)}async getSavedAlbums(e=20,t=0){const n=new URLSearchParams({limit:e.toString(),offset:t.toString()}),r=await fetch(`${this.baseUrl}/spotify/me/albums?${n}`,{headers:this.getHeaders()});return this.handleResponse(r)}async getFollowedArtists(e=20,t){const n=new URLSearchParams({limit:e.toString(),type:"artist"});t&&n.append("after",t);const r=await fetch(`${this.baseUrl}/spotify/me/following?${n}`,{headers:this.getHeaders()});return this.handleResponse(r)}async getTopItems(e,t=20,n=0,r="medium_term"){const a=new URLSearchParams({limit:t.toString(),offset:n.toString(),time_range:r}),i=await fetch(`${this.baseUrl}/spotify/me/top/${e}?${a}`,{headers:this.getHeaders()});return this.handleResponse(i)}async getRecentlyPlayed(e=20,t,n){const r=new URLSearchParams({limit:e.toString()});void 0!==t&&r.append("after",t.toString()),void 0!==n&&r.append("before",n.toString());const a=await fetch(`${this.baseUrl}/spotify/me/player/recently-played?${r}`,{headers:this.getHeaders()});return this.handleResponse(a)}async checkSavedTracks(e){const t=new URLSearchParams({ids:e.join(",")}),n=await fetch(`${this.baseUrl}/spotify/me/tracks/contains?${t}`,{headers:this.getHeaders()});return this.handleResponse(n)}async saveTracks(e){const t=await fetch(`${this.baseUrl}/spotify/me/tracks`,{method:"PUT",headers:this.getHeaders(),body:JSON.stringify({ids:e})});await this.handleResponse(t)}async removeSavedTracks(e){const t=await fetch(`${this.baseUrl}/spotify/me/tracks`,{method:"DELETE",headers:this.getHeaders(),body:JSON.stringify({ids:e})});await this.handleResponse(t)}isAuthenticated(){return!!this.sessionToken}getSessionToken(){return this.sessionToken}setSessionToken(e){this.sessionToken=e,localStorage.setItem("spotifySessionToken",e)}clearSession(){this.sessionToken=null,localStorage.removeItem("spotifySessionToken")}},Ek=new class{demoTracks=[{id:"demo-1",title:"Classical Piano",artist:"Demo Artist",albumArt:"/placeholder.svg",duration:3e4,url:"https://www.kozco.com/tech/piano2.wav",previewUrl:"https://www.kozco.com/tech/piano2.wav",genre:"classical"},{id:"demo-2",title:"Organ Finale",artist:"Demo Composer",albumArt:"/placeholder.svg",duration:25e3,url:"https://www.kozco.com/tech/organfinale.wav",previewUrl:"https://www.kozco.com/tech/organfinale.wav",genre:"classical"},{id:"demo-3",title:"LR Mono Phase",artist:"Test Audio",albumArt:"/placeholder.svg",duration:2e4,url:"https://www.kozco.com/tech/LRMonoPhase4.wav",previewUrl:"https://www.kozco.com/tech/LRMonoPhase4.wav",genre:"electronic"}];getDemoTracks(){return this.demoTracks}getRandomTrack(){const e=Math.floor(Math.random()*this.demoTracks.length);return this.demoTracks[e]}getTracksByEmotion(e){return{happy:[{id:"demo-happy-1",title:"Upbeat Piano",artist:"Demo Artist",albumArt:"/placeholder.svg",duration:3e4,url:"https://www.kozco.com/tech/piano2.wav",previewUrl:"https://www.kozco.com/tech/piano2.wav",genre:"classical"}],sad:[{id:"demo-sad-1",title:"Melancholy Organ",artist:"Demo Composer",albumArt:"/placeholder.svg",duration:25e3,url:"https://www.kozco.com/tech/organfinale.wav",previewUrl:"https://www.kozco.com/tech/organfinale.wav",genre:"classical"}],angry:[{id:"demo-angry-1",title:"Intense Electronic",artist:"Demo Producer",albumArt:"/placeholder.svg",duration:2e4,url:"https://www.kozco.com/tech/LRMonoPhase4.wav",previewUrl:"https://www.kozco.com/tech/LRMonoPhase4.wav",genre:"electronic"}],surprised:[{id:"demo-surprised-1",title:"Dramatic Piano",artist:"Demo Artist",albumArt:"/placeholder.svg",duration:3e4,url:"https://www.kozco.com/tech/piano2.wav",previewUrl:"https://www.kozco.com/tech/piano2.wav",genre:"classical"}],fearful:[{id:"demo-fearful-1",title:"Atmospheric Organ",artist:"Demo Composer",albumArt:"/placeholder.svg",duration:25e3,url:"https://www.kozco.com/tech/organfinale.wav",previewUrl:"https://www.kozco.com/tech/organfinale.wav",genre:"ambient"}],disgusted:[{id:"demo-disgusted-1",title:"Raw Electronic",artist:"Demo Producer",albumArt:"/placeholder.svg",duration:2e4,url:"https://www.kozco.com/tech/LRMonoPhase4.wav",previewUrl:"https://www.kozco.com/tech/LRMonoPhase4.wav",genre:"alternative"}],neutral:[{id:"demo-neutral-1",title:"Chill Piano",artist:"Demo Artist",albumArt:"/placeholder.svg",duration:3e4,url:"https://www.kozco.com/tech/piano2.wav",previewUrl:"https://www.kozco.com/tech/piano2.wav",genre:"ambient"}]}[e]||this.demoTracks}convertToTrack(e){return{id:e.id,title:e.title,artist:e.artist,albumArt:e.albumArt,duration:e.duration,url:e.url,previewUrl:e.previewUrl,quality:"medium",isSpotifyTrack:!1}}async testAudioUrl(e){try{const t=new Audio;return new Promise(n=>{const r=setTimeout(()=>n(!1),5e3);t.oncanplaythrough=()=>{clearTimeout(r),n(!0)},t.onerror=()=>{clearTimeout(r),n(!1)},t.src=e})}catch{return!1}}async getWorkingAudioUrl(e){for(const t of this.demoTracks)if(await this.testAudioUrl(t.url))return t.url;return this.generateSimpleTone(e.title)}generateSimpleTone(e){try{const t=new(window.AudioContext||window.webkitAudioContext),n=10,r=t.sampleRate,a=r*n,i=t.createBuffer(1,a,r).getChannelData(0);let o=0;for(let u=0;u<e.length;u++)o=(o<<5)-o+e.charCodeAt(u)&4294967295;const s=220+Math.abs(o)%440;for(let e=0;e<a;e++){const t=e/r;i[e]=.3*Math.sin(2*Math.PI*s*t)}return"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEWAjOH0fPTgjMGHm7A7+OZURE"}catch(t){return""}}};function Rk(){const[e,r]=t.useState(!1),a=go(),[i,o]=t.useState(null),[s,u]=t.useState([]),[c,l]=t.useState([]),[d,h]=t.useState([]),[p,f]=t.useState([]),[m,v]=t.useState(!1),{playTrack:g}=yk(),{toggleLike:x,isLiked:y,likedSongs:b,playlists:w}=Nk(),{toast:N}=Ce(),k=(new Date).getHours(),C=k<12?"Good morning":k<18?"Good afternoon":"Good evening";t.useEffect(()=>{(async()=>{const e=localStorage.getItem("spotifySessionToken"),t=localStorage.getItem("spotify_access_token"),n=!(!e&&!t);v(n);try{const e=await Sk.getNewReleases(12,0);u(e.albums?.items||[])}catch{}try{const e=await Sk.getTopArtists(12,0);l(e.artists?.items||[])}catch{}if(n)try{const e=await Sk.getRecentlyPlayed(12);if(e&&e.items&&e.items.length>0){const t=e.items.map(e=>({id:e.track?.id,title:e.track?.name,artist:(e.track?.artists||[]).map(e=>e.name).join(", "),image:e.track?.album?.images?.[0]?.url||"/placeholder.svg"})).filter(e=>e.id);h(t)}else h([])}catch(r){h([])}else h([]);try{const{recentlyPlayedService:e}=await pe(async()=>{const{recentlyPlayedService:e}=await import("./recentlyPlayedService-Dsp-bgAf.js");return{recentlyPlayedService:e}},[]),t=e.getRecentlyPlayed(12).map(e=>({id:e.id,title:e.title,artist:e.artist,image:e.image}));f(t)}catch(r){f([])}})()},[]);const j=t.useMemo(()=>{const e=[...p,...d].filter((e,t,n)=>t===n.findIndex(t=>t.id===e.id));return[{title:"Liked Songs",count:`${b.length} song${1!==b.length?"s":""}`,color:"bg-gradient-to-br from-purple-600 to-blue-600"},{title:"Recently Played",count:`${e.length} track${1!==e.length?"s":""}`,color:"bg-gradient-to-br from-orange-600 to-red-600"},{title:"My Playlists",count:`${w.length} playlist${1!==w.length?"s":""}`,color:"bg-gradient-to-br from-pink-600 to-purple-600"},{title:"Jump Back In",count:`${s.length} album${1!==s.length?"s":""}`,color:"bg-gradient-to-br from-yellow-600 to-orange-600"},{title:"Uniquely Yours",count:"Mix",color:"bg-gradient-to-br from-indigo-600 to-purple-600"}]},[b.length,d,p,w.length,s.length]);return n.jsxs("div",{className:"p-6 bg-gradient-to-b from-vibetune-gray/20 to-vibetune-dark",children:[n.jsxs("div",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h1",{className:"text-3xl font-bold text-white",children:C}),n.jsxs("div",{className:"flex space-x-3",children:[n.jsxs(Qo,{onClick:()=>r(!0),className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[n.jsx(Et,{className:"w-4 h-4 mr-2"}),"AI Camera"]}),n.jsxs(Qo,{variant:"outline",onClick:()=>window.location.href="/webcam",className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(jt,{className:"w-4 h-4 mr-2"}),"Emotion Music"]})]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:j.map((e,t)=>n.jsxs("div",{className:"group bg-vibetune-gray/40 hover:bg-vibetune-gray/60 rounded-lg p-4 transition-all duration-300 cursor-pointer flex items-center space-x-4",onClick:()=>{switch(e.title){case"Liked Songs":a("/liked");break;case"Recently Played":a("/search?type=recently-played");break;case"My Playlists":a("/library");break;case"Jump Back In":a("/search?type=new-releases");break;case"Uniquely Yours":a("/search?type=featured-playlists")}},children:[n.jsx("div",{className:`w-16 h-16 rounded-lg ${e.color} flex items-center justify-center`,children:n.jsx("div",{className:"w-8 h-8 bg-white/20 rounded"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"font-semibold text-white",children:e.title}),n.jsx("p",{className:"text-sm text-vibetune-text-muted",children:e.count})]}),n.jsx(Qo,{size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full w-12 h-12 p-0",onClick:t=>{switch(t.stopPropagation(),e.title){case"Liked Songs":a("/liked");break;case"Recently Played":a("/search?type=recently-played");break;case"Heavy Rotation":case"Uniquely Yours":a("/search?type=featured-playlists");break;case"Jump Back In":a("/search?type=new-releases")}},children:n.jsx(on,{className:"w-5 h-5 ml-0.5"})})]},t))})]}),n.jsxs("section",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-2xl font-bold text-white",children:"🎵 Try Demo Music"}),n.jsx("p",{className:"text-sm text-vibetune-text-muted",children:"Click to test audio playback"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:Ek.getDemoTracks().map(e=>n.jsx("div",{className:"group bg-vibetune-gray/40 hover:bg-vibetune-gray/60 rounded-lg p-4 transition-all duration-300 cursor-pointer",onClick:async()=>{try{N({title:"🎵 Loading Demo Track",description:`Playing ${e.title} by ${e.artist}`}),await g(Ek.convertToTrack(e))}catch(t){N({title:"❌ Playback Error",description:"Failed to play demo track. Please try again.",variant:"destructive"})}},children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-vibetune-green to-blue-600 rounded-lg flex items-center justify-center",children:n.jsx(nn,{className:"w-8 h-8 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"font-semibold text-white",children:e.title}),n.jsx("p",{className:"text-sm text-vibetune-text-muted",children:e.artist}),n.jsx("p",{className:"text-xs text-vibetune-text-muted",children:e.genre})]}),n.jsx(Qo,{size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full w-12 h-12 p-0",onClick:e=>{e.stopPropagation()},children:n.jsx(on,{className:"w-5 h-5 ml-0.5"})})]})},e.id))})]}),n.jsxs("section",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-2xl font-bold text-white",children:"Recently played"}),n.jsx(Qo,{variant:"ghost",className:"text-vibetune-text-muted hover:text-white",onClick:()=>a("/search?type=recently-played"),children:"Show all"})]}),(()=>{const e=[...p,...d].filter((e,t,n)=>t===n.findIndex(t=>t.id===e.id));return e.length>0?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:e.slice(0,12).map(e=>{const t=p.some(t=>t.id===e.id);return n.jsxs("div",{className:"group cursor-pointer",onClick:async()=>{try{if(t)await g({id:e.id,title:e.title,artist:e.artist,albumArt:e.image,duration:0,url:"",spotifyId:e.id,isSpotifyTrack:!0,previewUrl:null,quality:"high"});else{if(!e.id)return;const t=await Sk.getTrack(e.id);await g({id:t.id,title:t.name,artist:(t.artists||[]).map(e=>e.name).join(", "),albumArt:t.album?.images?.[0]?.url||"",duration:t.duration_ms,url:t.preview_url||t.external_urls?.spotify||"",spotifyId:t.id,previewUrl:t.preview_url,isSpotifyTrack:!0,quality:"high"})}}catch(IE){}},children:[n.jsxs("div",{className:"relative mb-3",children:[n.jsx("img",{src:e.image,alt:e.title,className:"w-full aspect-square object-cover rounded-md"}),t&&n.jsx("div",{className:"absolute top-2 left-2 bg-vibetune-green text-black text-xs px-2 py-1 rounded-full font-medium",children:"VibeTune"}),n.jsx(Qo,{size:"sm",className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full w-12 h-12 p-0 shadow-lg",onClick:async n=>{n.stopPropagation();try{if(t)await g({id:e.id,title:e.title,artist:e.artist,albumArt:e.image,duration:0,url:"",spotifyId:e.id,isSpotifyTrack:!0,previewUrl:null,quality:"high"});else{if(!e.id)return;const t=await Sk.getTrack(e.id);await g({id:t.id,title:t.name,artist:(t.artists||[]).map(e=>e.name).join(", "),albumArt:t.album?.images?.[0]?.url||"",duration:t.duration_ms,url:t.preview_url||t.external_urls?.spotify||"",spotifyId:t.id,previewUrl:t.preview_url,isSpotifyTrack:!0,quality:"high"})}N({title:"🎵 Now Playing",description:`${e.title} by ${e.artist}`})}catch(r){N({title:"❌ Error",description:"Failed to play track. Please try again.",variant:"destructive"})}},children:n.jsx(on,{className:"w-5 h-5 ml-0.5"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity w-8 h-8 p-0 "+(y(e.id)?"text-vibetune-green":"text-vibetune-text-muted hover:text-white"),onClick:t=>{t.stopPropagation();const n={id:e.id,title:e.title,artist:e.artist,albumArt:e.image,duration:0,url:"",dateAdded:(new Date).toISOString()};x(n),N({title:y(e.id)?"❤️ Removed from Liked Songs":"❤️ Added to Liked Songs",description:`${e.title} has been ${y(e.id)?"removed from":"added to"} your liked songs.`})},children:n.jsx(qt,{className:"w-4 h-4 "+(y(e.id)?"fill-current":"")})}),t&&n.jsx(Qo,{variant:"ghost",size:"sm",className:"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity w-8 h-8 p-0 text-red-400 hover:text-red-300 hover:bg-red-500/20",onClick:t=>{t.stopPropagation(),(async e=>{try{const{recentlyPlayedService:t}=await pe(async()=>{const{recentlyPlayedService:e}=await import("./recentlyPlayedService-Dsp-bgAf.js");return{recentlyPlayedService:e}},[]);t.removeTrack(e);const n=t.getRecentlyPlayed(12).map(e=>({id:e.id,title:e.title,artist:e.artist,image:e.image}));f(n),N({title:"🗑️ Removed from Recently Played",description:"Track has been removed from your recently played list."})}catch(t){N({title:"❌ Error",description:"Failed to remove track from recently played.",variant:"destructive"})}})(e.id)},children:n.jsx(wn,{className:"w-4 h-4"})})]}),n.jsx("h3",{className:"font-semibold text-white truncate",children:e.title}),n.jsx("p",{className:"text-sm text-vibetune-text-muted truncate",children:e.artist})]},e.id)})}):n.jsxs("div",{className:"text-center py-8",children:[n.jsx(nn,{className:"w-16 h-16 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"No recently played tracks"}),n.jsx("p",{className:"text-vibetune-text-muted mb-4",children:"Start playing music in VibeTune or connect your Spotify account to see your recently played tracks here"}),n.jsxs("div",{className:"flex gap-3 justify-center",children:[!m&&n.jsx(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",onClick:()=>window.location.reload(),children:"Connect Spotify"}),n.jsx(Qo,{variant:"outline",className:"border-vibetune-green text-vibetune-green hover:bg-vibetune-green hover:text-black",onClick:()=>a("/search"),children:"Discover Music"})]})]})})()]}),n.jsxs("section",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-2xl font-bold text-white",children:"Top Artists"}),n.jsx(Qo,{variant:"ghost",className:"text-vibetune-text-muted hover:text-white",onClick:()=>a("/search?type=artists"),children:"Show all"})]}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:c.map(e=>n.jsxs("div",{className:"group cursor-pointer",onClick:async()=>{try{N({title:"🎵 Loading Artist",description:`Loading ${e.name}...`}),a(`/artist/${e.id}`)}catch(t){N({title:"❌ Error",description:"Failed to load artist. Please try again.",variant:"destructive"})}},children:[n.jsxs("div",{className:"relative mb-3",children:[e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-full"}):n.jsx("div",{className:"w-full aspect-square rounded-full bg-gradient-to-br from-violet-600 to-fuchsia-600 flex items-center justify-center",children:n.jsx(nn,{className:"w-8 h-8 text-white"})}),n.jsx(Qo,{size:"sm",className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full w-12 h-12 p-0 shadow-lg",onClick:async t=>{t.stopPropagation();try{N({title:"🎵 Loading Artist",description:`Loading ${e.name} top tracks...`});const t=await Sk.getArtistTopTracks(e.id,"US");if(t.tracks&&t.tracks.length>0){const e=t.tracks[0];await g({id:e.id,title:e.name,artist:e.artists.map(e=>e.name).join(", "),albumArt:e.album.images[0]?.url||"",duration:e.duration_ms,url:e.preview_url||e.external_urls?.spotify||"",spotifyId:e.id,previewUrl:e.preview_url,isSpotifyTrack:!0,quality:"high"}),N({title:"🎵 Now Playing",description:`${e.name} by ${e.artists.map(e=>e.name).join(", ")}`})}else N({title:"❌ No Tracks Found",description:`No top tracks available for ${e.name}`,variant:"destructive"})}catch(n){N({title:"❌ Error",description:"Failed to play artist. Please try again.",variant:"destructive"})}},children:n.jsx(on,{className:"w-5 h-5 ml-0.5"})})]}),n.jsx("h3",{className:"font-semibold text-white truncate",children:e.name}),n.jsx("p",{className:"text-sm text-vibetune-text-muted truncate",children:e.followers?.total?`${Math.floor(e.followers.total/1e3)}K followers`:"Artist"})]},e.id))})]}),n.jsxs("section",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-2xl font-bold text-white",children:"Popular albums"}),n.jsx(Qo,{variant:"ghost",className:"text-vibetune-text-muted hover:text-white",onClick:()=>a("/search?type=new-releases"),children:"Show all"})]}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:s.map((e,t)=>n.jsxs("div",{className:"group cursor-pointer",onClick:async()=>{try{N({title:"🎵 Loading Album",description:`Loading ${e.name}...`}),a(`/album/${e.id}`)}catch(t){N({title:"❌ Error",description:"Failed to load album. Please try again.",variant:"destructive"})}},children:[n.jsxs("div",{className:"relative mb-3",children:[e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-md"}):n.jsx("img",{src:"/placeholder.svg",alt:e.name,className:"w-full aspect-square object-cover rounded-md"}),n.jsx(Qo,{size:"sm",className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full w-12 h-12 p-0 shadow-lg",onClick:async t=>{t.stopPropagation();try{N({title:"🎵 Loading Album",description:`Loading ${e.name} tracks...`});const t=await Sk.getAlbumTracks(e.id);if(t.items&&t.items.length>0){const n=t.items[0];await g({id:n.id,title:n.name,artist:n.artists.map(e=>e.name).join(", "),albumArt:e.images[0]?.url||"",duration:n.duration_ms,url:n.preview_url||n.external_urls?.spotify||"",spotifyId:n.id,previewUrl:n.preview_url,isSpotifyTrack:!0,quality:"high"}),N({title:"🎵 Now Playing",description:`${n.name} by ${n.artists.map(e=>e.name).join(", ")}`})}else N({title:"❌ No Tracks Found",description:`No tracks available for ${e.name}`,variant:"destructive"})}catch(n){N({title:"❌ Error",description:"Failed to play album. Please try again.",variant:"destructive"})}},children:n.jsx(on,{className:"w-5 h-5 ml-0.5"})})]}),n.jsx("h3",{className:"font-semibold text-white truncate",children:e.name}),n.jsx("p",{className:"text-sm text-vibetune-text-muted truncate",children:(e.artists||[]).map(e=>e.name).join(", ")})]},e.id))})]}),n.jsx(MN,{isOpen:e,onClose:()=>r(!1),onCapture:e=>{o(e)},title:"AI-Powered Camera",enableFaceDetection:!0})]})}const _k=()=>{const e=mo();return t.useEffect(()=>{},[e.pathname]),n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-vibetune-dark",children:n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("div",{className:"w-24 h-24 bg-vibetune-green rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(nn,{className:"w-12 h-12 text-black"})}),n.jsx("h1",{className:"text-6xl font-bold mb-4 text-white",children:"404"}),n.jsx("p",{className:"text-xl text-vibetune-text-muted mb-8",children:"The page you're looking for doesn't exist in VibeTune"})]}),n.jsx(zo,{to:"/",children:n.jsxs(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black font-semibold",children:[n.jsx(Gt,{className:"w-4 h-4 mr-2"}),"Back to Home"]})}),n.jsx("p",{className:"text-sm text-vibetune-text-muted mt-6",children:"Continue exploring your music with VibeTune"})]})})},Ik=t.forwardRef(({className:e,type:t,...r},a)=>n.jsx("input",{type:t,className:Nr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...r}));Ik.displayName="Input";const Tk=[{name:"Pop",color:"bg-pink-500",query:"pop music"},{name:"Hip-Hop",color:"bg-purple-600",query:"hip hop music"},{name:"Rock",color:"bg-red-500",query:"rock music"},{name:"Jazz",color:"bg-blue-600",query:"jazz music"},{name:"Electronic",color:"bg-green-500",query:"electronic music"},{name:"Country",color:"bg-yellow-600",query:"country music"},{name:"R&B",color:"bg-indigo-600",query:"rnb music"},{name:"Classical",color:"bg-gray-600",query:"classical music"},{name:"Reggae",color:"bg-orange-500",query:"reggae music"},{name:"Folk",color:"bg-teal-600",query:"folk music"}],Ak=["Bad Bunny","Taylor Swift","Drake","Olivia Rodrigo","Billie Eilish","The Weeknd"];function Dk(){const[e,r]=t.useState(""),[a,i]=t.useState(""),[o,s]=t.useState(null),[u]=qo(),{playTrack:c,currentTrack:l,isPlaying:d}=yk?.()||{},{user:h}=is(),{isLiked:p,toggleLike:f}=Nk(),[m,v]=t.useState({}),g=u.get("type")||"general",x=t.useCallback(((e,t)=>{let n;const r=(...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t)};return r.cancel=()=>clearTimeout(n),r})(e=>{i(e)},300),[]);t.useEffect(()=>(x(e),()=>{x.cancel()}),[e,x]);const{data:y,isLoading:b,error:w}=Ri({queryKey:["search",a,g],queryFn:()=>"recently-played"===g?(async()=>{try{const e=await fetch("/api/spotify/me/player/recently-played");return{tracks:{items:(await e.json()).items||[]}}}catch(w){return{tracks:{items:[]}}}})():"featured-playlists"===g?(async()=>{try{const e=await fetch("/api/spotify/featured-playlists"),t=await e.json();return{playlists:{items:t.playlists?.items||[]}}}catch(w){return{playlists:{items:[]}}}})():"new-releases"===g?(async()=>{try{const e=await fetch("/api/spotify/new-releases"),t=await e.json();return{albums:{items:t.albums?.items||[]}}}catch(w){return{albums:{items:[]}}}})():(async e=>{if(!e.trim())return{tracks:{items:[],total:0}};const t=await fetch(`/api/spotify/search?q=${encodeURIComponent(e)}&type=track&limit=20`);if(!t.ok)throw new Error("Failed to search");return t.json()})(a),enabled:a.length>0||"general"!==g,staleTime:3e4});return t.useEffect(()=>{(async()=>{try{if(!h||!y?.tracks?.items?.length)return void v({});const e=y?.tracks?.items?.map(e=>e.id)||[],t=await Sk.checkSavedTracks(e),n={};e.forEach((e,r)=>{n[e]=!!t[r]}),v(n)}catch(IE){}})()},[h,y?.tracks?.items?.length]),n.jsxs("div",{className:"p-6",children:["general"===g&&n.jsx("div",{className:"mb-8",children:n.jsxs("div",{className:"relative max-w-md",children:[n.jsx(pn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-vibetune-text-muted w-5 h-5"}),n.jsx(Ik,{value:e,onChange:e=>{return t=e.target.value,void r(t);var t},placeholder:"What do you want to listen to?",className:"pl-10 bg-white text-black placeholder:text-gray-600 border-0 rounded-full h-12"})]})}),(a||"general"!==g)&&n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:b?"Loading...":"recently-played"===g?"Recently Played":"featured-playlists"===g?"Made for You":"new-releases"===g?"Popular Albums":`Search results for "${a}"`}),b&&n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"w-8 h-8 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin"})}),w&&n.jsx("div",{className:"text-red-400 text-center py-4",children:"Failed to search. Please try again."}),y?.tracks?.items&&y.tracks.items.length>0&&n.jsx("div",{className:"space-y-2",children:y.tracks.items.map((e,t)=>{return n.jsxs("div",{className:"flex items-center space-x-4 p-3 hover:bg-vibetune-gray/40 rounded-md cursor-pointer transition-colors group",onClick:()=>(async e=>{if(c)try{await c({id:e.id,title:e.name,artist:e.artists[0]?.name||"Unknown Artist",albumArt:e.album.images[0]?.url||"",duration:e.duration_ms,url:e.preview_url||e.external_urls.spotify,spotifyId:e.id,previewUrl:e.preview_url,isSpotifyTrack:!0,quality:"high"}),s(e)}catch(t){}})(e),children:[n.jsxs("div",{className:"relative",children:[n.jsx("img",{src:e.album.images[0]?.url||"/placeholder.svg",alt:e.album.name,className:"w-12 h-12 rounded-md object-cover"}),n.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded-md",children:n.jsx(on,{className:"w-5 h-5 text-white"})})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsx("div",{className:"text-vibetune-text-muted text-sm truncate",children:e.artists.map(e=>e.name).join(", ")})]}),n.jsxs("div",{className:"flex items-center space-x-4 text-vibetune-text-muted",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity "+(p(e.id)?"text-vibetune-green":"text-vibetune-text-muted hover:text-white"),onClick:t=>{t.stopPropagation(),(async e=>{if(h)try{const t=!!m[e.id];t?await Sk.removeSavedTracks([e.id]):await Sk.saveTracks([e.id]),v(n=>({...n,[e.id]:!t}))}catch(t){const r={id:e.id,title:e.name,artist:e.artists[0]?.name||"Unknown Artist",albumArt:e.album.images[0]?.url||"",duration:e.duration_ms,url:e.preview_url||e.external_urls.spotify};f(r)}else{const t={id:e.id,title:e.name,artist:e.artists[0]?.name||"Unknown Artist",albumArt:e.album.images[0]?.url||"",duration:e.duration_ms,url:e.preview_url||e.external_urls.spotify};f(t)}})(e)},children:n.jsx(qt,{className:"w-4 h-4 "+(p(e.id)?"fill-current":"")})}),n.jsx("span",{className:"text-sm",children:(r=e.duration_ms,`${Math.floor(r/6e4)}:${Math.floor(r%6e4/1e3).toString().padStart(2,"0")}`)})]})]},e.id);var r})}),y?.tracks?.items&&0===y.tracks.items.length&&!b&&n.jsxs("div",{className:"text-vibetune-text-muted text-center py-8",children:['No results found for "',a,'"']}),y?.playlists?.items&&y.playlists.items.length>0&&n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:y.playlists.items.map(e=>n.jsxs("div",{className:"group cursor-pointer",children:[n.jsxs("div",{className:"relative mb-3",children:[e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-md"}):n.jsx("div",{className:"w-full aspect-square rounded-md bg-gradient-to-br from-violet-600 to-fuchsia-600 p-4 flex items-end",children:n.jsx("div",{className:"w-full h-16 bg-black/20 rounded"})}),n.jsx(Qo,{size:"sm",className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full w-12 h-12 p-0 shadow-lg",children:n.jsx(on,{className:"w-5 h-5 ml-0.5"})})]}),n.jsx("h3",{className:"font-semibold text-white truncate",children:e.name}),n.jsx("p",{className:"text-sm text-vibetune-text-muted truncate",children:e.description||"Featured"})]},e.id))}),y?.albums?.items&&y.albums.items.length>0&&n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:y.albums.items.map(e=>n.jsxs("div",{className:"group cursor-pointer",children:[n.jsxs("div",{className:"relative mb-3",children:[e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-md"}):n.jsx("img",{src:"/placeholder.svg",alt:e.name,className:"w-full aspect-square object-cover rounded-md"}),n.jsx(Qo,{size:"sm",className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full w-12 h-12 p-0 shadow-lg",children:n.jsx(on,{className:"w-5 h-5 ml-0.5"})})]}),n.jsx("h3",{className:"font-semibold text-white truncate",children:e.name}),n.jsx("p",{className:"text-sm text-vibetune-text-muted truncate",children:e.artists.map(e=>e.name).join(", ")})]},e.id))})]}),!a&&"general"===g&&n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Trending searches"}),n.jsx("div",{className:"space-y-2",children:Ak.map((e,t)=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/40 rounded-md cursor-pointer transition-colors",onClick:()=>(e=>{r(e),i(e)})(e),children:[n.jsx(Nn,{className:"w-5 h-5 text-vibetune-green"}),n.jsx("span",{className:"text-white",children:e})]},t))})]}),!a&&"general"===g&&n.jsxs("section",{children:[n.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Browse all"}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Tk.map((e,t)=>n.jsxs("div",{className:`${e.color} rounded-lg p-4 h-32 relative overflow-hidden cursor-pointer hover:scale-105 transition-transform`,onClick:()=>(e=>{r(e.query),i(e.query)})(e),children:[n.jsx("h3",{className:"text-white font-bold text-lg",children:e.name}),n.jsx("div",{className:"absolute -bottom-2 -right-2 w-16 h-16 bg-black/20 rounded-lg transform rotate-12"})]},t))})]})]})}function Pk(){const[e,r]=t.useState("All"),[a,i]=t.useState(""),[o,s]=t.useState([]),[u,c]=t.useState([]),[l,d]=t.useState([]),[h,p]=t.useState([]),[f,m]=t.useState(!1),[v,g]=t.useState("grid"),[x,y]=t.useState(!1),[b,w]=t.useState(null),[N,k]=t.useState([]),[C,j]=t.useState([]),[S,E]=t.useState(!1),[R,_]=t.useState([]),[I,T]=t.useState(!1),[A,D]=t.useState(""),[P,M]=t.useState(!1),F=go(),{playTrack:O}=yk(),{toggleLike:L,isLiked:B}=Nk(),{toast:z}=Ce();t.useEffect(()=>{(async()=>{m(!0);try{const e=await Sk.getUserPlaylists(50,0);s(e.items||[])}catch(e){}try{const e=await Sk.getSavedAlbums(50,0);c((e.items||[]).map(e=>e.album))}catch(e){}try{const e=await Sk.getFollowedArtists(50);d(e.artists?.items||[])}catch(e){}try{const e=await Sk.getSavedTracks(50,0);p((e.items||[]).map(e=>e.track))}catch(e){}try{await Z()}catch(e){}m(!1)})()},[]);const U=t.useMemo(()=>o.filter(e=>e.name?.toLowerCase().includes(a.toLowerCase())),[o,a]),W=t.useMemo(()=>u.filter(e=>e.name?.toLowerCase().includes(a.toLowerCase())),[u,a]),V=t.useMemo(()=>l.filter(e=>e.name?.toLowerCase().includes(a.toLowerCase())),[l,a]),H=t.useMemo(()=>R.filter(e=>e.name?.toLowerCase().includes(A.toLowerCase())),[R,A]),q=t.useMemo(()=>h.filter(e=>e.name?.toLowerCase().includes(a.toLowerCase())),[h,a]),G=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`,K=async e=>{try{await O(e),z({title:"🎵 Playing",description:`Now playing "${e.name}"`})}catch(t){z({title:"❌ Error",description:"Failed to play track. Please try again.",variant:"destructive"})}},$=async e=>{try{await L(e),z({title:B(e.id)?"💔 Removed from Liked":"❤️ Added to Liked",description:`"${e.name}" ${B(e.id)?"removed from":"added to"} your liked songs`})}catch(t){z({title:"❌ Error",description:"Failed to update liked status. Please try again.",variant:"destructive"})}},X=()=>{F("/create-playlist")},Y=e=>{F(`/playlist/${e}`)},Q=e=>{F(`/album/${e}`)},J=async e=>{w(e),E(!0);try{const t=await Sk.getArtistTopTracks(e.id);k(t.tracks||[]);const n=await Sk.getArtistAlbums(e.id);j(n.items||[])}catch(t){z({title:"❌ Error",description:"Failed to load artist details. Please try again.",variant:"destructive"})}finally{E(!1)}},Z=async()=>{T(!0);try{const e=["pop","rock","hip hop","electronic","classical","jazz","country","r&b"],t=e[Math.floor(Math.random()*e.length)],n=await Sk.search(t,"artist",30);_(n.artists?.items||[])}catch(e){z({title:"❌ Error",description:"Failed to load artists. Please try again.",variant:"destructive"})}finally{T(!1)}};return n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h1",{className:"text-2xl font-bold text-white",children:"Your Library"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:x?"text-white bg-vibetune-gray":"text-vibetune-text-muted hover:text-white",onClick:()=>y(!x),children:n.jsx(pn,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"grid"===v?"text-white bg-vibetune-gray":"text-vibetune-text-muted hover:text-white",onClick:()=>g("grid"),children:n.jsx(Ht,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"list"===v?"text-white bg-vibetune-gray":"text-vibetune-text-muted hover:text-white",onClick:()=>g("list"),children:n.jsx(Yt,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[n.jsxs(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full",onClick:X,children:[n.jsx(sn,{className:"w-4 h-4 mr-2"}),"Create playlist"]}),n.jsx(Qo,{variant:"outline",className:"border-vibetune-gray text-white hover:bg-vibetune-gray",onClick:()=>{z({title:"📥 Import",description:"Import functionality coming soon!"})},children:"Import"})]}),n.jsx("div",{className:"flex items-center space-x-4 mb-6",children:["All","Playlists","Artists","Albums","Podcasts"].map(t=>n.jsx(Qo,{variant:"ghost",size:"sm",onClick:()=>r(t),className:"rounded-full "+(t===e?"bg-white text-black":"bg-vibetune-gray text-white hover:bg-vibetune-light-gray"),children:t},t))}),x&&n.jsx("div",{className:"mb-6",children:n.jsxs("div",{className:"relative max-w-xs",children:[n.jsx(pn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-vibetune-text-muted w-4 h-4"}),n.jsx(Ik,{placeholder:`Search in ${e}`,value:a,onChange:e=>i(e.target.value),className:"pl-10 bg-vibetune-gray text-white placeholder:text-vibetune-text-muted border-0 h-10"})]})}),n.jsxs("div",{className:"space-y-6",children:[f&&n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"w-6 h-6 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin"})}),"Podcasts"===e&&n.jsxs("section",{children:[n.jsx("h2",{className:"text-white font-semibold mb-4",children:"Podcasts & Shows"}),n.jsxs("div",{className:"text-center py-12",children:[n.jsx(nn,{className:"w-16 h-16 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"No Podcasts Yet"}),n.jsx("p",{className:"text-vibetune-text-muted mb-4",children:"Podcasts are not available in your region yet. Check back later!"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"In the meantime, enjoy your music library below."})]})]}),("All"===e||"Podcasts"===e)&&q.length>0&&n.jsxs("section",{children:[n.jsx("h2",{className:"text-white font-semibold mb-4",children:"Podcasts"===e?"Your Music Collection":"Liked Songs"}),"grid"===v?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:q.slice(0,10).map(e=>n.jsxs("div",{className:"group cursor-pointer",children:[n.jsxs("div",{className:"relative mb-2",children:[e.album?.images?.[0]?.url?n.jsx("img",{src:e.album.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-md"}):n.jsx("div",{className:"w-full aspect-square bg-vibetune-gray rounded-md flex items-center justify-center",children:n.jsx(nn,{className:"w-8 h-8 text-vibetune-text-muted"})}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Qo,{size:"sm",className:"w-8 h-8 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full shadow-lg",onClick:()=>K(e),children:n.jsx(on,{className:"w-4 h-4 ml-0.5"})})})]}),n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsx("div",{className:"text-vibetune-text-muted text-sm truncate",children:e.artists?.map(e=>e.name).join(", ")})]},e.id))}):n.jsx("div",{className:"space-y-2",children:q.slice(0,20).map(e=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/20 rounded-md group",children:[n.jsx("img",{src:e.album?.images?.[0]?.url||"/placeholder.svg",alt:e.name,className:"w-12 h-12 rounded-md object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsx("div",{className:"text-vibetune-text-muted text-sm truncate",children:e.artists?.map(e=>e.name).join(", ")})]}),n.jsx("div",{className:"text-vibetune-text-muted text-sm",children:G(e.duration_ms)}),n.jsxs("div",{className:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Qo,{variant:"ghost",size:"sm",onClick:()=>K(e),className:"w-8 h-8 p-0 text-vibetune-green hover:text-white",children:n.jsx(on,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",onClick:()=>$(e),className:"w-8 h-8 p-0 text-red-400 hover:text-red-300",children:n.jsx(qt,{className:"w-4 h-4 "+(B(e.id)?"fill-current":"")})})]})]},e.id))})]}),("All"===e||"Playlists"===e)&&n.jsxs("section",{children:[n.jsx("h2",{className:"text-white font-semibold mb-4",children:"Playlists"}),"grid"===v?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:U.map(e=>n.jsxs("div",{className:"group cursor-pointer",onClick:()=>Y(e.id),children:[n.jsxs("div",{className:"relative mb-2",children:[e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-md"}):n.jsx("div",{className:"w-full aspect-square bg-vibetune-gray rounded-md flex items-center justify-center",children:n.jsx(nn,{className:"w-8 h-8 text-vibetune-text-muted"})}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Qo,{size:"sm",className:"w-8 h-8 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full shadow-lg",children:n.jsx(on,{className:"w-4 h-4 ml-0.5"})})})]}),n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-vibetune-text-muted text-sm truncate",children:[e.tracks?.total||0," songs"]})]},e.id))}):n.jsx("div",{className:"space-y-2",children:U.map(e=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/20 rounded-md group cursor-pointer",onClick:()=>Y(e.id),children:[n.jsx("img",{src:e.images?.[0]?.url||"/placeholder.svg",alt:e.name,className:"w-12 h-12 rounded-md object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-vibetune-text-muted text-sm truncate",children:[e.tracks?.total||0," songs • ",e.owner?.display_name||"You"]})]}),n.jsxs("div",{className:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-green hover:text-white",children:n.jsx(on,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-text-muted hover:text-white",children:n.jsx(Ut,{className:"w-4 h-4"})})]})]},e.id))})]}),("All"===e||"Artists"===e)&&n.jsx("section",{children:b?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex items-center space-x-4 mb-6",children:n.jsx(Qo,{variant:"ghost",onClick:()=>{w(null),k([]),j([])},className:"text-vibetune-text-muted hover:text-white",children:"← Back to Artists"})}),n.jsxs("div",{className:"flex items-center space-x-6 mb-8",children:[n.jsx("img",{src:b.images?.[0]?.url||"/placeholder.svg",alt:b.name,className:"w-32 h-32 rounded-full object-cover"}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:b.name}),n.jsxs("p",{className:"text-vibetune-text-muted text-lg",children:[b.followers?.total?.toLocaleString()||0," followers"]}),n.jsx("p",{className:"text-vibetune-text-muted",children:b.genres?.join(", ")||"Artist"})]})]}),S?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"w-6 h-6 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin"})}):n.jsxs("div",{className:"space-y-8",children:[N.length>0&&n.jsxs("div",{children:[n.jsx("h2",{className:"text-white text-xl font-semibold mb-4",children:"Popular Songs"}),n.jsx("div",{className:"space-y-2",children:N.slice(0,10).map((e,t)=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/20 rounded-md group",children:[n.jsx("div",{className:"text-vibetune-text-muted text-sm w-6",children:t+1}),n.jsx("img",{src:e.album?.images?.[0]?.url||"/placeholder.svg",alt:e.name,className:"w-12 h-12 rounded-md object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsx("div",{className:"text-vibetune-text-muted text-sm truncate",children:e.artists?.map(e=>e.name).join(", ")})]}),n.jsx("div",{className:"text-vibetune-text-muted text-sm",children:G(e.duration_ms)}),n.jsxs("div",{className:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Qo,{variant:"ghost",size:"sm",onClick:()=>K(e),className:"w-8 h-8 p-0 text-vibetune-green hover:text-white",children:n.jsx(on,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",onClick:()=>$(e),className:"w-8 h-8 p-0 text-red-400 hover:text-red-300",children:n.jsx(qt,{className:"w-4 h-4 "+(B(e.id)?"fill-current":"")})})]})]},e.id))})]}),C.length>0&&n.jsxs("div",{children:[n.jsx("h2",{className:"text-white text-xl font-semibold mb-4",children:"Albums"}),"grid"===v?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:C.slice(0,10).map(e=>n.jsxs("div",{className:"group cursor-pointer",onClick:()=>Q(e.id),children:[n.jsxs("div",{className:"relative mb-2",children:[n.jsx("img",{src:e.images?.[0]?.url||"/placeholder.svg",alt:e.name,className:"w-full aspect-square object-cover rounded-md"}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Qo,{size:"sm",className:"w-8 h-8 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full shadow-lg",children:n.jsx(on,{className:"w-4 h-4 ml-0.5"})})})]}),n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsx("div",{className:"text-vibetune-text-muted text-sm truncate",children:e.release_date?.split("-")[0]||""})]},e.id))}):n.jsx("div",{className:"space-y-2",children:C.slice(0,10).map(e=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/20 rounded-md group cursor-pointer",onClick:()=>Q(e.id),children:[n.jsx("img",{src:e.images?.[0]?.url||"/placeholder.svg",alt:e.name,className:"w-12 h-12 rounded-md object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-vibetune-text-muted text-sm truncate",children:[e.album_type," • ",e.release_date?.split("-")[0]||""]})]}),n.jsx("div",{className:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-green hover:text-white",children:n.jsx(on,{className:"w-4 h-4"})})})]},e.id))})]})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-white font-semibold",children:"Artists"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:P?"text-white bg-vibetune-gray":"text-vibetune-text-muted hover:text-white",onClick:()=>M(!P),children:n.jsx(pn,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"outline",size:"sm",className:"border-vibetune-gray text-white hover:bg-vibetune-gray",onClick:Z,children:"Discover Artists"})]})]}),P&&n.jsx("div",{className:"mb-6",children:n.jsxs("div",{className:"relative max-w-md",children:[n.jsx(pn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-vibetune-text-muted w-4 h-4"}),n.jsx(Ik,{placeholder:"Search for artists...",value:A,onChange:e=>{D(e.target.value),(async e=>{if(e.trim()){T(!0);try{const t=await Sk.search(e,"artist",50);_(t.artists?.items||[])}catch(t){z({title:"❌ Error",description:"Failed to search artists. Please try again.",variant:"destructive"})}finally{T(!1)}}else _([])})(e.target.value)},className:"pl-10 bg-vibetune-gray text-white placeholder:text-vibetune-text-muted border-0 h-10"})]})}),V.length>0&&n.jsxs("div",{className:"mb-6",children:[n.jsx("h3",{className:"text-white text-lg font-medium mb-3",children:"Your Followed Artists"}),"grid"===v?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:V.map(e=>n.jsxs("div",{className:"group cursor-pointer text-center",onClick:()=>J(e),children:[n.jsxs("div",{className:"mb-2 relative",children:[e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-full"}):n.jsx("div",{className:"w-full aspect-square bg-vibetune-gray rounded-full flex items-center justify-center",children:n.jsx(nn,{className:"w-8 h-8 text-vibetune-text-muted"})}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Qo,{size:"sm",className:"w-8 h-8 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full shadow-lg",children:n.jsx(on,{className:"w-4 h-4 ml-0.5"})})})]}),n.jsx("div",{className:"text-white font-medium truncate",children:e.name})]},e.id))}):n.jsx("div",{className:"space-y-2",children:V.map(e=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/20 rounded-md group cursor-pointer",onClick:()=>J(e),children:[n.jsx("img",{src:e.images?.[0]?.url||"/placeholder.svg",alt:e.name,className:"w-12 h-12 rounded-full object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-vibetune-text-muted text-sm truncate",children:[e.followers?.total?.toLocaleString()||0," followers"]})]}),n.jsxs("div",{className:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-green hover:text-white",children:n.jsx(on,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-text-muted hover:text-white",children:n.jsx(Ut,{className:"w-4 h-4"})})]})]},e.id))})]}),I?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"w-6 h-6 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin"})}):H.length>0?n.jsxs("div",{children:[n.jsx("h3",{className:"text-white text-lg font-medium mb-3",children:A?`Search Results for "${A}"`:"Discover Artists"}),"grid"===v?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:H.map(e=>n.jsxs("div",{className:"group cursor-pointer text-center",onClick:()=>J(e),children:[n.jsxs("div",{className:"mb-2 relative",children:[e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-full"}):n.jsx("div",{className:"w-full aspect-square bg-vibetune-gray rounded-full flex items-center justify-center",children:n.jsx(nn,{className:"w-8 h-8 text-vibetune-text-muted"})}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Qo,{size:"sm",className:"w-8 h-8 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full shadow-lg",children:n.jsx(on,{className:"w-4 h-4 ml-0.5"})})})]}),n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-vibetune-text-muted text-xs truncate",children:[e.followers?.total?.toLocaleString()||0," followers"]})]},e.id))}):n.jsx("div",{className:"space-y-2",children:H.map(e=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/20 rounded-md group cursor-pointer",onClick:()=>J(e),children:[n.jsx("img",{src:e.images?.[0]?.url||"/placeholder.svg",alt:e.name,className:"w-12 h-12 rounded-full object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-vibetune-text-muted text-sm truncate",children:[e.followers?.total?.toLocaleString()||0," followers • ",e.genres?.slice(0,2).join(", ")||"Artist"]})]}),n.jsxs("div",{className:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-green hover:text-white",children:n.jsx(on,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-text-muted hover:text-white",children:n.jsx(Ut,{className:"w-4 h-4"})})]})]},e.id))})]}):A?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(nn,{className:"w-16 h-16 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"No Artists Found"}),n.jsxs("p",{className:"text-vibetune-text-muted mb-4",children:['No artists found for "',A,'"']})]}):n.jsxs("div",{children:[n.jsx("h3",{className:"text-white text-lg font-medium mb-3",children:"Popular Artists"}),I?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"w-6 h-6 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin"})}):R.length>0?n.jsxs(n.Fragment,{children:["grid"===v?n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:R.slice(0,12).map(e=>n.jsxs("div",{className:"group cursor-pointer text-center",onClick:()=>J(e),children:[n.jsxs("div",{className:"mb-2 relative",children:[e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-full"}):n.jsx("div",{className:"w-full aspect-square bg-vibetune-gray rounded-full flex items-center justify-center",children:n.jsx(nn,{className:"w-8 h-8 text-vibetune-text-muted"})}),n.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Qo,{size:"sm",className:"w-8 h-8 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full shadow-lg",children:n.jsx(on,{className:"w-4 h-4 ml-0.5"})})})]}),n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-vibetune-text-muted text-xs truncate",children:[e.followers?.total?.toLocaleString()||0," followers"]})]},e.id))}):n.jsx("div",{className:"space-y-2",children:R.slice(0,12).map(e=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/20 rounded-md group cursor-pointer",onClick:()=>J(e),children:[n.jsx("img",{src:e.images?.[0]?.url||"/placeholder.svg",alt:e.name,className:"w-12 h-12 rounded-full object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsxs("div",{className:"text-vibetune-text-muted text-sm truncate",children:[e.followers?.total?.toLocaleString()||0," followers • ",e.genres?.slice(0,2).join(", ")||"Artist"]})]}),n.jsxs("div",{className:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-green hover:text-white",children:n.jsx(on,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-text-muted hover:text-white",children:n.jsx(Ut,{className:"w-4 h-4"})})]})]},e.id))}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",onClick:Z,children:[n.jsx(pn,{className:"w-4 h-4 mr-2"}),"Discover More Artists"]})})]}):n.jsxs("div",{className:"text-center py-8",children:[n.jsx(nn,{className:"w-16 h-16 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Discover New Artists"}),n.jsx("p",{className:"text-vibetune-text-muted mb-4",children:'Search for artists or click "Discover Artists" to find new music'}),n.jsxs(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",onClick:Z,children:[n.jsx(pn,{className:"w-4 h-4 mr-2"}),"Discover Artists"]})]})]})]})}),("All"===e||"Albums"===e)&&n.jsxs("section",{children:[n.jsx("h2",{className:"text-white font-semibold mb-4",children:"Albums"}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:W.map(e=>n.jsxs("div",{className:"group cursor-pointer",children:[n.jsx("div",{className:"relative mb-2",children:e.images?.[0]?.url?n.jsx("img",{src:e.images[0].url,alt:e.name,className:"w-full aspect-square object-cover rounded-md"}):n.jsx("div",{className:"w-full aspect-square bg-vibetune-gray rounded-md"})}),n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsx("div",{className:"text-vibetune-text-muted text-sm truncate",children:(e.artists||[]).map(e=>e.name).join(", ")})]},e.id))})]}),!f&&0===U.length&&0===W.length&&0===V.length&&0===q.length&&n.jsxs("div",{className:"text-center py-12",children:[n.jsx(nn,{className:"w-16 h-16 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Your Library is Empty"}),n.jsx("p",{className:"text-vibetune-text-muted mb-4",children:a?`No results found for "${a}"`:"Start by creating a playlist or saving some music"}),!a&&n.jsxs(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",onClick:X,children:[n.jsx(sn,{className:"w-4 h-4 mr-2"}),"Create Your First Playlist"]})]})]})]})}function Mk(){const{id:e}=xo(),[r,a]=t.useState(null),[i,o]=t.useState([]),{playTrack:s}=yk();return t.useEffect(()=>{(async()=>{if(e)try{const t=await Sk.getPlaylist(e);a(t);const n=await Sk.getPlaylistTracksAll(e);o(n)}catch(IE){}})()},[e]),n.jsxs("div",{children:[n.jsx("div",{className:"bg-gradient-to-b from-vibetune-green/20 to-vibetune-dark p-6 pb-8",children:n.jsxs("div",{className:"flex items-end space-x-6",children:[n.jsx("div",{className:"w-56 h-56 bg-vibetune-gray rounded-lg shadow-2xl overflow-hidden",children:r?.images?.[0]?.url?n.jsx("img",{src:r.images[0].url,alt:r?.name,className:"w-full h-full object-cover"}):n.jsx("img",{src:"/placeholder.svg",alt:r?.name,className:"w-full h-full object-cover"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium text-white mb-2",children:"PLAYLIST"}),n.jsx("h1",{className:"text-5xl font-bold text-white mb-4",children:r?.name||"Playlist"}),n.jsxs("p",{className:"text-vibetune-text-muted mb-2",children:[r?.owner?.display_name," • ",r?.tracks?.total||0," songs"]})]})]})}),n.jsx("div",{className:"px-6 py-4 bg-vibetune-dark",children:n.jsxs("div",{className:"flex items-center space-x-6",children:[n.jsx(Qo,{className:"w-14 h-14 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full",children:n.jsx(on,{className:"w-6 h-6 ml-0.5"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"text-vibetune-text-muted hover:text-white",children:n.jsx(qt,{className:"w-6 h-6"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"text-vibetune-text-muted hover:text-white",children:n.jsx(Ut,{className:"w-6 h-6"})})]})}),n.jsxs("div",{className:"px-6",children:[n.jsxs("div",{className:"grid grid-cols-[16px_6fr_4fr_3fr_minmax(120px,1fr)] gap-4 px-4 py-2 text-sm text-vibetune-text-muted border-b border-vibetune-gray/20 mb-4",children:[n.jsx("div",{children:"#"}),n.jsx("div",{children:"TITLE"}),n.jsx("div",{children:"ALBUM"}),n.jsx("div",{children:"DATE ADDED"}),n.jsx("div",{className:"flex justify-end",children:n.jsx(Bt,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"space-y-1",children:i.map((e,t)=>{const r=e.track;if(!r)return null;const a=Math.floor((r.duration_ms||0)/6e4),i=Math.floor((r.duration_ms||0)%6e4/1e3).toString().padStart(2,"0");return n.jsxs("div",{className:"grid grid-cols-[16px_6fr_4fr_3fr_minmax(120px,1fr)] gap-4 px-4 py-2 text-sm hover:bg-vibetune-gray/20 rounded-md group cursor-pointer",onClick:async()=>{await s({id:r.id,title:r.name,artist:(r.artists||[]).map(e=>e.name).join(", "),albumArt:r.album?.images?.[0]?.url||"",duration:r.duration_ms,url:r.preview_url||r.external_urls?.spotify||"",spotifyId:r.id,previewUrl:r.preview_url,isSpotifyTrack:!0,quality:"high"})},children:[n.jsxs("div",{className:"flex items-center text-vibetune-text-muted",children:[n.jsx("span",{className:"group-hover:hidden",children:t+1}),n.jsx(on,{className:"w-4 h-4 hidden group-hover:block"})]}),n.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[n.jsx("img",{src:r.album?.images?.[0]?.url||"/placeholder.svg",alt:r.name,className:"w-10 h-10 rounded"}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:r.name}),n.jsx("div",{className:"text-vibetune-text-muted truncate",children:(r.artists||[]).map(e=>e.name).join(", ")})]})]}),n.jsx("div",{className:"flex items-center text-vibetune-text-muted truncate",children:r.album?.name}),n.jsx("div",{className:"flex items-center text-vibetune-text-muted"}),n.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[n.jsxs("span",{className:"text-vibetune-text-muted",children:[a,":",i]}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 w-8 h-8 p-0",children:n.jsx(Ut,{className:"w-4 h-4 text-vibetune-text-muted"})})]})]},r.id||t)})})]})]})}function Fk(){const[e,r]=t.useState(""),[a,i]=t.useState(!1),{loginWithSpotify:o}=is(),s=async()=>{try{(await fetch("/api/auth/user",{credentials:"include"})).ok&&(window.location.href="/")}catch(e){}};return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-vibetune-dark via-vibetune-darker to-black flex items-center justify-center p-4",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("div",{className:"flex items-center justify-center mb-4",children:n.jsx("div",{className:"w-12 h-12 bg-vibetune-green rounded-full flex items-center justify-center",children:n.jsx(nn,{className:"w-7 h-7 text-black"})})}),n.jsx("h1",{className:"text-3xl font-bold text-white",children:"Welcome back"}),n.jsx("p",{className:"text-vibetune-text-muted mt-2",children:"Sign in to your VibeTune account"})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 backdrop-blur-sm rounded-2xl p-8 border border-vibetune-gray/20",children:[e&&n.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3 mb-6",children:n.jsx("p",{className:"text-red-400 text-sm",children:e})}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Connect with Spotify"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Access your music library, playlists, and discover new tracks"})]}),n.jsx(Qo,{onClick:async()=>{try{r(""),i(!0);const e=await fetch("/api/auth/spotify/url"),t=await e.json();if(!e.ok)throw new Error(t.error||"Failed to get authorization URL");const n=window.open(t.authUrl,"spotify-login","width=500,height=700,scrollbars=yes,resizable=yes,status=yes,location=yes,toolbar=no,menubar=no");if(!n)throw new Error("Popup blocked. Please allow popups for this site.");const a=setInterval(()=>{n.closed&&(clearInterval(a),i(!1),s())},1e3),o=e=>{e.origin===window.location.origin&&("SPOTIFY_AUTH_SUCCESS"===e.data.type?(clearInterval(a),n.close(),window.removeEventListener("message",o),window.location.href="/"):"SPOTIFY_AUTH_ERROR"===e.data.type&&(clearInterval(a),n.close(),window.removeEventListener("message",o),r(e.data.error||"Authentication failed"),i(!1)))};window.addEventListener("message",o)}catch(e){r(e instanceof Error?e.message:"Failed to connect with Spotify. Please try again."),i(!1)}},className:"w-full bg-[#1DB954] hover:bg-[#1ed760] text-white font-semibold py-4 rounded-full transition-all duration-200 flex items-center justify-center space-x-3",disabled:a,children:a?n.jsxs(n.Fragment,{children:[n.jsx(Qt,{className:"w-5 h-5 animate-spin"}),n.jsx("span",{children:"Connecting to Spotify..."})]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:n.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.299.421-1.02.599-1.559.3z"})}),n.jsx("span",{children:"Continue with Spotify"})]})}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-0 flex items-center",children:n.jsx("div",{className:"w-full border-t border-vibetune-gray/30"})}),n.jsx("div",{className:"relative flex justify-center text-sm",children:n.jsx("span",{className:"px-4 bg-vibetune-gray/20 text-vibetune-text-muted",children:"Why Spotify?"})})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 text-sm",children:[n.jsxs("div",{className:"flex items-center space-x-3 text-vibetune-text-muted",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{children:"Access to millions of songs and podcasts"})]}),n.jsxs("div",{className:"flex items-center space-x-3 text-vibetune-text-muted",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{children:"Sync your existing playlists and liked songs"})]}),n.jsxs("div",{className:"flex items-center space-x-3 text-vibetune-text-muted",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{children:"Personalized music recommendations"})]}),n.jsxs("div",{className:"flex items-center space-x-3 text-vibetune-text-muted",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{children:"Control playback across all your devices"})]})]}),n.jsx("div",{className:"text-center text-xs text-vibetune-text-muted",children:n.jsxs("p",{children:["By continuing, you agree to Spotify's"," ",n.jsx("a",{href:"https://www.spotify.com/legal/end-user-agreement/",target:"_blank",rel:"noopener noreferrer",className:"text-vibetune-green hover:underline",children:"Terms of Service"})," ","and"," ",n.jsx("a",{href:"https://www.spotify.com/legal/privacy-policy/",target:"_blank",rel:"noopener noreferrer",className:"text-vibetune-green hover:underline",children:"Privacy Policy"})]})})]})]})]})})}var Ok=t.forwardRef((e,t)=>n.jsx(r.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Ok.displayName="Label";var Lk=Ok;const Bk=vt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),zk=t.forwardRef(({className:e,...t},r)=>n.jsx(Lk,{ref:r,className:Nr(Bk(),e),...t}));function Uk(){const[e,r]=t.useState(""),[a,i]=t.useState(""),[o,s]=t.useState(""),[u,c]=t.useState(""),[l,d]=t.useState(!1),[h,p]=t.useState(!1),[f,m]=t.useState(""),[v,g]=t.useState(!1),{signup:x,isLoading:y}=is(),b=go(),w=[{text:"At least 8 characters",met:o.length>=8},{text:"Contains uppercase letter",met:/[A-Z]/.test(o)},{text:"Contains lowercase letter",met:/[a-z]/.test(o)},{text:"Contains number",met:/\d/.test(o)}],N=w.every(e=>e.met),k=o===u&&o.length>0;return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-vibetune-dark via-vibetune-darker to-black flex items-center justify-center p-4",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("div",{className:"flex items-center justify-center mb-4",children:n.jsx("div",{className:"w-12 h-12 bg-vibetune-green rounded-full flex items-center justify-center",children:n.jsx(nn,{className:"w-7 h-7 text-black"})})}),n.jsx("h1",{className:"text-3xl font-bold text-white",children:"Join VibeTune"}),n.jsx("p",{className:"text-vibetune-text-muted mt-2",children:"Create your account and start discovering music"})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 backdrop-blur-sm rounded-2xl p-8 border border-vibetune-gray/20",children:[n.jsxs("form",{onSubmit:async t=>{t.preventDefault(),m(""),e&&a&&o&&u?N?k?v?await x(e,a,o)?b("/"):m("Failed to create account. Please try again."):m("Please agree to the terms and conditions"):m("Passwords do not match"):m("Password does not meet requirements"):m("Please fill in all fields")},className:"space-y-6",children:[f&&n.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:n.jsx("p",{className:"text-red-400 text-sm",children:f})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(zk,{htmlFor:"name",className:"text-white",children:"Full Name"}),n.jsx(Ik,{id:"name",type:"text",value:e,onChange:e=>r(e.target.value),placeholder:"Enter your full name",className:"bg-vibetune-darker border-vibetune-gray text-white placeholder:text-vibetune-text-muted",disabled:y})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(zk,{htmlFor:"email",className:"text-white",children:"Email"}),n.jsx(Ik,{id:"email",type:"email",value:a,onChange:e=>i(e.target.value),placeholder:"Enter your email",className:"bg-vibetune-darker border-vibetune-gray text-white placeholder:text-vibetune-text-muted",disabled:y})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(zk,{htmlFor:"password",className:"text-white",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ik,{id:"password",type:l?"text":"password",value:o,onChange:e=>s(e.target.value),placeholder:"Create a password",className:"bg-vibetune-darker border-vibetune-gray text-white placeholder:text-vibetune-text-muted pr-10",disabled:y}),n.jsx(Qo,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-auto p-1 text-vibetune-text-muted hover:text-white",onClick:()=>d(!l),children:l?n.jsx(Wt,{className:"w-4 h-4"}):n.jsx(Vt,{className:"w-4 h-4"})})]}),o&&n.jsx("div",{className:"mt-3 space-y-1",children:w.map((e,t)=>n.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.met?n.jsx(_t,{className:"w-4 h-4 text-vibetune-green"}):n.jsx(_n,{className:"w-4 h-4 text-red-400"}),n.jsx("span",{className:e.met?"text-vibetune-green":"text-vibetune-text-muted",children:e.text})]},t))})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(zk,{htmlFor:"confirmPassword",className:"text-white",children:"Confirm Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ik,{id:"confirmPassword",type:h?"text":"password",value:u,onChange:e=>c(e.target.value),placeholder:"Confirm your password",className:"bg-vibetune-darker border-vibetune-gray text-white placeholder:text-vibetune-text-muted pr-10",disabled:y}),n.jsx(Qo,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 h-auto p-1 text-vibetune-text-muted hover:text-white",onClick:()=>p(!h),children:h?n.jsx(Wt,{className:"w-4 h-4"}):n.jsx(Vt,{className:"w-4 h-4"})})]}),u&&n.jsx("div",{className:"flex items-center space-x-2 text-sm mt-2",children:k?n.jsxs(n.Fragment,{children:[n.jsx(_t,{className:"w-4 h-4 text-vibetune-green"}),n.jsx("span",{className:"text-vibetune-green",children:"Passwords match"})]}):n.jsxs(n.Fragment,{children:[n.jsx(_n,{className:"w-4 h-4 text-red-400"}),n.jsx("span",{className:"text-red-400",children:"Passwords do not match"})]})})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("input",{type:"checkbox",id:"terms",checked:v,onChange:e=>g(e.target.checked),className:"mt-1 w-4 h-4 accent-vibetune-green"}),n.jsxs("label",{htmlFor:"terms",className:"text-sm text-vibetune-text-muted",children:["I agree to the"," ",n.jsx(zo,{to:"/terms",className:"text-vibetune-green hover:text-vibetune-green-light",children:"Terms of Service"})," ","and"," ",n.jsx(zo,{to:"/privacy",className:"text-vibetune-green hover:text-vibetune-green-light",children:"Privacy Policy"})]})]}),n.jsx(Qo,{type:"submit",className:"w-full bg-vibetune-green hover:bg-vibetune-green-dark text-black font-semibold py-6",disabled:y||!N||!k||!v,children:y?n.jsxs(n.Fragment,{children:[n.jsx(Qt,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating account..."]}):"Create account"})]}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs("p",{className:"text-vibetune-text-muted",children:["Already have an account?"," ",n.jsx(zo,{to:"/login",className:"text-vibetune-green hover:text-vibetune-green-light font-semibold",children:"Sign in"})]})})]})]})})}function Wk(){const{user:e,updateProfile:r}=is(),[a,i]=t.useState(!1),[o,s]=t.useState(!1),[u,c]=t.useState({name:e?.displayName||"",email:e?.email||"",bio:"Music lover and playlist curator",location:"New York, NY"}),[l,d]=t.useState(null);if(!e)return n.jsx("div",{className:"flex items-center justify-center h-full",children:n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-vibetune-text-muted mb-4",children:"Please log in to view your profile"}),n.jsx(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:"Log In"})]})});const h=l||(e.images&&e.images[0]?e.images[0].url:null);return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[n.jsx("div",{className:"bg-gradient-to-r from-vibetune-green/20 to-blue-500/20 rounded-lg p-8 mb-8",children:n.jsxs("div",{className:"flex items-start space-x-6",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"w-32 h-32 rounded-full overflow-hidden bg-vibetune-gray border-4 border-white/20",children:h?n.jsx("img",{src:h,alt:e.displayName,className:"w-full h-full object-cover"}):n.jsx("div",{className:"w-full h-full bg-vibetune-green flex items-center justify-center",children:n.jsx("span",{className:"text-2xl font-bold text-black",children:e.displayName.charAt(0).toUpperCase()})})}),n.jsx(Qo,{size:"sm",className:"absolute bottom-0 right-0 w-10 h-10 p-0 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full border-2 border-vibetune-dark",onClick:()=>s(!0),children:n.jsx(Et,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"flex-1",children:a?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(zk,{htmlFor:"name",className:"text-white",children:"Name"}),n.jsx(Ik,{id:"name",value:u.name,onChange:e=>c({...u,name:e.target.value}),className:"bg-vibetune-darker border-vibetune-gray text-white"})]}),n.jsxs("div",{children:[n.jsx(zk,{htmlFor:"email",className:"text-white",children:"Email"}),n.jsx(Ik,{id:"email",type:"email",value:u.email,onChange:e=>c({...u,email:e.target.value}),className:"bg-vibetune-darker border-vibetune-gray text-white"})]}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsxs(Qo,{onClick:async()=>{if(!e)return;const t={displayName:u.name,email:u.email};l&&(t.avatar=l),await r(t)&&(i(!1),d(null))},className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[n.jsx(dn,{className:"w-4 h-4 mr-2"}),"Save"]}),n.jsxs(Qo,{variant:"outline",onClick:()=>{c({name:e?.displayName||"",email:e?.email||"",bio:"Music lover and playlist curator",location:"New York, NY"}),d(null),i(!1)},className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(_n,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]}):n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[n.jsx("h1",{className:"text-3xl font-bold text-white",children:e.displayName}),n.jsx(Qo,{variant:"ghost",size:"sm",onClick:()=>i(!0),className:"text-vibetune-text-muted hover:text-white",children:n.jsx(an,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"space-y-2 text-vibetune-text-muted",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Zt,{className:"w-4 h-4"}),n.jsx("span",{children:e.email})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(St,{className:"w-4 h-4"}),n.jsxs("span",{children:["Joined ",(new Date).toLocaleDateString()]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(en,{className:"w-4 h-4"}),n.jsx("span",{children:u.location})]})]}),n.jsx("p",{className:"text-white mt-4",children:u.bio})]})})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-6 text-center",children:[n.jsx("h3",{className:"text-2xl font-bold text-vibetune-green",children:"487"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"Liked Songs"})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-6 text-center",children:[n.jsx("h3",{className:"text-2xl font-bold text-vibetune-green",children:"23"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"Playlists Created"})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-6 text-center",children:[n.jsx("h3",{className:"text-2xl font-bold text-vibetune-green",children:"156"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"Artists Followed"})]})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsx("h2",{className:"text-2xl font-bold text-white",children:"Recent Activity"}),n.jsx("div",{className:"space-y-3",children:[{action:"Liked",item:"Blinding Lights",artist:"The Weeknd",time:"2 hours ago"},{action:"Added to playlist",item:"Levitating",artist:"Dua Lipa",time:"5 hours ago"},{action:"Followed",item:"Olivia Rodrigo",artist:"Artist",time:"1 day ago"},{action:"Created playlist",item:"Summer Vibes 2024",artist:"Playlist",time:"2 days ago"}].map((e,t)=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-vibetune-gray/20 rounded-lg",children:[n.jsx("div",{className:"w-12 h-12 bg-vibetune-green/20 rounded-lg flex items-center justify-center",children:n.jsx("div",{className:"w-6 h-6 bg-vibetune-green/40 rounded"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("p",{className:"text-white",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:e.action})," ",e.item]}),n.jsxs("p",{className:"text-sm text-vibetune-text-muted",children:[e.artist," • ",e.time]})]})]},t))})]})]}),n.jsx(MN,{isOpen:o,onClose:()=>s(!1),onCapture:e=>{d(e)},title:"Update Profile Picture"})]})}function Vk({emotion:e,className:r}){const[a,i]=t.useState([]),[o,s]=t.useState(!1),[u,c]=t.useState(null),{playTrack:l}=yk();t.useEffect(()=>{e&&e.confidence>.3&&d(e.emotion)},[e?.emotion,e?.confidence]);const d=async e=>{s(!0),c(null);try{const t=h(e),n=await Sk.getRecommendations({seedGenres:[t],limit:10});if(n.tracks&&n.tracks.length>0)i(n.tracks);else{const t=Ek.getTracksByEmotion(e);i(t.map(Ek.convertToTrack))}}catch(t){c("Spotify recommendations failed, using demo music");try{const t=Ek.getTracksByEmotion(e);i(t.map(Ek.convertToTrack))}catch(n){c("Failed to load any music recommendations")}}finally{s(!1)}},h=e=>{switch(e){case"happy":default:return"pop";case"sad":return"acoustic";case"angry":return"metal";case"surprised":return"dance";case"disgusted":return"alternative";case"fearful":return"ambient";case"neutral":return"indie"}},p=()=>{e&&d(e.emotion)};return e?e.confidence<.3?n.jsx("div",{className:Nr("bg-vibetune-gray/20 rounded-lg p-6",r),children:n.jsxs("div",{className:"text-center",children:[n.jsx(nn,{className:"w-12 h-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h3",{className:"text-white font-semibold mb-2",children:"Analyzing Your Expression..."}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Face the camera clearly for better emotion detection"})]})}):n.jsxs("div",{className:Nr("bg-vibetune-gray/20 rounded-lg",r),children:[n.jsx("div",{className:"p-4 border-b border-vibetune-gray/20",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:_N.getEmotionColor(e.emotion)}}),n.jsxs("div",{children:[n.jsxs("h3",{className:"text-white font-semibold flex items-center",children:[n.jsx(nn,{className:"w-5 h-5 mr-2"}),"Songs for ",e.emotion," mood",n.jsx("span",{className:"ml-2 text-2xl",children:_N.getEmotionEmoji(e.emotion)})]}),n.jsxs("p",{className:"text-vibetune-text-muted text-sm",children:["Confidence: ",Math.round(100*e.confidence),"% • ",a.length," results"]})]})]}),n.jsx(Qo,{variant:"ghost",size:"sm",onClick:p,disabled:o,className:"text-vibetune-text-muted hover:text-white",children:n.jsx(un,{className:Nr("w-4 h-4",o&&"animate-spin")})})]})}),n.jsx("div",{className:"p-4",children:o?n.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,t)=>n.jsxs("div",{className:"flex space-x-3",children:[n.jsx("div",{className:"w-20 h-15 bg-vibetune-gray rounded animate-pulse"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("div",{className:"h-4 bg-vibetune-gray rounded animate-pulse"}),n.jsx("div",{className:"h-3 bg-vibetune-gray rounded w-3/4 animate-pulse"})]})]},t))}):u?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(nn,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),n.jsx("p",{className:"text-red-400 mb-4",children:u}),n.jsx(Qo,{onClick:p,className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:"Try Again"})]}):a.length>0?n.jsxs("div",{className:"space-y-3",children:[a.map(e=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-vibetune-gray/10 rounded-lg hover:bg-vibetune-gray/20 transition-colors group",children:[n.jsxs("div",{className:"relative",children:[e.album?.images?.[0]?.url?n.jsx("img",{src:e.album.images[0].url,alt:e.name,className:"w-20 h-15 object-cover rounded",loading:"lazy"}):n.jsx("div",{className:"w-20 h-15 bg-vibetune-gray rounded"}),n.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center",children:n.jsx(on,{className:"w-6 h-6 text-white"})})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"text-white font-medium text-sm line-clamp-2 mb-1",children:e.name}),n.jsx("p",{className:"text-vibetune-text-muted text-xs mb-2",children:(e.artists||[]).map(e=>e.name).join(", ")})]}),n.jsx("div",{className:"flex flex-col space-y-1",children:n.jsxs(Qo,{size:"sm",onClick:async()=>{await l({id:e.id,title:e.name,artist:(e.artists||[]).map(e=>e.name).join(", "),albumArt:e.album?.images?.[0]?.url||"",duration:e.duration_ms,url:e.preview_url||e.external_urls?.spotify||"",spotifyId:e.id,previewUrl:e.preview_url,isSpotifyTrack:!0,quality:"high"})},className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[n.jsx(on,{className:"w-3 h-3 mr-1"}),"Play"]})})]},e.id)),n.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-vibetune-gray/20",children:[n.jsxs("p",{className:"text-vibetune-text-muted text-xs",children:["Powered by your ",e.emotion," emotion"]}),n.jsx("div",{className:"flex space-x-2",children:n.jsxs(Qo,{variant:"ghost",size:"sm",onClick:p,className:"text-vibetune-text-muted hover:text-white",children:[n.jsx(un,{className:"w-4 h-4 mr-1"}),"More Songs"]})})]})]}):n.jsxs("div",{className:"text-center py-8",children:[n.jsx(nn,{className:"w-12 h-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-vibetune-text-muted",children:o?"Loading music recommendations...":u?`Error: ${u}`:"No songs found for your current mood. Try a different expression!"}),u&&n.jsxs(Qo,{variant:"outline",size:"sm",onClick:p,className:"mt-2",children:[n.jsx(un,{className:"w-4 h-4 mr-1"}),"Try Again"]})]})})]}):n.jsx("div",{className:Nr("bg-vibetune-gray/20 rounded-lg p-6",r),children:n.jsxs("div",{className:"text-center",children:[n.jsx(nn,{className:"w-12 h-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h3",{className:"text-white font-semibold mb-2",children:"Music Recommendations"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm mb-4",children:"Start the camera to get personalized song recommendations based on your emotions"}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-xs text-vibetune-text-muted",children:"Debug: Test with demo emotions"}),n.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[n.jsx(Qo,{size:"sm",variant:"outline",onClick:()=>d("happy"),className:"text-xs",children:"Test Happy"}),n.jsx(Qo,{size:"sm",variant:"outline",onClick:()=>d("sad"),className:"text-xs",children:"Test Sad"}),n.jsx(Qo,{size:"sm",variant:"outline",onClick:()=>d("angry"),className:"text-xs",children:"Test Angry"})]})]})]})})}function Hk({emotion:e}){return e?n.jsxs("div",{className:"flex items-center space-x-2 bg-vibetune-gray/20 rounded-lg px-3 py-2",children:[n.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:_N.getEmotionColor(e.emotion)}}),n.jsx("span",{className:"text-white font-medium capitalize",children:e.emotion}),n.jsx("span",{className:"text-xl",children:_N.getEmotionEmoji(e.emotion)}),n.jsxs("span",{className:"text-vibetune-text-muted text-sm",children:[Math.round(100*e.confidence),"%"]})]}):null}function qk({emotion:e}){if(!e)return null;const t=Object.entries(e.scores).sort(([,e],[,t])=>t-e);return n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center",children:[n.jsx(nn,{className:"w-4 h-4 mr-2"}),"Emotion Analysis"]}),n.jsx("div",{className:"space-y-2",children:t.map(([e,t])=>n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("span",{className:"text-2xl",children:_N.getEmotionEmoji(e)}),n.jsx("span",{className:"text-vibetune-text-muted text-sm w-16 capitalize",children:e}),n.jsx("div",{className:"flex-1 bg-vibetune-gray rounded-full h-2",children:n.jsx("div",{className:"h-2 rounded-full transition-all duration-300",style:{width:100*t+"%",backgroundColor:_N.getEmotionColor(e)}})}),n.jsxs("span",{className:"text-vibetune-text-muted text-xs w-8",children:[Math.round(100*t),"%"]})]},e))})]})}function Gk(){const[e,r]=t.useState(null),[a,i]=t.useState(null),[o,s]=t.useState(!1),[u,c]=t.useState(null);return n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-6 max-w-2xl mx-auto",children:[n.jsxs("h3",{className:"text-white font-semibold mb-4 flex items-center",children:[n.jsx(Et,{className:"w-5 h-5 mr-2 text-vibetune-green"}),"Debug Camera Test"]}),n.jsxs("div",{className:"mb-4 space-y-2 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:"Browser Support:"}),n.jsx("span",{className:navigator.mediaDevices?.getUserMedia?"text-green-400":"text-red-400",children:navigator.mediaDevices?.getUserMedia?"✓ Supported":"✗ Not Supported"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:"Stream Active:"}),n.jsx("span",{className:e?"text-green-400":"text-gray-400",children:e?"✓ Active":"✗ Inactive"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:"Protocol:"}),n.jsx("span",{className:"https:"===window.location.protocol||"localhost"===window.location.hostname?"text-green-400":"text-yellow-400",children:window.location.protocol})]})]}),a&&n.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/30 rounded text-red-200 text-sm",children:a}),n.jsxs("div",{className:"relative aspect-video bg-black rounded-lg mb-4 overflow-hidden",children:[n.jsx("video",{ref:c,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0,style:{backgroundColor:"#000"}}),!e&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Et,{className:"w-12 h-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-white",children:"No camera feed"})]})})]}),n.jsx("div",{className:"flex space-x-3 justify-center",children:n.jsxs(Qo,{onClick:e?()=>{e&&(e.getTracks().forEach(e=>{e.stop()}),r(null)),u&&(u.srcObject=null),i(null)}:async()=>{s(!0),i(null);try{if(!navigator.mediaDevices?.getUserMedia)throw new Error("getUserMedia not supported");const e={video:{width:{ideal:640},height:{ideal:480},facingMode:"user"},audio:!1},t=await navigator.mediaDevices.getUserMedia(e);r(t),u&&(u.srcObject=t,u.onloadedmetadata=()=>{u.play().then(()=>{}).catch(e=>{i(`Video play failed: ${e.message}`)})}),s(!1)}catch(e){i(e instanceof Error?e.message:"Camera access failed"),s(!1)}},disabled:o,className:e?"bg-red-500 hover:bg-red-600 text-white":"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[o?n.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2"}):e?n.jsx(bn,{className:"w-4 h-4 mr-2"}):n.jsx(on,{className:"w-4 h-4 mr-2"}),o?"Starting...":e?"Stop Camera":"Start Camera"]})}),n.jsx("div",{className:"mt-4 text-xs text-vibetune-text-muted",children:n.jsxs("details",{children:[n.jsx("summary",{className:"cursor-pointer",children:"Debug Information"}),n.jsx("pre",{className:"mt-2 p-2 bg-black/20 rounded text-xs overflow-x-auto",children:JSON.stringify({userAgent:navigator.userAgent,mediaDevices:!!navigator.mediaDevices,getUserMedia:!!navigator.mediaDevices?.getUserMedia,protocol:window.location.protocol,hostname:window.location.hostname,streamTracks:e?.getTracks().map(e=>({kind:e.kind,label:e.label,enabled:e.enabled,readyState:e.readyState}))||[]},null,2)})]})})]})}function Kk(){const[e,r]=t.useState([]),[a,i]=t.useState("camera"),[o,s]=t.useState(null),[u,c]=t.useState(!1),[l,d]=t.useState(!1),h=t.useRef(null),p=e=>{c(e.isActive),d(e.isDetecting),s(e.emotionData)};return n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"AI-Powered Webcam Studio"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"Capture photos, detect emotions, and discover music that matches your mood"}),n.jsxs("div",{className:"mt-4 flex items-center space-x-4",children:[u&&n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),n.jsx("span",{className:"text-green-400 text-sm",children:"Camera Active"})]}),l&&n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),n.jsx("span",{className:"text-blue-400 text-sm",children:"Detecting Emotions"})]}),u&&l&&o&&n.jsx(Hk,{emotion:o})]})]}),n.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[n.jsxs(Qo,{variant:"camera"===a?"default":"outline",onClick:()=>i("camera"),className:"camera"===a?"bg-vibetune-green text-black":"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(Et,{className:"w-4 h-4 mr-2"}),"Camera"]}),n.jsxs(Qo,{variant:"music"===a?"default":"outline",onClick:()=>i("music"),className:"music"===a?"bg-vibetune-green text-black":"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(nn,{className:"w-4 h-4 mr-2"}),"Music Recommendations"]}),n.jsxs(Qo,{variant:"gallery"===a?"default":"outline",onClick:()=>i("gallery"),className:"gallery"===a?"bg-vibetune-green text-black":"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(Kt,{className:"w-4 h-4 mr-2"}),"Gallery (",e.length,")"]})]}),n.jsxs("div",{className:"mb-8 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:[n.jsx("h3",{className:"text-yellow-400 font-medium mb-2",children:"🚧 Debug Mode (for camera testing)"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm mb-4",children:"This debug component tests basic camera functionality. Use this if the main camera isn't working."}),n.jsx(Gk,{})]}),"camera"===a?n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsx(PN,{ref:h,onCapture:e=>{r(t=>[e,...t]),i("gallery")},onStatusUpdate:p,className:"w-full",enableFaceDetection:!0})}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-6",children:[n.jsxs("h3",{className:"text-white font-semibold mb-4 flex items-center",children:[n.jsx(En,{className:"w-5 h-5 mr-2 text-vibetune-green"}),"Features"]}),n.jsxs("div",{className:"space-y-3 text-sm",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{className:"text-vibetune-text-muted",children:"Real-time face detection"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{className:"text-vibetune-text-muted",children:"Emotion recognition & analysis"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{className:"text-vibetune-text-muted",children:"Music recommendations by mood"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{className:"text-vibetune-text-muted",children:"YouTube API integration"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{className:"text-vibetune-text-muted",children:"High quality photo capture"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-vibetune-green rounded-full"}),n.jsx("span",{className:"text-vibetune-text-muted",children:"AI-powered overlays"})]})]})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-6",children:[n.jsx("h3",{className:"text-white font-semibold mb-4",children:"AI Tips"}),n.jsxs("div",{className:"space-y-2 text-sm text-vibetune-text-muted",children:[n.jsx("p",{children:"• Face directly towards the camera for best detection"}),n.jsx("p",{children:"• Ensure good lighting for accurate recognition"}),n.jsx("p",{children:"• Try different facial expressions for emotion detection"}),n.jsx("p",{children:"• Check the Music tab for song recommendations"}),n.jsx("p",{children:"• Emotions are detected every 1.5 seconds"})]})]}),u&&l&&o&&n.jsx(qk,{emotion:o}),e.length>0&&n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-6",children:[n.jsx("h3",{className:"text-white font-semibold mb-4",children:"Recent Captures"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:e.slice(0,6).map((e,t)=>n.jsx("div",{className:"aspect-square bg-vibetune-gray rounded overflow-hidden",children:n.jsx("img",{src:e,alt:`Capture ${t+1}`,className:"w-full h-full object-cover"})},t))}),e.length>6&&n.jsxs("p",{className:"text-xs text-vibetune-text-muted mt-2",children:["+",e.length-6," more photos"]})]})]})]}):"music"===a?n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsx("div",{className:"lg:col-span-1",children:n.jsx(Vk,{emotion:o,className:"h-full"})}),n.jsx("div",{className:"lg:col-span-1",children:n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsxs("h3",{className:"text-white font-semibold mb-4 flex items-center",children:[n.jsx(jt,{className:"w-5 h-5 mr-2 text-vibetune-green"}),"Emotion Detection"]}),n.jsx("div",{className:"aspect-video bg-black rounded-lg mb-4 overflow-hidden",children:n.jsx(PN,{showControls:!1,enableFaceDetection:!0,autoStart:!0,onStatusUpdate:p,className:"h-full"})}),n.jsxs("div",{className:"space-y-3",children:[!u&&n.jsxs("div",{className:"text-center py-4",children:[n.jsx(Et,{className:"w-8 h-8 text-vibetune-text-muted mx-auto mb-2"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Start the camera to begin emotion detection"})]}),u&&!l&&n.jsxs("div",{className:"text-center py-4",children:[n.jsx(jt,{className:"w-8 h-8 text-vibetune-text-muted mx-auto mb-2"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Enable face detection to analyze emotions"})]}),u&&l&&!o&&n.jsxs("div",{className:"text-center py-4",children:[n.jsx("div",{className:"w-6 h-6 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin mx-auto mb-2"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Analyzing your facial expressions..."})]}),o&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"text-4xl mb-2",children:["happy"===o.emotion&&"😊","sad"===o.emotion&&"😢","angry"===o.emotion&&"😠","surprised"===o.emotion&&"😲","fearful"===o.emotion&&"😨","disgusted"===o.emotion&&"🤢","neutral"===o.emotion&&"😐"]}),n.jsx("p",{className:"text-white font-medium capitalize mb-1",children:o.emotion}),n.jsxs("p",{className:"text-vibetune-text-muted text-sm",children:[Math.round(100*o.confidence),"% confidence"]})]}),n.jsx("div",{className:"bg-vibetune-gray/20 rounded-lg p-3",children:n.jsxs("p",{className:"text-vibetune-text-muted text-xs text-center mb-2",children:["Based on your ",o.emotion," emotion, we've found songs that match your mood!"]})})]})]})]})})]}):n.jsx("div",{children:0===e.length?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Kt,{className:"w-16 h-16 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h3",{className:"text-white font-semibold mb-2",children:"No photos yet"}),n.jsx("p",{className:"text-vibetune-text-muted mb-4",children:"Switch to camera mode to take your first photo"}),n.jsxs(Qo,{onClick:()=>i("camera"),className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[n.jsx(Et,{className:"w-4 h-4 mr-2"}),"Open Camera"]})]}):n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:e.map((e,t)=>n.jsxs("div",{className:"group relative bg-vibetune-gray rounded-lg overflow-hidden",children:[n.jsx("div",{className:"aspect-square",children:n.jsx("img",{src:e,alt:`Capture ${t+1}`,className:"w-full h-full object-cover"})}),n.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center space-x-2",children:[n.jsx(Qo,{size:"sm",variant:"ghost",className:"bg-black/50 text-white hover:bg-black/70",onClick:()=>((e,t)=>{const n=document.createElement("a");n.download=`vibetune-photo-${t+1}.jpg`,n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)})(e,t),children:n.jsx(zt,{className:"w-4 h-4"})}),n.jsx(Qo,{size:"sm",variant:"ghost",className:"bg-black/50 text-white hover:bg-black/70",children:n.jsx(mn,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"absolute top-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded",children:["#",t+1]})]},t))})})]})}function $k(){const[e,r]=t.useState(null),[a,i]=t.useState(null),[o,s]=t.useState(!1),[u,c]=t.useState([]),l=t.useRef(null),d=e=>{const t=(new Date).toLocaleTimeString();c(n=>[`[${t}] ${e}`,...n.slice(0,9)])};return n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"max-w-4xl mx-auto",children:[n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Camera Test"}),n.jsx("p",{className:"text-vibetune-text-muted mb-6",children:"Simple camera access test to diagnose issues"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[n.jsx("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[navigator.mediaDevices?.getUserMedia?n.jsx(Mt,{className:"w-5 h-5 text-green-400"}):n.jsx(Pt,{className:"w-5 h-5 text-red-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Browser Support"}),n.jsx("p",{className:"text-sm text-vibetune-text-muted",children:navigator.mediaDevices?.getUserMedia?"Supported":"Not Supported"})]})]})}),n.jsx("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[e?n.jsx(Mt,{className:"w-5 h-5 text-green-400"}):n.jsx(Pt,{className:"w-5 h-5 text-gray-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Camera Stream"}),n.jsx("p",{className:"text-sm text-vibetune-text-muted",children:e?"Active":"Inactive"})]})]})}),n.jsx("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:["https:"===window.location.protocol||"localhost"===window.location.hostname?n.jsx(Mt,{className:"w-5 h-5 text-green-400"}):n.jsx(Pt,{className:"w-5 h-5 text-yellow-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-white font-medium",children:"Security"}),n.jsxs("p",{className:"text-sm text-vibetune-text-muted",children:[window.location.protocol," - ",window.location.hostname]})]})]})})]}),a&&n.jsx("div",{className:"mb-6 p-4 bg-red-500/20 border border-red-500/30 rounded-lg",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Pt,{className:"w-5 h-5 text-red-400"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-red-200 font-medium",children:"Camera Error"}),n.jsx("p",{className:"text-red-300 text-sm",children:a})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative aspect-video bg-black rounded-lg overflow-hidden",children:[n.jsx("video",{ref:l,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0,style:{backgroundColor:"#000"}}),!e&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Et,{className:"w-12 h-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-white",children:"No camera feed"}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:'Click "Test Camera" to start'})]})})]}),n.jsxs("div",{className:"flex space-x-3",children:[n.jsxs(Qo,{onClick:e?()=>{d("Stopping camera..."),e&&(e.getTracks().forEach(e=>{d(`Stopping track: ${e.kind}`),e.stop()}),r(null)),l.current&&(l.current.srcObject=null),d("Camera stopped"),i(null)}:async()=>{d("Starting camera test..."),s(!0),i(null);try{if(d("Checking browser support..."),!navigator.mediaDevices)throw new Error("navigator.mediaDevices not available");if(!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia not supported");d("Browser support: OK"),d("Requesting camera permission...");const e={video:{width:{ideal:640},height:{ideal:480}},audio:!1},t=await navigator.mediaDevices.getUserMedia(e);d(`Camera stream obtained: ${t.getTracks().length} tracks`),t.getTracks().forEach(e=>{d(`Track: ${e.kind} - ${e.label} - ${e.readyState}`)}),r(t),l.current&&(l.current.srcObject=t,d("Video element source set"),l.current.onloadedmetadata=()=>{d("Video metadata loaded"),l.current&&l.current.play().then(()=>{d("Video playing successfully!")}).catch(e=>{d(`Video play failed: ${e.message}`)})}),s(!1),d("Camera test completed successfully")}catch(e){const t=e instanceof Error?e.message:String(e);d(`Error: ${t}`),i(t),s(!1)}},disabled:o,className:e?"bg-red-500 hover:bg-red-600 text-white":"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[o?n.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2"}):n.jsx(Et,{className:"w-4 h-4 mr-2"}),o?"Testing...":e?"Stop Camera":"Test Camera"]}),n.jsx(Qo,{onClick:()=>{c([])},variant:"outline",className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:"Clear Logs"})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"text-white font-medium",children:"Test Logs"}),n.jsx("div",{className:"bg-black/40 rounded-lg p-4 h-96 overflow-y-auto",children:0===u.length?n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:'No logs yet. Click "Test Camera" to start.'}):n.jsx("div",{className:"space-y-1",children:u.map((e,t)=>n.jsx("div",{className:"text-xs font-mono",style:{color:e.includes("Error:")?"#ef4444":e.includes("successfully")||e.includes("OK")?"#10b981":"#9ca3af"},children:e},t))})}),n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsx("h4",{className:"text-white font-medium mb-2",children:"Browser Info"}),n.jsxs("div",{className:"text-xs text-vibetune-text-muted space-y-1",children:[n.jsxs("div",{children:["User Agent: ",navigator.userAgent.slice(0,80),"..."]}),n.jsxs("div",{children:["Platform: ",navigator.platform]}),n.jsxs("div",{children:["Online: ",navigator.onLine?"Yes":"No"]}),n.jsxs("div",{children:["Permissions API: ",navigator.permissions?"Available":"Not Available"]})]})]})]})]})]})})}function Xk(){const[e,r]=t.useState([{id:"1",name:"John Doe",email:"john@example.com",photos:["/placeholder.svg","/placeholder.svg"],createdAt:new Date("2024-01-15"),lastSeen:new Date,isActive:!0},{id:"2",name:"Jane Smith",email:"jane@example.com",photos:["/placeholder.svg"],createdAt:new Date("2024-01-10"),lastSeen:new Date(Date.now()-1728e5),isActive:!0},{id:"3",name:"Alex Johnson",photos:["/placeholder.svg","/placeholder.svg","/placeholder.svg"],createdAt:new Date("2024-01-05"),isActive:!1}]),[a,i]=t.useState(!1),[o,s]=t.useState(!1),[u,c]=t.useState(null),[l,d]=t.useState(""),[h,p]=t.useState(""),[f,m]=t.useState([]);return n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Face Recognition Profiles"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"Manage face recognition profiles for personalized experiences"})]}),n.jsxs(os,{open:a,onOpenChange:i,children:[n.jsx(ss,{asChild:!0,children:n.jsxs(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[n.jsx(sn,{className:"w-4 h-4 mr-2"}),"Add Profile"]})}),n.jsxs(ls,{className:"max-w-md bg-vibetune-darker border-vibetune-gray",children:[n.jsx(ds,{children:n.jsx(hs,{className:"text-white",children:"Create Face Profile"})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(zk,{htmlFor:"name",className:"text-white",children:"Name"}),n.jsx(Ik,{id:"name",value:l,onChange:e=>d(e.target.value),placeholder:"Enter name",className:"bg-vibetune-gray border-vibetune-light-gray text-white"})]}),n.jsxs("div",{children:[n.jsx(zk,{htmlFor:"email",className:"text-white",children:"Email (optional)"}),n.jsx(Ik,{id:"email",type:"email",value:h,onChange:e=>p(e.target.value),placeholder:"Enter email",className:"bg-vibetune-gray border-vibetune-light-gray text-white"})]}),n.jsxs("div",{children:[n.jsxs(zk,{className:"text-white",children:["Photos (",f.length,"/5)"]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs(Qo,{type:"button",variant:"outline",onClick:()=>s(!0),className:"w-full border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:[n.jsx(Et,{className:"w-4 h-4 mr-2"}),"Take Photo"]}),f.length>0&&n.jsx("div",{className:"grid grid-cols-3 gap-2",children:f.map((e,t)=>n.jsxs("div",{className:"relative group",children:[n.jsx("img",{src:e,alt:`Capture ${t+1}`,className:"w-full aspect-square object-cover rounded border border-vibetune-gray"}),n.jsx(Qo,{size:"sm",variant:"destructive",className:"absolute top-1 right-1 w-6 h-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>(e=>{m(t=>t.filter((t,n)=>n!==e))})(t),children:n.jsx(wn,{className:"w-3 h-3"})})]},t))})]})]}),n.jsxs("div",{className:"flex space-x-2 pt-4",children:[n.jsx(Qo,{onClick:()=>{if(!l.trim()||0===f.length)return;const e={id:Date.now().toString(),name:l.trim(),email:h.trim()||void 0,photos:f,createdAt:new Date,isActive:!0};r(t=>[e,...t]),d(""),p(""),m([]),i(!1)},disabled:!l.trim()||0===f.length,className:"flex-1 bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:"Create Profile"}),n.jsx(Qo,{variant:"outline",onClick:()=>i(!1),className:"border-vibetune-gray text-white hover:bg-vibetune-gray/40",children:"Cancel"})]})]})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsx("h3",{className:"text-2xl font-bold text-vibetune-green",children:e.length}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Total Profiles"})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsx("h3",{className:"text-2xl font-bold text-vibetune-green",children:e.filter(e=>e.isActive).length}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Active Profiles"})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsx("h3",{className:"text-2xl font-bold text-vibetune-green",children:e.filter(e=>e.lastSeen).length}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Recently Seen"})]}),n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-4",children:[n.jsx("h3",{className:"text-2xl font-bold text-vibetune-green",children:e.reduce((e,t)=>e+t.photos.length,0)}),n.jsx("p",{className:"text-vibetune-text-muted text-sm",children:"Total Photos"})]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>n.jsxs("div",{className:"bg-vibetune-gray/20 rounded-lg p-6",children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-12 h-12 bg-vibetune-green rounded-full flex items-center justify-center",children:n.jsx(jn,{className:"w-6 h-6 text-black"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-white",children:e.name}),e.email&&n.jsx("p",{className:"text-sm text-vibetune-text-muted",children:e.email})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Qo,{size:"sm",variant:"ghost",onClick:()=>{return t=e.id,void r(e=>e.map(e=>e.id===t?{...e,isActive:!e.isActive}:e));var t},className:"w-8 h-8 p-0 "+(e.isActive?"text-vibetune-green":"text-vibetune-text-muted"),children:e.isActive?n.jsx(Vt,{className:"w-4 h-4"}):n.jsx(Wt,{className:"w-4 h-4"})}),n.jsx(Qo,{size:"sm",variant:"ghost",className:"w-8 h-8 p-0 text-vibetune-text-muted hover:text-white",children:n.jsx(an,{className:"w-4 h-4"})}),n.jsx(Qo,{size:"sm",variant:"ghost",onClick:()=>{return t=e.id,void r(e=>e.filter(e=>e.id!==t));var t},className:"w-8 h-8 p-0 text-red-400 hover:text-red-300",children:n.jsx(wn,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm text-vibetune-text-muted",children:"Photos"}),n.jsx("span",{className:"text-sm text-vibetune-green",children:e.photos.length})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.photos.slice(0,3).map((t,r)=>n.jsx("img",{src:t,alt:`${e.name} photo ${r+1}`,className:"w-full aspect-square object-cover rounded border border-vibetune-gray"},r)),e.photos.length>3&&n.jsx("div",{className:"w-full aspect-square bg-vibetune-gray rounded border border-vibetune-gray flex items-center justify-center",children:n.jsxs("span",{className:"text-xs text-vibetune-text-muted",children:["+",e.photos.length-3]})})]})]}),n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:"Status"}),n.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+(e.isActive?"bg-vibetune-green/20 text-vibetune-green":"bg-gray-500/20 text-gray-400"),children:e.isActive?"Active":"Inactive"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:"Created"}),n.jsx("span",{className:"text-white",children:e.createdAt.toLocaleDateString()})]}),e.lastSeen&&n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-vibetune-text-muted",children:"Last Seen"}),n.jsx("span",{className:"text-white",children:e.lastSeen.toLocaleDateString()})]})]})]},e.id))}),n.jsx(MN,{isOpen:o,onClose:()=>s(!1),onCapture:e=>{m(t=>[...t,e])},title:"Capture Profile Photo",enableFaceDetection:!0})]})}zk.displayName=Lk.displayName;const Yk=()=>{const e=go(),[r]=qo(),{setUser:a}=is(),[i,o]=t.useState("loading"),[s,u]=t.useState("");return t.useEffect(()=>{(async()=>{try{const t=r.get("code"),n=r.get("state"),i=r.get("error");if(i)throw new Error(`Spotify authorization failed: ${i}`);if(!t)throw new Error("No authorization code received");o("loading");const s=await Sk.handleCallback(t,n||void 0);if(s.accessToken&&localStorage.setItem("spotify_access_token",s.accessToken),s.refreshToken&&localStorage.setItem("spotify_refresh_token",s.refreshToken),a(s.user),o("success"),window.opener)window.opener.postMessage({type:"SPOTIFY_AUTH_SUCCESS",user:s.user},window.location.origin),window.close();else{const t=localStorage.getItem("vibetune_return_url")||"/";localStorage.removeItem("vibetune_return_url"),setTimeout(()=>{e(t,{replace:!0})},1500)}}catch(t){if(u(t instanceof Error?t.message:"Authentication failed"),o("error"),window.opener)window.opener.postMessage({type:"SPOTIFY_AUTH_ERROR",error:t instanceof Error?t.message:"Authentication failed"},window.location.origin),setTimeout(()=>window.close(),2e3);else{const t=localStorage.getItem("vibetune_return_url")||"/";localStorage.removeItem("vibetune_return_url"),setTimeout(()=>{e(t,{replace:!0})},3e3)}}})()},[r,e,a]),"loading"===i?n.jsx("div",{className:"min-h-screen bg-vibetune-dark flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-vibetune-green border-t-transparent rounded-full animate-spin mx-auto mb-4"}),n.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Connecting to Spotify"}),n.jsx("p",{className:"text-vibetune-light",children:"Please wait while we complete your authentication..."})]})}):"success"===i?n.jsx("div",{className:"min-h-screen bg-vibetune-dark flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-vibetune-green rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),n.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Successfully Connected!"}),n.jsx("p",{className:"text-vibetune-light",children:"Redirecting you to VibeTime..."})]})}):"error"===i?n.jsx("div",{className:"min-h-screen bg-vibetune-dark flex items-center justify-center",children:n.jsxs("div",{className:"text-center max-w-md",children:[n.jsx("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),n.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Authentication Failed"}),n.jsx("p",{className:"text-vibetune-light mb-4",children:s}),n.jsx("p",{className:"text-sm text-vibetune-light",children:"Redirecting you back to login..."})]})}):null},Qk=t.forwardRef(({className:e,...t},r)=>n.jsx("div",{ref:r,className:Nr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Qk.displayName="Card";const Jk=t.forwardRef(({className:e,...t},r)=>n.jsx("div",{ref:r,className:Nr("flex flex-col space-y-1.5 p-6",e),...t}));Jk.displayName="CardHeader";const Zk=t.forwardRef(({className:e,...t},r)=>n.jsx("h3",{ref:r,className:Nr("text-2xl font-semibold leading-none tracking-tight",e),...t}));Zk.displayName="CardTitle";const eC=t.forwardRef(({className:e,...t},r)=>n.jsx("p",{ref:r,className:Nr("text-sm text-muted-foreground",e),...t}));eC.displayName="CardDescription";const tC=t.forwardRef(({className:e,...t},r)=>n.jsx("div",{ref:r,className:Nr("p-6 pt-0",e),...t}));tC.displayName="CardContent",t.forwardRef(({className:e,...t},r)=>n.jsx("div",{ref:r,className:Nr("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter";var nC="Tabs",[rC,aC]=a(nC,[X]),iC=X(),[oC,sC]=rC(nC),uC=t.forwardRef((e,t)=>{const{__scopeTabs:a,value:i,onValueChange:o,defaultValue:s,orientation:c="horizontal",dir:l,activationMode:d="automatic",...h}=e,p=K(l),[f,m]=u({prop:i,onChange:o,defaultProp:s??"",caller:nC});return n.jsx(oC,{scope:a,baseId:J(),value:f,onValueChange:m,orientation:c,dir:p,activationMode:d,children:n.jsx(r.div,{dir:p,"data-orientation":c,...h,ref:t})})});uC.displayName=nC;var cC="TabsList",lC=t.forwardRef((e,t)=>{const{__scopeTabs:a,loop:i=!0,...o}=e,s=sC(cC,a),u=iC(a);return n.jsx(Y,{asChild:!0,...u,orientation:s.orientation,dir:s.dir,loop:i,children:n.jsx(r.div,{role:"tablist","aria-orientation":s.orientation,...o,ref:t})})});lC.displayName=cC;var dC="TabsTrigger",hC=t.forwardRef((e,t)=>{const{__scopeTabs:a,value:i,disabled:o=!1,...s}=e,u=sC(dC,a),c=iC(a),d=mC(u.baseId,i),h=vC(u.baseId,i),p=i===u.value;return n.jsx(Q,{asChild:!0,...c,focusable:!o,active:p,children:n.jsx(r.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":h,"data-state":p?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:d,...s,ref:t,onMouseDown:l(e.onMouseDown,e=>{o||0!==e.button||!1!==e.ctrlKey?e.preventDefault():u.onValueChange(i)}),onKeyDown:l(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&u.onValueChange(i)}),onFocus:l(e.onFocus,()=>{const e="manual"!==u.activationMode;p||o||!e||u.onValueChange(i)})})})});hC.displayName=dC;var pC="TabsContent",fC=t.forwardRef((e,a)=>{const{__scopeTabs:i,value:o,forceMount:s,children:u,...l}=e,d=sC(pC,i),h=mC(d.baseId,o),p=vC(d.baseId,o),f=o===d.value,m=t.useRef(f);return t.useEffect(()=>{const e=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(e)},[]),n.jsx(c,{present:s||f,children:({present:t})=>n.jsx(r.div,{"data-state":f?"active":"inactive","data-orientation":d.orientation,role:"tabpanel","aria-labelledby":h,hidden:!t,id:p,tabIndex:0,...l,ref:a,style:{...e.style,animationDuration:m.current?"0s":void 0},children:t&&u})})});function mC(e,t){return`${e}-trigger-${t}`}function vC(e,t){return`${e}-content-${t}`}fC.displayName=pC;var gC=lC,xC=hC,yC=fC;const bC=uC,wC=t.forwardRef(({className:e,...t},r)=>n.jsx(gC,{ref:r,className:Nr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));wC.displayName=gC.displayName;const NC=t.forwardRef(({className:e,...t},r)=>n.jsx(xC,{ref:r,className:Nr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));NC.displayName=xC.displayName;const kC=t.forwardRef(({className:e,...t},r)=>n.jsx(yC,{ref:r,className:Nr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));kC.displayName=yC.displayName;var CC=[" ","Enter","ArrowUp","ArrowDown"],jC=[" ","Enter"],SC="Select",[EC,RC,_C]=i(SC),[IC,TC]=a(SC,[_C,y]),AC=y(),[DC,PC]=IC(SC),[MC,FC]=IC(SC),OC=e=>{const{__scopeSelect:r,children:a,open:i,defaultOpen:o,onOpenChange:s,value:c,defaultValue:l,onValueChange:d,dir:h,name:p,autoComplete:f,disabled:m,required:v,form:g}=e,x=AC(r),[y,b]=t.useState(null),[w,N]=t.useState(null),[k,C]=t.useState(!1),j=K(h),[S,E]=u({prop:i,defaultProp:o??!1,onChange:s,caller:SC}),[R,_]=u({prop:c,defaultProp:l,onChange:d,caller:SC}),I=t.useRef(null),T=!y||g||!!y.closest("form"),[A,D]=t.useState(new Set),P=Array.from(A).map(e=>e.props.value).join(";");return n.jsx(ae,{...x,children:n.jsxs(DC,{required:v,scope:r,trigger:y,onTriggerChange:b,valueNode:w,onValueNodeChange:N,valueNodeHasChildren:k,onValueNodeHasChildrenChange:C,contentId:J(),value:R,onValueChange:_,open:S,onOpenChange:E,dir:j,triggerPointerDownPosRef:I,disabled:m,children:[n.jsx(EC.Provider,{scope:r,children:n.jsx(MC,{scope:e.__scopeSelect,onNativeOptionAdd:t.useCallback(e=>{D(t=>new Set(t).add(e))},[]),onNativeOptionRemove:t.useCallback(e=>{D(t=>{const n=new Set(t);return n.delete(e),n})},[]),children:a})}),T?n.jsxs(kj,{"aria-hidden":!0,required:v,tabIndex:-1,name:p,autoComplete:f,value:R,onChange:e=>_(e.target.value),disabled:m,form:g,children:[void 0===R?n.jsx("option",{value:""}):null,Array.from(A)]},P):null]})})};OC.displayName=SC;var LC="SelectTrigger",BC=t.forwardRef((e,a)=>{const{__scopeSelect:i,disabled:s=!1,...u}=e,c=AC(i),d=PC(LC,i),h=d.disabled||s,p=o(a,d.onTriggerChange),f=RC(i),m=t.useRef("touch"),[v,g,x]=jj(e=>{const t=f().filter(e=>!e.disabled),n=t.find(e=>e.value===d.value),r=Sj(t,e,n);void 0!==r&&d.onValueChange(r.value)}),y=e=>{h||(d.onOpenChange(!0),x()),e&&(d.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return n.jsx(k,{asChild:!0,...c,children:n.jsx(r.button,{type:"button",role:"combobox","aria-controls":d.contentId,"aria-expanded":d.open,"aria-required":d.required,"aria-autocomplete":"none",dir:d.dir,"data-state":d.open?"open":"closed",disabled:h,"data-disabled":h?"":void 0,"data-placeholder":Cj(d.value)?"":void 0,...u,ref:p,onClick:l(u.onClick,e=>{e.currentTarget.focus(),"mouse"!==m.current&&y(e)}),onPointerDown:l(u.onPointerDown,e=>{m.current=e.pointerType;const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&"mouse"===e.pointerType&&(y(e),e.preventDefault())}),onKeyDown:l(u.onKeyDown,e=>{const t=""!==v.current;e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||g(e.key),t&&" "===e.key||CC.includes(e.key)&&(y(),e.preventDefault())})})})});BC.displayName=LC;var zC="SelectValue",UC=t.forwardRef((e,t)=>{const{__scopeSelect:a,className:i,style:s,children:u,placeholder:c="",...l}=e,d=PC(zC,a),{onValueNodeHasChildrenChange:h}=d,p=void 0!==u,f=o(t,d.onValueNodeChange);return m(()=>{h(p)},[h,p]),n.jsx(r.span,{...l,ref:f,style:{pointerEvents:"none"},children:Cj(d.value)?n.jsx(n.Fragment,{children:c}):u})});UC.displayName=zC;var WC=t.forwardRef((e,t)=>{const{__scopeSelect:a,children:i,...o}=e;return n.jsx(r.span,{"aria-hidden":!0,...o,ref:t,children:i||"▼"})});WC.displayName="SelectIcon";var VC=e=>n.jsx(f,{asChild:!0,...e});VC.displayName="SelectPortal";var HC="SelectContent",qC=t.forwardRef((e,r)=>{const a=PC(HC,e.__scopeSelect),[i,o]=t.useState();if(m(()=>{o(new DocumentFragment)},[]),!a.open){const t=i;return t?h.createPortal(n.jsx(KC,{scope:e.__scopeSelect,children:n.jsx(EC.Slot,{scope:e.__scopeSelect,children:n.jsx("div",{children:e.children})})}),t):null}return n.jsx(YC,{...e,ref:r})});qC.displayName=HC;var GC=10,[KC,$C]=IC(HC),XC=ne("SelectContent.RemoveScroll"),YC=t.forwardRef((e,r)=>{const{__scopeSelect:a,position:i="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:u,onPointerDownOutside:c,side:d,sideOffset:h,align:p,alignOffset:f,arrowPadding:m,collisionBoundary:v,collisionPadding:g,sticky:x,hideWhenDetached:y,avoidCollisions:w,...N}=e,k=PC(HC,a),[C,j]=t.useState(null),[S,E]=t.useState(null),R=o(r,e=>j(e)),[_,I]=t.useState(null),[T,A]=t.useState(null),D=RC(a),[P,M]=t.useState(!1),F=t.useRef(!1);t.useEffect(()=>{if(C)return Z(C)},[C]),ee();const O=t.useCallback(e=>{const[t,...n]=D().map(e=>e.ref.current),[r]=n.slice(-1),a=document.activeElement;for(const i of e){if(i===a)return;if(i?.scrollIntoView({block:"nearest"}),i===t&&S&&(S.scrollTop=0),i===r&&S&&(S.scrollTop=S.scrollHeight),i?.focus(),document.activeElement!==a)return}},[D,S]),L=t.useCallback(()=>O([_,C]),[O,_,C]);t.useEffect(()=>{P&&L()},[P,L]);const{onOpenChange:B,triggerPointerDownPosRef:z}=k;t.useEffect(()=>{if(C){let e={x:0,y:0};const t=t=>{e={x:Math.abs(Math.round(t.pageX)-(z.current?.x??0)),y:Math.abs(Math.round(t.pageY)-(z.current?.y??0))}},n=n=>{e.x<=10&&e.y<=10?n.preventDefault():C.contains(n.target)||B(!1),document.removeEventListener("pointermove",t),z.current=null};return null!==z.current&&(document.addEventListener("pointermove",t),document.addEventListener("pointerup",n,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",n,{capture:!0})}}},[C,B,z]),t.useEffect(()=>{const e=()=>B(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}},[B]);const[U,W]=jj(e=>{const t=D().filter(e=>!e.disabled),n=t.find(e=>e.ref.current===document.activeElement),r=Sj(t,e,n);r&&setTimeout(()=>r.ref.current.focus())}),V=t.useCallback((e,t,n)=>{const r=!F.current&&!n;(void 0!==k.value&&k.value===t||r)&&(I(e),r&&(F.current=!0))},[k.value]),H=t.useCallback(()=>C?.focus(),[C]),q=t.useCallback((e,t,n)=>{const r=!F.current&&!n;(void 0!==k.value&&k.value===t||r)&&A(e)},[k.value]),G="popper"===i?JC:QC,K=G===JC?{side:d,sideOffset:h,align:p,alignOffset:f,arrowPadding:m,collisionBoundary:v,collisionPadding:g,sticky:x,hideWhenDetached:y,avoidCollisions:w}:{};return n.jsx(KC,{scope:a,content:C,viewport:S,onViewportChange:E,itemRefCallback:V,selectedItem:_,onItemLeave:H,itemTextRefCallback:q,focusSelectedItem:L,selectedItemText:T,position:i,isPositioned:P,searchRef:U,children:n.jsx(te,{as:XC,allowPinchZoom:!0,children:n.jsx(re,{asChild:!0,trapped:k.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:l(s,e=>{k.trigger?.focus({preventScroll:!0}),e.preventDefault()}),children:n.jsx(b,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:u,onPointerDownOutside:c,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>k.onOpenChange(!1),children:n.jsx(G,{role:"listbox",id:k.contentId,"data-state":k.open?"open":"closed",dir:k.dir,onContextMenu:e=>e.preventDefault(),...N,...K,onPlaced:()=>M(!0),ref:R,style:{display:"flex",flexDirection:"column",outline:"none",...N.style},onKeyDown:l(N.onKeyDown,e=>{const t=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),t||1!==e.key.length||W(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let t=D().filter(e=>!e.disabled).map(e=>e.ref.current);if(["ArrowUp","End"].includes(e.key)&&(t=t.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const n=e.target,r=t.indexOf(n);t=t.slice(r+1)}setTimeout(()=>O(t)),e.preventDefault()}})})})})})})});YC.displayName="SelectContentImpl";var QC=t.forwardRef((e,a)=>{const{__scopeSelect:i,onPlaced:s,...u}=e,c=PC(HC,i),l=$C(HC,i),[d,h]=t.useState(null),[p,f]=t.useState(null),v=o(a,e=>f(e)),g=RC(i),x=t.useRef(!1),y=t.useRef(!0),{viewport:b,selectedItem:w,selectedItemText:N,focusSelectedItem:k}=l,C=t.useCallback(()=>{if(c.trigger&&c.valueNode&&d&&p&&b&&w&&N){const e=c.trigger.getBoundingClientRect(),t=p.getBoundingClientRect(),n=c.valueNode.getBoundingClientRect(),r=N.getBoundingClientRect();if("rtl"!==c.dir){const a=r.left-t.left,i=n.left-a,o=e.left-i,s=e.width+o,u=Math.max(s,t.width),c=window.innerWidth-GC,l=LN(i,[GC,Math.max(GC,c-u)]);d.style.minWidth=s+"px",d.style.left=l+"px"}else{const a=t.right-r.right,i=window.innerWidth-n.right-a,o=window.innerWidth-e.right-i,s=e.width+o,u=Math.max(s,t.width),c=window.innerWidth-GC,l=LN(i,[GC,Math.max(GC,c-u)]);d.style.minWidth=s+"px",d.style.right=l+"px"}const a=g(),i=window.innerHeight-2*GC,o=b.scrollHeight,u=window.getComputedStyle(p),l=parseInt(u.borderTopWidth,10),h=parseInt(u.paddingTop,10),f=parseInt(u.borderBottomWidth,10),m=l+h+o+parseInt(u.paddingBottom,10)+f,v=Math.min(5*w.offsetHeight,m),y=window.getComputedStyle(b),k=parseInt(y.paddingTop,10),C=parseInt(y.paddingBottom,10),j=e.top+e.height/2-GC,S=i-j,E=w.offsetHeight/2,R=l+h+(w.offsetTop+E),_=m-R;if(R<=j){const e=a.length>0&&w===a[a.length-1].ref.current;d.style.bottom="0px";const t=p.clientHeight-b.offsetTop-b.offsetHeight,n=R+Math.max(S,E+(e?C:0)+t+f);d.style.height=n+"px"}else{const e=a.length>0&&w===a[0].ref.current;d.style.top="0px";const t=Math.max(j,l+b.offsetTop+(e?k:0)+E)+_;d.style.height=t+"px",b.scrollTop=R-j+b.offsetTop}d.style.margin=`${GC}px 0`,d.style.minHeight=v+"px",d.style.maxHeight=i+"px",s?.(),requestAnimationFrame(()=>x.current=!0)}},[g,c.trigger,c.valueNode,d,p,b,w,N,c.dir,s]);m(()=>C(),[C]);const[j,S]=t.useState();m(()=>{p&&S(window.getComputedStyle(p).zIndex)},[p]);const E=t.useCallback(e=>{e&&!0===y.current&&(C(),k?.(),y.current=!1)},[C,k]);return n.jsx(ZC,{scope:i,contentWrapper:d,shouldExpandOnScrollRef:x,onScrollButtonChange:E,children:n.jsx("div",{ref:h,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:j},children:n.jsx(r.div,{...u,ref:v,style:{boxSizing:"border-box",maxHeight:"100%",...u.style}})})})});QC.displayName="SelectItemAlignedPosition";var JC=t.forwardRef((e,t)=>{const{__scopeSelect:r,align:a="start",collisionPadding:i=GC,...o}=e,s=AC(r);return n.jsx(w,{...s,...o,ref:t,align:a,collisionPadding:i,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});JC.displayName="SelectPopperPosition";var[ZC,ej]=IC(HC,{}),tj="SelectViewport",nj=t.forwardRef((e,a)=>{const{__scopeSelect:i,nonce:s,...u}=e,c=$C(tj,i),d=ej(tj,i),h=o(a,c.onViewportChange),p=t.useRef(0);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),n.jsx(EC.Slot,{scope:i,children:n.jsx(r.div,{"data-radix-select-viewport":"",role:"presentation",...u,ref:h,style:{position:"relative",flex:1,overflow:"hidden auto",...u.style},onScroll:l(u.onScroll,e=>{const t=e.currentTarget,{contentWrapper:n,shouldExpandOnScrollRef:r}=d;if(r?.current&&n){const e=Math.abs(p.current-t.scrollTop);if(e>0){const r=window.innerHeight-2*GC,a=parseFloat(n.style.minHeight),i=parseFloat(n.style.height),o=Math.max(a,i);if(o<r){const a=o+e,i=Math.min(r,a),s=a-i;n.style.height=i+"px","0px"===n.style.bottom&&(t.scrollTop=s>0?s:0,n.style.justifyContent="flex-end")}}}p.current=t.scrollTop})})})]})});nj.displayName=tj;var rj="SelectGroup",[aj,ij]=IC(rj);t.forwardRef((e,t)=>{const{__scopeSelect:a,...i}=e,o=J();return n.jsx(aj,{scope:a,id:o,children:n.jsx(r.div,{role:"group","aria-labelledby":o,...i,ref:t})})}).displayName=rj;var oj="SelectLabel",sj=t.forwardRef((e,t)=>{const{__scopeSelect:a,...i}=e,o=ij(oj,a);return n.jsx(r.div,{id:o.id,...i,ref:t})});sj.displayName=oj;var uj="SelectItem",[cj,lj]=IC(uj),dj=t.forwardRef((e,a)=>{const{__scopeSelect:i,value:s,disabled:u=!1,textValue:c,...d}=e,h=PC(uj,i),p=$C(uj,i),f=h.value===s,[m,v]=t.useState(c??""),[g,x]=t.useState(!1),y=o(a,e=>p.itemRefCallback?.(e,s,u)),b=J(),w=t.useRef("touch"),N=()=>{u||(h.onValueChange(s),h.onOpenChange(!1))};if(""===s)throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return n.jsx(cj,{scope:i,value:s,disabled:u,textId:b,isSelected:f,onItemTextChange:t.useCallback(e=>{v(t=>t||(e?.textContent??"").trim())},[]),children:n.jsx(EC.ItemSlot,{scope:i,value:s,disabled:u,textValue:m,children:n.jsx(r.div,{role:"option","aria-labelledby":b,"data-highlighted":g?"":void 0,"aria-selected":f&&g,"data-state":f?"checked":"unchecked","aria-disabled":u||void 0,"data-disabled":u?"":void 0,tabIndex:u?void 0:-1,...d,ref:y,onFocus:l(d.onFocus,()=>x(!0)),onBlur:l(d.onBlur,()=>x(!1)),onClick:l(d.onClick,()=>{"mouse"!==w.current&&N()}),onPointerUp:l(d.onPointerUp,()=>{"mouse"===w.current&&N()}),onPointerDown:l(d.onPointerDown,e=>{w.current=e.pointerType}),onPointerMove:l(d.onPointerMove,e=>{w.current=e.pointerType,u?p.onItemLeave?.():"mouse"===w.current&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:l(d.onPointerLeave,e=>{e.currentTarget===document.activeElement&&p.onItemLeave?.()}),onKeyDown:l(d.onKeyDown,e=>{""!==p.searchRef?.current&&" "===e.key||(jC.includes(e.key)&&N()," "===e.key&&e.preventDefault())})})})})});dj.displayName=uj;var hj="SelectItemText",pj=t.forwardRef((e,a)=>{const{__scopeSelect:i,className:s,style:u,...c}=e,l=PC(hj,i),d=$C(hj,i),p=lj(hj,i),f=FC(hj,i),[v,g]=t.useState(null),x=o(a,e=>g(e),p.onItemTextChange,e=>d.itemTextRefCallback?.(e,p.value,p.disabled)),y=v?.textContent,b=t.useMemo(()=>n.jsx("option",{value:p.value,disabled:p.disabled,children:y},p.value),[p.disabled,p.value,y]),{onNativeOptionAdd:w,onNativeOptionRemove:N}=f;return m(()=>(w(b),()=>N(b)),[w,N,b]),n.jsxs(n.Fragment,{children:[n.jsx(r.span,{id:p.textId,...c,ref:x}),p.isSelected&&l.valueNode&&!l.valueNodeHasChildren?h.createPortal(c.children,l.valueNode):null]})});pj.displayName=hj;var fj="SelectItemIndicator",mj=t.forwardRef((e,t)=>{const{__scopeSelect:a,...i}=e;return lj(fj,a).isSelected?n.jsx(r.span,{"aria-hidden":!0,...i,ref:t}):null});mj.displayName=fj;var vj="SelectScrollUpButton",gj=t.forwardRef((e,r)=>{const a=$C(vj,e.__scopeSelect),i=ej(vj,e.__scopeSelect),[s,u]=t.useState(!1),c=o(r,i.onScrollButtonChange);return m(()=>{if(a.viewport&&a.isPositioned){let e=function(){const e=t.scrollTop>0;u(e)};const t=a.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[a.viewport,a.isPositioned]),s?n.jsx(bj,{...e,ref:c,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=a;e&&t&&(e.scrollTop=e.scrollTop-t.offsetHeight)}}):null});gj.displayName=vj;var xj="SelectScrollDownButton",yj=t.forwardRef((e,r)=>{const a=$C(xj,e.__scopeSelect),i=ej(xj,e.__scopeSelect),[s,u]=t.useState(!1),c=o(r,i.onScrollButtonChange);return m(()=>{if(a.viewport&&a.isPositioned){let e=function(){const e=t.scrollHeight-t.clientHeight,n=Math.ceil(t.scrollTop)<e;u(n)};const t=a.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[a.viewport,a.isPositioned]),s?n.jsx(bj,{...e,ref:c,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=a;e&&t&&(e.scrollTop=e.scrollTop+t.offsetHeight)}}):null});yj.displayName=xj;var bj=t.forwardRef((e,a)=>{const{__scopeSelect:i,onAutoScroll:o,...s}=e,u=$C("SelectScrollButton",i),c=t.useRef(null),d=RC(i),h=t.useCallback(()=>{null!==c.current&&(window.clearInterval(c.current),c.current=null)},[]);return t.useEffect(()=>()=>h(),[h]),m(()=>{const e=d().find(e=>e.ref.current===document.activeElement);e?.ref.current?.scrollIntoView({block:"nearest"})},[d]),n.jsx(r.div,{"aria-hidden":!0,...s,ref:a,style:{flexShrink:0,...s.style},onPointerDown:l(s.onPointerDown,()=>{null===c.current&&(c.current=window.setInterval(o,50))}),onPointerMove:l(s.onPointerMove,()=>{u.onItemLeave?.(),null===c.current&&(c.current=window.setInterval(o,50))}),onPointerLeave:l(s.onPointerLeave,()=>{h()})})}),wj=t.forwardRef((e,t)=>{const{__scopeSelect:a,...i}=e;return n.jsx(r.div,{"aria-hidden":!0,...i,ref:t})});wj.displayName="SelectSeparator";var Nj="SelectArrow";t.forwardRef((e,t)=>{const{__scopeSelect:r,...a}=e,i=AC(r),o=PC(Nj,r),s=$C(Nj,r);return o.open&&"popper"===s.position?n.jsx(C,{...i,...a,ref:t}):null}).displayName=Nj;var kj=t.forwardRef(({__scopeSelect:e,value:a,...i},s)=>{const u=t.useRef(null),c=o(s,u),l=BN(a);return t.useEffect(()=>{const e=u.current;if(!e)return;const t=window.HTMLSelectElement.prototype,n=Object.getOwnPropertyDescriptor(t,"value").set;if(l!==a&&n){const t=new Event("change",{bubbles:!0});n.call(e,a),e.dispatchEvent(t)}},[l,a]),n.jsx(r.select,{...i,style:{...je,...i.style},ref:c,defaultValue:a})});function Cj(e){return""===e||void 0===e}function jj(e){const n=d(e),r=t.useRef(""),a=t.useRef(0),i=t.useCallback(e=>{const t=r.current+e;n(t),function e(t){r.current=t,window.clearTimeout(a.current),""!==t&&(a.current=window.setTimeout(()=>e(""),1e3))}(t)},[n]),o=t.useCallback(()=>{r.current="",window.clearTimeout(a.current)},[]);return t.useEffect(()=>()=>window.clearTimeout(a.current),[]),[r,i,o]}function Sj(e,t,n){const r=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,a=n?e.indexOf(n):-1;let i=(o=e,s=Math.max(a,0),o.map((e,t)=>o[(s+t)%o.length]));var o,s;1===r.length&&(i=i.filter(e=>e!==n));const u=i.find(e=>e.textValue.toLowerCase().startsWith(r.toLowerCase()));return u!==n?u:void 0}kj.displayName="SelectBubbleInput";var Ej=BC,Rj=WC,_j=VC,Ij=qC,Tj=nj,Aj=sj,Dj=dj,Pj=pj,Mj=mj,Fj=gj,Oj=yj,Lj=wj;const Bj=OC,zj=UC,Uj=t.forwardRef(({className:e,children:t,...r},a)=>n.jsxs(Ej,{ref:a,className:Nr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,n.jsx(Rj,{asChild:!0,children:n.jsx(It,{className:"h-4 w-4 opacity-50"})})]}));Uj.displayName=Ej.displayName;const Wj=t.forwardRef(({className:e,...t},r)=>n.jsx(Fj,{ref:r,className:Nr("flex cursor-default items-center justify-center py-1",e),...t,children:n.jsx(Dt,{className:"h-4 w-4"})}));Wj.displayName=Fj.displayName;const Vj=t.forwardRef(({className:e,...t},r)=>n.jsx(Oj,{ref:r,className:Nr("flex cursor-default items-center justify-center py-1",e),...t,children:n.jsx(It,{className:"h-4 w-4"})}));Vj.displayName=Oj.displayName;const Hj=t.forwardRef(({className:e,children:t,position:r="popper",...a},i)=>n.jsx(_j,{children:n.jsxs(Ij,{ref:i,className:Nr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...a,children:[n.jsx(Wj,{}),n.jsx(Tj,{className:Nr("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),n.jsx(Vj,{})]})}));Hj.displayName=Ij.displayName,t.forwardRef(({className:e,...t},r)=>n.jsx(Aj,{ref:r,className:Nr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=Aj.displayName;const qj=t.forwardRef(({className:e,children:t,...r},a)=>n.jsxs(Dj,{ref:a,className:Nr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(Mj,{children:n.jsx(_t,{className:"h-4 w-4"})})}),n.jsx(Pj,{children:t})]}));qj.displayName=Dj.displayName,t.forwardRef(({className:e,...t},r)=>n.jsx(Lj,{ref:r,className:Nr("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=Lj.displayName;const Gj=vt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Kj({className:e,variant:t,...r}){return n.jsx("div",{className:Nr(Gj({variant:t}),e),...r})}var $j="Progress",[Xj,Yj]=a($j),[Qj,Jj]=Xj($j),Zj=t.forwardRef((e,t)=>{const{__scopeProgress:a,value:i=null,max:o,getValueLabel:s=nS,...u}=e;(o||0===o)&&iS(o);const c=iS(o)?o:100;null!==i&&oS(i,c);const l=oS(i,c)?i:null,d=aS(l)?s(l,c):void 0;return n.jsx(Qj,{scope:a,value:l,max:c,children:n.jsx(r.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":aS(l)?l:void 0,"aria-valuetext":d,role:"progressbar","data-state":rS(l,c),"data-value":l??void 0,"data-max":c,...u,ref:t})})});Zj.displayName=$j;var eS="ProgressIndicator",tS=t.forwardRef((e,t)=>{const{__scopeProgress:a,...i}=e,o=Jj(eS,a);return n.jsx(r.div,{"data-state":rS(o.value,o.max),"data-value":o.value??void 0,"data-max":o.max,...i,ref:t})});function nS(e,t){return`${Math.round(e/t*100)}%`}function rS(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function aS(e){return"number"==typeof e}function iS(e){return aS(e)&&!isNaN(e)&&e>0}function oS(e,t){return aS(e)&&!isNaN(e)&&e<=t&&e>=0}tS.displayName=eS;var sS=Zj,uS=tS;const cS=t.forwardRef(({className:e,value:t,...r},a)=>n.jsx(sS,{ref:a,className:Nr("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:n.jsx(uS,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));cS.displayName=sS.displayName;var lS="horizontal",dS=["horizontal","vertical"],hS=t.forwardRef((e,t)=>{const{decorative:a,orientation:i=lS,...o}=e,s=function(e){return dS.includes(e)}(i)?i:lS,u=a?{role:"none"}:{"aria-orientation":"vertical"===s?s:void 0,role:"separator"};return n.jsx(r.div,{"data-orientation":s,...u,...o,ref:t})});hS.displayName="Separator";var pS=hS;const fS=t.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...a},i)=>n.jsx(pS,{ref:i,decorative:r,orientation:t,className:Nr("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...a}));function mS(){const[e,r]=t.useState("month"),{data:a,isLoading:i}=Ri({queryKey:["listening-stats",e],queryFn:async()=>{const t=await fetch(`/api/analytics/listening?timeframe=${e}`,{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch listening stats");return t.json()}}),{data:o}=Ri({queryKey:["library-stats"],queryFn:async()=>{const e=await fetch("/api/library/stats",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch library stats");return e.json()}}),{data:s}=Ri({queryKey:["offline-stats"],queryFn:async()=>{const e=await fetch("/api/offline/stats",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch offline stats");return e.json()}}),{data:u}=Ri({queryKey:["social-stats"],queryFn:async()=>{const[e,t]=await Promise.all([fetch("/api/social/followers",{credentials:"include"}),fetch("/api/social/following",{credentials:"include"})]),n=await e.json(),r=await t.json();return{followers:n.followers?.length||0,following:r.following?.length||0,totalLikes:0,totalShares:0}}}),c=e=>{const t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4);return t>0?`${t}h ${n}m`:`${n}m`};return i?n.jsx("div",{className:"flex items-center justify-center h-screen",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-vibetune-green"})}):n.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-white",children:"Analytics Dashboard"}),n.jsx("p",{className:"text-vibetune-text-muted mt-2",children:"Insights into your music listening habits"})]}),n.jsxs(Bj,{value:e,onValueChange:e=>r(e),children:[n.jsx(Uj,{className:"w-32",children:n.jsx(zj,{})}),n.jsxs(Hj,{children:[n.jsx(qj,{value:"week",children:"This Week"}),n.jsx(qj,{value:"month",children:"This Month"}),n.jsx(qj,{value:"year",children:"This Year"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx(Zk,{className:"text-sm font-medium text-white",children:"Total Listening Time"}),n.jsx(Bt,{className:"h-4 w-4 text-vibetune-green"})]}),n.jsxs(tC,{children:[n.jsx("div",{className:"text-2xl font-bold text-white",children:c(a?.stats?a.stats.reduce((e,t)=>e+t.total_duration,0):0)}),n.jsxs("p",{className:"text-xs text-vibetune-text-muted",children:["week"===e?"+12%":"month"===e?"+23%":"+15%"," from last ",e]})]})]}),n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx(Zk,{className:"text-sm font-medium text-white",children:"Tracks Played"}),n.jsx(nn,{className:"h-4 w-4 text-vibetune-green"})]}),n.jsxs(tC,{children:[n.jsx("div",{className:"text-2xl font-bold text-white",children:a?.stats?a.stats.reduce((e,t)=>e+t.play_count,0):0}),n.jsxs("p",{className:"text-xs text-vibetune-text-muted",children:["Unique tracks: ",a?.stats?.length||0]})]})]}),n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx(Zk,{className:"text-sm font-medium text-white",children:"Library Size"}),n.jsx(zt,{className:"h-4 w-4 text-vibetune-green"})]}),n.jsxs(tC,{children:[n.jsx("div",{className:"text-2xl font-bold text-white",children:o?.stats?.totalTracks||0}),n.jsxs("p",{className:"text-xs text-vibetune-text-muted",children:[o?.stats?.offlineTracks||0," offline"]})]})]}),n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx(Zk,{className:"text-sm font-medium text-white",children:"Social"}),n.jsx(Sn,{className:"h-4 w-4 text-vibetune-green"})]}),n.jsxs(tC,{children:[n.jsx("div",{className:"text-2xl font-bold text-white",children:(u?.followers||0)+(u?.following||0)}),n.jsxs("p",{className:"text-xs text-vibetune-text-muted",children:[u?.followers||0," followers, ",u?.following||0," following"]})]})]})]}),n.jsxs(bC,{defaultValue:"overview",className:"space-y-6",children:[n.jsxs(wC,{className:"bg-vibetune-gray",children:[n.jsx(NC,{value:"overview",children:"Overview"}),n.jsx(NC,{value:"tracks",children:"Top Tracks"}),n.jsx(NC,{value:"artists",children:"Top Artists"}),n.jsx(NC,{value:"library",children:"Library"})]}),n.jsx(kC,{value:"overview",className:"space-y-6",children:n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Listening Trend"}),n.jsx(eC,{children:"Daily listening time over the past week"})]}),n.jsx(tC,{children:n.jsx(oe,{width:"100%",height:300,children:n.jsxs(se,{data:[{date:"2024-01-01",minutes:120},{date:"2024-01-02",minutes:95},{date:"2024-01-03",minutes:180},{date:"2024-01-04",minutes:150},{date:"2024-01-05",minutes:200},{date:"2024-01-06",minutes:175},{date:"2024-01-07",minutes:220}],children:[n.jsx(ue,{strokeDasharray:"3 3",stroke:"#333"}),n.jsx(ce,{dataKey:"date",stroke:"#666"}),n.jsx(le,{stroke:"#666"}),n.jsx(de,{contentStyle:{backgroundColor:"#1a1a1a",border:"1px solid #333",color:"#fff"}}),n.jsx(he,{type:"monotone",dataKey:"minutes",stroke:"#1db954",fill:"#1db954",fillOpacity:.3})]})})})]}),n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Storage Usage"}),n.jsx(eC,{children:"Offline music storage breakdown"})]}),n.jsx(tC,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-vibetune-text-muted",children:"Used Storage"}),n.jsxs("span",{className:"text-sm font-medium text-white",children:[s?.stats?.totalSizeGB.toFixed(2)||0," GB"]})]}),n.jsx(cS,{value:s?.stats?.usagePercentage||0,className:"h-2"}),n.jsxs("div",{className:"flex items-center justify-between text-xs text-vibetune-text-muted",children:[n.jsxs("span",{children:[s?.stats?.trackCount||0," tracks"]}),n.jsxs("span",{children:[s?.stats?.usagePercentage?.toFixed(1)||0,"% of limit"]})]})]})})]})]})}),n.jsx(kC,{value:"tracks",className:"space-y-6",children:n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Your Top Tracks"}),n.jsx(eC,{children:"Most played tracks in the selected timeframe"})]}),n.jsx(tC,{children:n.jsx("div",{className:"space-y-4",children:(a?.stats?a.stats.slice(0,10):[]).map((e,t)=>n.jsxs("div",{className:"flex items-center space-x-4 p-3 rounded-lg hover:bg-gray-800 transition-colors",children:[n.jsx("div",{className:"flex-shrink-0 w-8 text-center",children:n.jsxs("span",{className:"text-lg font-bold text-vibetune-green",children:["#",t+1]})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium text-white truncate",children:e.track_name}),n.jsxs("p",{className:"text-xs text-vibetune-text-muted truncate",children:[e.artist_name," • ",e.album_name]})]}),n.jsxs("div",{className:"flex items-center space-x-4 text-xs text-vibetune-text-muted",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Ft,{className:"h-3 w-3 mr-1"}),e.play_count]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(Bt,{className:"h-3 w-3 mr-1"}),c(e.total_duration)]})]})]},t))})})]})}),n.jsx(kC,{value:"artists",className:"space-y-6",children:n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Your Top Artists"}),n.jsx(eC,{children:"Most listened to artists in the selected timeframe"})]}),n.jsx(tC,{children:n.jsx("div",{className:"space-y-4",children:(()=>{if(!a?.stats)return[];const e=new Map;return a.stats.forEach(t=>{const n=t.artist_name;e.has(n)?e.set(n,{...e.get(n),play_count:e.get(n).play_count+t.play_count,total_duration:e.get(n).total_duration+t.total_duration}):e.set(n,{name:n,play_count:t.play_count,total_duration:t.total_duration})}),Array.from(e.values()).sort((e,t)=>t.play_count-e.play_count).slice(0,10)})().map((e,t)=>n.jsxs("div",{className:"flex items-center space-x-4 p-3 rounded-lg hover:bg-gray-800 transition-colors",children:[n.jsx("div",{className:"flex-shrink-0 w-8 text-center",children:n.jsxs("span",{className:"text-lg font-bold text-vibetune-green",children:["#",t+1]})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium text-white truncate",children:e.name}),n.jsxs("p",{className:"text-xs text-vibetune-text-muted",children:[e.play_count," plays • ",c(e.total_duration)]})]})]},t))})})]})}),n.jsx(kC,{value:"library",className:"space-y-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Library Overview"}),n.jsx(eC,{children:"Your music library statistics"})]}),n.jsx(tC,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm text-vibetune-text-muted",children:"Total Tracks"}),n.jsx(Kj,{variant:"secondary",children:o?.stats?.totalTracks||0})]}),n.jsx(fS,{className:"bg-gray-700"}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm text-vibetune-text-muted",children:"Playlists"}),n.jsx(Kj,{variant:"secondary",children:o?.stats?.totalPlaylists||0})]}),n.jsx(fS,{className:"bg-gray-700"}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm text-vibetune-text-muted",children:"Albums"}),n.jsx(Kj,{variant:"secondary",children:o?.stats?.totalAlbums||0})]}),n.jsx(fS,{className:"bg-gray-700"}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm text-vibetune-text-muted",children:"Offline Tracks"}),n.jsx(Kj,{variant:"outline",className:"text-vibetune-green border-vibetune-green",children:o?.stats?.offlineTracks||0})]})]})})]}),n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Last Sync"}),n.jsx(eC,{children:"Library synchronization status"})]}),n.jsx(tC,{children:n.jsxs("div",{className:"text-center py-4",children:[n.jsx(St,{className:"h-12 w-12 text-vibetune-green mx-auto mb-4"}),n.jsx("p",{className:"text-sm text-white",children:o?.stats?.lastSyncAt?new Date(o.stats.lastSyncAt).toLocaleString():"Never synchronized"}),n.jsx(Qo,{variant:"outline",className:"mt-4 border-vibetune-green text-vibetune-green hover:bg-vibetune-green hover:text-black",children:"Sync Now"})]})})]})]})})]})]})}fS.displayName=pS.displayName;var vS=fe();function gS(){return()=>{}}var xS="Avatar",[yS,bS]=a(xS),[wS,NS]=yS(xS),kS=t.forwardRef((e,a)=>{const{__scopeAvatar:i,...o}=e,[s,u]=t.useState("idle");return n.jsx(wS,{scope:i,imageLoadingStatus:s,onImageLoadingStatusChange:u,children:n.jsx(r.span,{...o,ref:a})})});kS.displayName=xS;var CS="AvatarImage",jS=t.forwardRef((e,a)=>{const{__scopeAvatar:i,src:o,onLoadingStatusChange:s=()=>{},...u}=e,c=NS(CS,i),l=function(e,{referrerPolicy:n,crossOrigin:r}){const a=vS.useSyncExternalStore(gS,()=>!0,()=>!1),i=t.useRef(null),o=a?(i.current||(i.current=new window.Image),i.current):null,[s,u]=t.useState(()=>RS(o,e));return m(()=>{u(RS(o,e))},[o,e]),m(()=>{const e=e=>()=>{u(e)};if(!o)return;const t=e("loaded"),a=e("error");return o.addEventListener("load",t),o.addEventListener("error",a),n&&(o.referrerPolicy=n),"string"==typeof r&&(o.crossOrigin=r),()=>{o.removeEventListener("load",t),o.removeEventListener("error",a)}},[o,r,n]),s}(o,u),h=d(e=>{s(e),c.onImageLoadingStatusChange(e)});return m(()=>{"idle"!==l&&h(l)},[l,h]),"loaded"===l?n.jsx(r.img,{...u,ref:a,src:o}):null});jS.displayName=CS;var SS="AvatarFallback",ES=t.forwardRef((e,a)=>{const{__scopeAvatar:i,delayMs:o,...s}=e,u=NS(SS,i),[c,l]=t.useState(void 0===o);return t.useEffect(()=>{if(void 0!==o){const e=window.setTimeout(()=>l(!0),o);return()=>window.clearTimeout(e)}},[o]),c&&"loaded"!==u.imageLoadingStatus?n.jsx(r.span,{...s,ref:a}):null});function RS(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}ES.displayName=SS;var _S=kS,IS=jS,TS=ES;const AS=t.forwardRef(({className:e,...t},r)=>n.jsx(_S,{ref:r,className:Nr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));AS.displayName=_S.displayName;const DS=t.forwardRef(({className:e,...t},r)=>n.jsx(IS,{ref:r,className:Nr("aspect-square h-full w-full",e),...t}));DS.displayName=IS.displayName;const PS=t.forwardRef(({className:e,...t},r)=>n.jsx(TS,{ref:r,className:Nr("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));PS.displayName=TS.displayName;var MS="ScrollArea",[FS,OS]=a(MS),[LS,BS]=FS(MS),zS=t.forwardRef((e,a)=>{const{__scopeScrollArea:i,type:s="hover",dir:u,scrollHideDelay:c=600,...l}=e,[d,h]=t.useState(null),[p,f]=t.useState(null),[m,v]=t.useState(null),[g,x]=t.useState(null),[y,b]=t.useState(null),[w,N]=t.useState(0),[k,C]=t.useState(0),[j,S]=t.useState(!1),[E,R]=t.useState(!1),_=o(a,e=>h(e)),I=K(u);return n.jsx(LS,{scope:i,type:s,dir:I,scrollHideDelay:c,scrollArea:d,viewport:p,onViewportChange:f,content:m,onContentChange:v,scrollbarX:g,onScrollbarXChange:x,scrollbarXEnabled:j,onScrollbarXEnabledChange:S,scrollbarY:y,onScrollbarYChange:b,scrollbarYEnabled:E,onScrollbarYEnabledChange:R,onCornerWidthChange:N,onCornerHeightChange:C,children:n.jsx(r.div,{dir:I,...l,ref:_,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":k+"px",...e.style}})})});zS.displayName=MS;var US="ScrollAreaViewport",WS=t.forwardRef((e,a)=>{const{__scopeScrollArea:i,children:s,nonce:u,...c}=e,l=BS(US,i),d=t.useRef(null),h=o(a,d,l.onViewportChange);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:u}),n.jsx(r.div,{"data-radix-scroll-area-viewport":"",...c,ref:h,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...e.style},children:n.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});WS.displayName=US;var VS="ScrollAreaScrollbar",HS=t.forwardRef((e,r)=>{const{forceMount:a,...i}=e,o=BS(VS,e.__scopeScrollArea),{onScrollbarXEnabledChange:s,onScrollbarYEnabledChange:u}=o,c="horizontal"===e.orientation;return t.useEffect(()=>(c?s(!0):u(!0),()=>{c?s(!1):u(!1)}),[c,s,u]),"hover"===o.type?n.jsx(qS,{...i,ref:r,forceMount:a}):"scroll"===o.type?n.jsx(GS,{...i,ref:r,forceMount:a}):"auto"===o.type?n.jsx(KS,{...i,ref:r,forceMount:a}):"always"===o.type?n.jsx($S,{...i,ref:r}):null});HS.displayName=VS;var qS=t.forwardRef((e,r)=>{const{forceMount:a,...i}=e,o=BS(VS,e.__scopeScrollArea),[s,u]=t.useState(!1);return t.useEffect(()=>{const e=o.scrollArea;let t=0;if(e){const n=()=>{window.clearTimeout(t),u(!0)},r=()=>{t=window.setTimeout(()=>u(!1),o.scrollHideDelay)};return e.addEventListener("pointerenter",n),e.addEventListener("pointerleave",r),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",n),e.removeEventListener("pointerleave",r)}}},[o.scrollArea,o.scrollHideDelay]),n.jsx(c,{present:a||s,children:n.jsx(KS,{"data-state":s?"visible":"hidden",...i,ref:r})})}),GS=t.forwardRef((e,r)=>{const{forceMount:a,...i}=e,o=BS(VS,e.__scopeScrollArea),s="horizontal"===e.orientation,u=pE(()=>h("SCROLL_END"),100),[d,h]=(p="hidden",f={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},t.useReducer((e,t)=>f[e][t]??e,p));var p,f;return t.useEffect(()=>{if("idle"===d){const e=window.setTimeout(()=>h("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(e)}},[d,o.scrollHideDelay,h]),t.useEffect(()=>{const e=o.viewport,t=s?"scrollLeft":"scrollTop";if(e){let n=e[t];const r=()=>{const r=e[t];n!==r&&(h("SCROLL"),u()),n=r};return e.addEventListener("scroll",r),()=>e.removeEventListener("scroll",r)}},[o.viewport,s,h,u]),n.jsx(c,{present:a||"hidden"!==d,children:n.jsx($S,{"data-state":"hidden"===d?"hidden":"visible",...i,ref:r,onPointerEnter:l(e.onPointerEnter,()=>h("POINTER_ENTER")),onPointerLeave:l(e.onPointerLeave,()=>h("POINTER_LEAVE"))})})}),KS=t.forwardRef((e,r)=>{const a=BS(VS,e.__scopeScrollArea),{forceMount:i,...o}=e,[s,u]=t.useState(!1),l="horizontal"===e.orientation,d=pE(()=>{if(a.viewport){const e=a.viewport.offsetWidth<a.viewport.scrollWidth,t=a.viewport.offsetHeight<a.viewport.scrollHeight;u(l?e:t)}},10);return fE(a.viewport,d),fE(a.content,d),n.jsx(c,{present:i||s,children:n.jsx($S,{"data-state":s?"visible":"hidden",...o,ref:r})})}),$S=t.forwardRef((e,r)=>{const{orientation:a="vertical",...i}=e,o=BS(VS,e.__scopeScrollArea),s=t.useRef(null),u=t.useRef(0),[c,l]=t.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=sE(c.viewport,c.content),h={...i,sizes:c,onSizesChange:l,hasThumb:Boolean(d>0&&d<1),onThumbChange:e=>s.current=e,onThumbPointerUp:()=>u.current=0,onThumbPointerDown:e=>u.current=e};function p(e,t){return function(e,t,n,r="ltr"){const a=uE(n),i=a/2,o=t||i,s=a-o,u=n.scrollbar.paddingStart+o,c=n.scrollbar.size-n.scrollbar.paddingEnd-s,l=n.content-n.viewport,d="ltr"===r?[0,l]:[-1*l,0];return lE([u,c],d)(e)}(e,u.current,c,t)}return"horizontal"===a?n.jsx(XS,{...h,ref:r,onThumbPositionChange:()=>{if(o.viewport&&s.current){const e=cE(o.viewport.scrollLeft,c,o.dir);s.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollLeft=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollLeft=p(e,o.dir))}}):"vertical"===a?n.jsx(YS,{...h,ref:r,onThumbPositionChange:()=>{if(o.viewport&&s.current){const e=cE(o.viewport.scrollTop,c);s.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{o.viewport&&(o.viewport.scrollTop=e)},onDragScroll:e=>{o.viewport&&(o.viewport.scrollTop=p(e))}}):null}),XS=t.forwardRef((e,r)=>{const{sizes:a,onSizesChange:i,...s}=e,u=BS(VS,e.__scopeScrollArea),[c,l]=t.useState(),d=t.useRef(null),h=o(r,d,u.onScrollbarXChange);return t.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),n.jsx(ZS,{"data-orientation":"horizontal",...s,ref:h,sizes:a,style:{bottom:0,left:"rtl"===u.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===u.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":uE(a)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.x),onDragScroll:t=>e.onDragScroll(t.x),onWheelScroll:(t,n)=>{if(u.viewport){const r=u.viewport.scrollLeft+t.deltaX;e.onWheelScroll(r),dE(r,n)&&t.preventDefault()}},onResize:()=>{d.current&&u.viewport&&c&&i({content:u.viewport.scrollWidth,viewport:u.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:oE(c.paddingLeft),paddingEnd:oE(c.paddingRight)}})}})}),YS=t.forwardRef((e,r)=>{const{sizes:a,onSizesChange:i,...s}=e,u=BS(VS,e.__scopeScrollArea),[c,l]=t.useState(),d=t.useRef(null),h=o(r,d,u.onScrollbarYChange);return t.useEffect(()=>{d.current&&l(getComputedStyle(d.current))},[d]),n.jsx(ZS,{"data-orientation":"vertical",...s,ref:h,sizes:a,style:{top:0,right:"ltr"===u.dir?0:void 0,left:"rtl"===u.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":uE(a)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.y),onDragScroll:t=>e.onDragScroll(t.y),onWheelScroll:(t,n)=>{if(u.viewport){const r=u.viewport.scrollTop+t.deltaY;e.onWheelScroll(r),dE(r,n)&&t.preventDefault()}},onResize:()=>{d.current&&u.viewport&&c&&i({content:u.viewport.scrollHeight,viewport:u.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:oE(c.paddingTop),paddingEnd:oE(c.paddingBottom)}})}})}),[QS,JS]=FS(VS),ZS=t.forwardRef((e,a)=>{const{__scopeScrollArea:i,sizes:s,hasThumb:u,onThumbChange:c,onThumbPointerUp:h,onThumbPointerDown:p,onThumbPositionChange:f,onDragScroll:m,onWheelScroll:v,onResize:g,...x}=e,y=BS(VS,i),[b,w]=t.useState(null),N=o(a,e=>w(e)),k=t.useRef(null),C=t.useRef(""),j=y.viewport,S=s.content-s.viewport,E=d(v),R=d(f),_=pE(g,10);function I(e){if(k.current){const t=e.clientX-k.current.left,n=e.clientY-k.current.top;m({x:t,y:n})}}return t.useEffect(()=>{const e=e=>{const t=e.target,n=b?.contains(t);n&&E(e,S)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[j,b,S,E]),t.useEffect(R,[s,R]),fE(b,_),fE(y.content,_),n.jsx(QS,{scope:i,scrollbar:b,hasThumb:u,onThumbChange:d(c),onThumbPointerUp:d(h),onThumbPositionChange:R,onThumbPointerDown:d(p),children:n.jsx(r.div,{...x,ref:N,style:{position:"absolute",...x.style},onPointerDown:l(e.onPointerDown,e=>{0===e.button&&(e.target.setPointerCapture(e.pointerId),k.current=b.getBoundingClientRect(),C.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",y.viewport&&(y.viewport.style.scrollBehavior="auto"),I(e))}),onPointerMove:l(e.onPointerMove,I),onPointerUp:l(e.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=C.current,y.viewport&&(y.viewport.style.scrollBehavior=""),k.current=null})})})}),eE="ScrollAreaThumb",tE=t.forwardRef((e,t)=>{const{forceMount:r,...a}=e,i=JS(eE,e.__scopeScrollArea);return n.jsx(c,{present:r||i.hasThumb,children:n.jsx(nE,{ref:t,...a})})}),nE=t.forwardRef((e,a)=>{const{__scopeScrollArea:i,style:s,...u}=e,c=BS(eE,i),d=JS(eE,i),{onThumbPositionChange:h}=d,p=o(a,e=>d.onThumbChange(e)),f=t.useRef(void 0),m=pE(()=>{f.current&&(f.current(),f.current=void 0)},100);return t.useEffect(()=>{const e=c.viewport;if(e){const t=()=>{if(m(),!f.current){const t=hE(e,h);f.current=t,h()}};return h(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[c.viewport,m,h]),n.jsx(r.div,{"data-state":d.hasThumb?"visible":"hidden",...u,ref:p,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:l(e.onPointerDownCapture,e=>{const t=e.target.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;d.onThumbPointerDown({x:n,y:r})}),onPointerUp:l(e.onPointerUp,d.onThumbPointerUp)})});tE.displayName=eE;var rE="ScrollAreaCorner",aE=t.forwardRef((e,t)=>{const r=BS(rE,e.__scopeScrollArea),a=Boolean(r.scrollbarX&&r.scrollbarY);return"scroll"!==r.type&&a?n.jsx(iE,{...e,ref:t}):null});aE.displayName=rE;var iE=t.forwardRef((e,a)=>{const{__scopeScrollArea:i,...o}=e,s=BS(rE,i),[u,c]=t.useState(0),[l,d]=t.useState(0),h=Boolean(u&&l);return fE(s.scrollbarX,()=>{const e=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(e),d(e)}),fE(s.scrollbarY,()=>{const e=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(e),c(e)}),h?n.jsx(r.div,{...o,ref:a,style:{width:u,height:l,position:"absolute",right:"ltr"===s.dir?0:void 0,left:"rtl"===s.dir?0:void 0,bottom:0,...e.style}}):null});function oE(e){return e?parseInt(e,10):0}function sE(e,t){const n=e/t;return isNaN(n)?0:n}function uE(e){const t=sE(e.viewport,e.content),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,r=(e.scrollbar.size-n)*t;return Math.max(r,18)}function cE(e,t,n="ltr"){const r=uE(t),a=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,i=t.scrollbar.size-a,o=t.content-t.viewport,s=i-r,u=LN(e,"ltr"===n?[0,o]:[-1*o,0]);return lE([0,o],[0,s])(u)}function lE(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function dE(e,t){return e>0&&e<t}var hE=(e,t=()=>{})=>{let n={left:e.scrollLeft,top:e.scrollTop},r=0;return function a(){const i={left:e.scrollLeft,top:e.scrollTop},o=n.left!==i.left,s=n.top!==i.top;(o||s)&&t(),n=i,r=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(r)};function pE(e,n){const r=d(e),a=t.useRef(0);return t.useEffect(()=>()=>window.clearTimeout(a.current),[]),t.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,n)},[r,n])}function fE(e,t){const n=d(t);m(()=>{let t=0;if(e){const r=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(n)});return r.observe(e),()=>{window.cancelAnimationFrame(t),r.unobserve(e)}}},[e,n])}var mE=zS,vE=WS,gE=aE;const xE=t.forwardRef(({className:e,children:t,...r},a)=>n.jsxs(mE,{ref:a,className:Nr("relative overflow-hidden",e),...r,children:[n.jsx(vE,{className:"h-full w-full rounded-[inherit]",children:t}),n.jsx(yE,{}),n.jsx(gE,{})]}));xE.displayName=mE.displayName;const yE=t.forwardRef(({className:e,orientation:t="vertical",...r},a)=>n.jsx(HS,{ref:a,orientation:t,className:Nr("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:n.jsx(tE,{className:"relative flex-1 rounded-full bg-border"})}));function bE(){const[e,r]=t.useState(""),a=bi(),{data:i,isLoading:o}=Ri({queryKey:["activity-feed"],queryFn:async()=>{const e=await fetch("/api/social/activity?limit=50",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch activity feed");return e.json()},refetchInterval:3e4}),{data:s}=Ri({queryKey:["user-following"],queryFn:async()=>{const e=await fetch("/api/social/following",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch following list");return e.json()}}),{data:u}=Ri({queryKey:["user-followers"],queryFn:async()=>{const e=await fetch("/api/social/followers",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch followers list");return e.json()}}),c=_i({mutationFn:async e=>{const t=await fetch(`/api/social/follow/${e}`,{method:"POST",credentials:"include"});if(!t.ok)throw new Error("Failed to follow user");return t.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["user-following"]}),a.invalidateQueries({queryKey:["activity-feed"]}),ke({title:"Success",description:"User followed successfully"})}}),l=_i({mutationFn:async e=>{const t=await fetch(`/api/social/follow/${e}`,{method:"DELETE",credentials:"include"});if(!t.ok)throw new Error("Failed to unfollow user");return t.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["user-following"]}),a.invalidateQueries({queryKey:["activity-feed"]}),ke({title:"Success",description:"User unfollowed successfully"})}}),d=_i({mutationFn:async e=>{const t=await fetch("/api/social/like",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({trackData:e})});if(!t.ok)throw new Error("Failed to like track");return t.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["activity-feed"]}),ke({title:"Success",description:"Track liked!"})}}),h=_i({mutationFn:async({trackData:e,message:t})=>{const n=await fetch("/api/social/share",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({trackData:e,message:t})});if(!n.ok)throw new Error("Failed to share track");return n.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["activity-feed"]}),ke({title:"Success",description:"Track shared!"})}}),p=e=>{const t=new Date,n=new Date(e),r=Math.floor((t.getTime()-n.getTime())/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:`${Math.floor(r/86400)}d ago`},f=e=>{switch(e){case"play":return n.jsx(Ft,{className:"h-4 w-4 text-vibetune-green"});case"like":return n.jsx(qt,{className:"h-4 w-4 text-red-500"});case"share":return n.jsx(mn,{className:"h-4 w-4 text-blue-500"});case"playlist_create":return n.jsx(nn,{className:"h-4 w-4 text-purple-500"});case"follow":return n.jsx(Cn,{className:"h-4 w-4 text-orange-500"});default:return n.jsx(nn,{className:"h-4 w-4 text-gray-500"})}},m=e=>{const{activity_type:t,activity_data:n}=e;switch(t){case"play":return`played "${n.trackName}" by ${n.artistName}`;case"like":return`liked "${n.trackName}" by ${n.artistName}`;case"share":return`shared "${n.trackName}" by ${n.artistName}`;case"playlist_create":return`created playlist "${n.playlistName}"`;case"follow":return"followed a new user";default:return"had some activity"}},v=(e,t)=>{t?l.mutate(e):c.mutate(e)},g=s?.following?.filter(t=>t.display_name.toLowerCase().includes(e.toLowerCase()))||[];return o?n.jsx("div",{className:"flex items-center justify-center h-screen",children:n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-vibetune-green"})}):n.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-white",children:"Social"}),n.jsx("p",{className:"text-vibetune-text-muted mt-2",children:"Connect with other music lovers and discover new tracks"})]})}),n.jsxs(bC,{defaultValue:"feed",className:"space-y-6",children:[n.jsxs(wC,{className:"bg-vibetune-gray",children:[n.jsx(NC,{value:"feed",children:"Activity Feed"}),n.jsxs(NC,{value:"following",children:["Following (",s?.following?.length||0,")"]}),n.jsxs(NC,{value:"followers",children:["Followers (",u?.followers?.length||0,")"]}),n.jsx(NC,{value:"discover",children:"Discover"})]}),n.jsx(kC,{value:"feed",className:"space-y-4",children:n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsxs(Zk,{className:"text-white flex items-center",children:[n.jsx(Nn,{className:"h-5 w-5 mr-2"}),"Activity Feed"]}),n.jsx(eC,{children:"See what your friends are listening to"})]}),n.jsx(tC,{children:n.jsx(xE,{className:"h-[600px]",children:n.jsxs("div",{className:"space-y-4",children:[i?.activities?.map(e=>n.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-800 transition-colors",children:[n.jsxs(AS,{className:"h-10 w-10",children:[n.jsx(DS,{src:e.image_url}),n.jsx(PS,{children:e.display_name?.charAt(0).toUpperCase()})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[n.jsx("span",{className:"font-medium text-white",children:e.display_name}),f(e.activity_type),n.jsx("span",{className:"text-xs text-vibetune-text-muted",children:p(e.created_at)})]}),n.jsx("p",{className:"text-sm text-gray-300",children:m(e)}),e.activity_data.shareMessage&&n.jsxs("p",{className:"text-xs text-vibetune-text-muted mt-1 italic",children:['"',e.activity_data.shareMessage,'"']}),("play"===e.activity_type||"like"===e.activity_type||"share"===e.activity_type)&&e.activity_data.trackName&&n.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[n.jsxs(Qo,{variant:"ghost",size:"sm",className:"text-xs h-7 px-2",onClick:()=>d.mutate({id:e.activity_data.trackId,name:e.activity_data.trackName,artists:[{name:e.activity_data.artistName}],album:{name:e.activity_data.albumName}}),children:[n.jsx(qt,{className:"h-3 w-3 mr-1"}),"Like"]}),n.jsxs(Qo,{variant:"ghost",size:"sm",className:"text-xs h-7 px-2",onClick:()=>h.mutate({trackData:{id:e.activity_data.trackId,name:e.activity_data.trackName,artists:[{name:e.activity_data.artistName}],album:{name:e.activity_data.albumName}},message:"Check out this track!"}),children:[n.jsx(mn,{className:"h-3 w-3 mr-1"}),"Share"]})]})]})]},e.id)),(!i?.activities||0===i.activities.length)&&n.jsxs("div",{className:"text-center py-8",children:[n.jsx(nn,{className:"h-12 w-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"No recent activity"}),n.jsx("p",{className:"text-sm text-vibetune-text-muted mt-1",children:"Follow some users to see their activity here"})]})]})})})]})}),n.jsx(kC,{value:"following",className:"space-y-4",children:n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Following"}),n.jsx(eC,{children:"People you follow"}),n.jsxs("div",{className:"flex items-center space-x-2 mt-4",children:[n.jsx(pn,{className:"h-4 w-4 text-vibetune-text-muted"}),n.jsx(Ik,{placeholder:"Search following...",value:e,onChange:e=>r(e.target.value),className:"bg-vibetune-dark border-gray-600"})]})]}),n.jsx(tC,{children:n.jsxs("div",{className:"space-y-3",children:[g.map(e=>n.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-800 transition-colors",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsxs(AS,{children:[n.jsx(DS,{src:e.image_url}),n.jsx(PS,{children:e.display_name?.charAt(0).toUpperCase()})]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-white",children:e.display_name}),n.jsxs("p",{className:"text-xs text-vibetune-text-muted",children:[e.followers||0," followers"]})]})]}),n.jsxs(Qo,{variant:"outline",size:"sm",onClick:()=>v(e.id,!0),disabled:l.isPending,className:"border-gray-600 text-white hover:bg-gray-700",children:[n.jsx(kn,{className:"h-4 w-4 mr-1"}),"Unfollow"]})]},e.id)),0===g.length&&n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Sn,{className:"h-12 w-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-vibetune-text-muted",children:e?"No users found":"Not following anyone yet"})]})]})})]})}),n.jsx(kC,{value:"followers",className:"space-y-4",children:n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Followers"}),n.jsx(eC,{children:"People who follow you"})]}),n.jsx(tC,{children:n.jsxs("div",{className:"space-y-3",children:[u?.followers?.map(e=>n.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-800 transition-colors",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsxs(AS,{children:[n.jsx(DS,{src:e.image_url}),n.jsx(PS,{children:e.display_name?.charAt(0).toUpperCase()})]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-white",children:e.display_name}),n.jsxs("p",{className:"text-xs text-vibetune-text-muted",children:["Followed you ",p(e.followed_at||(new Date).toISOString())]})]})]}),n.jsxs(Qo,{variant:"outline",size:"sm",onClick:()=>v(e.id,!1),disabled:c.isPending,className:"border-vibetune-green text-vibetune-green hover:bg-vibetune-green hover:text-black",children:[n.jsx(Cn,{className:"h-4 w-4 mr-1"}),"Follow Back"]})]},e.id)),(!u?.followers||0===u.followers.length)&&n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Sn,{className:"h-12 w-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"No followers yet"})]})]})})]})}),n.jsx(kC,{value:"discover",className:"space-y-4",children:n.jsxs(Qk,{className:"bg-vibetune-gray border-gray-700",children:[n.jsxs(Jk,{children:[n.jsx(Zk,{className:"text-white",children:"Discover New Users"}),n.jsx(eC,{children:"Find new people to follow based on similar music taste"})]}),n.jsx(tC,{children:n.jsxs("div",{className:"text-center py-8",children:[n.jsx(pn,{className:"h-12 w-12 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"User discovery coming soon!"}),n.jsx("p",{className:"text-sm text-vibetune-text-muted mt-1",children:"We're working on recommendations based on your listening habits"})]})})]})})]})]})}function wE(){const{likedSongs:e,toggleLike:r,isLiked:a}=Nk(),{playTrack:i,currentTrack:o,isPlaying:s}=yk(),[u,c]=t.useState(null),{toast:l}=Ce(),d=async e=>{if(i)try{await i({id:e.id,title:e.title,artist:e.artist,albumArt:e.albumArt||"",duration:e.duration||0,url:e.url||"",spotifyId:e.spotifyId,previewUrl:e.previewUrl,isSpotifyTrack:e.isSpotifyTrack||!1,quality:e.quality||"medium"}),c(e.id),l({title:"🎵 Now Playing",description:`${e.title} by ${e.artist}`})}catch(t){l({title:"❌ Playback Error",description:"Could not play this track. Please try again.",variant:"destructive"})}};return 0===e.length?n.jsx("div",{className:"p-6",children:n.jsx("div",{className:"flex items-center justify-center h-96",children:n.jsxs("div",{className:"text-center",children:[n.jsx(qt,{className:"w-16 h-16 text-vibetune-text-muted mx-auto mb-4"}),n.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"No Liked Songs Yet"}),n.jsx("p",{className:"text-vibetune-text-muted mb-6",children:"Songs you like will appear here. Start exploring music and like your favorites!"}),n.jsx(Qo,{className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",onClick:()=>window.location.href="/search",children:"Discover Music"})]})})}):n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[n.jsx("div",{className:"w-48 h-48 bg-gradient-to-br from-purple-600 to-pink-600 rounded-lg flex items-center justify-center",children:n.jsx(qt,{className:"w-24 h-24 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm text-vibetune-text-muted uppercase tracking-wider mb-2",children:"Playlist"}),n.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"Liked Songs"}),n.jsxs("div",{className:"flex items-center space-x-2 text-vibetune-text-muted",children:[n.jsxs("span",{className:"font-medium text-white",children:[e.length," songs"]}),n.jsx("span",{children:"•"}),n.jsx("span",{children:"Your personal collection"})]})]})]}),n.jsx("div",{className:"flex items-center space-x-4",children:n.jsxs(Qo,{size:"lg",className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full px-8",onClick:()=>e.length>0&&d(e[0]),children:[n.jsx(on,{className:"w-6 h-6 mr-2"}),"Play"]})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-2 text-vibetune-text-muted text-sm border-b border-vibetune-gray/20",children:[n.jsx("div",{className:"col-span-1 text-center",children:"#"}),n.jsx("div",{className:"col-span-5",children:"Title"}),n.jsx("div",{className:"col-span-3",children:"Artist"}),n.jsx("div",{className:"col-span-2",children:"Date Added"}),n.jsx("div",{className:"col-span-1 text-right",children:n.jsx(Bt,{className:"w-4 h-4"})})]}),e.map((e,t)=>n.jsxs("div",{className:"grid grid-cols-12 gap-4 px-4 py-3 rounded-md hover:bg-vibetune-gray/40 transition-colors group cursor-pointer "+(u===e.id?"bg-vibetune-gray/20":""),onClick:()=>d(e),children:[n.jsxs("div",{className:"col-span-1 flex items-center justify-center",children:[u===e.id&&s?n.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:n.jsx("div",{className:"w-1 h-4 bg-vibetune-green animate-pulse"})}):n.jsx("span",{className:"text-vibetune-text-muted group-hover:hidden",children:t+1}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),d(e)},children:n.jsx(on,{className:"w-4 h-4 text-white"})})]}),n.jsxs("div",{className:"col-span-5 flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-vibetune-gray rounded-md overflow-hidden",children:n.jsx("img",{src:e.albumArt||"/placeholder.svg",alt:e.title,className:"w-full h-full object-cover"})}),n.jsx("div",{className:"min-w-0 flex-1",children:n.jsx("div",{className:"font-medium truncate "+(u===e.id?"text-vibetune-green":"text-white"),children:e.title})})]}),n.jsx("div",{className:"col-span-3 text-vibetune-text-muted truncate",children:e.artist}),n.jsx("div",{className:"col-span-2 text-vibetune-text-muted text-sm",children:e.dateAdded?new Date(e.dateAdded).toLocaleDateString():"Recently"}),n.jsxs("div",{className:"col-span-1 flex items-center justify-end space-x-2",children:[n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity "+(a(e.id)?"text-vibetune-green":"text-vibetune-text-muted hover:text-white"),onClick:t=>{t.stopPropagation(),(e=>{r(e),l({title:"❤️ Removed from Liked Songs",description:`${e.title} has been removed from your liked songs.`})})(e)},children:n.jsx(qt,{className:"w-4 h-4 "+(a(e.id)?"fill-current":"")})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsx(Ut,{className:"w-4 h-4 text-vibetune-text-muted"})})]})]},e.id))]})]})}yE.displayName=HS.displayName;const NE=t.forwardRef(({className:e,...t},r)=>n.jsx("textarea",{className:Nr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));function kE(){const{createPlaylist:e,addToPlaylist:r,removeFromPlaylist:a,playlists:i,deletePlaylist:o}=Nk(),{playTrack:s,currentTrack:u,isPlaying:c}=yk(),{toast:l}=Ce(),d=go(),[h,p]=t.useState("list"),[f,m]=t.useState(""),[v,g]=t.useState(""),[x,y]=t.useState(!1),[b,w]=t.useState(null),[N,k]=t.useState(""),[C,j]=t.useState([]),[S,E]=t.useState(!1),[R,_]=t.useState(!1),[I,T]=t.useState([]),[A,D]=t.useState(null),P=async()=>{if(f.trim()){y(!0);try{const t=e(f.trim(),v.trim());w(t.id),m(""),g(""),p("list"),l({title:"🎵 Playlist Created!",description:`"${t.name}" has been created successfully.`})}catch(t){l({title:"❌ Error",description:"Failed to create playlist. Please try again.",variant:"destructive"})}finally{y(!1)}}else l({title:"❌ Playlist Name Required",description:"Please enter a name for your playlist.",variant:"destructive"})},M=(e,t)=>{w(e),_(!0),l({title:"🎵 Adding to Playlist",description:`Adding songs to "${t}"`})},F=e=>e.tracks&&e.tracks.length>0?e.tracks[0].albumArt||"/placeholder.svg":null;return"create"===h?n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"max-w-4xl mx-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:b?"Edit Playlist":"Create New Playlist"}),n.jsx("p",{className:"text-vibetune-text-muted",children:b?"Modify your playlist details and songs":"Create your perfect music collection"})]}),n.jsx(Qo,{variant:"ghost",onClick:()=>p("list"),className:"text-vibetune-text-muted hover:text-white",children:"← Back to Playlists"})]}),n.jsx("div",{className:"bg-vibetune-gray/20 rounded-2xl p-8 mb-8",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-white mb-3",children:"Playlist Name *"}),n.jsx(Ik,{value:f,onChange:e=>m(e.target.value),placeholder:"Enter playlist name...",className:"bg-vibetune-dark border-vibetune-gray text-white placeholder:text-vibetune-text-muted h-12 text-lg"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-white mb-3",children:"Description"}),n.jsx(NE,{value:v,onChange:e=>g(e.target.value),placeholder:"Add a description (optional)...",rows:4,className:"bg-vibetune-dark border-vibetune-gray text-white placeholder:text-vibetune-text-muted"})]}),n.jsx(Qo,{onClick:P,disabled:x||!f.trim(),className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black h-12 px-8 text-lg font-semibold",children:x?"Creating...":b?"Update Playlist":"Create Playlist"})]}),n.jsx("div",{className:"flex items-center justify-center",children:n.jsx("div",{className:"w-64 h-64 bg-gradient-to-br from-vibetune-green/20 to-purple-600/20 rounded-2xl flex items-center justify-center border border-vibetune-gray/30",children:n.jsxs("div",{className:"text-center",children:[n.jsx(nn,{className:"w-16 h-16 text-vibetune-green mx-auto mb-4"}),n.jsx("div",{className:"text-white font-semibold text-lg mb-2",children:f||"Your Playlist"}),n.jsx("div",{className:"text-vibetune-text-muted text-sm",children:v||"No description yet"})]})})})]})})]})}):n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"max-w-6xl mx-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Your Playlists"}),n.jsx("p",{className:"text-vibetune-text-muted",children:"Manage and organize your music collections"})]}),n.jsxs(Qo,{onClick:()=>{p("create"),m(""),g(""),w(null)},className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black h-12 px-6",children:[n.jsx(sn,{className:"w-5 h-5 mr-2"}),"Create New Playlist"]})]}),0===i.length?n.jsx("div",{className:"flex items-center justify-center h-96",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-32 h-32 bg-vibetune-gray/20 rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(nn,{className:"w-16 h-16 text-vibetune-text-muted"})}),n.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"No Playlists Yet"}),n.jsx("p",{className:"text-vibetune-text-muted mb-6 max-w-md",children:"Create your first playlist to start organizing your favorite music and discover new songs."}),n.jsxs(Qo,{onClick:()=>p("create"),className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black",children:[n.jsx(sn,{className:"w-4 h-4 mr-2"}),"Create Your First Playlist"]})]})}):n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:i.map(e=>n.jsxs("div",{className:"group bg-vibetune-gray/20 rounded-xl p-6 hover:bg-vibetune-gray/30 transition-all duration-200 hover:scale-105",children:[n.jsxs("div",{className:"relative mb-4",children:[n.jsx("div",{className:"w-full aspect-square bg-gradient-to-br from-vibetune-green/20 to-purple-600/20 rounded-lg flex items-center justify-center border border-vibetune-gray/30 overflow-hidden",children:F(e)?n.jsx("img",{src:F(e),alt:e.name,className:"w-full h-full object-cover"}):n.jsx(nn,{className:"w-12 h-12 text-vibetune-green"})}),n.jsxs("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-2",children:[n.jsx(Qo,{size:"sm",className:"w-10 h-10 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full shadow-lg",onClick:()=>M(e.id,e.name),title:"Add Songs",children:n.jsx(sn,{className:"w-4 h-4"})}),e.tracks.length>0&&n.jsx(Qo,{size:"sm",className:"w-10 h-10 bg-vibetune-green hover:bg-vibetune-green-dark text-black rounded-full shadow-lg",onClick:()=>(async e=>{if(s)try{await s({id:e.id,title:e.title,artist:e.artist,albumArt:e.albumArt||"",duration:e.duration||0,url:e.url||"",spotifyId:e.spotifyId,previewUrl:e.previewUrl,isSpotifyTrack:e.isSpotifyTrack||!1,quality:e.quality||"medium"}),D(e.id)}catch(t){l({title:"❌ Playback Error",description:"Could not play this track. Please try again.",variant:"destructive"})}})(e.tracks[0]),title:"Play",children:n.jsx(on,{className:"w-4 h-4 ml-0.5"})})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("h3",{className:"text-white font-semibold text-lg mb-1 truncate",children:e.name}),n.jsx("p",{className:"text-vibetune-text-muted text-sm mb-2 line-clamp-2",children:e.description||"No description"}),n.jsxs("p",{className:"text-vibetune-text-muted text-xs",children:[e.tracks.length," songs • Created ",new Date(e.createdAt).toLocaleDateString()]})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsxs(Qo,{variant:"ghost",size:"sm",onClick:()=>M(e.id,e.name),className:"flex-1 text-vibetune-green hover:text-white hover:bg-vibetune-green/20",children:[n.jsx(sn,{className:"w-4 h-4 mr-1"}),"Add"]}),n.jsxs(Qo,{variant:"ghost",size:"sm",onClick:()=>{return t=e.id,void d(`/playlist/${t}`);var t},className:"flex-1 text-vibetune-text-muted hover:text-white hover:bg-vibetune-gray/40",children:[n.jsx(Vt,{className:"w-4 h-4 mr-1"}),"View"]}),n.jsxs(Qo,{variant:"ghost",size:"sm",onClick:()=>(e=>{w(e),p("create");const t=i.find(t=>t.id===e);t&&(m(t.name),g(t.description||""),T(t.tracks||[]))})(e.id),className:"flex-1 text-vibetune-text-muted hover:text-white hover:bg-vibetune-gray/40",children:[n.jsx(an,{className:"w-4 h-4 mr-1"}),"Edit"]}),n.jsx(Qo,{variant:"ghost",size:"sm",onClick:()=>{return t=e.id,n=e.name,o(t),void l({title:"🗑️ Playlist Deleted",description:`"${n}" has been deleted.`});var t,n},className:"text-red-400 hover:text-red-300 hover:bg-red-500/20",children:n.jsx(wn,{className:"w-4 h-4"})})]})]},e.id))}),n.jsx(os,{open:R,onOpenChange:_,children:n.jsxs(ls,{className:"max-w-2xl bg-vibetune-dark border-vibetune-gray text-white",children:[n.jsx(ds,{children:n.jsxs(hs,{className:"text-white",children:['Add Songs to "',i.find(e=>e.id===b)?.name||"Playlist",'"']})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx(pn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-vibetune-text-muted w-4 h-4"}),n.jsx(Ik,{value:N,onChange:e=>{k(e.target.value),(async e=>{if(e.trim()){E(!0);try{const t=await Sk.search(e.trim());j(t.tracks?.items||[])}catch(t){j([])}finally{E(!1)}}else j([])})(e.target.value)},placeholder:"Search for songs...",className:"pl-10 bg-vibetune-gray border-vibetune-gray text-white placeholder:text-vibetune-text-muted"})]}),S&&n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"w-6 h-6 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin"})}),C.length>0&&n.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:C.map(e=>{return n.jsxs("div",{className:"flex items-center space-x-3 p-3 hover:bg-vibetune-gray/40 rounded-md cursor-pointer transition-colors",onClick:()=>(async e=>{if(b)try{const t={id:e.id,title:e.name,artist:e.artists.map(e=>e.name).join(", "),albumArt:e.album.images?.[0]?.url||"",duration:e.duration_ms,url:e.preview_url||e.external_urls?.spotify||"",spotifyId:e.id,previewUrl:e.preview_url,isSpotifyTrack:!0,quality:"high",dateAdded:(new Date).toISOString()};r(b,t),T(e=>[...e,t]),l({title:"🎵 Song Added!",description:`"${e.name}" has been added to your playlist.`}),_(!1),k(""),j([]),w(null)}catch(t){l({title:"❌ Error",description:"Failed to add song. Please try again.",variant:"destructive"})}else l({title:"❌ No Playlist Selected",description:"Please create a playlist first.",variant:"destructive"})})(e),children:[n.jsx("img",{src:e.album.images?.[0]?.url||"/placeholder.svg",alt:e.album.name,className:"w-12 h-12 rounded-md object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-white font-medium truncate",children:e.name}),n.jsx("div",{className:"text-vibetune-text-muted text-sm truncate",children:e.artists.map(e=>e.name).join(", ")})]}),n.jsx("div",{className:"text-vibetune-text-muted text-sm",children:(t=e.duration_ms,`${Math.floor(t/6e4)}:${Math.floor(t%6e4/1e3).toString().padStart(2,"0")}`)}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 text-vibetune-green hover:text-white",children:n.jsx(sn,{className:"w-4 h-4"})})]},e.id);var t})}),N&&!S&&0===C.length&&n.jsxs("div",{className:"text-center py-8 text-vibetune-text-muted",children:['No songs found for "',N,'"']})]})]})})]})})}function CE(){const{id:e}=xo(),r=go(),[a,i]=t.useState(null),[o,s]=t.useState([]),[u,c]=t.useState(!0),{playTrack:l}=yk(),{toggleLike:d,isLiked:h}=Nk(),{toast:p}=Ce();t.useEffect(()=>{(async()=>{if(e)try{c(!0);const[t,n]=await Promise.all([Sk.getArtist(e),Sk.getArtistTopTracks(e,"US")]);i(t),s(n.tracks||[])}catch(t){p({title:"❌ Error",description:"Failed to load artist. Please try again.",variant:"destructive"})}finally{c(!1)}})()},[e,p]);const f=async e=>{try{const t={id:e.id,title:e.name,artist:e.artists.map(e=>e.name).join(", "),image:e.album.images[0]?.url||"/placeholder.svg",previewUrl:e.preview_url,duration:e.duration_ms,url:e.external_urls.spotify,isSpotifyTrack:!0,spotifyId:e.id};await l(t),p({title:"🎵 Now Playing",description:`${e.name} by ${e.artists.map(e=>e.name).join(", ")}`})}catch(t){p({title:"❌ Error",description:"Failed to play track. Please try again.",variant:"destructive"})}};return u?n.jsx("div",{className:"p-6 bg-gradient-to-b from-vibetune-gray/20 to-vibetune-dark min-h-screen",children:n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("div",{className:"text-white text-lg",children:"Loading artist..."})})}):a?n.jsxs("div",{className:"p-6 bg-gradient-to-b from-vibetune-gray/20 to-vibetune-dark min-h-screen",children:[n.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[n.jsx(Qo,{variant:"ghost",size:"sm",onClick:()=>r(-1),className:"text-vibetune-text-muted hover:text-white",children:n.jsx(kt,{className:"w-5 h-5"})}),n.jsx("h1",{className:"text-2xl font-bold text-white",children:"Artist"})]}),n.jsxs("div",{className:"flex flex-col md:flex-row gap-6 mb-8",children:[n.jsx("div",{className:"flex-shrink-0",children:a.images?.[0]?.url?n.jsx("img",{src:a.images[0].url,alt:a.name,className:"w-48 h-48 md:w-64 md:h-64 object-cover rounded-lg shadow-lg"}):n.jsx("div",{className:"w-48 h-48 md:w-64 md:h-64 rounded-lg bg-gradient-to-br from-violet-600 to-fuchsia-600 flex items-center justify-center shadow-lg",children:n.jsx(nn,{className:"w-16 h-16 text-white"})})}),n.jsxs("div",{className:"flex-1 flex flex-col justify-end",children:[n.jsx("h2",{className:"text-4xl md:text-6xl font-bold text-white mb-4",children:a.name}),a.followers&&n.jsxs("p",{className:"text-vibetune-text-muted text-lg mb-2",children:[a.followers.total.toLocaleString()," followers"]}),a.genres&&a.genres.length>0&&n.jsx("p",{className:"text-vibetune-text-muted text-sm mb-4",children:a.genres.slice(0,3).join(" • ")}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(Qo,{onClick:async()=>{if(0!==o.length)try{await f(o[0]),p({title:"🎵 Playing Artist",description:`Starting ${a?.name}...`})}catch(e){p({title:"❌ Error",description:"Failed to play artist. Please try again.",variant:"destructive"})}},className:"bg-vibetune-green hover:bg-vibetune-green-dark text-black font-semibold px-8 py-3 rounded-full",children:[n.jsx(on,{className:"w-5 h-5 mr-2"}),"Play"]}),n.jsxs(Qo,{variant:"outline",className:"border-vibetune-text-muted text-vibetune-text-muted hover:text-white hover:border-white px-6 py-3 rounded-full",children:[n.jsx(qt,{className:"w-5 h-5 mr-2"}),"Follow"]})]})]})]}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"Popular Tracks"}),n.jsx("div",{className:"space-y-2",children:o.map((e,t)=>{return n.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg hover:bg-vibetune-gray/30 transition-colors group cursor-pointer",onClick:()=>f(e),children:[n.jsx("div",{className:"w-8 text-vibetune-text-muted text-sm font-medium",children:t+1}),n.jsxs("div",{className:"flex-1 flex items-center gap-4",children:[n.jsx("div",{className:"w-12 h-12 flex-shrink-0",children:e.album.images[0]?.url?n.jsx("img",{src:e.album.images[0].url,alt:e.album.name,className:"w-full h-full object-cover rounded"}):n.jsx("div",{className:"w-full h-full bg-gradient-to-br from-violet-600 to-fuchsia-600 rounded flex items-center justify-center",children:n.jsx(nn,{className:"w-4 h-4 text-white"})})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"font-medium text-white truncate",children:e.name}),n.jsx("p",{className:"text-sm text-vibetune-text-muted truncate",children:e.artists.map(e=>e.name).join(", ")})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm text-vibetune-text-muted",children:(r=e.duration_ms,`${Math.floor(r/6e4)}:${Math.floor(r%6e4/1e3).toString().padStart(2,"0")}`)}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity text-vibetune-text-muted hover:text-white",onClick:t=>{t.stopPropagation(),f(e)},children:n.jsx(on,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity text-vibetune-text-muted hover:text-white",onClick:e=>{e.stopPropagation()},children:n.jsx(qt,{className:"w-4 h-4"})}),n.jsx(Qo,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity text-vibetune-text-muted hover:text-white",children:n.jsx(Ut,{className:"w-4 h-4"})})]})]},e.id);var r})})]})]}):n.jsx("div",{className:"p-6 bg-gradient-to-b from-vibetune-gray/20 to-vibetune-dark min-h-screen",children:n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("div",{className:"text-white text-lg",children:"Artist not found"})})})}NE.displayName="Textarea";const jE=new class{#q;#m;#l;#G;#K;#$;#X;#Y;constructor(e={}){this.#q=e.queryCache||new oi,this.#m=e.mutationCache||new ui,this.#l=e.defaultOptions||{},this.#G=new Map,this.#K=new Map,this.#$=0}mount(){this.#$++,1===this.#$&&(this.#X=$a.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#q.onFocus())}),this.#Y=Xa.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#q.onOnline())}))}unmount(){this.#$--,0===this.#$&&(this.#X?.(),this.#X=void 0,this.#Y?.(),this.#Y=void 0)}isFetching(e){return this.#q.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#m.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#q.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=this.#q.build(this,t),r=n.state.data;return void 0===r?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Ia(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return this.#q.findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),a=this.#q.get(r.queryHash),i=a?.state.data,o=function(e,t){return"function"==typeof e?e(t):e}(t,i);if(void 0!==o)return this.#q.build(this,r).setData(o,{...n,manual:!0})}setQueriesData(e,t,n){return ni.batch(()=>this.#q.findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,n)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#q.get(t.queryHash)?.state}removeQueries(e){const t=this.#q;ni.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const n=this.#q;return ni.batch(()=>(n.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=ni.batch(()=>this.#q.findAll(e).map(e=>e.cancel(n)));return Promise.all(r).then(Ea).catch(Ea)}invalidateQueries(e,t={}){return ni.batch(()=>(this.#q.findAll(e).forEach(e=>{e.invalidate()}),"none"===e?.refetchType?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=ni.batch(()=>this.#q.findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,n);return n.throwOnError||(t=t.catch(Ea)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(r).then(Ea)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const n=this.#q.build(this,t);return n.isStaleByTime(Ia(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Ea).catch(Ea)}fetchInfiniteQuery(e){return e.behavior=li(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Ea).catch(Ea)}ensureInfiniteQueryData(e){return e.behavior=li(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Xa.isOnline()?this.#m.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#q}getMutationCache(){return this.#m}getDefaultOptions(){return this.#l}setDefaultOptions(e){this.#l=e}setQueryDefaults(e,t){this.#G.set(Ma(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#G.values()],n={};return t.forEach(t=>{Fa(e,t.queryKey)&&Object.assign(n,t.defaultOptions)}),n}setMutationDefaults(e,t){this.#K.set(Ma(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#K.values()],n={};return t.forEach(t=>{Fa(e,t.mutationKey)&&Object.assign(n,t.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#l.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=Pa(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===qa&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#l.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#q.clear(),this.#m.clear()}};function SE(){return n.jsx("div",{className:"h-screen bg-vibetune-dark flex items-center justify-center",children:n.jsx("div",{className:"w-8 h-8 border-2 border-vibetune-green border-t-transparent rounded-full animate-spin"})})}function EE({children:e}){return n.jsxs("div",{className:"h-screen bg-vibetune-dark text-white overflow-hidden",children:[n.jsxs("div",{className:"flex h-full",children:[n.jsx(Xo,{}),n.jsxs("div",{className:"flex-1 flex flex-col",children:[n.jsx(ON,{}),n.jsx("main",{className:"flex-1 overflow-y-auto pb-24",children:e})]})]}),n.jsx(jk,{})]})}function RE(){const{isLoading:e}=is();return e?n.jsx(SE,{}):n.jsxs(To,{children:[n.jsx(_o,{path:"/callback",element:n.jsx(Yk,{})}),n.jsx(_o,{path:"/login",element:n.jsx(Fk,{})}),n.jsx(_o,{path:"/signup",element:n.jsx(Uk,{})}),n.jsx(_o,{path:"/",element:n.jsx(EE,{children:n.jsx(Rk,{})})}),n.jsx(_o,{path:"/search",element:n.jsx(EE,{children:n.jsx(Dk,{})})}),n.jsx(_o,{path:"/library",element:n.jsx(EE,{children:n.jsx(Pk,{})})}),n.jsx(_o,{path:"/profile",element:n.jsx(EE,{children:n.jsx(Wk,{})})}),n.jsx(_o,{path:"/webcam",element:n.jsx(EE,{children:n.jsx(Kk,{})})}),n.jsx(_o,{path:"/camera-test",element:n.jsx(EE,{children:n.jsx($k,{})})}),n.jsx(_o,{path:"/face-profiles",element:n.jsx(EE,{children:n.jsx(Xk,{})})}),n.jsx(_o,{path:"/playlist/:id",element:n.jsx(EE,{children:n.jsx(Mk,{})})}),n.jsx(_o,{path:"/artist/:id",element:n.jsx(EE,{children:n.jsx(CE,{})})}),n.jsx(_o,{path:"/create-playlist",element:n.jsx(EE,{children:n.jsx(kE,{})})}),n.jsx(_o,{path:"/liked",element:n.jsx(EE,{children:n.jsx(wE,{})})}),n.jsx(_o,{path:"/downloaded",element:n.jsx(EE,{children:n.jsx(Mk,{})})}),n.jsx(_o,{path:"/analytics",element:n.jsx(EE,{children:n.jsx(mS,{})})}),n.jsx(_o,{path:"/social",element:n.jsx(EE,{children:n.jsx(bE,{})})}),n.jsx(_o,{path:"*",element:n.jsx(_k,{})})]})}const _E=()=>n.jsx(wi,{client:jE,children:n.jsxs(Ca,{children:[n.jsx(Ir,{}),n.jsx(Zr,{}),n.jsx(Oo,{children:n.jsx(as,{children:n.jsx(kk,{children:n.jsx(bk,{children:n.jsx(RE,{})})})})})]})});me.createRoot(document.getElementById("root")).render(n.jsx(_E,{}))}},function(){return ge||(0,ve[e(ve)[0]])((ge={exports:{}}).exports,ge),ge.exports});export default xe();
